{%- if section.settings.show_bar -%}
  {%- liquid
    assign sid = section.id
    assign se_stts = section.settings
    assign bar_text = se_stts.text
    assign bar_link = se_stts.link_url
    assign bg_color = se_stts.bg_color
    assign text_color = se_stts.text_color
    assign dismissible = se_stts.dismissible
  -%}

  {%- style -%}
    .t4s-announcement-custom-{{ sid }} {
      position: relative;
      display: flex;
      align-items: center;
      justify-content: center;
      min-height: {{ se_stts.height }}px;
      padding: 8px 40px;
      background-color: {{ bg_color }};
      color: {{ text_color }};
      font-size: {{ se_stts.font_size }}px;
      line-height: 1.4;
      text-align: center;
      transition: max-height 0.3s ease, opacity 0.3s ease, padding 0.3s ease;
      overflow: hidden;
    }
    .t4s-announcement-custom-{{ sid }} a {
      color: {{ text_color }};
      text-decoration: underline;
      text-underline-offset: 2px;
    }
    .t4s-announcement-custom-{{ sid }} a:hover {
      opacity: 0.8;
    }
    .t4s-announcement-custom-{{ sid }}__dismiss {
      position: absolute;
      right: 12px;
      top: 50%;
      transform: translateY(-50%);
      background: transparent;
      border: none;
      color: {{ text_color }};
      cursor: pointer;
      padding: 4px;
      line-height: 1;
      transition: opacity 0.2s;
      z-index: 2;
    }
    .t4s-announcement-custom-{{ sid }}__dismiss:hover {
      opacity: 0.7;
    }
    .t4s-announcement-custom-{{ sid }}__dismiss svg {
      width: 14px;
      height: 14px;
      stroke-width: 2px;
    }
    .t4s-announcement-custom-{{ sid }}.is-hidden {
      max-height: 0;
      opacity: 0;
      padding-top: 0;
      padding-bottom: 0;
      min-height: 0;
      pointer-events: none;
    }
  {%- endstyle -%}

  <div
    id="t4s-announcement-custom-{{ sid }}"
    class="t4s-announcement-custom-{{ sid }}"
    role="region"
    aria-label="{{ 'sections.announcement.announcement' | t | default: 'Announcement' }}"
  >
    {%- if bar_text != blank -%}
      <div class="t4s-announcement-custom__content">
        {%- if bar_link != blank -%}
          <a href="{{ bar_link }}">{{ bar_text }}</a>
        {%- else -%}
          <p style="margin: 0;">{{ bar_text }}</p>
        {%- endif -%}
      </div>
    {%- endif -%}

    {%- if dismissible -%}
      <button
        class="t4s-announcement-custom-{{ sid }}__dismiss"
        type="button"
        aria-label="{{ 'sections.announcement.close' | t | default: 'Close announcement' }}"
        onclick="(function(btn){
          var bar = document.getElementById('t4s-announcement-custom-{{ sid }}');
          bar.classList.add('is-hidden');
          bar.setAttribute('aria-hidden', 'true');
          try { document.cookie = 't4s_ab_custom_{{ sid }}=dismissed;path=/;max-age=' + ({{ se_stts.dismiss_days }} * 86400); } catch(e) {}
        })(this)"
      >
        <svg role="presentation" viewBox="0 0 16 14" fill="none" stroke="currentColor">
          <path d="M15 0L1 14m14 0L1 0" fill="none" fill-rule="evenodd"></path>
        </svg>
      </button>
    {%- endif -%}
  </div>

  {%- if dismissible -%}
    <script>
      (function(){
        try {
          if (document.cookie.indexOf('t4s_ab_custom_{{ sid }}=dismissed') > -1) {
            var el = document.getElementById('t4s-announcement-custom-{{ sid }}');
            if (el) {
              el.classList.add('is-hidden');
              el.setAttribute('aria-hidden', 'true');
            }
          }
        } catch(e) {}
      })();
    </script>
  {%- endif -%}

{%- else -%}
  <script>
    try {
      if (window.Shopify && !Shopify.designMode) {
        document.getElementById('shopify-section-{{ section.id }}').remove();
      } else {
        document.getElementById('shopify-section-{{ section.id }}').setAttribute('aria-hidden', true);
      }
    } catch(e) {}
  </script>
{%- endif -%}

{% schema %}
{
  "name": "Announcement bar custom",
  "tag": "section",
  "class": "t4s-section t4s-section-announcement-custom",
  "settings": [
    {
      "type": "checkbox",
      "id": "show_bar",
      "label": "Show announcement bar",
      "default": true
    },
    {
      "type": "textarea",
      "id": "text",
      "label": "Announcement text",
      "default": "Free shipping on all orders over $50!"
    },
    {
      "type": "url",
      "id": "link_url",
      "label": "Link URL"
    },
    {
      "type": "color",
      "id": "bg_color",
      "label": "Background color",
      "default": "#e91e63"
    },
    {
      "type": "color",
      "id": "text_color",
      "label": "Text color",
      "default": "#ffffff"
    },
    {
      "type": "range",
      "id": "height",
      "label": "Min height",
      "default": 40,
      "min": 20,
      "max": 80,
      "step": 2,
      "unit": "px"
    },
    {
      "type": "range",
      "id": "font_size",
      "label": "Font size",
      "default": 13,
      "min": 10,
      "max": 20,
      "step": 1,
      "unit": "px"
    },
    {
      "type": "header",
      "content": "Dismiss options"
    },
    {
      "type": "checkbox",
      "id": "dismissible",
      "label": "Allow customers to dismiss",
      "default": true
    },
    {
      "type": "range",
      "id": "dismiss_days",
      "label": "Remember dismissal for",
      "info": "Number of days before the bar reappears after dismissal",
      "default": 7,
      "min": 1,
      "max": 90,
      "step": 1,
      "unit": "day"
    }
  ],
  "presets": [
    {
      "name": "Announcement bar custom",
      "category": "Header"
    }
  ]
}
{% endschema %}
