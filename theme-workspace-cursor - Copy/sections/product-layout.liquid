{% comment %}
  Product Layout Section (Modular Architecture)

  Establishes a CSS Grid layout for the modular product page template.
  Must be FIRST in the template section order. Renders no visible content —
  it outputs the grid CSS and the variant-sync communication bridge.

  How it works:
  In Shopify JSON templates, sections render as independent sibling elements
  inside a parent container. This section:
  1. Runs an inline script that tags the parent container with a grid class
  2. Outputs CSS Grid rules that position sibling sections by their schema class names
  3. Renders the variant-sync snippet for cross-section communication

  Desktop grid:
  ┌──────────────────────────────────────┐
  │       breadcrumb (full width)        │
  ├──────────────────┬───────────────────┤
  │                  │    description    │
  │     gallery      ├───────────────────┤
  │    (spans 3      │     variants      │
  │     info rows)   ├───────────────────┤
  │                  │    add to cart    │
  ├──────────────────┴───────────────────┤
  │    related products (full width)     │
  └──────────────────────────────────────┘

  Mobile: all sections stack vertically.
{% endcomment %}

{%- liquid
  assign se_stts = section.settings
  assign is_stacked = false

  case se_stts.media_column_size
    when 'small'
      assign gallery_fr = '4fr'
      assign info_fr = '8fr'
    when 'large'
      assign gallery_fr = '7fr'
      assign info_fr = '5fr'
    when 'full'
      assign gallery_fr = '1fr'
      assign info_fr = '0fr'
      assign is_stacked = true
    else
      assign gallery_fr = '1fr'
      assign info_fr = '1fr'
  endcase

  case se_stts.layout
    when 'wide'
      assign max_width = '1600px'
    when 'full'
      assign max_width = '100%'
    else
      assign max_width = '1200px'
  endcase
-%}

<script>
  (function () {
    var s = document.currentScript;
    if (!s) return;
    var section = s.parentElement;
    var container = section ? section.parentElement : null;
    if (container) container.classList.add('t4s-product-grid-container');
  })();
</script>

{%- style -%}
  .t4s-product-grid-container {
    display: grid;
    grid-template-columns: {{ gallery_fr }} {{ info_fr }};
    column-gap: {{ se_stts.column_gap | default: 30 }}px;
    row-gap: 0;
    max-width: {{ max_width }};
    margin: 0 auto;
    padding: 0 15px;
  }

  .t4s-product-grid-container > .t4s-product-modular {
    display: none;
  }

  .t4s-product-grid-container > .shopify-section {
    grid-column: 1 / -1;
    min-width: 0;
  }

  {%- unless is_stacked -%}
    .t4s-product-grid-container > .t4s-section-product-gallery {
      grid-column: 1 / 2;
      grid-row: span 3;
      align-self: start;
    }

    .t4s-product-grid-container > .t4s-section-product-description,
    .t4s-product-grid-container > .t4s-section-product-variants,
    .t4s-product-grid-container > .t4s-section-product-atc {
      grid-column: 2 / 3;
      align-self: start;
    }
  {%- endunless -%}

  {%- if se_stts.sticky_info and is_stacked == false -%}
    .t4s-product-grid-container > .t4s-section-product-description,
    .t4s-product-grid-container > .t4s-section-product-variants,
    .t4s-product-grid-container > .t4s-section-product-atc {
      position: sticky;
      top: 20px;
    }
  {%- endif -%}

  @media (max-width: 767px) {
    .t4s-product-grid-container {
      grid-template-columns: 1fr !important;
    }
    .t4s-product-grid-container > .shopify-section,
    .t4s-product-grid-container > .t4s-section-product-gallery,
    .t4s-product-grid-container > .t4s-section-product-description,
    .t4s-product-grid-container > .t4s-section-product-variants,
    .t4s-product-grid-container > .t4s-section-product-atc {
      grid-column: 1 / -1 !important;
      grid-row: auto !important;
      position: static !important;
    }
  }
{%- endstyle -%}

{% render 'product-variant-sync' %}

{% schema %}
{
  "name": "Product layout",
  "tag": "section",
  "class": "t4s-section t4s-product-modular",
  "settings": [
    {
      "type": "select",
      "id": "layout",
      "label": "Page layout",
      "default": "default",
      "options": [
        { "value": "default", "label": "Default (1200px)" },
        { "value": "wide", "label": "Wide (1600px)" },
        { "value": "full", "label": "Full width" }
      ]
    },
    {
      "type": "select",
      "id": "media_column_size",
      "label": "Media column size",
      "default": "medium",
      "info": "Controls the gallery vs info column split",
      "options": [
        { "value": "small", "label": "Small (4/12)" },
        { "value": "medium", "label": "Medium (6/12)" },
        { "value": "large", "label": "Large (7/12)" },
        { "value": "full", "label": "Full width (stacked)" }
      ]
    },
    {
      "type": "range",
      "id": "column_gap",
      "min": 0,
      "max": 60,
      "step": 5,
      "label": "Column gap",
      "unit": "px",
      "default": 30
    },
    {
      "type": "checkbox",
      "id": "sticky_info",
      "label": "Sticky product info on scroll",
      "default": false
    }
  ],
  "presets": [
    {
      "name": "Product layout"
    }
  ]
}
{% endschema %}
