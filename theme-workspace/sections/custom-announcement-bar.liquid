{%- liquid
  assign se_stts = section.settings
  assign bg_color = se_stts.bg_color
  assign text_color = se_stts.text_color
  assign text_content = se_stts.text
  assign link_url = se_stts.link_url
  assign dismissible = se_stts.dismissible
  assign font_size = se_stts.font_size
  assign bar_padding = se_stts.bar_padding
-%}

{%- if text_content != blank -%}
  {%- style -%}
    #t4s-custom-announcement-{{ section.id }} {
      background-color: {{ bg_color }};
      color: {{ text_color }};
      font-size: {{ font_size }}px;
      padding: {{ bar_padding }}px 20px;
      text-align: center;
      position: relative;
      z-index: 10;
    }
    #t4s-custom-announcement-{{ section.id }} a {
      color: {{ text_color }};
      text-decoration: underline;
      text-underline-offset: 2px;
    }
    #t4s-custom-announcement-{{ section.id }} a:hover {
      opacity: 0.8;
    }
    #t4s-custom-announcement-{{ section.id }} .t4s-custom-ann__close {
      position: absolute;
      right: 12px;
      top: 50%;
      transform: translateY(-50%);
      background: transparent;
      border: none;
      color: {{ text_color }};
      cursor: pointer;
      padding: 4px;
      line-height: 1;
      transition: opacity 0.2s;
    }
    #t4s-custom-announcement-{{ section.id }} .t4s-custom-ann__close:hover {
      opacity: 0.6;
    }
    #t4s-custom-announcement-{{ section.id }} .t4s-custom-ann__close svg {
      width: 14px;
      height: 14px;
    }
    #t4s-custom-announcement-{{ section.id }}.t4s-hidden {
      display: none;
    }
    @media (max-width: 749px) {
      #t4s-custom-announcement-{{ section.id }} {
        font-size: {{ font_size | minus: 1 }}px;
        padding: {{ bar_padding | minus: 2 }}px 14px;
      }
    }
  {%- endstyle -%}

  <div
    id="t4s-custom-announcement-{{ section.id }}"
    role="region"
    aria-label="{{ 'sections.announcement.label' | t | default: 'Announcement' }}"
  >
    <div class="t4s-container" style="position:relative;">
      {%- if link_url != blank -%}
        <a href="{{ link_url }}">{{ text_content }}</a>
      {%- else -%}
        <span>{{ text_content }}</span>
      {%- endif -%}

      {%- if dismissible -%}
        <button
          class="t4s-custom-ann__close"
          aria-label="{{ 'sections.announcement.close' | t | default: 'Dismiss announcement' }}"
          data-dismiss-custom-ann="{{ section.id }}"
        >
          <svg viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
            <path d="M2 2l12 12M14 2L2 14"></path>
          </svg>
        </button>
      {%- endif -%}
    </div>
  </div>

  {%- if dismissible -%}
    <script>
      (function() {
        var sectionId = {{ section.id | json }};
        var storageKey = 't4s_custom_ann_dismissed_' + sectionId;
        var el = document.getElementById('t4s-custom-announcement-' + sectionId);
        if (!el) return;

        if (localStorage.getItem(storageKey) === 'true') {
          el.classList.add('t4s-hidden');
          el.setAttribute('aria-hidden', 'true');
          return;
        }

        var btn = el.querySelector('[data-dismiss-custom-ann]');
        if (btn) {
          btn.addEventListener('click', function() {
            el.classList.add('t4s-hidden');
            el.setAttribute('aria-hidden', 'true');
            localStorage.setItem(storageKey, 'true');
          });
        }
      })();
    </script>
  {%- endif -%}
{%- endif -%}

{% schema %}
{
  "name": "Custom announcement bar",
  "tag": "section",
  "class": "t4s-section t4s-section-custom-announcement-bar",
  "settings": [
    {
      "type": "text",
      "id": "text",
      "label": "Announcement text",
      "default": "Free shipping on orders over $50!"
    },
    {
      "type": "url",
      "id": "link_url",
      "label": "Link URL",
      "info": "Optional. Wraps the announcement text in a clickable link."
    },
    {
      "type": "color",
      "id": "bg_color",
      "label": "Background color",
      "default": "#1a1a1a"
    },
    {
      "type": "color",
      "id": "text_color",
      "label": "Text color",
      "default": "#ffffff"
    },
    {
      "type": "range",
      "id": "font_size",
      "label": "Font size",
      "default": 13,
      "min": 10,
      "max": 22,
      "step": 1,
      "unit": "px"
    },
    {
      "type": "range",
      "id": "bar_padding",
      "label": "Vertical padding",
      "default": 10,
      "min": 4,
      "max": 24,
      "step": 2,
      "unit": "px"
    },
    {
      "type": "checkbox",
      "id": "dismissible",
      "label": "Allow visitors to dismiss",
      "info": "Adds a close button. Dismissed state is saved in the browser.",
      "default": true
    }
  ],
  "presets": [
    {
      "name": "Custom announcement bar",
      "category": "group8"
    }
  ]
}
{% endschema %}
