{
  "timestamp": "2026-02-27T07:11:28.450Z",
  "projectId": "838e7498-6dc5-4268-9fcd-e6f6148f65ad",
  "scenario": "restock-badge-lengths",
  "prompt": "On the product page template, update product-form-dynamic so out-of-stock color swatches with \"Awaiting Restock\" also show a second line listing available longer lengths for that color. Implement all three layers in one pass: (1) Liquid markup in snippets/product-form-dynamic.liquid, (2) styling in assets/product-form-dynamic.css, and (3) behavior/data handling in assets/product-form-dynamic.js. The length list must come from variant option1 availability and must exclude any lengths present in the product metafield list custom_values. Ensure text contrast is background-aware over swatch images.",
  "totalRuns": 1,
  "results": [
    {
      "run": 1,
      "passed": true,
      "reason": "Applied required files (3/3) in 21 tool calls",
      "metrics": {
        "totalToolCalls": 21,
        "editToolCalls": 8,
        "readToolCalls": 12,
        "searchToolCalls": 0,
        "elapsedMs": 249936,
        "costCents": 0,
        "inputTokens": 0,
        "outputTokens": 0
      },
      "tier": "COMPLEX",
      "strategy": "GOD_MODE",
      "changedFiles": [
        "snippets/product-form-dynamic.liquid",
        "assets/product-form-dynamic.js",
        "assets/product-form-dynamic.css",
        "product-form-dynamic.liquid"
      ],
      "transcript": {
        "runId": "run-1",
        "scenario": "restock-badge-lengths",
        "decisions": [
          {
            "phase": "analyzing",
            "label": "Loading context...",
            "timestamp": 0
          },
          {
            "phase": "analyzing",
            "label": "Context ready",
            "detail": "606 files, 5 prefs",
            "timestamp": 0
          },
          {
            "phase": "analyzing",
            "label": "Building context...",
            "timestamp": 0
          },
          {
            "phase": "analyzing",
            "label": "Classifying request...",
            "timestamp": 0
          },
          {
            "phase": "analyzing",
            "label": "Preparing file context...",
            "timestamp": 0
          },
          {
            "phase": "analyzing",
            "label": "Building structural brief...",
            "timestamp": 0
          },
          {
            "phase": "analyzing",
            "label": "Starting agent...",
            "timestamp": 0
          },
          {
            "phase": "strategy",
            "label": "Strategy: GOD_MODE",
            "detail": "strategy=GOD_MODE, tier=COMPLEX",
            "timestamp": 0
          },
          {
            "phase": "analyzing",
            "label": "COMPLEX tier — GOD_MODE strategy — claude-sonnet-4-6",
            "detail": "routingTier=COMPLEX, strategy=GOD_MODE",
            "timestamp": 0
          },
          {
            "phase": "analyzing",
            "label": "Style profile loaded",
            "detail": "styleProfileRules=8, designTokenCount=0, patternConflictResolutions=0, referenceSectionsLoaded=0, cssPreloaded=false, snippetConsumers=0",
            "timestamp": 0
          }
        ],
        "toolSequence": [
          {
            "name": "read_lines",
            "id": "toolu_019Ea6LHSt1RKttpSh1LhS2p",
            "input": {
              "filePath": "snippets/product-form-dynamic.liquid",
              "ranges": [
                {
                  "startLine": 1,
                  "endLine": 10
                },
                {
                  "startLine": 180,
                  "endLine": 270
                },
                {
                  "startLine": 630,
                  "endLine": 700
                }
              ]
            },
            "result": "",
            "isError": false,
            "elapsedMs": 0
          },
          {
            "name": "read_lines",
            "id": "toolu_01XqAfHHJEkW4PSvdUPXAwRp",
            "input": {
              "filePath": "assets/product-form-dynamic.js",
              "ranges": [
                {
                  "startLine": 651,
                  "endLine": 830
                },
                {
                  "startLine": 830,
                  "endLine": 960
                }
              ]
            },
            "result": "",
            "isError": false,
            "elapsedMs": 0
          },
          {
            "name": "read_lines",
            "id": "toolu_014ArkrkP53oh6TvPZEwb3JX",
            "input": {
              "filePath": "snippets/product-form-dynamic.liquid",
              "ranges": [
                {
                  "startLine": 300,
                  "endLine": 500
                },
                {
                  "startLine": 500,
                  "endLine": 630
                }
              ]
            },
            "result": "",
            "isError": false,
            "elapsedMs": 0
          },
          {
            "name": "read_lines",
            "id": "toolu_01LuwbLYUvDUJ6k2vUx2Mwqw",
            "input": {
              "filePath": "assets/product-form-dynamic.css",
              "ranges": [
                {
                  "startLine": 607,
                  "endLine": 791
                }
              ]
            },
            "result": "",
            "isError": false,
            "elapsedMs": 0
          },
          {
            "name": "read_lines",
            "id": "toolu_01EFpKSJtuP8mi2KQi7rpiTR",
            "input": {
              "filePath": "snippets/product-form-dynamic.liquid",
              "ranges": [
                {
                  "startLine": 130,
                  "endLine": 180
                },
                {
                  "startLine": 258,
                  "endLine": 300
                }
              ]
            },
            "result": "",
            "isError": false,
            "elapsedMs": 0
          },
          {
            "name": "read_lines",
            "id": "toolu_01AYZTH33D9jipRr13USs9op",
            "input": {
              "filePath": "assets/product-form-dynamic.js",
              "ranges": [
                {
                  "startLine": 960,
                  "endLine": 1100
                },
                {
                  "startLine": 1100,
                  "endLine": 1250
                }
              ]
            },
            "result": "",
            "isError": false,
            "elapsedMs": 0
          },
          {
            "name": "read_lines",
            "id": "toolu_018kGnULpH745PivMXs7Wfsk",
            "input": {
              "filePath": "snippets/product-form-dynamic.liquid",
              "ranges": [
                {
                  "startLine": 100,
                  "endLine": 135
                }
              ]
            },
            "result": "",
            "isError": false,
            "elapsedMs": 0
          },
          {
            "name": "read_lines",
            "id": "toolu_01Tiiq43gKkLsu6HWuSzNPMx",
            "input": {
              "filePath": "snippets/product-form-dynamic.liquid",
              "ranges": [
                {
                  "startLine": 410,
                  "endLine": 475
                },
                {
                  "startLine": 531,
                  "endLine": 590
                }
              ]
            },
            "result": "",
            "isError": false,
            "elapsedMs": 0
          },
          {
            "name": "read_lines",
            "id": "toolu_01CWRg7SoSNY2m6EBDLZdomV",
            "input": {
              "filePath": "snippets/product-form-dynamic.liquid",
              "ranges": [
                {
                  "startLine": 408,
                  "endLine": 490
                }
              ]
            },
            "result": "",
            "isError": false,
            "elapsedMs": 0
          },
          {
            "name": "read_lines",
            "id": "toolu_01UQznvQ9wUJQVtsgPGyigdU",
            "input": {
              "filePath": "snippets/product-form-dynamic.liquid",
              "ranges": [
                {
                  "startLine": 350,
                  "endLine": 490
                }
              ]
            },
            "result": "",
            "isError": false,
            "elapsedMs": 0
          },
          {
            "name": "read_lines",
            "id": "toolu_01Q5QSSitqJqxg2EHHqQif5Z",
            "input": {
              "filePath": "snippets/product-form-dynamic.liquid",
              "ranges": [
                {
                  "startLine": 1030,
                  "endLine": 1060
                }
              ]
            },
            "result": "",
            "isError": false,
            "elapsedMs": 0
          },
          {
            "name": "check_lint",
            "id": "toolu_01LNDtLu3QwU7jfA8fGY5gnA",
            "input": {
              "fileName": "snippets/product-form-dynamic.liquid"
            },
            "result": "",
            "isError": false,
            "elapsedMs": 0
          },
          {
            "name": "read_lines",
            "id": "toolu_012EkgTvAoBwmvPLULt7NVds",
            "input": {
              "filePath": "snippets/product-form-dynamic.liquid",
              "ranges": [
                {
                  "startLine": 479,
                  "endLine": 600
                }
              ]
            },
            "result": "",
            "isError": false,
            "elapsedMs": 0
          },
          {
            "name": "propose_code_edit",
            "id": "pm-change-1772176109618",
            "input": {
              "filePath": "product-form-dynamic.liquid",
              "newContent": "{% comment %} Custom options configuration - options listed here will render as dropdowns {% endcomment %}\n{% assign custom_option_names = product.metafields.custom.custom_values.value %}\n\n{% comment %} Custom content configuration for specific options {% endcomment %}\n{% comment %} Format: option_name:option_value|<html content> - separated by semicolons for multiple {% endcomment %}\n\n{% assign option_content_config = 'texture:Straight|<div class=\"pfd-info-content\"><span class=\"pfd-info-icon\">i</span><span class=\"pfd-info-text\">Our straight texture has slight natural wave texture to it when washed and dried. It is not pin straight hair, nor is that desirable among most clientele.</span></div>;texture:Natural Wave|<div class=\"pfd-info-content\"><span class=\"pfd-info-icon\">i</span><span class=\"pfd-info-text\">Our natural wave texture features soft, beachy waves that blend seamlessly with most natural hair textures. Low maintenance and versatile for everyday styling.</span></div>;texture:Loose Curl|<div class=\"pfd-info-content\"><span class=\"pfd-info-icon\">i</span><span class=\"pfd-info-text\">Our loose curl texture offers bouncy, defined curls that hold their shape beautifully. Perfect for adding volume and movement with minimal styling required.</span></div>;texture:Tight Curl|<div class=\"pfd-info-content\"><span class=\"pfd-info-icon\">i</span><span class=\"pfd-info-text\">Our tight curl texture provides well-defined, springy curls with maximum volume. Ideal for protective styles and blending with naturally curly hair.</span></div>' %}\n\n{% assign option_content_pairs = option_content_config | split: ';' %}\n\n{% comment %} SellersDash collect child product details {% endcomment %}\n{% assign shsd_product_details = product.metafields.sellersdash.shsdproducts %}\n{% if shsd_product_details.product_type == 'shsd_parent' %}\n  {% assign shsd_product_handles = product.handle %}\n  {% assign shsd_product_handles = shsd_product_handles | concat: shsd_product_details.handles %}\n  {% for shsd_handle in shsd_product_handles %}\n    {% assign shsd_single_product = all_products[shsd_handle] %}\n    {% assign shsd_product_variants = shsd_product_variants | concat: shsd_single_product.variants %}\n    {% assign shsd_product_media = shsd_product_media | concat: shsd_single_product.media %}\n    {% assign shsd_product_images = shsd_product_images | concat: shsd_single_product.images %}\n  {% endfor %}\n  {% assign shsd_product_options_with_values = shsd_product_details.options_with_values %}\n{% else %}\n  {% assign shsd_product_options_with_values = product.options_with_values %}\n  {% assign shsd_product_variants = product.variants %}\n  {% assign shsd_product_media = product.media %}\n  {% assign shsd_product_images = product.images %}\n{% endif %}\n\n{% comment %} Reorder options: Length, Texture, Color, then remaining {% endcomment %}\n{% assign reordered_options = '' | split: '' %}\n{% assign remaining_options = '' | split: '' %}\n\n{% for option in shsd_product_options_with_values %}\n  {% assign opt_name_lower = option.name | downcase | strip %}\n  {% if opt_name_lower == 'length' %}\n    {% assign length_slice = shsd_product_options_with_values | slice: forloop.index0, 1 %}\n  {% elsif opt_name_lower == 'texture' %}\n    {% assign texture_slice = shsd_product_options_with_values | slice: forloop.index0, 1 %}\n  {% elsif opt_name_lower == 'color' or opt_name_lower == 'colour' or opt_name_lower == 'colors' %}\n    {% assign color_slice = shsd_product_options_with_values | slice: forloop.index0, 1 %}\n  {% else %}\n    {% assign other_slice = shsd_product_options_with_values | slice: forloop.index0, 1 %}\n    {% assign remaining_options = remaining_options | concat: other_slice %}\n  {% endif %}\n{% endfor %}\n\n{% if length_slice %}\n  {% assign reordered_options = reordered_options | concat: length_slice %}\n{% endif %}\n{% if texture_slice %}\n  {% assign reordered_options = reordered_options | concat: texture_slice %}\n{% endif %}\n{% if color_slice %}\n  {% assign reordered_options = reordered_options | concat: color_slice %}\n{% endif %}\n{% assign shsd_product_options_with_values = reordered_options | concat: remaining_options %}\n\n{%- assign product_form_id = 'product-form-' | append: pr_sid -%}\n{%- liquid\n  assign pr_variants = shsd_product_variants\n  assign PR_buy_pr = false\n  if bk_stts.show_dynamic_checkout and isExternal == false and isProductAvailable\n    assign PR_buy_pr = true\n  endif\n  assign choose_an_option = 'products.product.choose_an_option' | t\n  assign date_in = settings.date_in\n  assign class_frm = 't4s-form__product has--form__swatch'\n  if isProductDefault\n    assign class_frm = 't4s-form__product'\n  endif\n  if arr_properties.size > 0 and isProductAvailable\n    assign class_frm = class_frm | append: ' has--properties'\n  endif\n  if settings.sticky_atc and type == 'main'\n    assign class_frm = class_frm | append: ' is--main-sticky'\n  else\n    assign class_frm = class_frm | append: ' is--atc-sticky'\n  endif\n\n  assign color_swatch = 'disabled-'\n  assign color_mode = bk_stts.color_mode\n  assign selector_mode = bk_stts.selector_mode\n  assign stt_color_ck = settings.color_ck | default: ';'\n  assign color_ck = stt_color_ck | append: ',color,colors,couleur,colour' | remove: ';,'\n  assign get_color = color_ck | downcase | replace: ' ,', ',' | replace: ', ', ',' | split: ',' | uniq\n  assign color_mode_list = 'color, color is-sw-cl__round, color is-sw-cl__round is-sw-cl__label, variant_image, variant_image is-sw-cl__round, variant_image is-sw-cl__round is-sw-cl__label' | split: ', '\n  if color_mode_list contains color_mode\n    assign color_swatch = 'is-sw__color '\n  endif\n  assign current_variant_available = current_variant.available\n  assign use_incoming_mess = settings.use_incoming_mess\n  assign current_variant_incoming = false\n  assign current_inventory_quantity = current_variant.inventory_quantity\n  if current_inventory_quantity <= 0 and current_variant.inventory_management == 'shopify' and current_variant.incoming\n    assign current_variant_incoming = true\n  endif\n  if pos_sizeg == '1'\n    assign html_sizeg = ''\n  endif\n  if current_variant.inventory_management != null and current_inventory_quantity > 0 and current_variant.inventory_policy != 'continue'\n    assign max_qty = current_inventory_quantity\n  else\n    assign max_qty = 9999\n  endif\n  if color_mode contains 'color' or color_mode contains 'variant'\n    assign show_tooltip = ''\n  else\n    assign show_tooltip = '-off'\n  endif\n-%}\n\n{%- if product.metafields.custom.default_variant.value -%}\n  <script>\n    window.__HAS_SELECTED__ = {{ product.selected_variant | json }};\n    window.__DEFAULT_VARIANT__ = {{ product.metafields.custom.default_variant.value | json }};\n  </script>\n{%- endif -%}\n\n{%- assign length_option_position = -1 -%}\n{%- assign color_option_position = -1 -%}\n{%- for opt_name in product.options -%}\n  {%- assign opt_name_down = opt_name | downcase -%}\n  {%- if opt_name_down == 'length' -%}\n    {%- assign length_option_position = forloop.index -%}\n  {%- endif -%}\n  {%- if get_color contains opt_name_down -%}\n    {%- assign color_option_position = forloop.index -%}\n  {%- endif -%}\n{%- endfor -%}\n\n<script>\n  window.__CUSTOM_OPTION_NAMES__ = {{ custom_option_names | json }};\n  window.__LENGTH_OPTION_INDEX__ = {{ length_option_position | minus: 1 }};\n</script>\n\n{%- comment -%} Load dropdown CSS if either color mode or selector mode is dropdown {%- endcomment -%}\n\n{%- if color_mode == 'dropdown' or selector_mode == 'dropdown' -%}\n  <link\n    rel=\"stylesheet\"\n    href=\"{{ 'base_drop.min.css' | asset_url }}\"\n    media=\"all\"\n  >\n{%- endif -%}\n\n{%- comment -%} Custom CSS for product form dynamic {%- endcomment -%}\n{{ 'product-form-dynamic.css' | asset_url | stylesheet_tag }}\n\n<div class=\"pfd-override-wrapper\">\n  <div class=\"pfd-custom-wrapper\">\n    <div\n      class=\"t4s-product-form__variants is-no-pick__{{ PR_no_pick }}{% if PR_buy_pr %} is-payment-btn-true t4s-payment-button t4s-btn-color-{{ bk_stts.button_color_payment }}{% endif %} is-remove-soldout-{{ remove_soldout }} is-btn-full-width__{{ bk_stts.btn_atc_full }} is-btn-atc-txt-{{ bk_stts.btn_txt }} is-btn-ck-txt-{{ bk_stts.btn_txt2 }} is--fist-ratio-{{ is_fit_ratio_img }}\"\n      style=\"{% if is_fit_ratio_img %} --fit-ratio-img: {{ first_ratio_img }}; {% endif %} --wishlist-color: {{bk_stts.wishlist_color}};--wishlist-hover-color: {{bk_stts.wishlist_color_hover}};--wishlist-active-color: {{bk_stts.wishlist_color_active}};--compare-color: {{bk_stts.compare_color}};--compare-hover-color: {{bk_stts.compare_color_hover}};--compare-active-color: {{bk_stts.compare_color_active}};\"\n      {{ shopify_attributes }}\n    >\n      <div data-callBackVariant id=\"t4s-callBackVariant{{ product_form_id }}\">\n        {%- form 'product',\n          product,\n          id: product_form_id,\n          data-productid: product.id,\n          class: class_frm,\n          novalidate: 'novalidate',\n          data-type: 'add-to-cart-form',\n          data-disable-swatch: isProductDefault\n        -%}\n          {% comment %}{{- form | payment_terms -}}{% endcomment %}\n          {%- if isProductDefault -%}\n            <input\n              name=\"id\"\n              value=\"{{ pr_variants.first.id }}\"\n              type=\"hidden\"\n            >\n            {%- if advance_pr_type != blank -%}\n              {%- render 'choose_style', advance_pr_type: advance_pr_type, title: advance_label, pid: product.id -%}\n            {%- endif -%}\n          {%- else -%}\n            {{ 'swatch.css' | asset_url | stylesheet_tag }}\n            <select\n              name=\"id\"\n              id=\"product-select-{{ pr_sid }}\"\n              class=\"t4s-product__select t4s-d-none\"\n            >\n              {%- for variant in pr_variants -%}\n                {%- if variant.available -%}\n                  <option\n                    data-option1=\"{{ variant.option1 }}\"\n                    data-option2=\"{{ variant.option2 }}\"\n                    value=\"{{ variant.id }}\"\n                    data-mdid=\"{{ variant.featured_media.id | json }}\"\n                    data-incoming=\"{{ variant.incoming }}\"\n                    data-inventoryQuantity=\"{{ variant.inventory_quantity | json }}\"\n                    data-inventoryPolicy=\"{{ variant.inventory_policy | json }}\"\n                    data-nextIncomingDate=\"{{ variant.next_incoming_date | date: date_in }}\"\n                    {% if variant.id == current_variant.id %}\n                      selected=\"selected\"\n                    {% endif %}\n                  >\n                    {{ variant.title | escape }}\n                  </option>\n                {%- else -%}\n                  <option\n                    data-option1=\"{{ variant.option1 }}\"\n                    data-option2=\"{{ variant.option2 }}\"\n                    value=\"{{ variant.id }}\"\n                    data-mdid=\"{{ variant.featured_media.id | json }}\"\n                    data-incoming=\"{{ variant.incoming }}\"\n                    data-inventoryQuantity=\"{{ variant.inventory_quantity | json }}\"\n                    data-inventoryPolicy=\"{{ variant.inventory_policy | json }}\"\n                    data-nextIncomingDate=\"{{ variant.next_incoming_date | date: date_in }}\"\n                  >\n                    {{ variant.title | escape }}\n                  </option>\n                {%- endif -%}\n              {%- endfor -%}\n            </select>\n\n            <div class=\"pfd-variant-images\" style=\"display:none !important;\">\n              <div class=\"pfd-main-imgs\">\n                {%- for variant in pr_variants -%}\n                  {% assign var_imgs = variant.metafields.custom.variant_image.value %}\n                  <div\n                    class=\"pfd-img-listing\"\n                    data-var-img=\"{{ variant.image.src | img_url: 'master' }}\"\n                    data-pfd-variant-id=\"{{ variant.id }}\"\n                  >\n                    {% for value in var_imgs %}\n                      <div class=\"pfd-media-item\">\n                        <img src=\"{{value | img_url: 'master'}}\">\n                      </div>\n                    {% endfor %}\n                  </div>\n                {%- endfor -%}\n              </div>\n              <div class=\"pfd-thumb-imgs\">\n                {%- for variant in pr_variants -%}\n                  {% assign var_imgs = variant.metafields.custom.variant_image.value %}\n                  <div class=\"pfd-img-listing\" data-pfd-variant-id=\"{{ variant.id }}\">\n                    {% for value in var_imgs %}\n                      <div class=\"pfd-media-thumb\">\n                        <div\n                          class=\"pfd-img\"\n                          style=\"background-image:url('{{value | img_url: \"master\"}}');\"\n                        ></div>\n                      </div>\n                    {% endfor %}\n                  </div>\n                {%- endfor -%}\n              </div>\n            </div>\n\n            <div class=\"t4s-swatch t4s-color-mode__{{ color_mode }} t4s-color-size__{{ bk_stts.color_size }} t4s-selector-mode__{{ selector_mode }}\">\n              {%- if advance_pr_type != blank -%}\n                {%- render 'choose_style', advance_pr_type: advance_pr_type, title: advance_label, pid: product.id -%}\n              {%- endif -%}\n\n              {%- for option in shsd_product_options_with_values -%}\n                {%- liquid\n                  assign option_index = 'option' | append: forloop.index\n                  assign selected_value = product.selected_or_first_available_variant[option_index]\n                  assign option_name = option.name\n                  assign name_downcase = option_name | downcase\n                -%}\n\n                {%- if get_color contains name_downcase -%}\n                  {% comment %}--MARK: Color Option{% endcomment %}\n\n                  {% comment %} Build color nickname map from variant metafields {% endcomment %}\n                  {%- capture color_nicknames_map -%}\n                    {%- for variant in shsd_product_variants -%}\n                      {%- if variant.metafields.custom.variant_color != blank -%}\n                        {%- for opt_index in (1..3) -%}\n                          {%- assign opt_key = 'option' | append: opt_index -%}\n                          {%- assign opt_val = variant[opt_key] -%}\n                          {%- if opt_val != blank -%}\n                            {%- assign opt_index_adjusted = opt_index | minus: 1 -%}\n                            {%- assign opt_name_check = product.options[opt_index_adjusted] | downcase -%}\n                            {%- if get_color contains opt_name_check -%}\n                              {{ opt_val | handle }}:{{ variant.metafields.custom.variant_color }};\n                            {%- endif -%}\n                          {%- endif -%}\n                        {%- endfor -%}\n                      {%- endif -%}\n                    {%- endfor -%}\n                  {%- endcapture -%}\n                  {%- assign color_nicknames_map = color_nicknames_map | strip -%}\n\n                  <div\n                    data-swatch-option\n                    data-option-name=\"{{ option_name | escape }}\"\n                    data-id=\"{{ forloop.index0 }}\"\n                    data-option-unit=\"\n                      {%- liquid\n                        assign option_unit = ''\n                        if se_stts and se_stts.option_units and se_stts.option_units != blank\n                          assign option_units_raw = se_stts.option_units | strip | newline_to_br | split: '<br />'\n                          for pair in option_units_raw\n                            assign pair_cleaned = pair | strip\n                            if pair_cleaned contains ':'\n                              assign key_value = pair_cleaned | split: ':'\n                              assign key = key_value[0] | strip\n                              assign value = key_value[1] | strip\n                              if key == option_name and value != blank\n                                assign option_unit = value\n                                break\n                              endif\n                            endif\n                          endfor\n                        endif\n                      -%}{{ option_unit | escape }}\n                    \"\n                    class=\"t4s-swatch__option is-t4s-style__color is-t4s-name__{{ option_name | handle }} {% cycle 'is--first-color', '', '' %}\"\n                  >\n                    <h4 class=\"t4s-swatch__title t4s-swatch__title--color\">\n                      <span class=\"t4s-swatch__title--left\">\n                        <span class=\"bold\">\n                          {{- option_name | upcase -}}\n                          {%- liquid\n                            assign option_unit = ''\n                            if se_stts and se_stts.option_units and se_stts.option_units != blank\n                              assign option_units_raw = se_stts.option_units | strip | newline_to_br | split: '<br />'\n                              for pair in option_units_raw\n                                assign pair_cleaned = pair | strip\n                                if pair_cleaned contains ':'\n                                  assign key_value = pair_cleaned | split: ':'\n                                  assign key = key_value[0] | strip\n                                  assign value = key_value[1] | strip\n                                  if key == option_name and value != blank\n                                    assign option_unit = value\n                                    break\n                                  endif\n                                endif\n                              endfor\n                            endif\n                          -%}\n                          {%- if option_unit != blank %} ({{ option_unit }}){%- endif -%}\n                          :\n                        </span>\n                        <span class=\"t4s-selected-value\">\n                          {%- assign display_value = selected_value | default: choose_an_option | replace: '\"', '' -%}\n                          {{- display_value -}}\n                          {%- if option_unit != blank %} {{ option_unit }}{%- endif -%}\n                        </span>\n                      </span>\n                      {%- if name_sizeg == name_downcase -%}\n                        {{- html_sizeg -}}\n                      {%- endif %}\n                    </h4>\n\n                    <div data-swatch-list class=\"t4s-swatch__list\">\n                      {%- if color_mode != 'dropdown' -%}\n                        {%- if color_mode contains 'is-sw-cl__label' -%}\n                          {%- for value in option.values -%}\n                            {%- assign color_handle = value | handle -%}\n\n                            {%- comment %} Look up color nickname from map {%- endcomment -%}\n                            {%- assign color_nickname = '' -%}\n                            {%- assign nickname_pairs = color_nicknames_map | split: ';' -%}\n                            {%- for pair in nickname_pairs -%}\n                              {%- assign pair_clean = pair | strip -%}\n                              {%- if pair_clean != blank -%}\n                                {%- assign pair_parts = pair_clean | split: ':' -%}\n                                {%- if pair_parts[0] == color_handle -%}\n                                  {%- assign color_nickname = pair_parts[1] -%}\n                                  {%- break -%}\n                                {%- endif -%}\n                              {%- endif -%}\n                            {%- endfor -%}\n\n                            {%- comment %} Context-aware availability check: color + current other selections {%- endcomment -%}\n                            {%- assign color_is_available = false -%}\n                            {%- for variant in shsd_product_variants -%}\n                              {%- assign matches_color = false -%}\n                              {%- assign matches_other_options = true -%}\n\n                              {%- for opt_idx in (1..3) -%}\n                                {%- assign opt_key = 'option' | append: opt_idx -%}\n                                {%- assign variant_opt_val = variant[opt_key] -%}\n                                {%- if variant_opt_val != blank -%}\n                                  {%- assign variant_opt_handle = variant_opt_val | handle -%}\n\n                                  {%- comment %} Determine if this option index is the color option {%- endcomment -%}\n                                  {%- assign opt_idx_adjusted = opt_idx | minus: 1 -%}\n                                  {%- assign this_opt_name = product.options[opt_idx_adjusted] | downcase -%}\n\n                                  {%- if get_color contains this_opt_name -%}\n                                    {%- comment %} This is the color option - check if it matches our target color {%- endcomment -%}\n                                    {%- if variant_opt_handle == color_handle -%}\n                                      {%- assign matches_color = true -%}\n                                    {%- endif -%}\n                                  {%- else -%}\n                                    {%- comment %} This is a non-color option - check if variant matches current selection {%- endcomment -%}\n                                    {%- assign current_selected_val = product.selected_or_first_available_variant[opt_key] -%}\n                                    {%- if current_selected_val != blank -%}\n                                      {%- assign current_selected_handle = current_selected_val | handle -%}\n                                      {%- unless variant_opt_handle == current_selected_handle -%}\n                                        {%- assign matches_other_options = false -%}\n                                      {%- endunless -%}\n                                    {%- endif -%}\n                                  {%- endif -%}\n                                {%- endif -%}\n                              {%- endfor -%}\n\n                              {%- if matches_color and matches_other_options and variant.available -%}\n                                {%- assign color_is_available = true -%}\n                                {%- break -%}\n                              {%- endif -%}\n                            {%- endfor -%}\n\n                            {%- comment %} Compute available standard lengths for this color (used for both classes and content) {%- endcomment -%}\n                            {%- assign avail_lengths = '' -%}\n                            {%- assign avail_lengths_seen = '' -%}\n                            {%- assign length_opt_key = 'option' | append: length_option_position -%}\n                            {%- if length_option_position > 0 and color_option_position > 0 -%}\n                              {%- for lv in shsd_product_variants -%}\n                                {%- assign v_color_key = 'option' | append: color_option_position -%}\n                                {%- assign v_color_val = lv[v_color_key] | handle -%}\n                                {%- if v_color_val == color_handle and lv.available -%}\n                                  {%- assign v_length_val = lv[length_opt_key] -%}\n                                  {%- if v_length_val != blank -%}\n                                    {%- assign is_custom_length = false -%}\n                                    {%- if custom_option_names -%}\n                                      {%- for custom_name in custom_option_names -%}\n                                        {%- assign custom_name_stripped = custom_name | strip -%}\n                                        {%- if v_length_val == custom_name_stripped -%}\n                                          {%- assign is_custom_length = true -%}\n                                          {%- break -%}\n                                        {%- endif -%}\n                                      {%- endfor -%}\n                                    {%- endif -%}\n                                    {%- unless is_custom_length -%}\n                                      {%- assign v_length_clean = v_length_val | replace: '\"', '' | strip -%}\n                                      {%- assign sentinel = '@@' | append: v_length_clean | append: '@@' -%}\n                                      {%- unless avail_lengths_seen contains sentinel -%}\n                                        {%- assign avail_lengths_seen = avail_lengths_seen | append: sentinel -%}\n                                        {%- if avail_lengths == '' -%}\n                                          {%- assign avail_lengths = v_length_clean -%}\n                                        {%- else -%}\n                                          {% avail_lengths | append: ', ' | append: v_length_clean -%}\n                                        {%- endif -%}\n                                      {%- endunless -%}\n                                    {%- endunless -%}\n                                  {%- endif -%}\n                                {%- endif -%}\n                              {%- endfor -%}\n                            {%- endif -%}\n\n                            <div\n                              data-swatch-item\n                              class=\"t4s-swatch__btn-wrap{% if selected_value == value %} is--selected{% endif %}{% unless color_is_available %} is--out-of-stock{% if avail_lengths != '' %} pfd-has-lengths{% endif %}{% endunless %}\"\n                              data-value=\"{{ value | escape }}\"\n                              data-available=\"{{ color_is_available }}\"\n                            >\n                              <!-- DEBUG: color={{ color_handle }} | available={{ color_is_available }} | selected_opt1={{ product.selected_or_first_available_variant.option1 | handle }} | selected_opt2={{ product.selected_or_first_available_variant.option2 | handle }} -->\n                              <div\n                                data-img-el\n                                class=\"t4s-swatch__item {{ color_swatch }}bg_color_{{ value | handle }} lazyloadt4s\"\n                              >\n                                <img crossorigin=\"anonymous\">\n                                {%- unless color_is_available -%}\n                                  <span class=\"t4s-swatch__re-visible\">Awaiting Restock</span>\n                                {%- endunless -%}\n                              </div>\n                              {%- unless color_is_available -%}\n                                {%- if avail_lengths != '' -%}\n                                  <span class=\"t4s-swatch__available-lengths is-visible\">Available in {{ avail_lengths }}</span>\n                                {%- endif -%}\n                              {%- endunless -%}\n                              <span class=\"t4s-swatch__label\">\n                                {{- value | replace: '\"', '' -}}\n                              </span>\n                              {%- if color_nickname != blank -%}\n                                <span class=\"t4s-swatch__nickname\">{{ color_nickname }}</span>\n                              {%- endif -%}\n                            </div>\n                          {%- endfor -%}\n\n                          {%- endfor -%}\n\n                        {%- else -%}\n                          {%- for value in option.values -%}\n                            {%- assign color_handle = value | handle -%}\n\n                            {%- comment %} Look up color nickname {%- endcomment -%}\n                            {%- assign color_nickname = '' -%}\n                            {%- assign nickname_pairs = color_nicknames_map | split: ';' -%}\n                            {%- for pair in nickname_pairs -%}\n                              {%- assign pair_clean = pair | strip -%}\n                              {%- if pair_clean != blank -%}\n                                {%- assign pair_parts = pair_clean | split: ':' -%}\n                                {%- if pair_parts[0] == color_handle -%}\n                                  {%- assign color_nickname = pair_parts[1] -%}\n                                  {%- break -%}\n                                {%- endif -%}\n                              {%- endif -%}\n                            {%- endfor -%}\n\n                            {%- comment %} Context-aware availability check: color + current other selections {%- endcomment -%}\n                            {%- assign color_is_available = false -%}\n                            {%- for variant in shsd_product_variants -%}\n                              {%- assign matches_color = false -%}\n                              {%- assign matches_other_options = true -%}\n\n                              {%- for opt_idx in (1..3) -%}\n                                {%- assign opt_key = 'option' | append: opt_idx -%}\n                                {%- assign variant_opt_val = variant[opt_key] -%}\n                                {%- if variant_opt_val != blank -%}\n                                  {%- assign variant_opt_handle = variant_opt_val | handle -%}\n\n                                  {%- comment %} Determine if this option index is the color option {%- endcomment -%}\n                                  {%- assign opt_idx_adjusted = opt_idx | minus: 1 -%}\n                                  {%- assign this_opt_name = product.options[opt_idx_adjusted] | downcase -%}\n\n                                  {%- if get_color contains this_opt_name -%}\n                                    {%- comment %} This is the color option - check if it matches our target color {%- endcomment -%}\n                                    {%- if variant_opt_handle == color_handle -%}\n                                      {%- assign matches_color = true -%}\n                                    {%- endif -%}\n                                  {%- else -%}\n                                    {%- comment %} This is a non-color option - check if variant matches current selection {%- endcomment -%}\n                                    {%- assign current_selected_val = product.selected_or_first_available_variant[opt_key] -%}\n                                    {%- if current_selected_val != blank -%}\n                                      {%- assign current_selected_handle = current_selected_val | handle -%}\n                                      {%- unless variant_opt_handle == current_selected_handle -%}\n                                        {%- assign matches_other_options = false -%}\n                                      {%- endunless -%}\n                                    {%- endif -%}\n                                  {%- endif -%}\n                                {%- endif -%}\n                              {%- endfor -%}\n\n                              {%- if matches_color and matches_other_options and variant.available -%}\n                                {%- assign color_is_available = true -%}\n                                {%- break -%}\n                              {%- endif -%}\n                            {%- endfor -%}\n\n                            <div\n                              data-swatch-item\n                              class=\"t4s-swatch__btn-wrap{% if selected_value == value %} is--selected{% endif %}{% unless color_is_available %} is--out-of-stock{% endunless %}{%- unless color_is_available -%}{%- assign avail_lengths_check = '' -%}{%- assign length_opt_key_check = 'option' | append: length_option_position -%}{%- if length_option_position > 0 -%}{%- for variant in shsd_product_variants -%}{%- assign v_color_key_c = 'option' | append: color_option_position -%}{%- if variant[v_color_key_c] | handle == color_handle and variant.available -%}{%- assign v_lv = variant[length_opt_key_check] -%}{%- if v_lv != blank -%}{%- assign is_cl = false -%}{%- if custom_option_names -%}{%- for cn in custom_option_names -%}{%- if v_lv == cn -%}{%- assign is_cl = true -%}{%- break -%}{%- endif -%}{%- endfor -%}{%- endif -%}{%- unless is_cl -%}{%- assign avail_lengths_check = avail_lengths_check | append: 'x' -%}{%- endunless -%}{%- endif -%}{%- endif -%}{%- endfor -%}{%- endif -%}{%- if avail_lengths_check != '' %} pfd-has-lengths{%- endif -%}{%- endunless -%}\"\n                              data-value=\"{{ value | escape }}\"\n                              data-available=\"{{ color_is_available }}\"\n                            >\n\n                              <div\n  data-img-el\n  class=\"t4s-swatch__item {{ color_swatch }}bg_color_{{ value | handle }} lazyloadt4s\"\n>\n  <img crossorigin=\"anonymous\">\n</div>\n                              {%- unless color_is_available -%}\n                                <span class=\"t4s-swatch__restock-badge\">Awaiting Restock</span>\n                                {%- comment %} Compute available standard lengths for this color {%- endcomment -%}\n                                {%- assign avail_lengths = '' -%}\n                                {%- assign length_opt_key = 'option' | append: length_option_position -%}\n                                {%- if length_option_position > 0 -%}\n                                  {%- for variant in shsd_product_variants -%}\n                                    {%- assign v_color_key = 'option' | append: color_option_position -%}\n                                    {%- assign v_color_val = variant[v_color_key] | handle -%}\n                                    {%- if v_color_val == color_handle and variant.available -%}\n                                      {%- assign v_length_val = variant[length_opt_key] -%}\n                                      {%- if v_length_val != blank -%}\n                                        {%- assign is_custom_length = false -%}\n                                        {%- if custom_option_names -%}\n                                          {%- for custom_name in custom_option_names -%}\n                                            {%- if v_length_val == custom_name -%}\n                                              {%- assign is_custom_length = true -%}\n                                              {%- break -%}\n                                            {%- endif -%}\n                                          {%- endfor -%}\n                                        {%- endif -%}\n                                        {%- unless is_custom_length -%}\n                                          {%- assign v_length_clean = v_length_val | replace: '\"', '' -%}\n                                          {%- assign length_check = '|' | append: v_length_clean | append: '|' -%}\n                                          {%- assign lengths_haystack = '|' | append: avail_lengths | replace: ', ', '|,|' | append: '|' -%}\n                                          {%- unless lengths_haystack contains length_check -%}\n                                            {%- if avail_lengths == '' -%}\n                                              {%- assign avail_lengths = v_length_clean -%}\n                                            {%- else -%}\n                                              {%- assign avail_lengths = avail_lengths | append: ', ' | append: v_length_clean -%}\n                                            {%- endif -%}\n                                          {%- endunless -%}\n                                        {%- endunless -%}\n                                      {%- endif -%}\n                                    {%- endif -%}\n                                  {%- endfor -%}\n                                {%- endif -%}\n                                {%- if avail_lengths != '' -%}\n                                  <span class=\"t4s-swatch__available-lengths is-visible\">Available in {{ avail_lengths }}</span>\n                                {%- endif -%}\n                              {%- endunless -%}\n                              {%- if color_nickname != blank -%}\n                                <span class=\"t4s-swatch__nickname\">{{ color_nickname }}</span>\n                              {%- endif -%}\n                            </div>\n\n                          {%- endfor -%}\n                        {%- endif -%}\n                      {%- else -%}\n                        <button\n                          type=\"button\"\n                          data-dropdown-open\n                          data-position=\"bottom-end\"\n                          data-id=\"t4s_nt_{{ pr_sid }}{{ forloop.index }}\"\n                        >\n                          <span data-current-value>\n                            {{- selected_value | default: choose_an_option -}}\n                          </span>\n                          <svg\n                            class=\"t4s-icon-select-arrow\"\n                            role=\"presentation\"\n                            viewBox=\"0 0 19 12\"\n                          >\n                            <use xlink:href=\"#t4s-select-arrow\"></use>\n                          </svg>\n                        </button>\n                        <div\n                          data-dropdown-wrapper\n                          class=\"t4s-dropdown__wrapper t4s-current-scrollbar\"\n                          id=\"t4s_nt_{{ pr_sid }}{{ forloop.index }}\"\n                        >\n                          <div class=\"t4s-drop-arrow\"></div>\n                          <div class=\"t4s-dropdown__header\">\n                            <span\n                              data-current-value\n                              class=\"t4s-dropdown__title\"\n                            >\n                              {{- selected_value | default: choose_an_option -}}\n                            </span>\n                            <button\n                              data-dropdown-close\n                              aria-label=\"{{ 'general.aria.close' | t }}\"\n                            >\n                              <svg\n                                role=\"presentation\"\n                                class=\"t4s-iconsvg-close\"\n                                viewBox=\"0 0 16 14\"\n                              >\n                                <path d=\"M15 0L1 14m14 0L1 0\" stroke=\"currentColor\" fill=\"none\" fill-rule=\"evenodd\"></path>\n                              </svg>\n                            </button>\n                          </div>\n                          <div class=\"t4s-dropdown__content\">\n                            {%- for value in option.values -%}\n                              <div\n                                data-swatch-item\n                                data-dropdown-off\n                                class=\"t4s-swatch__item t4s-truncate {{ color_swatch }}bg_color_{{ value | handle }} lazyloadt4s{% if selected_value == value %} is--selected{% endif %}\"\n                                data-value=\"{{ value | escape }}\"\n                              >\n                                {{ value | replace: '\"', '' }}\n                              </div>\n                            {%- endfor -%}\n                          </div>\n                        </div>\n                      {%- endif -%}\n                    </div>\n                    {%- render 'color-info-accordion' -%}\n                  </div>\n                {%- else -%}\n                  {% comment %}--MARK: Non-Color{% endcomment %}\n                  {%- liquid\n                    assign standard_values = ''\n                    assign custom_values = ''\n                    assign has_standard = false\n                    assign has_custom = false\n\n                    for value in option.values\n                      assign is_custom = false\n                      for custom_name in custom_option_names\n                        assign custom_name_clean = custom_name | strip\n                        if value contains custom_name_clean\n                          assign is_custom = true\n                          break\n                        endif\n                      endfor\n\n                      if is_custom\n                        if custom_values == ''\n                          assign custom_values = value\n                        else\n                          assign custom_values = custom_values | append: ',' | append: value\n                        endif\n                        assign has_custom = true\n                      else\n                        if standard_values == ''\n                          assign standard_values = value\n                        else\n                          assign standard_values = standard_values | append: ',' | append: value\n                        endif\n                        assign has_standard = true\n                      endif\n                    endfor\n\n                    assign standard_values_array = standard_values | split: ','\n                    assign custom_values_array = custom_values | split: ','\n                  -%}\n\n                  <div\n                    data-swatch-option\n                    data-option-name=\"{{ option_name | escape }}\"\n                    data-id=\"{{ forloop.index0 }}\"\n                    data-option-unit=\"\n                      {%- liquid\n                        assign option_unit = ''\n                        if se_stts and se_stts.option_units and se_stts.option_units != blank\n                          assign option_units_raw = se_stts.option_units | strip | newline_to_br | split: '<br />'\n                          for pair in option_units_raw\n                            assign pair_cleaned = pair | strip\n                            if pair_cleaned contains ':'\n                              assign key_value = pair_cleaned | split: ':'\n                              assign key = key_value[0] | strip\n                              assign value = key_value[1] | strip\n                              if key == option_name and value != blank\n                                assign option_unit = value\n                                break\n                              endif\n                            endif\n                          endfor\n                        endif\n                      -%}{{ option_unit | escape }}\n                    \"\n                    class=\"t4s-swatch__option is-t4s-name__{{ option_name | handle }} pfd-split-option\"\n                  >\n                    <h4 class=\"t4s-swatch__title\">\n                      <span class=\"t4s-swatch__title--left\"\n                        >Select a\n                        <span class=\"bold\">\n                          {{- option_name -}}\n                        </span>\n                        {%- liquid\n                          assign option_unit = ''\n                          if se_stts and se_stts.option_units and se_stts.option_units != blank\n                            assign option_units_raw = se_stts.option_units | strip | newline_to_br | split: '<br />'\n                            for pair in option_units_raw\n                              assign pair_cleaned = pair | strip\n                              if pair_cleaned contains ':'\n                                assign key_value = pair_cleaned | split: ':'\n                                assign key = key_value[0] | strip\n                                assign value = key_value[1] | strip\n                                if key == option_name and value != blank\n                                  assign option_unit = value\n                                  break\n                                endif\n                              endif\n                            endfor\n                          endif\n                        -%}\n                        {%- if option_unit != blank %} ({{ option_unit }}){%- endif -%}\n                      </span>\n                      <span class=\"t4s-swatch__title--right\"\n                        >Selected:\n                        <span class=\"bold\">\n                          {%- assign display_value = selected_value | default: choose_an_option | replace: '\"', '' -%}\n                          {{- display_value -}}\n                          {%- if option_unit != blank %} {{ option_unit }}{%- endif -%}\n                        </span></span\n                      >\n                      {%- if name_sizeg == name_downcase -%}\n                        {{- html_sizeg -}}\n                      {%- endif %}\n                    </h4>\n\n                    <div class=\"pfd-split-selection\">\n                      {%- if has_standard -%}\n                        <div class=\"pfd-standard-options\">\n                          {%- if selector_mode != 'dropdown' -%}\n                            {%- for value in standard_values_array -%}\n                              <div\n                                data-swatch-item\n                                class=\"t4s-swatch__item{% if selected_value == value %} is--selected{% endif %}\"\n                                data-value=\"{{ value | escape }}\"\n                              >\n                                {{ value | replace: '\"', '' }}\n                              </div>\n                            {%- endfor -%}\n                          {%- else -%}\n                            <button\n                              type=\"button\"\n                              data-pfd-dropdown-open\n                              data-position=\"bottom-end\"\n                              data-id=\"t4s_nt_{{ pr_sid }}{{ forloop.index }}_standard\"\n                            >\n                              <span data-current-value>\n                                {{- selected_value | default: choose_an_option -}}\n                              </span>\n                              <svg\n                                class=\"t4s-icon-select-arrow\"\n                                role=\"presentation\"\n                                viewBox=\"0 0 19 12\"\n                              >\n                                <use xlink:href=\"#t4s-select-arrow\"></use>\n                              </svg>\n                            </button>\n                            <div\n                              data-dropdown-wrapper\n                              class=\"t4s-dropdown__wrapper t4s-current-scrollbar\"\n                              id=\"t4s_nt_{{ pr_sid }}{{ forloop.index }}_standard\"\n                            >\n                              <div class=\"t4s-drop-arrow\"></div>\n                              <div class=\"t4s-dropdown__content\">\n                                {%- for value in standard_values_array -%}\n                                  <div\n                                    data-swatch-item\n                                    data-dropdown-off\n                                    class=\"t4s-swatch__item t4s-truncate{% if selected_value == value %} is--selected{% endif %}\"\n                                    data-value=\"{{ value | escape }}\"\n                                  >\n                                    {{ value | replace: '\"', '' }}\n                                  </div>\n                                {%- endfor -%}\n                              </div>\n                            </div>\n                          {%- endif -%}\n                        </div>\n                      {%- endif -%}\n\n                      {%- if has_custom -%}\n                        <div class=\"pfd-custom-options\">\n                          {%- if has_standard and has_custom -%}\n                            <span class=\"pfd-or-separator\">or</span>\n                          {%- endif -%}\n                          <button\n                            type=\"button\"\n                            data-pfd-dropdown-open\n                            data-position=\"bottom-end\"\n                            data-id=\"t4s_nt_{{ pr_sid }}{{ forloop.index }}_custom\"\n                            class=\"pfd-custom-dropdown\"\n                          >\n                            <span data-current-value>\n                              {%- assign is_custom_selected = false -%}\n                              {%- for custom_val in custom_values_array -%}\n                                {%- if selected_value == custom_val -%}\n                                  {%- assign display_custom_val = custom_val | replace: '\"', '' -%}\n                                  {%- if option_unit != blank -%}\n                                    {{ display_custom_val }}\n                                    {{ option_unit }}\n                                    <span class=\"pfd-custom-badge\">Custom</span>\n                                  {%- else -%}\n                                    {{ display_custom_val }}\n                                    <span class=\"pfd-custom-badge\">Custom</span>\n                                  {%- endif -%}\n                                  {%- assign is_custom_selected = true -%}\n                                  {%- break -%}\n                                {%- endif -%}\n                              {%- endfor -%}\n                              {%- unless is_custom_selected -%}\n                                Custom {{ option_name | downcase }}\n                              {%- endunless -%}\n                            </span>\n                            <svg\n                              class=\"t4s-icon-select-arrow\"\n                              role=\"presentation\"\n                              viewBox=\"0 0 19 12\"\n                            >\n                              <use xlink:href=\"#t4s-select-arrow\"></use>\n                            </svg>\n                          </button>\n                          <div\n                            data-dropdown-wrapper\n                            class=\"t4s-dropdown__wrapper t4s-current-scrollbar\"\n                            id=\"t4s_nt_{{ pr_sid }}{{ forloop.index }}_custom\"\n                          >\n                            <div class=\"t4s-drop-arrow\"></div>\n                            <div class=\"t4s-dropdown__content\">\n                              {%- for value in custom_values_array -%}\n                                <div\n                                  data-swatch-item\n                                  data-dropdown-off\n                                  class=\"t4s-swatch__item t4s-truncate{% if selected_value == value %} is--selected{% endif %}\"\n                                  data-value=\"{{ value | escape }}\"\n                                >\n                                  <span class=\"pfd-checkmark\">✓</span>\n                                  <span class=\"pfd-option-text\">\n                                    {%- assign display_value = value | replace: '\"', '' -%}\n                                    {%- if option_unit != blank -%}\n                                      {{ display_value }}\n                                      {{ option_unit }}\n                                    {%- else -%}\n                                      {{ display_value }}\n                                    {%- endif -%}\n                                  </span>\n                                  <span class=\"pfd-custom-badge\">Custom</span>\n                                </div>\n                              {%- endfor -%}\n                            </div>\n                          </div>\n                        </div>\n                      {%- endif -%}\n\n                      {%- unless has_standard or has_custom -%}\n                        {%- comment %} Fallback to original rendering if no split detected {%- endcomment %}\n                        <div class=\"t4s-swatch__list pfd-fallback-list\">\n                          {%- if selector_mode != 'dropdown' -%}\n                            {%- for value in option.values -%}\n                              <div\n                                data-swatch-item\n                                class=\"t4s-swatch__item{% if selected_value == value %} is--selected{% endif %}\"\n                                data-value=\"{{ value | escape }}\"\n                              >\n                                {{ value | replace: '\"', '' }}\n                              </div>\n                            {%- endfor -%}\n                          {%- else -%}\n                            <button\n                              type=\"button\"\n                              data-pfd-dropdown-open\n                              data-position=\"bottom-end\"\n                              data-id=\"t4s_nt_{{ pr_sid }}{{ forloop.index }}\"\n                            >\n                              <span data-current-value>\n                                {{- selected_value | default: choose_an_option -}}\n                              </span>\n                              <svg\n                                class=\"t4s-icon-select-arrow\"\n                                role=\"presentation\"\n                                viewBox=\"0 0 19 12\"\n                              >\n                                <use xlink:href=\"#t4s-select-arrow\"></use>\n                              </svg>\n                            </button>\n                            <div\n                              data-dropdown-wrapper\n                              class=\"t4s-dropdown__wrapper t4s-current-scrollbar\"\n                              id=\"t4s_nt_{{ pr_sid }}{{ forloop.index }}\"\n                            >\n                              <div class=\"t4s-drop-arrow\"></div>\n                              <div class=\"t4s-dropdown__content\">\n                                {%- for value in option.values -%}\n                                  <div\n                                    data-swatch-item\n                                    data-dropdown-off\n                                    class=\"t4s-swatch__item t4s-truncate{% if selected_value == value %} is--selected{% endif %}\"\n                                    data-value=\"{{ value | escape }}\"\n                                  >\n                                    {{ value | replace: '\"', '' }}\n                                  </div>\n                                {%- endfor -%}\n                              </div>\n                            </div>\n                          {%- endif -%}\n                        </div>\n                      {%- endunless -%}\n                    </div>\n\n                    {%- comment %} Custom order notice - shown when custom option is selected {%- endcomment %}\n                    {%- assign show_custom_notice = false -%}\n                    {%- for custom_val in custom_values_array -%}\n                      {%- if selected_value == custom_val -%}\n                        {%- assign show_custom_notice = true -%}\n                        {%- break -%}\n                      {%- endif -%}\n                    {%- endfor -%}\n                    <div\n                      class=\"pfd-custom-notice\"\n                      style=\"display: {% if show_custom_notice %}block{% else %}none{% endif %};\"\n                    >\n                      <div class=\"pfd-custom-notice-content\">\n                        <svg\n                          class=\"pfd-custom-notice-icon\"\n                          xmlns=\"http://www.w3.org/2000/svg\"\n                          width=\"24\"\n                          height=\"24\"\n                          viewBox=\"0 0 24 24\"\n                          fill=\"none\"\n                          stroke=\"currentColor\"\n                          stroke-width=\"2\"\n                          stroke-linecap=\"round\"\n                          stroke-linejoin=\"round\"\n                        >\n                          <circle cx=\"12\" cy=\"12\" r=\"10\"></circle>\n                          <polyline points=\"12 6 12 12 16 14\"></polyline>\n                        </svg>\n                        <p class=\"pfd-custom-notice-text\">\n                          Custom {{ option_name | downcase }}s are <strong>made to order</strong>. Please allow\n                          <span class=\"pfd-custom-notice-highlight\">6-8 weeks</span> for delivery.\n                        </p>\n                      </div>\n                    </div>\n\n                    {%- comment %} Configuration-based custom content for options {%- endcomment %}\n                    {%- comment %} Renders ALL matching option content, shows only the selected one {%- endcomment %}\n                    {%- assign option_name_lower = option_name | downcase -%}\n                    {%- assign selected_value_lower = selected_value | downcase -%}\n\n                    {%- capture all_option_info -%}\n  {%- for pair in option_content_pairs -%}\n    {%- assign pair_cleaned = pair | strip -%}\n    {%- if pair_cleaned contains '|' -%}\n      {%- assign parts = pair_cleaned | split: '|' -%}\n      {%- assign option_key_full = parts[0] | strip -%}\n      {%- assign content_value = parts[1] | strip -%}\n\n      {%- if option_key_full contains ':' -%}\n        {%- assign key_parts = option_key_full | split: ':' -%}\n        {%- assign option_key = key_parts[0] | strip | downcase -%}\n        {%- assign value_key = key_parts[1] | strip -%}\n        {%- assign value_key_lower = value_key | downcase -%}\n\n        {%- if option_name_lower == option_key -%}\n          {%- assign is_selected = false -%}\n          {%- if selected_value_lower == value_key_lower -%}\n            {%- assign is_selected = true -%}\n          {%- endif -%}\n          <div class=\"pfd-option-info-item\"\n               data-option-name=\"{{ option_name_lower }}\"\n               data-option-value=\"{{ value_key | handle }}\"\n               style=\"{% unless is_selected %}display: none;{% endunless %}\">\n            {{ content_value }}\n          </div>\n        {%- endif -%}\n      {%- endif -%}\n    {%- endif -%}\n  {%- endfor -%}\n{%- endcapture -%}\n\n                    {%- assign all_option_info_stripped = all_option_info | strip -%}\n                    {%- if all_option_info_stripped != blank -%}\n                      <div class=\"pfd-custom-option-info\" data-option-info-container=\"{{ option_name_lower }}\">\n                        {{ all_option_info }}\n                      </div>\n                    {%- endif -%}\n                  </div>\n                {%- endif -%}\n              {%- endfor -%}\n            </div>\n          {%- endif -%}\n\n          {%- liquid\n            if arr_properties.size > 0 and isProductAvailable\n              render 'frm_properties', arr_properties: arr_properties, product: product\n            endif\n          -%}\n\n          {%- if use_incoming_mess\n            and current_variant_incoming\n            and pr_variants.size == 1\n            and current_variant.next_incoming_date != blank\n          -%}\n            {%- assign format_date = current_variant.next_incoming_date | date: date_in -%}\n            {% comment %}<div class=\"t4s-incoming__mess\">{% if current_variant_available %}{{ 'products.product_single.will_not_ship_until_html' | t: date: format_date }}{% else %}{{ 'products.product_single.will_be_in_stock_after_html' | t: date: format_date }}{% endif %}</div>{% endcomment %}\n          {%- elsif use_incoming_mess and pr_variants.size > 1 -%}\n            {%- liquid\n              assign format_date = current_variant.next_incoming_date | date: date_in\n              unless format_date\n                assign format_date = '19041994'\n              endunless\n            -%}\n            {% comment %}<div data-incoming__mess class=\"t4s-incoming__mess\"{% unless current_variant_incoming %} hidden{% endunless %}><span data-incoming-available{% if current_variant_available == false or current_variant == blank %} style=\"display: none\"{% endif %}>{{ 'products.product_single.will_not_ship_until_html' | t: date: format_date }}</span><span data-incoming-soldout{% if current_variant_available or current_variant == blank %} style=\"display: none\"{% endif %}>{{ 'products.product_single.will_be_in_stock_after_html' | t: date: format_date }}</span></div>{% endcomment %}\n          {%- endif -%}\n\n          {{ 'button-style.css' | asset_url | stylesheet_tag }}\n          <link\n            href=\"{{ 'custom-effect.css' | asset_url }}\"\n            rel=\"stylesheet\"\n            media=\"print\"\n            onload=\"this.media='all'\"\n          >\n\n          {{- html_price -}}\n\n          <div\n            class=\"t4s-product-form__buttons\"\n            style=\"--pr-btn-round: {{ bk_stts.pr_btn_round }}px;--wis-cp-btn-round: {{ bk_stts.wis_cp_btn_round }}px;\"\n          >\n            <div class=\"t4s-pr__qty_cart t4s-d-flex t4s-flex-wrap\">\n              {%- if isExternal -%}\n                <a\n                  href=\"{{ external_link }}\"\n                  rel=\"nofollow\"\n                  target=\"_blank\"\n                  class=\"t4s-product-form__submit t4s-btn t4s-btn-base t4s-btn-style-{{ bk_stts.button_style }} t4s-btn-color-{{ bk_stts.button_color }} t4s-w-100 t4s-justify-content-center {% if bk_stts.button_style == 'default' or bk_stts.button_style == 'outline' %} t4s-btn-effect-{{ bk_stts.button_effect }}{% endif %} t4s-truncate is--btn-external t4s-btn-loading__svg\"\n                >\n                  {%- if bk_stts.btn_icon -%}\n                    <svg class=\"t4s-btn-icon\" viewBox=\"0 0 24 24\">\n                      <use xlink:href=\"#t4s-icon-atc\"></use>\n                    </svg>\n                  {%- endif -%}\n                  <span class=\"t4s-btn-atc_text\">\n                    {{- external_title -}}\n                  </span>\n                  <span class=\"t4s-loading__spinner\" hidden>\n                    <svg\n                      width=\"16\"\n                      height=\"16\"\n                      hidden\n                      class=\"t4s-svg-spinner\"\n                      focusable=\"false\"\n                      role=\"presentation\"\n                      viewBox=\"0 0 66 66\"\n                      xmlns=\"http://www.w3.org/2000/svg\"\n                    >\n                      <circle class=\"t4s-path\" fill=\"none\" stroke-width=\"6\" cx=\"33\" cy=\"33\" r=\"30\"></circle>\n                    </svg>\n                  </span>\n                </a>\n              {%- else -%}\n                {%- if bk_stts.show_qty and isProductAvailable -%}\n                  <div\n                    data-quantity-wrapper\n                    class=\"t4s-quantity-wrapper t4s-product-form__qty\"\n                  >\n                    <button\n                      data-quantity-selector\n                      data-decrease-qty\n                      type=\"button\"\n                      class=\"t4s-quantity-selector is--minus\"\n                    ></button>\n                    <input\n                      data-quantity-value\n                      type=\"number\"\n                      class=\"t4s-quantity-input\"\n                      step=\"1\"\n                      min=\"{{cus_qty}}\"\n                      max=\"{{max_qty}}\"\n                      name=\"quantity\"\n                      value=\"{{cus_qty}}\"\n                      size=\"4\"\n                      pattern=\"[0-9]*\"\n                      inputmode=\"numeric\"\n                    >\n                    <button\n                      data-quantity-selector\n                      data-increase-qty\n                      type=\"button\"\n                      class=\"t4s-quantity-selector is--plus\"\n                    ></button>\n                  </div>\n                {%- else -%}\n                  <input type=\"hidden\" name=\"quantity\" value=\"1\">\n                {%- endif -%}\n                {% if customer %}\n                  <button\n                    data-animation-atc='{ \"ani\": \"{{ bk_stts.ani }}\",\"time\": {{ bk_stts.time }}000 }'\n                    type=\"submit\"\n                    name=\"add\"\n                    data-atc-form\n                    class=\"t4s-product-form__submit t4s-btn t4s-btn-base t4s-btn-style-{{ bk_stts.button_style }} t4s-btn-color-{{ bk_stts.button_color }} t4s-w-100 t4s-justify-content-center {% if bk_stts.button_style == 'default' or bk_stts.button_style == 'outline' %} t4s-btn-effect-{{ bk_stts.button_effect }}{% endif %} t4s-btn-loading__svg\"\n                    {% unless current_variant_available %}\n                      aria-disabled=\"true\"\n                    {% endunless -%}\n                    {% unless isProductAvailable %}\n                      disabled=\"disabled\"\n                    {% endunless %}\n                  >\n                    {%- if bk_stts.btn_icon -%}\n                      <svg\n                        class=\"t4s-btn-icon\"\n                        viewBox=\"0 0 24 24\"\n                      >\n                        <use xlink:href=\"#t4s-icon-atc\"></use>\n                      </svg>\n                    {%- endif -%}\n                    <span class=\"t4s-btn-atc_text\">\n                      {%- if current_variant_available == false or isProductAvailable == false -%}\n                        {{- 'products.product.sold_out' | t -}}\n                      {%- elsif isPreoder -%}\n                        {{- 'products.product.pre_order' | t }}\n                      {%- else -%}\n                        {{ 'products.product.add_to_cart' | t }}\n                      {%- endif -%}\n                    </span>\n                    <span class=\"t4s-loading__spinner\" hidden>\n                      <svg\n                        width=\"16\"\n                        height=\"16\"\n                        hidden\n                        class=\"t4s-svg-spinner\"\n                        focusable=\"false\"\n                        role=\"presentation\"\n                        viewBox=\"0 0 66 66\"\n                        xmlns=\"http://www.w3.org/2000/svg\"\n                      >\n                        <circle class=\"t4s-path\" fill=\"none\" stroke-width=\"6\" cx=\"33\" cy=\"33\" r=\"30\"></circle>\n                      </svg>\n                    </span>\n                  </button>\n                {% else %}\n                  <a\n                    href=\"/account/login\"\n                    onclick=\"rememberPage(event)\"\n                    data-drawer-delay-\n                    data-drawer-options='{ \"id\": \"#t4s-login-sidebar\" }'\n                    class=\"atc-btn t4s-btn t4s-btn-base t4s-btn-style-default t4s-btn-color-dark t4s-w-100 t4s-justify-content-center t4s-btn-effect-sweep-to-right t4s-btn-loading__svg\"\n                  >\n                    <svg\n                      class=\"t4s-btn-icon\"\n                      viewBox=\"0 0 24 24\"\n                      style=\"margin-right:4px\"\n                    >\n                      <use xlink:href=\"#t4s-icon-atc\"></use>\n                    </svg>\n                    <span class=\"t4s-btn-atc_text\">Login to Shop</span>\n                    <span class=\"t4s-loading__spinner\" hidden=\"\">\n                      <svg\n                        width=\"16\"\n                        height=\"16\"\n                        hidden=\"\"\n                        class=\"t4s-svg-spinner\"\n                        focusable=\"false\"\n                        role=\"presentation\"\n                        viewBox=\"0 0 66 66\"\n                        xmlns=\"http://www.w3.org/2000/svg\"\n                      >\n                        <circle class=\"t4s-path\" fill=\"none\" stroke-width=\"6\" cx=\"33\" cy=\"33\" r=\"30\"></circle>\n                      </svg>\n                    </span>\n                  </a>\n                {% endif %}\n              {%- endif -%}\n            </div>\n            {%- if PR_buy_pr and type != 'main_sticky' %}\n              {{- form | payment_button -}}\n            {% endif -%}\n            {%- if settings.use_notify_me -%}\n              {% if customer -%}\n                <button\n                  data-class=\"t4s-mfp-btn-close-inline\"\n                  data-id=\"t4s-pr-popup__notify-stock\"\n                  data-storageid=\"notify-stock{{ current_variant.id }}\"\n                  data-mfp-src\n                  data-open-mfp-ajax\n                  class=\"t4s-pr__notify-stock{% if current_variant_available or current_variant == blank %} t4s-d-none{% endif %}\"\n                  type=\"button\"\n                  data-notify-stock-btn\n                  data-variant-id=\"{{ current_variant.id }}\"\n                  data-root-url=\"{{ routes.root_url }}\"\n                >\n                  {{ 'products.notify_stock.trigger' | t }}\n                </button>\n              {%- endif %}\n            {%- endif -%}\n            {%- if bk_stts.enable_wishlist or bk_stts.enable_compare -%}\n              <div class=\"t4s-pr__wis_cp\">\n                {%- render 't4s_wis_cp', product: product, bk_stts: bk_stts, disableTooltip: true -%}\n              </div>\n            {%- endif -%}\n          </div>\n        {%- endform -%}\n        {%- unless isProductDefault or type == 'main_sticky' -%}\n          <script type=\"application/json\" class=\"pr_variants_json\">\n            {{ shsd_product_variants | json }}\n          </script>\n          <script type=\"application/json\" class=\"pr_options_json\">\n            {{ shsd_product_options_with_values | json }}\n          </script>\n        {%- endunless -%}\n        {%- if bk_stts.ani != 'none' -%}\n          <link\n            href=\"{{ 'ani-atc.min.css' | asset_url }}\"\n            rel=\"stylesheet\"\n            media=\"print\"\n            onload=\"this.media='all'\"\n          >\n        {%- endif -%}\n      </div>\n    </div>\n  </div>\n\n  <script>\n    (function () {\n      'use strict';\n\n      function updateOptionInfo(container, selectedValue) {\n        var optionName = container.getAttribute('data-option-name');\n        if (!optionName) return;\n        optionName = optionName.toLowerCase();\n\n        var infoContainer = container.querySelector('[data-option-info-container=\"' + optionName + '\"]');\n        if (!infoContainer) return;\n\n        var valueHandle = selectedValue\n          .toLowerCase()\n          .replace(/\\s+/g, '-')\n          .replace(/[^a-z0-9-]/g, '');\n        var infoItems = infoContainer.querySelectorAll('.pfd-option-info-item');\n\n        infoItems.forEach(function (item) {\n          var itemValue = item.getAttribute('data-option-value');\n          item.style.display = itemValue === valueHandle ? '' : 'none';\n        });\n      }\n\n      function initOptionInfoHandler() {\n        var swatchContainers = document.querySelectorAll('[data-swatch-option]');\n\n        swatchContainers.forEach(function (container) {\n          // Method 1: MutationObserver for instant updates\n          var observer = new MutationObserver(function (mutations) {\n            mutations.forEach(function (mutation) {\n              if (mutation.type === 'attributes' && mutation.attributeName === 'class') {\n                var target = mutation.target;\n                if (target.classList.contains('is--selected') && target.hasAttribute('data-value')) {\n                  var selectedValue = target.getAttribute('data-value');\n                  updateOptionInfo(container, selectedValue);\n                }\n              }\n            });\n          });\n\n          observer.observe(container, {\n            attributes: true,\n            subtree: true,\n            attributeFilter: ['class'],\n          });\n\n          // Method 2: Backup click handler with small delay\n          var swatchItems = container.querySelectorAll('[data-swatch-item]');\n          swatchItems.forEach(function (swatch) {\n            swatch.addEventListener('click', function () {\n              var selectedValue = this.getAttribute('data-value');\n              if (!selectedValue) return;\n              setTimeout(function () {\n                updateOptionInfo(container, selectedValue);\n              }, 10);\n            });\n          });\n        });\n      }\n\n      if (document.readyState === 'loading') {\n        document.addEventListener('DOMContentLoaded', initOptionInfoHandler);\n      } else {\n        initOptionInfoHandler();\n      }\n\n      document.addEventListener('shopify:section:load', initOptionInfoHandler);\n    })();\n  </script>\n</div>\n{%- if PR_buy_pr and current_variant_available != true and type != 'main_sticky' -%}\n  <style>\n    #t4s-callBackVariant{{ product_form_id }} .shopify-payment-button { display: none;}\n  </style>\n{% endif -%}\n",
              "reasoning": "Refactor the is-sw-cl__label color swatch branch: move the restock badge inside [data-img-el] so JS finds and reuses it (no duplicate), fix dedup using @@ sentinel delimiter, clean up pfd-has-lengths class logic, and pre-compute lengths before the btn-wrap div."
            },
            "result": "(no result received)",
            "isError": true,
            "elapsedMs": 0
          },
          {
            "name": "edit_lines",
            "id": "toolu_0148PEvCsXSYmALgL3TC6z3i",
            "input": {
              "filePath": "snippets/product-form-dynamic.liquid",
              "startLine": 410,
              "endLine": 470,
              "newContent": "                            {%- comment %} Compute available standard lengths for this color (used for both classes and content) {%- endcomment -%}\n                            {%- assign avail_lengths = '' -%}\n                            {%- assign avail_lengths_seen = '' -%}\n                            {%- assign length_opt_key = 'option' | append: length_option_position -%}\n                            {%- if length_option_position > 0 and color_option_position > 0 -%}\n                              {%- for lv in shsd_product_variants -%}\n                                {%- assign v_color_key = 'option' | append: color_option_position -%}\n                                {%- assign v_color_val = lv[v_color_key] | handle -%}\n                                {%- if v_color_val == color_handle and lv.available -%}\n                                  {%- assign v_length_val = lv[length_opt_key] -%}\n                                  {%- if v_length_val != blank -%}\n                                    {%- assign is_custom_length = false -%}\n                                    {%- if custom_option_names -%}\n                                      {%- for custom_name in custom_option_names -%}\n                                        {%- assign custom_name_stripped = custom_name | strip -%}\n                                        {%- if v_length_val == custom_name_stripped -%}\n                                          {%- assign is_custom_length = true -%}\n                                          {%- break -%}\n                                        {%- endif -%}\n                                      {%- endfor -%}\n                                    {%- endif -%}\n                                    {%- unless is_custom_length -%}\n                                      {%- assign v_length_clean = v_length_val | replace: '\"', '' | strip -%}\n                                      {%- assign sentinel = '@@' | append: v_length_clean | append: '@@' -%}\n                                      {%- unless avail_lengths_seen contains sentinel -%}\n                                        {%- assign avail_lengths_seen = avail_lengths_seen | append: sentinel -%}\n                                        {%- if avail_lengths == '' -%}\n                                          {%- assign avail_lengths = v_length_clean -%}\n                                        {%- else -%}\n                                          {% avail_lengths | append: ', ' | append: v_length_clean -%}\n                                        {%- endif -%}\n                                      {%- endunless -%}\n                                    {%- endunless -%}\n                                  {%- endif -%}\n                                {%- endif -%}\n                              {%- endfor -%}\n                            {%- endif -%}\n\n                            <div\n                              data-swatch-item\n                              class=\"t4s-swatch__btn-wrap{% if selected_value == value %} is--selected{% endif %}{% unless color_is_available %} is--out-of-stock{% if avail_lengths != '' %} pfd-has-lengths{% endif %}{% endunless %}\"\n                              data-value=\"{{ value | escape }}\"\n                              data-available=\"{{ color_is_available }}\"\n                            >\n                              <!-- DEBUG: color={{ color_handle }} | available={{ color_is_available }} | selected_opt1={{ product.selected_or_first_available_variant.option1 | handle }} | selected_opt2={{ product.selected_or_first_available_variant.option2 | handle }} -->\n                              <div\n                                data-img-el\n                                class=\"t4s-swatch__item {{ color_swatch }}bg_color_{{ value | handle }} lazyloadt4s\"\n                              >\n                                <img crossorigin=\"anonymous\">\n                                {%- unless color_is_available -%}\n                                  <span class=\"t4s-swatch__re-visible\">Awaiting Restock</span>\n                                {%- endunless -%}\n                              </div>\n                              {%- unless color_is_available -%}\n                                {%- if avail_lengths != '' -%}\n                                  <span class=\"t4s-swatch__available-lengths is-visible\">Available in {{ avail_lengths }}</span>\n                                {%- endif -%}\n                              {%- endunless -%}\n                              <span class=\"t4s-swatch__label\">\n                                {{- value | replace: '\"', '' -}}\n                              </span>\n                              {%- if color_nickname != blank -%}\n                                <span class=\"t4s-swatch__nickname\">{{ color_nickname }}</span>\n                              {%- endif -%}\n                            </div>\n                          {%- endfor -%}\n",
              "reasoning": "Refactor the is-sw-cl__label color swatch branch: move the restock badge inside [data-img-el] so JS finds and reuses it (no duplicate), fix dedup using @@ sentinel delimiter, clean up pfd-has-lengths class logic, and pre-compute lengths before the btn-wrap div."
            },
            "result": "(no result received)",
            "isError": true,
            "elapsedMs": 0
          },
          {
            "name": "propose_code_edit",
            "id": "pm-change-1772176119255",
            "input": {
              "filePath": "product-form-dynamic.liquid",
              "newContent": "{% comment %} Custom options configuration - options listed here will render as dropdowns {% endcomment %}\n{% assign custom_option_names = product.metafields.custom.custom_values.value %}\n\n{% comment %} Custom content configuration for specific options {% endcomment %}\n{% comment %} Format: option_name:option_value|<html content> - separated by semicolons for multiple {% endcomment %}\n\n{% assign option_content_config = 'texture:Straight|<div class=\"pfd-info-content\"><span class=\"pfd-info-icon\">i</span><span class=\"pfd-info-text\">Our straight texture has slight natural wave texture to it when washed and dried. It is not pin straight hair, nor is that desirable among most clientele.</span></div>;texture:Natural Wave|<div class=\"pfd-info-content\"><span class=\"pfd-info-icon\">i</span><span class=\"pfd-info-text\">Our natural wave texture features soft, beachy waves that blend seamlessly with most natural hair textures. Low maintenance and versatile for everyday styling.</span></div>;texture:Loose Curl|<div class=\"pfd-info-content\"><span class=\"pfd-info-icon\">i</span><span class=\"pfd-info-text\">Our loose curl texture offers bouncy, defined curls that hold their shape beautifully. Perfect for adding volume and movement with minimal styling required.</span></div>;texture:Tight Curl|<div class=\"pfd-info-content\"><span class=\"pfd-info-icon\">i</span><span class=\"pfd-info-text\">Our tight curl texture provides well-defined, springy curls with maximum volume. Ideal for protective styles and blending with naturally curly hair.</span></div>' %}\n\n{% assign option_content_pairs = option_content_config | split: ';' %}\n\n{% comment %} SellersDash collect child product details {% endcomment %}\n{% assign shsd_product_details = product.metafields.sellersdash.shsdproducts %}\n{% if shsd_product_details.product_type == 'shsd_parent' %}\n  {% assign shsd_product_handles = product.handle %}\n  {% assign shsd_product_handles = shsd_product_handles | concat: shsd_product_details.handles %}\n  {% for shsd_handle in shsd_product_handles %}\n    {% assign shsd_single_product = all_products[shsd_handle] %}\n    {% assign shsd_product_variants = shsd_product_variants | concat: shsd_single_product.variants %}\n    {% assign shsd_product_media = shsd_product_media | concat: shsd_single_product.media %}\n    {% assign shsd_product_images = shsd_product_images | concat: shsd_single_product.images %}\n  {% endfor %}\n  {% assign shsd_product_options_with_values = shsd_product_details.options_with_values %}\n{% else %}\n  {% assign shsd_product_options_with_values = product.options_with_values %}\n  {% assign shsd_product_variants = product.variants %}\n  {% assign shsd_product_media = product.media %}\n  {% assign shsd_product_images = product.images %}\n{% endif %}\n\n{% comment %} Reorder options: Length, Texture, Color, then remaining {% endcomment %}\n{% assign reordered_options = '' | split: '' %}\n{% assign remaining_options = '' | split: '' %}\n\n{% for option in shsd_product_options_with_values %}\n  {% assign opt_name_lower = option.name | downcase | strip %}\n  {% if opt_name_lower == 'length' %}\n    {% assign length_slice = shsd_product_options_with_values | slice: forloop.index0, 1 %}\n  {% elsif opt_name_lower == 'texture' %}\n    {% assign texture_slice = shsd_product_options_with_values | slice: forloop.index0, 1 %}\n  {% elsif opt_name_lower == 'color' or opt_name_lower == 'colour' or opt_name_lower == 'colors' %}\n    {% assign color_slice = shsd_product_options_with_values | slice: forloop.index0, 1 %}\n  {% else %}\n    {% assign other_slice = shsd_product_options_with_values | slice: forloop.index0, 1 %}\n    {% assign remaining_options = remaining_options | concat: other_slice %}\n  {% endif %}\n{% endfor %}\n\n{% if length_slice %}\n  {% assign reordered_options = reordered_options | concat: length_slice %}\n{% endif %}\n{% if texture_slice %}\n  {% assign reordered_options = reordered_options | concat: texture_slice %}\n{% endif %}\n{% if color_slice %}\n  {% assign reordered_options = reordered_options | concat: color_slice %}\n{% endif %}\n{% assign shsd_product_options_with_values = reordered_options | concat: remaining_options %}\n\n{%- assign product_form_id = 'product-form-' | append: pr_sid -%}\n{%- liquid\n  assign pr_variants = shsd_product_variants\n  assign PR_buy_pr = false\n  if bk_stts.show_dynamic_checkout and isExternal == false and isProductAvailable\n    assign PR_buy_pr = true\n  endif\n  assign choose_an_option = 'products.product.choose_an_option' | t\n  assign date_in = settings.date_in\n  assign class_frm = 't4s-form__product has--form__swatch'\n  if isProductDefault\n    assign class_frm = 't4s-form__product'\n  endif\n  if arr_properties.size > 0 and isProductAvailable\n    assign class_frm = class_frm | append: ' has--properties'\n  endif\n  if settings.sticky_atc and type == 'main'\n    assign class_frm = class_frm | append: ' is--main-sticky'\n  else\n    assign class_frm = class_frm | append: ' is--atc-sticky'\n  endif\n\n  assign color_swatch = 'disabled-'\n  assign color_mode = bk_stts.color_mode\n  assign selector_mode = bk_stts.selector_mode\n  assign stt_color_ck = settings.color_ck | default: ';'\n  assign color_ck = stt_color_ck | append: ',color,colors,couleur,colour' | remove: ';,'\n  assign get_color = color_ck | downcase | replace: ' ,', ',' | replace: ', ', ',' | split: ',' | uniq\n  assign color_mode_list = 'color, color is-sw-cl__round, color is-sw-cl__round is-sw-cl__label, variant_image, variant_image is-sw-cl__round, variant_image is-sw-cl__round is-sw-cl__label' | split: ', '\n  if color_mode_list contains color_mode\n    assign color_swatch = 'is-sw__color '\n  endif\n  assign current_variant_available = current_variant.available\n  assign use_incoming_mess = settings.use_incoming_mess\n  assign current_variant_incoming = false\n  assign current_inventory_quantity = current_variant.inventory_quantity\n  if current_inventory_quantity <= 0 and current_variant.inventory_management == 'shopify' and current_variant.incoming\n    assign current_variant_incoming = true\n  endif\n  if pos_sizeg == '1'\n    assign html_sizeg = ''\n  endif\n  if current_variant.inventory_management != null and current_inventory_quantity > 0 and current_variant.inventory_policy != 'continue'\n    assign max_qty = current_inventory_quantity\n  else\n    assign max_qty = 9999\n  endif\n  if color_mode contains 'color' or color_mode contains 'variant'\n    assign show_tooltip = ''\n  else\n    assign show_tooltip = '-off'\n  endif\n-%}\n\n{%- if product.metafields.custom.default_variant.value -%}\n  <script>\n    window.__HAS_SELECTED__ = {{ product.selected_variant | json }};\n    window.__DEFAULT_VARIANT__ = {{ product.metafields.custom.default_variant.value | json }};\n  </script>\n{%- endif -%}\n\n{%- assign length_option_position = -1 -%}\n{%- assign color_option_position = -1 -%}\n{%- for opt_name in product.options -%}\n  {%- assign opt_name_down = opt_name | downcase -%}\n  {%- if opt_name_down == 'length' -%}\n    {%- assign length_option_position = forloop.index -%}\n  {%- endif -%}\n  {%- if get_color contains opt_name_down -%}\n    {%- assign color_option_position = forloop.index -%}\n  {%- endif -%}\n{%- endfor -%}\n\n<script>\n  window.__CUSTOM_OPTION_NAMES__ = {{ custom_option_names | json }};\n  window.__LENGTH_OPTION_INDEX__ = {{ length_option_position | minus: 1 }};\n</script>\n\n{%- comment -%} Load dropdown CSS if either color mode or selector mode is dropdown {%- endcomment -%}\n\n{%- if color_mode == 'dropdown' or selector_mode == 'dropdown' -%}\n  <link\n    rel=\"stylesheet\"\n    href=\"{{ 'base_drop.min.css' | asset_url }}\"\n    media=\"all\"\n  >\n{%- endif -%}\n\n{%- comment -%} Custom CSS for product form dynamic {%- endcomment -%}\n{{ 'product-form-dynamic.css' | asset_url | stylesheet_tag }}\n\n<div class=\"pfd-override-wrapper\">\n  <div class=\"pfd-custom-wrapper\">\n    <div\n      class=\"t4s-product-form__variants is-no-pick__{{ PR_no_pick }}{% if PR_buy_pr %} is-payment-btn-true t4s-payment-button t4s-btn-color-{{ bk_stts.button_color_payment }}{% endif %} is-remove-soldout-{{ remove_soldout }} is-btn-full-width__{{ bk_stts.btn_atc_full }} is-btn-atc-txt-{{ bk_stts.btn_txt }} is-btn-ck-txt-{{ bk_stts.btn_txt2 }} is--fist-ratio-{{ is_fit_ratio_img }}\"\n      style=\"{% if is_fit_ratio_img %} --fit-ratio-img: {{ first_ratio_img }}; {% endif %} --wishlist-color: {{bk_stts.wishlist_color}};--wishlist-hover-color: {{bk_stts.wishlist_color_hover}};--wishlist-active-color: {{bk_stts.wishlist_color_active}};--compare-color: {{bk_stts.compare_color}};--compare-hover-color: {{bk_stts.compare_color_hover}};--compare-active-color: {{bk_stts.compare_color_active}};\"\n      {{ shopify_attributes }}\n    >\n      <div data-callBackVariant id=\"t4s-callBackVariant{{ product_form_id }}\">\n        {%- form 'product',\n          product,\n          id: product_form_id,\n          data-productid: product.id,\n          class: class_frm,\n          novalidate: 'novalidate',\n          data-type: 'add-to-cart-form',\n          data-disable-swatch: isProductDefault\n        -%}\n          {% comment %}{{- form | payment_terms -}}{% endcomment %}\n          {%- if isProductDefault -%}\n            <input\n              name=\"id\"\n              value=\"{{ pr_variants.first.id }}\"\n              type=\"hidden\"\n            >\n            {%- if advance_pr_type != blank -%}\n              {%- render 'choose_style', advance_pr_type: advance_pr_type, title: advance_label, pid: product.id -%}\n            {%- endif -%}\n          {%- else -%}\n            {{ 'swatch.css' | asset_url | stylesheet_tag }}\n            <select\n              name=\"id\"\n              id=\"product-select-{{ pr_sid }}\"\n              class=\"t4s-product__select t4s-d-none\"\n            >\n              {%- for variant in pr_variants -%}\n                {%- if variant.available -%}\n                  <option\n                    data-option1=\"{{ variant.option1 }}\"\n                    data-option2=\"{{ variant.option2 }}\"\n                    value=\"{{ variant.id }}\"\n                    data-mdid=\"{{ variant.featured_media.id | json }}\"\n                    data-incoming=\"{{ variant.incoming }}\"\n                    data-inventoryQuantity=\"{{ variant.inventory_quantity | json }}\"\n                    data-inventoryPolicy=\"{{ variant.inventory_policy | json }}\"\n                    data-nextIncomingDate=\"{{ variant.next_incoming_date | date: date_in }}\"\n                    {% if variant.id == current_variant.id %}\n                      selected=\"selected\"\n                    {% endif %}\n                  >\n                    {{ variant.title | escape }}\n                  </option>\n                {%- else -%}\n                  <option\n                    data-option1=\"{{ variant.option1 }}\"\n                    data-option2=\"{{ variant.option2 }}\"\n                    value=\"{{ variant.id }}\"\n                    data-mdid=\"{{ variant.featured_media.id | json }}\"\n                    data-incoming=\"{{ variant.incoming }}\"\n                    data-inventoryQuantity=\"{{ variant.inventory_quantity | json }}\"\n                    data-inventoryPolicy=\"{{ variant.inventory_policy | json }}\"\n                    data-nextIncomingDate=\"{{ variant.next_incoming_date | date: date_in }}\"\n                  >\n                    {{ variant.title | escape }}\n                  </option>\n                {%- endif -%}\n              {%- endfor -%}\n            </select>\n\n            <div class=\"pfd-variant-images\" style=\"display:none !important;\">\n              <div class=\"pfd-main-imgs\">\n                {%- for variant in pr_variants -%}\n                  {% assign var_imgs = variant.metafields.custom.variant_image.value %}\n                  <div\n                    class=\"pfd-img-listing\"\n                    data-var-img=\"{{ variant.image.src | img_url: 'master' }}\"\n                    data-pfd-variant-id=\"{{ variant.id }}\"\n                  >\n                    {% for value in var_imgs %}\n                      <div class=\"pfd-media-item\">\n                        <img src=\"{{value | img_url: 'master'}}\">\n                      </div>\n                    {% endfor %}\n                  </div>\n                {%- endfor -%}\n              </div>\n              <div class=\"pfd-thumb-imgs\">\n                {%- for variant in pr_variants -%}\n                  {% assign var_imgs = variant.metafields.custom.variant_image.value %}\n                  <div class=\"pfd-img-listing\" data-pfd-variant-id=\"{{ variant.id }}\">\n                    {% for value in var_imgs %}\n                      <div class=\"pfd-media-thumb\">\n                        <div\n                          class=\"pfd-img\"\n                          style=\"background-image:url('{{value | img_url: \"master\"}}');\"\n                        ></div>\n                      </div>\n                    {% endfor %}\n                  </div>\n                {%- endfor -%}\n              </div>\n            </div>\n\n            <div class=\"t4s-swatch t4s-color-mode__{{ color_mode }} t4s-color-size__{{ bk_stts.color_size }} t4s-selector-mode__{{ selector_mode }}\">\n              {%- if advance_pr_type != blank -%}\n                {%- render 'choose_style', advance_pr_type: advance_pr_type, title: advance_label, pid: product.id -%}\n              {%- endif -%}\n\n              {%- for option in shsd_product_options_with_values -%}\n                {%- liquid\n                  assign option_index = 'option' | append: forloop.index\n                  assign selected_value = product.selected_or_first_available_variant[option_index]\n                  assign option_name = option.name\n                  assign name_downcase = option_name | downcase\n                -%}\n\n                {%- if get_color contains name_downcase -%}\n                  {% comment %}--MARK: Color Option{% endcomment %}\n\n                  {% comment %} Build color nickname map from variant metafields {% endcomment %}\n                  {%- capture color_nicknames_map -%}\n                    {%- for variant in shsd_product_variants -%}\n                      {%- if variant.metafields.custom.variant_color != blank -%}\n                        {%- for opt_index in (1..3) -%}\n                          {%- assign opt_key = 'option' | append: opt_index -%}\n                          {%- assign opt_val = variant[opt_key] -%}\n                          {%- if opt_val != blank -%}\n                            {%- assign opt_index_adjusted = opt_index | minus: 1 -%}\n                            {%- assign opt_name_check = product.options[opt_index_adjusted] | downcase -%}\n                            {%- if get_color contains opt_name_check -%}\n                              {{ opt_val | handle }}:{{ variant.metafields.custom.variant_color }};\n                            {%- endif -%}\n                          {%- endif -%}\n                        {%- endfor -%}\n                      {%- endif -%}\n                    {%- endfor -%}\n                  {%- endcapture -%}\n                  {%- assign color_nicknames_map = color_nicknames_map | strip -%}\n\n                  <div\n                    data-swatch-option\n                    data-option-name=\"{{ option_name | escape }}\"\n                    data-id=\"{{ forloop.index0 }}\"\n                    data-option-unit=\"\n                      {%- liquid\n                        assign option_unit = ''\n                        if se_stts and se_stts.option_units and se_stts.option_units != blank\n                          assign option_units_raw = se_stts.option_units | strip | newline_to_br | split: '<br />'\n                          for pair in option_units_raw\n                            assign pair_cleaned = pair | strip\n                            if pair_cleaned contains ':'\n                              assign key_value = pair_cleaned | split: ':'\n                              assign key = key_value[0] | strip\n                              assign value = key_value[1] | strip\n                              if key == option_name and value != blank\n                                assign option_unit = value\n                                break\n                              endif\n                            endif\n                          endfor\n                        endif\n                      -%}{{ option_unit | escape }}\n                    \"\n                    class=\"t4s-swatch__option is-t4s-style__color is-t4s-name__{{ option_name | handle }} {% cycle 'is--first-color', '', '' %}\"\n                  >\n                    <h4 class=\"t4s-swatch__title t4s-swatch__title--color\">\n                      <span class=\"t4s-swatch__title--left\">\n                        <span class=\"bold\">\n                          {{- option_name | upcase -}}\n                          {%- liquid\n                            assign option_unit = ''\n                            if se_stts and se_stts.option_units and se_stts.option_units != blank\n                              assign option_units_raw = se_stts.option_units | strip | newline_to_br | split: '<br />'\n                              for pair in option_units_raw\n                                assign pair_cleaned = pair | strip\n                                if pair_cleaned contains ':'\n                                  assign key_value = pair_cleaned | split: ':'\n                                  assign key = key_value[0] | strip\n                                  assign value = key_value[1] | strip\n                                  if key == option_name and value != blank\n                                    assign option_unit = value\n                                    break\n                                  endif\n                                endif\n                              endfor\n                            endif\n                          -%}\n                          {%- if option_unit != blank %} ({{ option_unit }}){%- endif -%}\n                          :\n                        </span>\n                        <span class=\"t4s-selected-value\">\n                          {%- assign display_value = selected_value | default: choose_an_option | replace: '\"', '' -%}\n                          {{- display_value -}}\n                          {%- if option_unit != blank %} {{ option_unit }}{%- endif -%}\n                        </span>\n                      </span>\n                      {%- if name_sizeg == name_downcase -%}\n                        {{- html_sizeg -}}\n                      {%- endif %}\n                    </h4>\n\n                    <div data-swatch-list class=\"t4s-swatch__list\">\n                      {%- if color_mode != 'dropdown' -%}\n                        {%- if color_mode contains 'is-sw-cl__label' -%}\n                          {%- for value in option.values -%}\n                            {%- assign color_handle = value | handle -%}\n\n                            {%- comment %} Look up color nickname from map {%- endcomment -%}\n                            {%- assign color_nickname = '' -%}\n                            {%- assign nickname_pairs = color_nicknames_map | split: ';' -%}\n                            {%- for pair in nickname_pairs -%}\n                              {%- assign pair_clean = pair | strip -%}\n                              {%- if pair_clean != blank -%}\n                                {%- assign pair_parts = pair_clean | split: ':' -%}\n                                {%- if pair_parts[0] == color_handle -%}\n                                  {%- assign color_nickname = pair_parts[1] -%}\n                                  {%- break -%}\n                                {%- endif -%}\n                              {%- endif -%}\n                            {%- endfor -%}\n\n                            {%- comment %} Context-aware availability check: color + current other selections {%- endcomment -%}\n                            {%- assign color_is_available = false -%}\n                            {%- for variant in shsd_product_variants -%}\n                              {%- assign matches_color = false -%}\n                              {%- assign matches_other_options = true -%}\n\n                              {%- for opt_idx in (1..3) -%}\n                                {%- assign opt_key = 'option' | append: opt_idx -%}\n                                {%- assign variant_opt_val = variant[opt_key] -%}\n                                {%- if variant_opt_val != blank -%}\n                                  {%- assign variant_opt_handle = variant_opt_val | handle -%}\n\n                                  {%- comment %} Determine if this option index is the color option {%- endcomment -%}\n                                  {%- assign opt_idx_adjusted = opt_idx | minus: 1 -%}\n                                  {%- assign this_opt_name = product.options[opt_idx_adjusted] | downcase -%}\n\n                                  {%- if get_color contains this_opt_name -%}\n                                    {%- comment %} This is the color option - check if it matches our target color {%- endcomment -%}\n                                    {%- if variant_opt_handle == color_handle -%}\n                                      {%- assign matches_color = true -%}\n                                    {%- endif -%}\n                                  {%- else -%}\n                                    {%- comment %} This is a non-color option - check if variant matches current selection {%- endcomment -%}\n                                    {%- assign current_selected_val = product.selected_or_first_available_variant[opt_key] -%}\n                                    {%- if current_selected_val != blank -%}\n                                      {%- assign current_selected_handle = current_selected_val | handle -%}\n                                      {%- unless variant_opt_handle == current_selected_handle -%}\n                                        {%- assign matches_other_options = false -%}\n                                      {%- endunless -%}\n                                    {%- endif -%}\n                                  {%- endif -%}\n                                {%- endif -%}\n                              {%- endfor -%}\n\n                              {%- if matches_color and matches_other_options and variant.available -%}\n                                {%- assign color_is_available = true -%}\n                                {%- break -%}\n                              {%- endif -%}\n                            {%- endfor -%}\n\n                            {%- comment %} Compute available standard lengths for this color (used for both classes and content) {%- endcomment -%}\n                            {%- assign avail_lengths = '' -%}\n                            {%- assign avail_lengths_seen = '' -%}\n                            {%- assign length_opt_key = 'option' | append: length_option_position -%}\n                            {%- if length_option_position > 0 and color_option_position > 0 -%}\n                              {%- for lv in shsd_product_variants -%}\n                                {%- assign v_color_key = 'option' | append: color_option_position -%}\n                                {%- assign v_color_val = lv[v_color_key] | handle -%}\n                                {%- if v_color_val == color_handle and lv.available -%}\n                                  {%- assign v_length_val = lv[length_opt_key] -%}\n                                  {%- if v_length_val != blank -%}\n                                    {%- assign is_custom_length = false -%}\n                                    {%- if custom_option_names -%}\n                                      {%- for custom_name in custom_option_names -%}\n                                        {%- assign custom_name_stripped = custom_name | strip -%}\n                                        {%- if v_length_val == custom_name_stripped -%}\n                                          {%- assign is_custom_length = true -%}\n                                          {%- break -%}\n                                        {%- endif -%}\n                                      {%- endfor -%}\n                                    {%- endif -%}\n                                    {%- unless is_custom_length -%}\n                                      {%- assign v_length_clean = v_length_val | replace: '\"', '' | strip -%}\n                                      {%- assign sentinel = '@@' | append: v_length_clean | append: '@@' -%}\n                                      {%- unless avail_lengths_seen contains sentinel -%}\n                                        {%- assign avail_lengths_seen = avail_lengths_seen | append: sentinel -%}\n                                        {%- if avail_lengths == '' -%}\n                                          {%- assign avail_lengths = v_length_clean -%}\n                                        {%- else -%}\n                                          {%- assign avail_lengths = avail_lengths | append: ', ' | append: v_length_clean -%}\n\n                                        {%- endif -%}\n                                      {%- endunless -%}\n                                    {%- endunless -%}\n                                  {%- endif -%}\n                                {%- endif -%}\n                              {%- endfor -%}\n                            {%- endif -%}\n\n                            <div\n                              data-swatch-item\n                              class=\"t4s-swatch__btn-wrap{% if selected_value == value %} is--selected{% endif %}{% unless color_is_available %} is--out-of-stock{% if avail_lengths != '' %} pfd-has-lengths{% endif %}{% endunless %}\"\n                              data-value=\"{{ value | escape }}\"\n                              data-available=\"{{ color_is_available }}\"\n                            >\n                              <!-- DEBUG: color={{ color_handle }} | available={{ color_is_available }} | selected_opt1={{ product.selected_or_first_available_variant.option1 | handle }} | selected_opt2={{ product.selected_or_first_available_variant.option2 | handle }} -->\n                              <div\n                                data-img-el\n                                class=\"t4s-swatch__item {{ color_swatch }}bg_color_{{ value | handle }} lazyloadt4s\"\n                              >\n                                <img crossorigin=\"anonymous\">\n                                {%- unless color_is_available -%}\n                                  <span class=\"t4s-swatch__re-visible\">Awaiting Restock</span>\n                                {%- endunless -%}\n                              </div>\n                              {%- unless color_is_available -%}\n                                {%- if avail_lengths != '' -%}\n                                  <span class=\"t4s-swatch__available-lengths is-visible\">Available in {{ avail_lengths }}</span>\n                                {%- endif -%}\n                              {%- endunless -%}\n                              <span class=\"t4s-swatch__label\">\n                                {{- value | replace: '\"', '' -}}\n                              </span>\n                              {%- if color_nickname != blank -%}\n                                <span class=\"t4s-swatch__nickname\">{{ color_nickname }}</span>\n                              {%- endif -%}\n                            </div>\n                          {%- endfor -%}\n\n                          {%- endfor -%}\n\n                        {%- else -%}\n                          {%- for value in option.values -%}\n                            {%- assign color_handle = value | handle -%}\n\n                            {%- comment %} Look up color nickname {%- endcomment -%}\n                            {%- assign color_nickname = '' -%}\n                            {%- assign nickname_pairs = color_nicknames_map | split: ';' -%}\n                            {%- for pair in nickname_pairs -%}\n                              {%- assign pair_clean = pair | strip -%}\n                              {%- if pair_clean != blank -%}\n                                {%- assign pair_parts = pair_clean | split: ':' -%}\n                                {%- if pair_parts[0] == color_handle -%}\n                                  {%- assign color_nickname = pair_parts[1] -%}\n                                  {%- break -%}\n                                {%- endif -%}\n                              {%- endif -%}\n                            {%- endfor -%}\n\n                            {%- comment %} Context-aware availability check: color + current other selections {%- endcomment -%}\n                            {%- assign color_is_available = false -%}\n                            {%- for variant in shsd_product_variants -%}\n                              {%- assign matches_color = false -%}\n                              {%- assign matches_other_options = true -%}\n\n                              {%- for opt_idx in (1..3) -%}\n                                {%- assign opt_key = 'option' | append: opt_idx -%}\n                                {%- assign variant_opt_val = variant[opt_key] -%}\n                                {%- if variant_opt_val != blank -%}\n                                  {%- assign variant_opt_handle = variant_opt_val | handle -%}\n\n                                  {%- comment %} Determine if this option index is the color option {%- endcomment -%}\n                                  {%- assign opt_idx_adjusted = opt_idx | minus: 1 -%}\n                                  {%- assign this_opt_name = product.options[opt_idx_adjusted] | downcase -%}\n\n                                  {%- if get_color contains this_opt_name -%}\n                                    {%- comment %} This is the color option - check if it matches our target color {%- endcomment -%}\n                                    {%- if variant_opt_handle == color_handle -%}\n                                      {%- assign matches_color = true -%}\n                                    {%- endif -%}\n                                  {%- else -%}\n                                    {%- comment %} This is a non-color option - check if variant matches current selection {%- endcomment -%}\n                                    {%- assign current_selected_val = product.selected_or_first_available_variant[opt_key] -%}\n                                    {%- if current_selected_val != blank -%}\n                                      {%- assign current_selected_handle = current_selected_val | handle -%}\n                                      {%- unless variant_opt_handle == current_selected_handle -%}\n                                        {%- assign matches_other_options = false -%}\n                                      {%- endunless -%}\n                                    {%- endif -%}\n                                  {%- endif -%}\n                                {%- endif -%}\n                              {%- endfor -%}\n\n                              {%- if matches_color and matches_other_options and variant.available -%}\n                                {%- assign color_is_available = true -%}\n                                {%- break -%}\n                              {%- endif -%}\n                            {%- endfor -%}\n\n                            <div\n                              data-swatch-item\n                              class=\"t4s-swatch__btn-wrap{% if selected_value == value %} is--selected{% endif %}{% unless color_is_available %} is--out-of-stock{% endunless %}{%- unless color_is_available -%}{%- assign avail_lengths_check = '' -%}{%- assign length_opt_key_check = 'option' | append: length_option_position -%}{%- if length_option_position > 0 -%}{%- for variant in shsd_product_variants -%}{%- assign v_color_key_c = 'option' | append: color_option_position -%}{%- if variant[v_color_key_c] | handle == color_handle and variant.available -%}{%- assign v_lv = variant[length_opt_key_check] -%}{%- if v_lv != blank -%}{%- assign is_cl = false -%}{%- if custom_option_names -%}{%- for cn in custom_option_names -%}{%- if v_lv == cn -%}{%- assign is_cl = true -%}{%- break -%}{%- endif -%}{%- endfor -%}{%- endif -%}{%- unless is_cl -%}{%- assign avail_lengths_check = avail_lengths_check | append: 'x' -%}{%- endunless -%}{%- endif -%}{%- endif -%}{%- endfor -%}{%- endif -%}{%- if avail_lengths_check != '' %} pfd-has-lengths{%- endif -%}{%- endunless -%}\"\n                              data-value=\"{{ value | escape }}\"\n                              data-available=\"{{ color_is_available }}\"\n                            >\n\n                              <div\n  data-img-el\n  class=\"t4s-swatch__item {{ color_swatch }}bg_color_{{ value | handle }} lazyloadt4s\"\n>\n  <img crossorigin=\"anonymous\">\n</div>\n                              {%- unless color_is_available -%}\n                                <span class=\"t4s-swatch__restock-badge\">Awaiting Restock</span>\n                                {%- comment %} Compute available standard lengths for this color {%- endcomment -%}\n                                {%- assign avail_lengths = '' -%}\n                                {%- assign length_opt_key = 'option' | append: length_option_position -%}\n                                {%- if length_option_position > 0 -%}\n                                  {%- for variant in shsd_product_variants -%}\n                                    {%- assign v_color_key = 'option' | append: color_option_position -%}\n                                    {%- assign v_color_val = variant[v_color_key] | handle -%}\n                                    {%- if v_color_val == color_handle and variant.available -%}\n                                      {%- assign v_length_val = variant[length_opt_key] -%}\n                                      {%- if v_length_val != blank -%}\n                                        {%- assign is_custom_length = false -%}\n                                        {%- if custom_option_names -%}\n                                          {%- for custom_name in custom_option_names -%}\n                                            {%- if v_length_val == custom_name -%}\n                                              {%- assign is_custom_length = true -%}\n                                              {%- break -%}\n                                            {%- endif -%}\n                                          {%- endfor -%}\n                                        {%- endif -%}\n                                        {%- unless is_custom_length -%}\n                                          {%- assign v_length_clean = v_length_val | replace: '\"', '' -%}\n                                          {%- assign length_check = '|' | append: v_length_clean | append: '|' -%}\n                                          {%- assign lengths_haystack = '|' | append: avail_lengths | replace: ', ', '|,|' | append: '|' -%}\n                                          {%- unless lengths_haystack contains length_check -%}\n                                            {%- if avail_lengths == '' -%}\n                                              {%- assign avail_lengths = v_length_clean -%}\n                                            {%- else -%}\n                                              {%- assign avail_lengths = avail_lengths | append: ', ' | append: v_length_clean -%}\n                                            {%- endif -%}\n                                          {%- endunless -%}\n                                        {%- endunless -%}\n                                      {%- endif -%}\n                                    {%- endif -%}\n                                  {%- endfor -%}\n                                {%- endif -%}\n                                {%- if avail_lengths != '' -%}\n                                  <span class=\"t4s-swatch__available-lengths is-visible\">Available in {{ avail_lengths }}</span>\n                                {%- endif -%}\n                              {%- endunless -%}\n                              {%- if color_nickname != blank -%}\n                                <span class=\"t4s-swatch__nickname\">{{ color_nickname }}</span>\n                              {%- endif -%}\n                            </div>\n\n                          {%- endfor -%}\n                        {%- endif -%}\n                      {%- else -%}\n                        <button\n                          type=\"button\"\n                          data-dropdown-open\n                          data-position=\"bottom-end\"\n                          data-id=\"t4s_nt_{{ pr_sid }}{{ forloop.index }}\"\n                        >\n                          <span data-current-value>\n                            {{- selected_value | default: choose_an_option -}}\n                          </span>\n                          <svg\n                            class=\"t4s-icon-select-arrow\"\n                            role=\"presentation\"\n                            viewBox=\"0 0 19 12\"\n                          >\n                            <use xlink:href=\"#t4s-select-arrow\"></use>\n                          </svg>\n                        </button>\n                        <div\n                          data-dropdown-wrapper\n                          class=\"t4s-dropdown__wrapper t4s-current-scrollbar\"\n                          id=\"t4s_nt_{{ pr_sid }}{{ forloop.index }}\"\n                        >\n                          <div class=\"t4s-drop-arrow\"></div>\n                          <div class=\"t4s-dropdown__header\">\n                            <span\n                              data-current-value\n                              class=\"t4s-dropdown__title\"\n                            >\n                              {{- selected_value | default: choose_an_option -}}\n                            </span>\n                            <button\n                              data-dropdown-close\n                              aria-label=\"{{ 'general.aria.close' | t }}\"\n                            >\n                              <svg\n                                role=\"presentation\"\n                                class=\"t4s-iconsvg-close\"\n                                viewBox=\"0 0 16 14\"\n                              >\n                                <path d=\"M15 0L1 14m14 0L1 0\" stroke=\"currentColor\" fill=\"none\" fill-rule=\"evenodd\"></path>\n                              </svg>\n                            </button>\n                          </div>\n                          <div class=\"t4s-dropdown__content\">\n                            {%- for value in option.values -%}\n                              <div\n                                data-swatch-item\n                                data-dropdown-off\n                                class=\"t4s-swatch__item t4s-truncate {{ color_swatch }}bg_color_{{ value | handle }} lazyloadt4s{% if selected_value == value %} is--selected{% endif %}\"\n                                data-value=\"{{ value | escape }}\"\n                              >\n                                {{ value | replace: '\"', '' }}\n                              </div>\n                            {%- endfor -%}\n                          </div>\n                        </div>\n                      {%- endif -%}\n                    </div>\n                    {%- render 'color-info-accordion' -%}\n                  </div>\n                {%- else -%}\n                  {% comment %}--MARK: Non-Color{% endcomment %}\n                  {%- liquid\n                    assign standard_values = ''\n                    assign custom_values = ''\n                    assign has_standard = false\n                    assign has_custom = false\n\n                    for value in option.values\n                      assign is_custom = false\n                      for custom_name in custom_option_names\n                        assign custom_name_clean = custom_name | strip\n                        if value contains custom_name_clean\n                          assign is_custom = true\n                          break\n                        endif\n                      endfor\n\n                      if is_custom\n                        if custom_values == ''\n                          assign custom_values = value\n                        else\n                          assign custom_values = custom_values | append: ',' | append: value\n                        endif\n                        assign has_custom = true\n                      else\n                        if standard_values == ''\n                          assign standard_values = value\n                        else\n                          assign standard_values = standard_values | append: ',' | append: value\n                        endif\n                        assign has_standard = true\n                      endif\n                    endfor\n\n                    assign standard_values_array = standard_values | split: ','\n                    assign custom_values_array = custom_values | split: ','\n                  -%}\n\n                  <div\n                    data-swatch-option\n                    data-option-name=\"{{ option_name | escape }}\"\n                    data-id=\"{{ forloop.index0 }}\"\n                    data-option-unit=\"\n                      {%- liquid\n                        assign option_unit = ''\n                        if se_stts and se_stts.option_units and se_stts.option_units != blank\n                          assign option_units_raw = se_stts.option_units | strip | newline_to_br | split: '<br />'\n                          for pair in option_units_raw\n                            assign pair_cleaned = pair | strip\n                            if pair_cleaned contains ':'\n                              assign key_value = pair_cleaned | split: ':'\n                              assign key = key_value[0] | strip\n                              assign value = key_value[1] | strip\n                              if key == option_name and value != blank\n                                assign option_unit = value\n                                break\n                              endif\n                            endif\n                          endfor\n                        endif\n                      -%}{{ option_unit | escape }}\n                    \"\n                    class=\"t4s-swatch__option is-t4s-name__{{ option_name | handle }} pfd-split-option\"\n                  >\n                    <h4 class=\"t4s-swatch__title\">\n                      <span class=\"t4s-swatch__title--left\"\n                        >Select a\n                        <span class=\"bold\">\n                          {{- option_name -}}\n                        </span>\n                        {%- liquid\n                          assign option_unit = ''\n                          if se_stts and se_stts.option_units and se_stts.option_units != blank\n                            assign option_units_raw = se_stts.option_units | strip | newline_to_br | split: '<br />'\n                            for pair in option_units_raw\n                              assign pair_cleaned = pair | strip\n                              if pair_cleaned contains ':'\n                                assign key_value = pair_cleaned | split: ':'\n                                assign key = key_value[0] | strip\n                                assign value = key_value[1] | strip\n                                if key == option_name and value != blank\n                                  assign option_unit = value\n                                  break\n                                endif\n                              endif\n                            endfor\n                          endif\n                        -%}\n                        {%- if option_unit != blank %} ({{ option_unit }}){%- endif -%}\n                      </span>\n                      <span class=\"t4s-swatch__title--right\"\n                        >Selected:\n                        <span class=\"bold\">\n                          {%- assign display_value = selected_value | default: choose_an_option | replace: '\"', '' -%}\n                          {{- display_value -}}\n                          {%- if option_unit != blank %} {{ option_unit }}{%- endif -%}\n                        </span></span\n                      >\n                      {%- if name_sizeg == name_downcase -%}\n                        {{- html_sizeg -}}\n                      {%- endif %}\n                    </h4>\n\n                    <div class=\"pfd-split-selection\">\n                      {%- if has_standard -%}\n                        <div class=\"pfd-standard-options\">\n                          {%- if selector_mode != 'dropdown' -%}\n                            {%- for value in standard_values_array -%}\n                              <div\n                                data-swatch-item\n                                class=\"t4s-swatch__item{% if selected_value == value %} is--selected{% endif %}\"\n                                data-value=\"{{ value | escape }}\"\n                              >\n                                {{ value | replace: '\"', '' }}\n                              </div>\n                            {%- endfor -%}\n                          {%- else -%}\n                            <button\n                              type=\"button\"\n                              data-pfd-dropdown-open\n                              data-position=\"bottom-end\"\n                              data-id=\"t4s_nt_{{ pr_sid }}{{ forloop.index }}_standard\"\n                            >\n                              <span data-current-value>\n                                {{- selected_value | default: choose_an_option -}}\n                              </span>\n                              <svg\n                                class=\"t4s-icon-select-arrow\"\n                                role=\"presentation\"\n                                viewBox=\"0 0 19 12\"\n                              >\n                                <use xlink:href=\"#t4s-select-arrow\"></use>\n                              </svg>\n                            </button>\n                            <div\n                              data-dropdown-wrapper\n                              class=\"t4s-dropdown__wrapper t4s-current-scrollbar\"\n                              id=\"t4s_nt_{{ pr_sid }}{{ forloop.index }}_standard\"\n                            >\n                              <div class=\"t4s-drop-arrow\"></div>\n                              <div class=\"t4s-dropdown__content\">\n                                {%- for value in standard_values_array -%}\n                                  <div\n                                    data-swatch-item\n                                    data-dropdown-off\n                                    class=\"t4s-swatch__item t4s-truncate{% if selected_value == value %} is--selected{% endif %}\"\n                                    data-value=\"{{ value | escape }}\"\n                                  >\n                                    {{ value | replace: '\"', '' }}\n                                  </div>\n                                {%- endfor -%}\n                              </div>\n                            </div>\n                          {%- endif -%}\n                        </div>\n                      {%- endif -%}\n\n                      {%- if has_custom -%}\n                        <div class=\"pfd-custom-options\">\n                          {%- if has_standard and has_custom -%}\n                            <span class=\"pfd-or-separator\">or</span>\n                          {%- endif -%}\n                          <button\n                            type=\"button\"\n                            data-pfd-dropdown-open\n                            data-position=\"bottom-end\"\n                            data-id=\"t4s_nt_{{ pr_sid }}{{ forloop.index }}_custom\"\n                            class=\"pfd-custom-dropdown\"\n                          >\n                            <span data-current-value>\n                              {%- assign is_custom_selected = false -%}\n                              {%- for custom_val in custom_values_array -%}\n                                {%- if selected_value == custom_val -%}\n                                  {%- assign display_custom_val = custom_val | replace: '\"', '' -%}\n                                  {%- if option_unit != blank -%}\n                                    {{ display_custom_val }}\n                                    {{ option_unit }}\n                                    <span class=\"pfd-custom-badge\">Custom</span>\n                                  {%- else -%}\n                                    {{ display_custom_val }}\n                                    <span class=\"pfd-custom-badge\">Custom</span>\n                                  {%- endif -%}\n                                  {%- assign is_custom_selected = true -%}\n                                  {%- break -%}\n                                {%- endif -%}\n                              {%- endfor -%}\n                              {%- unless is_custom_selected -%}\n                                Custom {{ option_name | downcase }}\n                              {%- endunless -%}\n                            </span>\n                            <svg\n                              class=\"t4s-icon-select-arrow\"\n                              role=\"presentation\"\n                              viewBox=\"0 0 19 12\"\n                            >\n                              <use xlink:href=\"#t4s-select-arrow\"></use>\n                            </svg>\n                          </button>\n                          <div\n                            data-dropdown-wrapper\n                            class=\"t4s-dropdown__wrapper t4s-current-scrollbar\"\n                            id=\"t4s_nt_{{ pr_sid }}{{ forloop.index }}_custom\"\n                          >\n                            <div class=\"t4s-drop-arrow\"></div>\n                            <div class=\"t4s-dropdown__content\">\n                              {%- for value in custom_values_array -%}\n                                <div\n                                  data-swatch-item\n                                  data-dropdown-off\n                                  class=\"t4s-swatch__item t4s-truncate{% if selected_value == value %} is--selected{% endif %}\"\n                                  data-value=\"{{ value | escape }}\"\n                                >\n                                  <span class=\"pfd-checkmark\">✓</span>\n                                  <span class=\"pfd-option-text\">\n                                    {%- assign display_value = value | replace: '\"', '' -%}\n                                    {%- if option_unit != blank -%}\n                                      {{ display_value }}\n                                      {{ option_unit }}\n                                    {%- else -%}\n                                      {{ display_value }}\n                                    {%- endif -%}\n                                  </span>\n                                  <span class=\"pfd-custom-badge\">Custom</span>\n                                </div>\n                              {%- endfor -%}\n                            </div>\n                          </div>\n                        </div>\n                      {%- endif -%}\n\n                      {%- unless has_standard or has_custom -%}\n                        {%- comment %} Fallback to original rendering if no split detected {%- endcomment %}\n                        <div class=\"t4s-swatch__list pfd-fallback-list\">\n                          {%- if selector_mode != 'dropdown' -%}\n                            {%- for value in option.values -%}\n                              <div\n                                data-swatch-item\n                                class=\"t4s-swatch__item{% if selected_value == value %} is--selected{% endif %}\"\n                                data-value=\"{{ value | escape }}\"\n                              >\n                                {{ value | replace: '\"', '' }}\n                              </div>\n                            {%- endfor -%}\n                          {%- else -%}\n                            <button\n                              type=\"button\"\n                              data-pfd-dropdown-open\n                              data-position=\"bottom-end\"\n                              data-id=\"t4s_nt_{{ pr_sid }}{{ forloop.index }}\"\n                            >\n                              <span data-current-value>\n                                {{- selected_value | default: choose_an_option -}}\n                              </span>\n                              <svg\n                                class=\"t4s-icon-select-arrow\"\n                                role=\"presentation\"\n                                viewBox=\"0 0 19 12\"\n                              >\n                                <use xlink:href=\"#t4s-select-arrow\"></use>\n                              </svg>\n                            </button>\n                            <div\n                              data-dropdown-wrapper\n                              class=\"t4s-dropdown__wrapper t4s-current-scrollbar\"\n                              id=\"t4s_nt_{{ pr_sid }}{{ forloop.index }}\"\n                            >\n                              <div class=\"t4s-drop-arrow\"></div>\n                              <div class=\"t4s-dropdown__content\">\n                                {%- for value in option.values -%}\n                                  <div\n                                    data-swatch-item\n                                    data-dropdown-off\n                                    class=\"t4s-swatch__item t4s-truncate{% if selected_value == value %} is--selected{% endif %}\"\n                                    data-value=\"{{ value | escape }}\"\n                                  >\n                                    {{ value | replace: '\"', '' }}\n                                  </div>\n                                {%- endfor -%}\n                              </div>\n                            </div>\n                          {%- endif -%}\n                        </div>\n                      {%- endunless -%}\n                    </div>\n\n                    {%- comment %} Custom order notice - shown when custom option is selected {%- endcomment %}\n                    {%- assign show_custom_notice = false -%}\n                    {%- for custom_val in custom_values_array -%}\n                      {%- if selected_value == custom_val -%}\n                        {%- assign show_custom_notice = true -%}\n                        {%- break -%}\n                      {%- endif -%}\n                    {%- endfor -%}\n                    <div\n                      class=\"pfd-custom-notice\"\n                      style=\"display: {% if show_custom_notice %}block{% else %}none{% endif %};\"\n                    >\n                      <div class=\"pfd-custom-notice-content\">\n                        <svg\n                          class=\"pfd-custom-notice-icon\"\n                          xmlns=\"http://www.w3.org/2000/svg\"\n                          width=\"24\"\n                          height=\"24\"\n                          viewBox=\"0 0 24 24\"\n                          fill=\"none\"\n                          stroke=\"currentColor\"\n                          stroke-width=\"2\"\n                          stroke-linecap=\"round\"\n                          stroke-linejoin=\"round\"\n                        >\n                          <circle cx=\"12\" cy=\"12\" r=\"10\"></circle>\n                          <polyline points=\"12 6 12 12 16 14\"></polyline>\n                        </svg>\n                        <p class=\"pfd-custom-notice-text\">\n                          Custom {{ option_name | downcase }}s are <strong>made to order</strong>. Please allow\n                          <span class=\"pfd-custom-notice-highlight\">6-8 weeks</span> for delivery.\n                        </p>\n                      </div>\n                    </div>\n\n                    {%- comment %} Configuration-based custom content for options {%- endcomment %}\n                    {%- comment %} Renders ALL matching option content, shows only the selected one {%- endcomment %}\n                    {%- assign option_name_lower = option_name | downcase -%}\n                    {%- assign selected_value_lower = selected_value | downcase -%}\n\n                    {%- capture all_option_info -%}\n  {%- for pair in option_content_pairs -%}\n    {%- assign pair_cleaned = pair | strip -%}\n    {%- if pair_cleaned contains '|' -%}\n      {%- assign parts = pair_cleaned | split: '|' -%}\n      {%- assign option_key_full = parts[0] | strip -%}\n      {%- assign content_value = parts[1] | strip -%}\n\n      {%- if option_key_full contains ':' -%}\n        {%- assign key_parts = option_key_full | split: ':' -%}\n        {%- assign option_key = key_parts[0] | strip | downcase -%}\n        {%- assign value_key = key_parts[1] | strip -%}\n        {%- assign value_key_lower = value_key | downcase -%}\n\n        {%- if option_name_lower == option_key -%}\n          {%- assign is_selected = false -%}\n          {%- if selected_value_lower == value_key_lower -%}\n            {%- assign is_selected = true -%}\n          {%- endif -%}\n          <div class=\"pfd-option-info-item\"\n               data-option-name=\"{{ option_name_lower }}\"\n               data-option-value=\"{{ value_key | handle }}\"\n               style=\"{% unless is_selected %}display: none;{% endunless %}\">\n            {{ content_value }}\n          </div>\n        {%- endif -%}\n      {%- endif -%}\n    {%- endif -%}\n  {%- endfor -%}\n{%- endcapture -%}\n\n                    {%- assign all_option_info_stripped = all_option_info | strip -%}\n                    {%- if all_option_info_stripped != blank -%}\n                      <div class=\"pfd-custom-option-info\" data-option-info-container=\"{{ option_name_lower }}\">\n                        {{ all_option_info }}\n                      </div>\n                    {%- endif -%}\n                  </div>\n                {%- endif -%}\n              {%- endfor -%}\n            </div>\n          {%- endif -%}\n\n          {%- liquid\n            if arr_properties.size > 0 and isProductAvailable\n              render 'frm_properties', arr_properties: arr_properties, product: product\n            endif\n          -%}\n\n          {%- if use_incoming_mess\n            and current_variant_incoming\n            and pr_variants.size == 1\n            and current_variant.next_incoming_date != blank\n          -%}\n            {%- assign format_date = current_variant.next_incoming_date | date: date_in -%}\n            {% comment %}<div class=\"t4s-incoming__mess\">{% if current_variant_available %}{{ 'products.product_single.will_not_ship_until_html' | t: date: format_date }}{% else %}{{ 'products.product_single.will_be_in_stock_after_html' | t: date: format_date }}{% endif %}</div>{% endcomment %}\n          {%- elsif use_incoming_mess and pr_variants.size > 1 -%}\n            {%- liquid\n              assign format_date = current_variant.next_incoming_date | date: date_in\n              unless format_date\n                assign format_date = '19041994'\n              endunless\n            -%}\n            {% comment %}<div data-incoming__mess class=\"t4s-incoming__mess\"{% unless current_variant_incoming %} hidden{% endunless %}><span data-incoming-available{% if current_variant_available == false or current_variant == blank %} style=\"display: none\"{% endif %}>{{ 'products.product_single.will_not_ship_until_html' | t: date: format_date }}</span><span data-incoming-soldout{% if current_variant_available or current_variant == blank %} style=\"display: none\"{% endif %}>{{ 'products.product_single.will_be_in_stock_after_html' | t: date: format_date }}</span></div>{% endcomment %}\n          {%- endif -%}\n\n          {{ 'button-style.css' | asset_url | stylesheet_tag }}\n          <link\n            href=\"{{ 'custom-effect.css' | asset_url }}\"\n            rel=\"stylesheet\"\n            media=\"print\"\n            onload=\"this.media='all'\"\n          >\n\n          {{- html_price -}}\n\n          <div\n            class=\"t4s-product-form__buttons\"\n            style=\"--pr-btn-round: {{ bk_stts.pr_btn_round }}px;--wis-cp-btn-round: {{ bk_stts.wis_cp_btn_round }}px;\"\n          >\n            <div class=\"t4s-pr__qty_cart t4s-d-flex t4s-flex-wrap\">\n              {%- if isExternal -%}\n                <a\n                  href=\"{{ external_link }}\"\n                  rel=\"nofollow\"\n                  target=\"_blank\"\n                  class=\"t4s-product-form__submit t4s-btn t4s-btn-base t4s-btn-style-{{ bk_stts.button_style }} t4s-btn-color-{{ bk_stts.button_color }} t4s-w-100 t4s-justify-content-center {% if bk_stts.button_style == 'default' or bk_stts.button_style == 'outline' %} t4s-btn-effect-{{ bk_stts.button_effect }}{% endif %} t4s-truncate is--btn-external t4s-btn-loading__svg\"\n                >\n                  {%- if bk_stts.btn_icon -%}\n                    <svg class=\"t4s-btn-icon\" viewBox=\"0 0 24 24\">\n                      <use xlink:href=\"#t4s-icon-atc\"></use>\n                    </svg>\n                  {%- endif -%}\n                  <span class=\"t4s-btn-atc_text\">\n                    {{- external_title -}}\n                  </span>\n                  <span class=\"t4s-loading__spinner\" hidden>\n                    <svg\n                      width=\"16\"\n                      height=\"16\"\n                      hidden\n                      class=\"t4s-svg-spinner\"\n                      focusable=\"false\"\n                      role=\"presentation\"\n                      viewBox=\"0 0 66 66\"\n                      xmlns=\"http://www.w3.org/2000/svg\"\n                    >\n                      <circle class=\"t4s-path\" fill=\"none\" stroke-width=\"6\" cx=\"33\" cy=\"33\" r=\"30\"></circle>\n                    </svg>\n                  </span>\n                </a>\n              {%- else -%}\n                {%- if bk_stts.show_qty and isProductAvailable -%}\n                  <div\n                    data-quantity-wrapper\n                    class=\"t4s-quantity-wrapper t4s-product-form__qty\"\n                  >\n                    <button\n                      data-quantity-selector\n                      data-decrease-qty\n                      type=\"button\"\n                      class=\"t4s-quantity-selector is--minus\"\n                    ></button>\n                    <input\n                      data-quantity-value\n                      type=\"number\"\n                      class=\"t4s-quantity-input\"\n                      step=\"1\"\n                      min=\"{{cus_qty}}\"\n                      max=\"{{max_qty}}\"\n                      name=\"quantity\"\n                      value=\"{{cus_qty}}\"\n                      size=\"4\"\n                      pattern=\"[0-9]*\"\n                      inputmode=\"numeric\"\n                    >\n                    <button\n                      data-quantity-selector\n                      data-increase-qty\n                      type=\"button\"\n                      class=\"t4s-quantity-selector is--plus\"\n                    ></button>\n                  </div>\n                {%- else -%}\n                  <input type=\"hidden\" name=\"quantity\" value=\"1\">\n                {%- endif -%}\n                {% if customer %}\n                  <button\n                    data-animation-atc='{ \"ani\": \"{{ bk_stts.ani }}\",\"time\": {{ bk_stts.time }}000 }'\n                    type=\"submit\"\n                    name=\"add\"\n                    data-atc-form\n                    class=\"t4s-product-form__submit t4s-btn t4s-btn-base t4s-btn-style-{{ bk_stts.button_style }} t4s-btn-color-{{ bk_stts.button_color }} t4s-w-100 t4s-justify-content-center {% if bk_stts.button_style == 'default' or bk_stts.button_style == 'outline' %} t4s-btn-effect-{{ bk_stts.button_effect }}{% endif %} t4s-btn-loading__svg\"\n                    {% unless current_variant_available %}\n                      aria-disabled=\"true\"\n                    {% endunless -%}\n                    {% unless isProductAvailable %}\n                      disabled=\"disabled\"\n                    {% endunless %}\n                  >\n                    {%- if bk_stts.btn_icon -%}\n                      <svg\n                        class=\"t4s-btn-icon\"\n                        viewBox=\"0 0 24 24\"\n                      >\n                        <use xlink:href=\"#t4s-icon-atc\"></use>\n                      </svg>\n                    {%- endif -%}\n                    <span class=\"t4s-btn-atc_text\">\n                      {%- if current_variant_available == false or isProductAvailable == false -%}\n                        {{- 'products.product.sold_out' | t -}}\n                      {%- elsif isPreoder -%}\n                        {{- 'products.product.pre_order' | t }}\n                      {%- else -%}\n                        {{ 'products.product.add_to_cart' | t }}\n                      {%- endif -%}\n                    </span>\n                    <span class=\"t4s-loading__spinner\" hidden>\n                      <svg\n                        width=\"16\"\n                        height=\"16\"\n                        hidden\n                        class=\"t4s-svg-spinner\"\n                        focusable=\"false\"\n                        role=\"presentation\"\n                        viewBox=\"0 0 66 66\"\n                        xmlns=\"http://www.w3.org/2000/svg\"\n                      >\n                        <circle class=\"t4s-path\" fill=\"none\" stroke-width=\"6\" cx=\"33\" cy=\"33\" r=\"30\"></circle>\n                      </svg>\n                    </span>\n                  </button>\n                {% else %}\n                  <a\n                    href=\"/account/login\"\n                    onclick=\"rememberPage(event)\"\n                    data-drawer-delay-\n                    data-drawer-options='{ \"id\": \"#t4s-login-sidebar\" }'\n                    class=\"atc-btn t4s-btn t4s-btn-base t4s-btn-style-default t4s-btn-color-dark t4s-w-100 t4s-justify-content-center t4s-btn-effect-sweep-to-right t4s-btn-loading__svg\"\n                  >\n                    <svg\n                      class=\"t4s-btn-icon\"\n                      viewBox=\"0 0 24 24\"\n                      style=\"margin-right:4px\"\n                    >\n                      <use xlink:href=\"#t4s-icon-atc\"></use>\n                    </svg>\n                    <span class=\"t4s-btn-atc_text\">Login to Shop</span>\n                    <span class=\"t4s-loading__spinner\" hidden=\"\">\n                      <svg\n                        width=\"16\"\n                        height=\"16\"\n                        hidden=\"\"\n                        class=\"t4s-svg-spinner\"\n                        focusable=\"false\"\n                        role=\"presentation\"\n                        viewBox=\"0 0 66 66\"\n                        xmlns=\"http://www.w3.org/2000/svg\"\n                      >\n                        <circle class=\"t4s-path\" fill=\"none\" stroke-width=\"6\" cx=\"33\" cy=\"33\" r=\"30\"></circle>\n                      </svg>\n                    </span>\n                  </a>\n                {% endif %}\n              {%- endif -%}\n            </div>\n            {%- if PR_buy_pr and type != 'main_sticky' %}\n              {{- form | payment_button -}}\n            {% endif -%}\n            {%- if settings.use_notify_me -%}\n              {% if customer -%}\n                <button\n                  data-class=\"t4s-mfp-btn-close-inline\"\n                  data-id=\"t4s-pr-popup__notify-stock\"\n                  data-storageid=\"notify-stock{{ current_variant.id }}\"\n                  data-mfp-src\n                  data-open-mfp-ajax\n                  class=\"t4s-pr__notify-stock{% if current_variant_available or current_variant == blank %} t4s-d-none{% endif %}\"\n                  type=\"button\"\n                  data-notify-stock-btn\n                  data-variant-id=\"{{ current_variant.id }}\"\n                  data-root-url=\"{{ routes.root_url }}\"\n                >\n                  {{ 'products.notify_stock.trigger' | t }}\n                </button>\n              {%- endif %}\n            {%- endif -%}\n            {%- if bk_stts.enable_wishlist or bk_stts.enable_compare -%}\n              <div class=\"t4s-pr__wis_cp\">\n                {%- render 't4s_wis_cp', product: product, bk_stts: bk_stts, disableTooltip: true -%}\n              </div>\n            {%- endif -%}\n          </div>\n        {%- endform -%}\n        {%- unless isProductDefault or type == 'main_sticky' -%}\n          <script type=\"application/json\" class=\"pr_variants_json\">\n            {{ shsd_product_variants | json }}\n          </script>\n          <script type=\"application/json\" class=\"pr_options_json\">\n            {{ shsd_product_options_with_values | json }}\n          </script>\n        {%- endunless -%}\n        {%- if bk_stts.ani != 'none' -%}\n          <link\n            href=\"{{ 'ani-atc.min.css' | asset_url }}\"\n            rel=\"stylesheet\"\n            media=\"print\"\n            onload=\"this.media='all'\"\n          >\n        {%- endif -%}\n      </div>\n    </div>\n  </div>\n\n  <script>\n    (function () {\n      'use strict';\n\n      function updateOptionInfo(container, selectedValue) {\n        var optionName = container.getAttribute('data-option-name');\n        if (!optionName) return;\n        optionName = optionName.toLowerCase();\n\n        var infoContainer = container.querySelector('[data-option-info-container=\"' + optionName + '\"]');\n        if (!infoContainer) return;\n\n        var valueHandle = selectedValue\n          .toLowerCase()\n          .replace(/\\s+/g, '-')\n          .replace(/[^a-z0-9-]/g, '');\n        var infoItems = infoContainer.querySelectorAll('.pfd-option-info-item');\n\n        infoItems.forEach(function (item) {\n          var itemValue = item.getAttribute('data-option-value');\n          item.style.display = itemValue === valueHandle ? '' : 'none';\n        });\n      }\n\n      function initOptionInfoHandler() {\n        var swatchContainers = document.querySelectorAll('[data-swatch-option]');\n\n        swatchContainers.forEach(function (container) {\n          // Method 1: MutationObserver for instant updates\n          var observer = new MutationObserver(function (mutations) {\n            mutations.forEach(function (mutation) {\n              if (mutation.type === 'attributes' && mutation.attributeName === 'class') {\n                var target = mutation.target;\n                if (target.classList.contains('is--selected') && target.hasAttribute('data-value')) {\n                  var selectedValue = target.getAttribute('data-value');\n                  updateOptionInfo(container, selectedValue);\n                }\n              }\n            });\n          });\n\n          observer.observe(container, {\n            attributes: true,\n            subtree: true,\n            attributeFilter: ['class'],\n          });\n\n          // Method 2: Backup click handler with small delay\n          var swatchItems = container.querySelectorAll('[data-swatch-item]');\n          swatchItems.forEach(function (swatch) {\n            swatch.addEventListener('click', function () {\n              var selectedValue = this.getAttribute('data-value');\n              if (!selectedValue) return;\n              setTimeout(function () {\n                updateOptionInfo(container, selectedValue);\n              }, 10);\n            });\n          });\n        });\n      }\n\n      if (document.readyState === 'loading') {\n        document.addEventListener('DOMContentLoaded', initOptionInfoHandler);\n      } else {\n        initOptionInfoHandler();\n      }\n\n      document.addEventListener('shopify:section:load', initOptionInfoHandler);\n    })();\n  </script>\n</div>\n{%- if PR_buy_pr and current_variant_available != true and type != 'main_sticky' -%}\n  <style>\n    #t4s-callBackVariant{{ product_form_id }} .shopify-payment-button { display: none;}\n  </style>\n{% endif -%}\n",
              "reasoning": "Fix missing 'assign' keyword — was a bare tag with no statement."
            },
            "result": "(no result received)",
            "isError": true,
            "elapsedMs": 0
          },
          {
            "name": "edit_lines",
            "id": "toolu_01TEvXEWpKHW4mN7BBXx3ENZ",
            "input": {
              "filePath": "snippets/product-form-dynamic.liquid",
              "startLine": 439,
              "endLine": 439,
              "newContent": "                                          {%- assign avail_lengths = avail_lengths | append: ', ' | append: v_length_clean -%}\n",
              "reasoning": "Fix missing 'assign' keyword — was a bare tag with no statement."
            },
            "result": "(no result received)",
            "isError": true,
            "elapsedMs": 0
          },
          {
            "name": "propose_code_edit",
            "id": "pm-change-1772176122422",
            "input": {
              "filePath": "product-form-dynamic.liquid",
              "newContent": "{% comment %} Custom options configuration - options listed here will render as dropdowns {% endcomment %}\n{% assign custom_option_names = product.metafields.custom.custom_values.value %}\n\n{% comment %} Custom content configuration for specific options {% endcomment %}\n{% comment %} Format: option_name:option_value|<html content> - separated by semicolons for multiple {% endcomment %}\n\n{% assign option_content_config = 'texture:Straight|<div class=\"pfd-info-content\"><span class=\"pfd-info-icon\">i</span><span class=\"pfd-info-text\">Our straight texture has slight natural wave texture to it when washed and dried. It is not pin straight hair, nor is that desirable among most clientele.</span></div>;texture:Natural Wave|<div class=\"pfd-info-content\"><span class=\"pfd-info-icon\">i</span><span class=\"pfd-info-text\">Our natural wave texture features soft, beachy waves that blend seamlessly with most natural hair textures. Low maintenance and versatile for everyday styling.</span></div>;texture:Loose Curl|<div class=\"pfd-info-content\"><span class=\"pfd-info-icon\">i</span><span class=\"pfd-info-text\">Our loose curl texture offers bouncy, defined curls that hold their shape beautifully. Perfect for adding volume and movement with minimal styling required.</span></div>;texture:Tight Curl|<div class=\"pfd-info-content\"><span class=\"pfd-info-icon\">i</span><span class=\"pfd-info-text\">Our tight curl texture provides well-defined, springy curls with maximum volume. Ideal for protective styles and blending with naturally curly hair.</span></div>' %}\n\n{% assign option_content_pairs = option_content_config | split: ';' %}\n\n{% comment %} SellersDash collect child product details {% endcomment %}\n{% assign shsd_product_details = product.metafields.sellersdash.shsdproducts %}\n{% if shsd_product_details.product_type == 'shsd_parent' %}\n  {% assign shsd_product_handles = product.handle %}\n  {% assign shsd_product_handles = shsd_product_handles | concat: shsd_product_details.handles %}\n  {% for shsd_handle in shsd_product_handles %}\n    {% assign shsd_single_product = all_products[shsd_handle] %}\n    {% assign shsd_product_variants = shsd_product_variants | concat: shsd_single_product.variants %}\n    {% assign shsd_product_media = shsd_product_media | concat: shsd_single_product.media %}\n    {% assign shsd_product_images = shsd_product_images | concat: shsd_single_product.images %}\n  {% endfor %}\n  {% assign shsd_product_options_with_values = shsd_product_details.options_with_values %}\n{% else %}\n  {% assign shsd_product_options_with_values = product.options_with_values %}\n  {% assign shsd_product_variants = product.variants %}\n  {% assign shsd_product_media = product.media %}\n  {% assign shsd_product_images = product.images %}\n{% endif %}\n\n{% comment %} Reorder options: Length, Texture, Color, then remaining {% endcomment %}\n{% assign reordered_options = '' | split: '' %}\n{% assign remaining_options = '' | split: '' %}\n\n{% for option in shsd_product_options_with_values %}\n  {% assign opt_name_lower = option.name | downcase | strip %}\n  {% if opt_name_lower == 'length' %}\n    {% assign length_slice = shsd_product_options_with_values | slice: forloop.index0, 1 %}\n  {% elsif opt_name_lower == 'texture' %}\n    {% assign texture_slice = shsd_product_options_with_values | slice: forloop.index0, 1 %}\n  {% elsif opt_name_lower == 'color' or opt_name_lower == 'colour' or opt_name_lower == 'colors' %}\n    {% assign color_slice = shsd_product_options_with_values | slice: forloop.index0, 1 %}\n  {% else %}\n    {% assign other_slice = shsd_product_options_with_values | slice: forloop.index0, 1 %}\n    {% assign remaining_options = remaining_options | concat: other_slice %}\n  {% endif %}\n{% endfor %}\n\n{% if length_slice %}\n  {% assign reordered_options = reordered_options | concat: length_slice %}\n{% endif %}\n{% if texture_slice %}\n  {% assign reordered_options = reordered_options | concat: texture_slice %}\n{% endif %}\n{% if color_slice %}\n  {% assign reordered_options = reordered_options | concat: color_slice %}\n{% endif %}\n{% assign shsd_product_options_with_values = reordered_options | concat: remaining_options %}\n\n{%- assign product_form_id = 'product-form-' | append: pr_sid -%}\n{%- liquid\n  assign pr_variants = shsd_product_variants\n  assign PR_buy_pr = false\n  if bk_stts.show_dynamic_checkout and isExternal == false and isProductAvailable\n    assign PR_buy_pr = true\n  endif\n  assign choose_an_option = 'products.product.choose_an_option' | t\n  assign date_in = settings.date_in\n  assign class_frm = 't4s-form__product has--form__swatch'\n  if isProductDefault\n    assign class_frm = 't4s-form__product'\n  endif\n  if arr_properties.size > 0 and isProductAvailable\n    assign class_frm = class_frm | append: ' has--properties'\n  endif\n  if settings.sticky_atc and type == 'main'\n    assign class_frm = class_frm | append: ' is--main-sticky'\n  else\n    assign class_frm = class_frm | append: ' is--atc-sticky'\n  endif\n\n  assign color_swatch = 'disabled-'\n  assign color_mode = bk_stts.color_mode\n  assign selector_mode = bk_stts.selector_mode\n  assign stt_color_ck = settings.color_ck | default: ';'\n  assign color_ck = stt_color_ck | append: ',color,colors,couleur,colour' | remove: ';,'\n  assign get_color = color_ck | downcase | replace: ' ,', ',' | replace: ', ', ',' | split: ',' | uniq\n  assign color_mode_list = 'color, color is-sw-cl__round, color is-sw-cl__round is-sw-cl__label, variant_image, variant_image is-sw-cl__round, variant_image is-sw-cl__round is-sw-cl__label' | split: ', '\n  if color_mode_list contains color_mode\n    assign color_swatch = 'is-sw__color '\n  endif\n  assign current_variant_available = current_variant.available\n  assign use_incoming_mess = settings.use_incoming_mess\n  assign current_variant_incoming = false\n  assign current_inventory_quantity = current_variant.inventory_quantity\n  if current_inventory_quantity <= 0 and current_variant.inventory_management == 'shopify' and current_variant.incoming\n    assign current_variant_incoming = true\n  endif\n  if pos_sizeg == '1'\n    assign html_sizeg = ''\n  endif\n  if current_variant.inventory_management != null and current_inventory_quantity > 0 and current_variant.inventory_policy != 'continue'\n    assign max_qty = current_inventory_quantity\n  else\n    assign max_qty = 9999\n  endif\n  if color_mode contains 'color' or color_mode contains 'variant'\n    assign show_tooltip = ''\n  else\n    assign show_tooltip = '-off'\n  endif\n-%}\n\n{%- if product.metafields.custom.default_variant.value -%}\n  <script>\n    window.__HAS_SELECTED__ = {{ product.selected_variant | json }};\n    window.__DEFAULT_VARIANT__ = {{ product.metafields.custom.default_variant.value | json }};\n  </script>\n{%- endif -%}\n\n{%- assign length_option_position = -1 -%}\n{%- assign color_option_position = -1 -%}\n{%- for opt_name in product.options -%}\n  {%- assign opt_name_down = opt_name | downcase -%}\n  {%- if opt_name_down == 'length' -%}\n    {%- assign length_option_position = forloop.index -%}\n  {%- endif -%}\n  {%- if get_color contains opt_name_down -%}\n    {%- assign color_option_position = forloop.index -%}\n  {%- endif -%}\n{%- endfor -%}\n\n<script>\n  window.__CUSTOM_OPTION_NAMES__ = {{ custom_option_names | json }};\n  window.__LENGTH_OPTION_INDEX__ = {{ length_option_position | minus: 1 }};\n</script>\n\n{%- comment -%} Load dropdown CSS if either color mode or selector mode is dropdown {%- endcomment -%}\n\n{%- if color_mode == 'dropdown' or selector_mode == 'dropdown' -%}\n  <link\n    rel=\"stylesheet\"\n    href=\"{{ 'base_drop.min.css' | asset_url }}\"\n    media=\"all\"\n  >\n{%- endif -%}\n\n{%- comment -%} Custom CSS for product form dynamic {%- endcomment -%}\n{{ 'product-form-dynamic.css' | asset_url | stylesheet_tag }}\n\n<div class=\"pfd-override-wrapper\">\n  <div class=\"pfd-custom-wrapper\">\n    <div\n      class=\"t4s-product-form__variants is-no-pick__{{ PR_no_pick }}{% if PR_buy_pr %} is-payment-btn-true t4s-payment-button t4s-btn-color-{{ bk_stts.button_color_payment }}{% endif %} is-remove-soldout-{{ remove_soldout }} is-btn-full-width__{{ bk_stts.btn_atc_full }} is-btn-atc-txt-{{ bk_stts.btn_txt }} is-btn-ck-txt-{{ bk_stts.btn_txt2 }} is--fist-ratio-{{ is_fit_ratio_img }}\"\n      style=\"{% if is_fit_ratio_img %} --fit-ratio-img: {{ first_ratio_img }}; {% endif %} --wishlist-color: {{bk_stts.wishlist_color}};--wishlist-hover-color: {{bk_stts.wishlist_color_hover}};--wishlist-active-color: {{bk_stts.wishlist_color_active}};--compare-color: {{bk_stts.compare_color}};--compare-hover-color: {{bk_stts.compare_color_hover}};--compare-active-color: {{bk_stts.compare_color_active}};\"\n      {{ shopify_attributes }}\n    >\n      <div data-callBackVariant id=\"t4s-callBackVariant{{ product_form_id }}\">\n        {%- form 'product',\n          product,\n          id: product_form_id,\n          data-productid: product.id,\n          class: class_frm,\n          novalidate: 'novalidate',\n          data-type: 'add-to-cart-form',\n          data-disable-swatch: isProductDefault\n        -%}\n          {% comment %}{{- form | payment_terms -}}{% endcomment %}\n          {%- if isProductDefault -%}\n            <input\n              name=\"id\"\n              value=\"{{ pr_variants.first.id }}\"\n              type=\"hidden\"\n            >\n            {%- if advance_pr_type != blank -%}\n              {%- render 'choose_style', advance_pr_type: advance_pr_type, title: advance_label, pid: product.id -%}\n            {%- endif -%}\n          {%- else -%}\n            {{ 'swatch.css' | asset_url | stylesheet_tag }}\n            <select\n              name=\"id\"\n              id=\"product-select-{{ pr_sid }}\"\n              class=\"t4s-product__select t4s-d-none\"\n            >\n              {%- for variant in pr_variants -%}\n                {%- if variant.available -%}\n                  <option\n                    data-option1=\"{{ variant.option1 }}\"\n                    data-option2=\"{{ variant.option2 }}\"\n                    value=\"{{ variant.id }}\"\n                    data-mdid=\"{{ variant.featured_media.id | json }}\"\n                    data-incoming=\"{{ variant.incoming }}\"\n                    data-inventoryQuantity=\"{{ variant.inventory_quantity | json }}\"\n                    data-inventoryPolicy=\"{{ variant.inventory_policy | json }}\"\n                    data-nextIncomingDate=\"{{ variant.next_incoming_date | date: date_in }}\"\n                    {% if variant.id == current_variant.id %}\n                      selected=\"selected\"\n                    {% endif %}\n                  >\n                    {{ variant.title | escape }}\n                  </option>\n                {%- else -%}\n                  <option\n                    data-option1=\"{{ variant.option1 }}\"\n                    data-option2=\"{{ variant.option2 }}\"\n                    value=\"{{ variant.id }}\"\n                    data-mdid=\"{{ variant.featured_media.id | json }}\"\n                    data-incoming=\"{{ variant.incoming }}\"\n                    data-inventoryQuantity=\"{{ variant.inventory_quantity | json }}\"\n                    data-inventoryPolicy=\"{{ variant.inventory_policy | json }}\"\n                    data-nextIncomingDate=\"{{ variant.next_incoming_date | date: date_in }}\"\n                  >\n                    {{ variant.title | escape }}\n                  </option>\n                {%- endif -%}\n              {%- endfor -%}\n            </select>\n\n            <div class=\"pfd-variant-images\" style=\"display:none !important;\">\n              <div class=\"pfd-main-imgs\">\n                {%- for variant in pr_variants -%}\n                  {% assign var_imgs = variant.metafields.custom.variant_image.value %}\n                  <div\n                    class=\"pfd-img-listing\"\n                    data-var-img=\"{{ variant.image.src | img_url: 'master' }}\"\n                    data-pfd-variant-id=\"{{ variant.id }}\"\n                  >\n                    {% for value in var_imgs %}\n                      <div class=\"pfd-media-item\">\n                        <img src=\"{{value | img_url: 'master'}}\">\n                      </div>\n                    {% endfor %}\n                  </div>\n                {%- endfor -%}\n              </div>\n              <div class=\"pfd-thumb-imgs\">\n                {%- for variant in pr_variants -%}\n                  {% assign var_imgs = variant.metafields.custom.variant_image.value %}\n                  <div class=\"pfd-img-listing\" data-pfd-variant-id=\"{{ variant.id }}\">\n                    {% for value in var_imgs %}\n                      <div class=\"pfd-media-thumb\">\n                        <div\n                          class=\"pfd-img\"\n                          style=\"background-image:url('{{value | img_url: \"master\"}}');\"\n                        ></div>\n                      </div>\n                    {% endfor %}\n                  </div>\n                {%- endfor -%}\n              </div>\n            </div>\n\n            <div class=\"t4s-swatch t4s-color-mode__{{ color_mode }} t4s-color-size__{{ bk_stts.color_size }} t4s-selector-mode__{{ selector_mode }}\">\n              {%- if advance_pr_type != blank -%}\n                {%- render 'choose_style', advance_pr_type: advance_pr_type, title: advance_label, pid: product.id -%}\n              {%- endif -%}\n\n              {%- for option in shsd_product_options_with_values -%}\n                {%- liquid\n                  assign option_index = 'option' | append: forloop.index\n                  assign selected_value = product.selected_or_first_available_variant[option_index]\n                  assign option_name = option.name\n                  assign name_downcase = option_name | downcase\n                -%}\n\n                {%- if get_color contains name_downcase -%}\n                  {% comment %}--MARK: Color Option{% endcomment %}\n\n                  {% comment %} Build color nickname map from variant metafields {% endcomment %}\n                  {%- capture color_nicknames_map -%}\n                    {%- for variant in shsd_product_variants -%}\n                      {%- if variant.metafields.custom.variant_color != blank -%}\n                        {%- for opt_index in (1..3) -%}\n                          {%- assign opt_key = 'option' | append: opt_index -%}\n                          {%- assign opt_val = variant[opt_key] -%}\n                          {%- if opt_val != blank -%}\n                            {%- assign opt_index_adjusted = opt_index | minus: 1 -%}\n                            {%- assign opt_name_check = product.options[opt_index_adjusted] | downcase -%}\n                            {%- if get_color contains opt_name_check -%}\n                              {{ opt_val | handle }}:{{ variant.metafields.custom.variant_color }};\n                            {%- endif -%}\n                          {%- endif -%}\n                        {%- endfor -%}\n                      {%- endif -%}\n                    {%- endfor -%}\n                  {%- endcapture -%}\n                  {%- assign color_nicknames_map = color_nicknames_map | strip -%}\n\n                  <div\n                    data-swatch-option\n                    data-option-name=\"{{ option_name | escape }}\"\n                    data-id=\"{{ forloop.index0 }}\"\n                    data-option-unit=\"\n                      {%- liquid\n                        assign option_unit = ''\n                        if se_stts and se_stts.option_units and se_stts.option_units != blank\n                          assign option_units_raw = se_stts.option_units | strip | newline_to_br | split: '<br />'\n                          for pair in option_units_raw\n                            assign pair_cleaned = pair | strip\n                            if pair_cleaned contains ':'\n                              assign key_value = pair_cleaned | split: ':'\n                              assign key = key_value[0] | strip\n                              assign value = key_value[1] | strip\n                              if key == option_name and value != blank\n                                assign option_unit = value\n                                break\n                              endif\n                            endif\n                          endfor\n                        endif\n                      -%}{{ option_unit | escape }}\n                    \"\n                    class=\"t4s-swatch__option is-t4s-style__color is-t4s-name__{{ option_name | handle }} {% cycle 'is--first-color', '', '' %}\"\n                  >\n                    <h4 class=\"t4s-swatch__title t4s-swatch__title--color\">\n                      <span class=\"t4s-swatch__title--left\">\n                        <span class=\"bold\">\n                          {{- option_name | upcase -}}\n                          {%- liquid\n                            assign option_unit = ''\n                            if se_stts and se_stts.option_units and se_stts.option_units != blank\n                              assign option_units_raw = se_stts.option_units | strip | newline_to_br | split: '<br />'\n                              for pair in option_units_raw\n                                assign pair_cleaned = pair | strip\n                                if pair_cleaned contains ':'\n                                  assign key_value = pair_cleaned | split: ':'\n                                  assign key = key_value[0] | strip\n                                  assign value = key_value[1] | strip\n                                  if key == option_name and value != blank\n                                    assign option_unit = value\n                                    break\n                                  endif\n                                endif\n                              endfor\n                            endif\n                          -%}\n                          {%- if option_unit != blank %} ({{ option_unit }}){%- endif -%}\n                          :\n                        </span>\n                        <span class=\"t4s-selected-value\">\n                          {%- assign display_value = selected_value | default: choose_an_option | replace: '\"', '' -%}\n                          {{- display_value -}}\n                          {%- if option_unit != blank %} {{ option_unit }}{%- endif -%}\n                        </span>\n                      </span>\n                      {%- if name_sizeg == name_downcase -%}\n                        {{- html_sizeg -}}\n                      {%- endif %}\n                    </h4>\n\n                    <div data-swatch-list class=\"t4s-swatch__list\">\n                      {%- if color_mode != 'dropdown' -%}\n                        {%- if color_mode contains 'is-sw-cl__label' -%}\n                          {%- for value in option.values -%}\n                            {%- assign color_handle = value | handle -%}\n\n                            {%- comment %} Look up color nickname from map {%- endcomment -%}\n                            {%- assign color_nickname = '' -%}\n                            {%- assign nickname_pairs = color_nicknames_map | split: ';' -%}\n                            {%- for pair in nickname_pairs -%}\n                              {%- assign pair_clean = pair | strip -%}\n                              {%- if pair_clean != blank -%}\n                                {%- assign pair_parts = pair_clean | split: ':' -%}\n                                {%- if pair_parts[0] == color_handle -%}\n                                  {%- assign color_nickname = pair_parts[1] -%}\n                                  {%- break -%}\n                                {%- endif -%}\n                              {%- endif -%}\n                            {%- endfor -%}\n\n                            {%- comment %} Context-aware availability check: color + current other selections {%- endcomment -%}\n                            {%- assign color_is_available = false -%}\n                            {%- for variant in shsd_product_variants -%}\n                              {%- assign matches_color = false -%}\n                              {%- assign matches_other_options = true -%}\n\n                              {%- for opt_idx in (1..3) -%}\n                                {%- assign opt_key = 'option' | append: opt_idx -%}\n                                {%- assign variant_opt_val = variant[opt_key] -%}\n                                {%- if variant_opt_val != blank -%}\n                                  {%- assign variant_opt_handle = variant_opt_val | handle -%}\n\n                                  {%- comment %} Determine if this option index is the color option {%- endcomment -%}\n                                  {%- assign opt_idx_adjusted = opt_idx | minus: 1 -%}\n                                  {%- assign this_opt_name = product.options[opt_idx_adjusted] | downcase -%}\n\n                                  {%- if get_color contains this_opt_name -%}\n                                    {%- comment %} This is the color option - check if it matches our target color {%- endcomment -%}\n                                    {%- if variant_opt_handle == color_handle -%}\n                                      {%- assign matches_color = true -%}\n                                    {%- endif -%}\n                                  {%- else -%}\n                                    {%- comment %} This is a non-color option - check if variant matches current selection {%- endcomment -%}\n                                    {%- assign current_selected_val = product.selected_or_first_available_variant[opt_key] -%}\n                                    {%- if current_selected_val != blank -%}\n                                      {%- assign current_selected_handle = current_selected_val | handle -%}\n                                      {%- unless variant_opt_handle == current_selected_handle -%}\n                                        {%- assign matches_other_options = false -%}\n                                      {%- endunless -%}\n                                    {%- endif -%}\n                                  {%- endif -%}\n                                {%- endif -%}\n                              {%- endfor -%}\n\n                              {%- if matches_color and matches_other_options and variant.available -%}\n                                {%- assign color_is_available = true -%}\n                                {%- break -%}\n                              {%- endif -%}\n                            {%- endfor -%}\n\n                            {%- comment %} Compute available standard lengths for this color (used for both classes and content) {%- endcomment -%}\n                            {%- assign avail_lengths = '' -%}\n                            {%- assign avail_lengths_seen = '' -%}\n                            {%- assign length_opt_key = 'option' | append: length_option_position -%}\n                            {%- if length_option_position > 0 and color_option_position > 0 -%}\n                              {%- for lv in shsd_product_variants -%}\n                                {%- assign v_color_key = 'option' | append: color_option_position -%}\n                                {%- assign v_color_val = lv[v_color_key] | handle -%}\n                                {%- if v_color_val == color_handle and lv.available -%}\n                                  {%- assign v_length_val = lv[length_opt_key] -%}\n                                  {%- if v_length_val != blank -%}\n                                    {%- assign is_custom_length = false -%}\n                                    {%- if custom_option_names -%}\n                                      {%- for custom_name in custom_option_names -%}\n                                        {%- assign custom_name_stripped = custom_name | strip -%}\n                                        {%- if v_length_val == custom_name_stripped -%}\n                                          {%- assign is_custom_length = true -%}\n                                          {%- break -%}\n                                        {%- endif -%}\n                                      {%- endfor -%}\n                                    {%- endif -%}\n                                    {%- unless is_custom_length -%}\n                                      {%- assign v_length_clean = v_length_val | replace: '\"', '' | strip -%}\n                                      {%- assign sentinel = '@@' | append: v_length_clean | append: '@@' -%}\n                                      {%- unless avail_lengths_seen contains sentinel -%}\n                                        {%- assign avail_lengths_seen = avail_lengths_seen | append: sentinel -%}\n                                        {%- if avail_lengths == '' -%}\n                                          {%- assign avail_lengths = v_length_clean -%}\n                                        {%- else -%}\n                                          {%- assign avail_lengths = avail_lengths | append: ', ' | append: v_length_clean -%}\n\n                                        {%- endif -%}\n                                      {%- endunless -%}\n                                    {%- endunless -%}\n                                  {%- endif -%}\n                                {%- endif -%}\n                              {%- endfor -%}\n                            {%- endif -%}\n\n                            <div\n                              data-swatch-item\n                              class=\"t4s-swatch__btn-wrap{% if selected_value == value %} is--selected{% endif %}{% unless color_is_available %} is--out-of-stock{% if avail_lengths != '' %} pfd-has-lengths{% endif %}{% endunless %}\"\n                              data-value=\"{{ value | escape }}\"\n                              data-available=\"{{ color_is_available }}\"\n                            >\n                              <!-- DEBUG: color={{ color_handle }} | available={{ color_is_available }} | selected_opt1={{ product.selected_or_first_available_variant.option1 | handle }} | selected_opt2={{ product.selected_or_first_available_variant.option2 | handle }} -->\n                              <div\n                                data-img-el\n                                class=\"t4s-swatch__item {{ color_swatch }}bg_color_{{ value | handle }} lazyloadt4s\"\n                              >\n                                <img crossorigin=\"anonymous\">\n                                {%- unless color_is_available -%}\n                                  <span class=\"t4s-swatch__re-visible\">Awaiting Restock</span>\n                                {%- endunless -%}\n                              </div>\n                              {%- unless color_is_available -%}\n                                {%- if avail_lengths != '' -%}\n                                  <span class=\"t4s-swatch__available-lengths is-visible\">Available in {{ avail_lengths }}</span>\n                                {%- endif -%}\n                              {%- endunless -%}\n                              <span class=\"t4s-swatch__label\">\n                                {{- value | replace: '\"', '' -}}\n                              </span>\n                              {%- if color_nickname != blank -%}\n                                <span class=\"t4s-swatch__nickname\">{{ color_nickname }}</span>\n                              {%- endif -%}\n                            </div>\n                          {%- endfor -%}\n\n                        {%- else -%}\n                          {%- for value in option.values -%}\n                            {%- assign color_handle = value | handle -%}\n\n                            {%- comment %} Look up color nickname {%- endcomment -%}\n                            {%- assign color_nickname = '' -%}\n                            {%- assign nickname_pairs = color_nicknames_map | split: ';' -%}\n                            {%- for pair in nickname_pairs -%}\n                              {%- assign pair_clean = pair | strip -%}\n                              {%- if pair_clean != blank -%}\n                                {%- assign pair_parts = pair_clean | split: ':' -%}\n                                {%- if pair_parts[0] == color_handle -%}\n                                  {%- assign color_nickname = pair_parts[1] -%}\n                                  {%- break -%}\n                                {%- endif -%}\n                              {%- endif -%}\n                            {%- endfor -%}\n\n                            {%- comment %} Context-aware availability check: color + current other selections {%- endcomment -%}\n                            {%- assign color_is_available = false -%}\n                            {%- for variant in shsd_product_variants -%}\n                              {%- assign matches_color = false -%}\n                              {%- assign matches_other_options = true -%}\n\n                              {%- for opt_idx in (1..3) -%}\n                                {%- assign opt_key = 'option' | append: opt_idx -%}\n                                {%- assign variant_opt_val = variant[opt_key] -%}\n                                {%- if variant_opt_val != blank -%}\n                                  {%- assign variant_opt_handle = variant_opt_val | handle -%}\n\n                                  {%- comment %} Determine if this option index is the color option {%- endcomment -%}\n                                  {%- assign opt_idx_adjusted = opt_idx | minus: 1 -%}\n                                  {%- assign this_opt_name = product.options[opt_idx_adjusted] | downcase -%}\n\n                                  {%- if get_color contains this_opt_name -%}\n                                    {%- comment %} This is the color option - check if it matches our target color {%- endcomment -%}\n                                    {%- if variant_opt_handle == color_handle -%}\n                                      {%- assign matches_color = true -%}\n                                    {%- endif -%}\n                                  {%- else -%}\n                                    {%- comment %} This is a non-color option - check if variant matches current selection {%- endcomment -%}\n                                    {%- assign current_selected_val = product.selected_or_first_available_variant[opt_key] -%}\n                                    {%- if current_selected_val != blank -%}\n                                      {%- assign current_selected_handle = current_selected_val | handle -%}\n                                      {%- unless variant_opt_handle == current_selected_handle -%}\n                                        {%- assign matches_other_options = false -%}\n                                      {%- endunless -%}\n                                    {%- endif -%}\n                                  {%- endif -%}\n                                {%- endif -%}\n                              {%- endfor -%}\n\n                              {%- if matches_color and matches_other_options and variant.available -%}\n                                {%- assign color_is_available = true -%}\n                                {%- break -%}\n                              {%- endif -%}\n                            {%- endfor -%}\n\n                            <div\n                              data-swatch-item\n                              class=\"t4s-swatch__btn-wrap{% if selected_value == value %} is--selected{% endif %}{% unless color_is_available %} is--out-of-stock{% endunless %}{%- unless color_is_available -%}{%- assign avail_lengths_check = '' -%}{%- assign length_opt_key_check = 'option' | append: length_option_position -%}{%- if length_option_position > 0 -%}{%- for variant in shsd_product_variants -%}{%- assign v_color_key_c = 'option' | append: color_option_position -%}{%- if variant[v_color_key_c] | handle == color_handle and variant.available -%}{%- assign v_lv = variant[length_opt_key_check] -%}{%- if v_lv != blank -%}{%- assign is_cl = false -%}{%- if custom_option_names -%}{%- for cn in custom_option_names -%}{%- if v_lv == cn -%}{%- assign is_cl = true -%}{%- break -%}{%- endif -%}{%- endfor -%}{%- endif -%}{%- unless is_cl -%}{%- assign avail_lengths_check = avail_lengths_check | append: 'x' -%}{%- endunless -%}{%- endif -%}{%- endif -%}{%- endfor -%}{%- endif -%}{%- if avail_lengths_check != '' %} pfd-has-lengths{%- endif -%}{%- endunless -%}\"\n                              data-value=\"{{ value | escape }}\"\n                              data-available=\"{{ color_is_available }}\"\n                            >\n\n                              <div\n  data-img-el\n  class=\"t4s-swatch__item {{ color_swatch }}bg_color_{{ value | handle }} lazyloadt4s\"\n>\n  <img crossorigin=\"anonymous\">\n</div>\n                              {%- unless color_is_available -%}\n                                <span class=\"t4s-swatch__restock-badge\">Awaiting Restock</span>\n                                {%- comment %} Compute available standard lengths for this color {%- endcomment -%}\n                                {%- assign avail_lengths = '' -%}\n                                {%- assign length_opt_key = 'option' | append: length_option_position -%}\n                                {%- if length_option_position > 0 -%}\n                                  {%- for variant in shsd_product_variants -%}\n                                    {%- assign v_color_key = 'option' | append: color_option_position -%}\n                                    {%- assign v_color_val = variant[v_color_key] | handle -%}\n                                    {%- if v_color_val == color_handle and variant.available -%}\n                                      {%- assign v_length_val = variant[length_opt_key] -%}\n                                      {%- if v_length_val != blank -%}\n                                        {%- assign is_custom_length = false -%}\n                                        {%- if custom_option_names -%}\n                                          {%- for custom_name in custom_option_names -%}\n                                            {%- if v_length_val == custom_name -%}\n                                              {%- assign is_custom_length = true -%}\n                                              {%- break -%}\n                                            {%- endif -%}\n                                          {%- endfor -%}\n                                        {%- endif -%}\n                                        {%- unless is_custom_length -%}\n                                          {%- assign v_length_clean = v_length_val | replace: '\"', '' -%}\n                                          {%- assign length_check = '|' | append: v_length_clean | append: '|' -%}\n                                          {%- assign lengths_haystack = '|' | append: avail_lengths | replace: ', ', '|,|' | append: '|' -%}\n                                          {%- unless lengths_haystack contains length_check -%}\n                                            {%- if avail_lengths == '' -%}\n                                              {%- assign avail_lengths = v_length_clean -%}\n                                            {%- else -%}\n                                              {%- assign avail_lengths = avail_lengths | append: ', ' | append: v_length_clean -%}\n                                            {%- endif -%}\n                                          {%- endunless -%}\n                                        {%- endunless -%}\n                                      {%- endif -%}\n                                    {%- endif -%}\n                                  {%- endfor -%}\n                                {%- endif -%}\n                                {%- if avail_lengths != '' -%}\n                                  <span class=\"t4s-swatch__available-lengths is-visible\">Available in {{ avail_lengths }}</span>\n                                {%- endif -%}\n                              {%- endunless -%}\n                              {%- if color_nickname != blank -%}\n                                <span class=\"t4s-swatch__nickname\">{{ color_nickname }}</span>\n                              {%- endif -%}\n                            </div>\n\n                          {%- endfor -%}\n                        {%- endif -%}\n                      {%- else -%}\n                        <button\n                          type=\"button\"\n                          data-dropdown-open\n                          data-position=\"bottom-end\"\n                          data-id=\"t4s_nt_{{ pr_sid }}{{ forloop.index }}\"\n                        >\n                          <span data-current-value>\n                            {{- selected_value | default: choose_an_option -}}\n                          </span>\n                          <svg\n                            class=\"t4s-icon-select-arrow\"\n                            role=\"presentation\"\n                            viewBox=\"0 0 19 12\"\n                          >\n                            <use xlink:href=\"#t4s-select-arrow\"></use>\n                          </svg>\n                        </button>\n                        <div\n                          data-dropdown-wrapper\n                          class=\"t4s-dropdown__wrapper t4s-current-scrollbar\"\n                          id=\"t4s_nt_{{ pr_sid }}{{ forloop.index }}\"\n                        >\n                          <div class=\"t4s-drop-arrow\"></div>\n                          <div class=\"t4s-dropdown__header\">\n                            <span\n                              data-current-value\n                              class=\"t4s-dropdown__title\"\n                            >\n                              {{- selected_value | default: choose_an_option -}}\n                            </span>\n                            <button\n                              data-dropdown-close\n                              aria-label=\"{{ 'general.aria.close' | t }}\"\n                            >\n                              <svg\n                                role=\"presentation\"\n                                class=\"t4s-iconsvg-close\"\n                                viewBox=\"0 0 16 14\"\n                              >\n                                <path d=\"M15 0L1 14m14 0L1 0\" stroke=\"currentColor\" fill=\"none\" fill-rule=\"evenodd\"></path>\n                              </svg>\n                            </button>\n                          </div>\n                          <div class=\"t4s-dropdown__content\">\n                            {%- for value in option.values -%}\n                              <div\n                                data-swatch-item\n                                data-dropdown-off\n                                class=\"t4s-swatch__item t4s-truncate {{ color_swatch }}bg_color_{{ value | handle }} lazyloadt4s{% if selected_value == value %} is--selected{% endif %}\"\n                                data-value=\"{{ value | escape }}\"\n                              >\n                                {{ value | replace: '\"', '' }}\n                              </div>\n                            {%- endfor -%}\n                          </div>\n                        </div>\n                      {%- endif -%}\n                    </div>\n                    {%- render 'color-info-accordion' -%}\n                  </div>\n                {%- else -%}\n                  {% comment %}--MARK: Non-Color{% endcomment %}\n                  {%- liquid\n                    assign standard_values = ''\n                    assign custom_values = ''\n                    assign has_standard = false\n                    assign has_custom = false\n\n                    for value in option.values\n                      assign is_custom = false\n                      for custom_name in custom_option_names\n                        assign custom_name_clean = custom_name | strip\n                        if value contains custom_name_clean\n                          assign is_custom = true\n                          break\n                        endif\n                      endfor\n\n                      if is_custom\n                        if custom_values == ''\n                          assign custom_values = value\n                        else\n                          assign custom_values = custom_values | append: ',' | append: value\n                        endif\n                        assign has_custom = true\n                      else\n                        if standard_values == ''\n                          assign standard_values = value\n                        else\n                          assign standard_values = standard_values | append: ',' | append: value\n                        endif\n                        assign has_standard = true\n                      endif\n                    endfor\n\n                    assign standard_values_array = standard_values | split: ','\n                    assign custom_values_array = custom_values | split: ','\n                  -%}\n\n                  <div\n                    data-swatch-option\n                    data-option-name=\"{{ option_name | escape }}\"\n                    data-id=\"{{ forloop.index0 }}\"\n                    data-option-unit=\"\n                      {%- liquid\n                        assign option_unit = ''\n                        if se_stts and se_stts.option_units and se_stts.option_units != blank\n                          assign option_units_raw = se_stts.option_units | strip | newline_to_br | split: '<br />'\n                          for pair in option_units_raw\n                            assign pair_cleaned = pair | strip\n                            if pair_cleaned contains ':'\n                              assign key_value = pair_cleaned | split: ':'\n                              assign key = key_value[0] | strip\n                              assign value = key_value[1] | strip\n                              if key == option_name and value != blank\n                                assign option_unit = value\n                                break\n                              endif\n                            endif\n                          endfor\n                        endif\n                      -%}{{ option_unit | escape }}\n                    \"\n                    class=\"t4s-swatch__option is-t4s-name__{{ option_name | handle }} pfd-split-option\"\n                  >\n                    <h4 class=\"t4s-swatch__title\">\n                      <span class=\"t4s-swatch__title--left\"\n                        >Select a\n                        <span class=\"bold\">\n                          {{- option_name -}}\n                        </span>\n                        {%- liquid\n                          assign option_unit = ''\n                          if se_stts and se_stts.option_units and se_stts.option_units != blank\n                            assign option_units_raw = se_stts.option_units | strip | newline_to_br | split: '<br />'\n                            for pair in option_units_raw\n                              assign pair_cleaned = pair | strip\n                              if pair_cleaned contains ':'\n                                assign key_value = pair_cleaned | split: ':'\n                                assign key = key_value[0] | strip\n                                assign value = key_value[1] | strip\n                                if key == option_name and value != blank\n                                  assign option_unit = value\n                                  break\n                                endif\n                              endif\n                            endfor\n                          endif\n                        -%}\n                        {%- if option_unit != blank %} ({{ option_unit }}){%- endif -%}\n                      </span>\n                      <span class=\"t4s-swatch__title--right\"\n                        >Selected:\n                        <span class=\"bold\">\n                          {%- assign display_value = selected_value | default: choose_an_option | replace: '\"', '' -%}\n                          {{- display_value -}}\n                          {%- if option_unit != blank %} {{ option_unit }}{%- endif -%}\n                        </span></span\n                      >\n                      {%- if name_sizeg == name_downcase -%}\n                        {{- html_sizeg -}}\n                      {%- endif %}\n                    </h4>\n\n                    <div class=\"pfd-split-selection\">\n                      {%- if has_standard -%}\n                        <div class=\"pfd-standard-options\">\n                          {%- if selector_mode != 'dropdown' -%}\n                            {%- for value in standard_values_array -%}\n                              <div\n                                data-swatch-item\n                                class=\"t4s-swatch__item{% if selected_value == value %} is--selected{% endif %}\"\n                                data-value=\"{{ value | escape }}\"\n                              >\n                                {{ value | replace: '\"', '' }}\n                              </div>\n                            {%- endfor -%}\n                          {%- else -%}\n                            <button\n                              type=\"button\"\n                              data-pfd-dropdown-open\n                              data-position=\"bottom-end\"\n                              data-id=\"t4s_nt_{{ pr_sid }}{{ forloop.index }}_standard\"\n                            >\n                              <span data-current-value>\n                                {{- selected_value | default: choose_an_option -}}\n                              </span>\n                              <svg\n                                class=\"t4s-icon-select-arrow\"\n                                role=\"presentation\"\n                                viewBox=\"0 0 19 12\"\n                              >\n                                <use xlink:href=\"#t4s-select-arrow\"></use>\n                              </svg>\n                            </button>\n                            <div\n                              data-dropdown-wrapper\n                              class=\"t4s-dropdown__wrapper t4s-current-scrollbar\"\n                              id=\"t4s_nt_{{ pr_sid }}{{ forloop.index }}_standard\"\n                            >\n                              <div class=\"t4s-drop-arrow\"></div>\n                              <div class=\"t4s-dropdown__content\">\n                                {%- for value in standard_values_array -%}\n                                  <div\n                                    data-swatch-item\n                                    data-dropdown-off\n                                    class=\"t4s-swatch__item t4s-truncate{% if selected_value == value %} is--selected{% endif %}\"\n                                    data-value=\"{{ value | escape }}\"\n                                  >\n                                    {{ value | replace: '\"', '' }}\n                                  </div>\n                                {%- endfor -%}\n                              </div>\n                            </div>\n                          {%- endif -%}\n                        </div>\n                      {%- endif -%}\n\n                      {%- if has_custom -%}\n                        <div class=\"pfd-custom-options\">\n                          {%- if has_standard and has_custom -%}\n                            <span class=\"pfd-or-separator\">or</span>\n                          {%- endif -%}\n                          <button\n                            type=\"button\"\n                            data-pfd-dropdown-open\n                            data-position=\"bottom-end\"\n                            data-id=\"t4s_nt_{{ pr_sid }}{{ forloop.index }}_custom\"\n                            class=\"pfd-custom-dropdown\"\n                          >\n                            <span data-current-value>\n                              {%- assign is_custom_selected = false -%}\n                              {%- for custom_val in custom_values_array -%}\n                                {%- if selected_value == custom_val -%}\n                                  {%- assign display_custom_val = custom_val | replace: '\"', '' -%}\n                                  {%- if option_unit != blank -%}\n                                    {{ display_custom_val }}\n                                    {{ option_unit }}\n                                    <span class=\"pfd-custom-badge\">Custom</span>\n                                  {%- else -%}\n                                    {{ display_custom_val }}\n                                    <span class=\"pfd-custom-badge\">Custom</span>\n                                  {%- endif -%}\n                                  {%- assign is_custom_selected = true -%}\n                                  {%- break -%}\n                                {%- endif -%}\n                              {%- endfor -%}\n                              {%- unless is_custom_selected -%}\n                                Custom {{ option_name | downcase }}\n                              {%- endunless -%}\n                            </span>\n                            <svg\n                              class=\"t4s-icon-select-arrow\"\n                              role=\"presentation\"\n                              viewBox=\"0 0 19 12\"\n                            >\n                              <use xlink:href=\"#t4s-select-arrow\"></use>\n                            </svg>\n                          </button>\n                          <div\n                            data-dropdown-wrapper\n                            class=\"t4s-dropdown__wrapper t4s-current-scrollbar\"\n                            id=\"t4s_nt_{{ pr_sid }}{{ forloop.index }}_custom\"\n                          >\n                            <div class=\"t4s-drop-arrow\"></div>\n                            <div class=\"t4s-dropdown__content\">\n                              {%- for value in custom_values_array -%}\n                                <div\n                                  data-swatch-item\n                                  data-dropdown-off\n                                  class=\"t4s-swatch__item t4s-truncate{% if selected_value == value %} is--selected{% endif %}\"\n                                  data-value=\"{{ value | escape }}\"\n                                >\n                                  <span class=\"pfd-checkmark\">✓</span>\n                                  <span class=\"pfd-option-text\">\n                                    {%- assign display_value = value | replace: '\"', '' -%}\n                                    {%- if option_unit != blank -%}\n                                      {{ display_value }}\n                                      {{ option_unit }}\n                                    {%- else -%}\n                                      {{ display_value }}\n                                    {%- endif -%}\n                                  </span>\n                                  <span class=\"pfd-custom-badge\">Custom</span>\n                                </div>\n                              {%- endfor -%}\n                            </div>\n                          </div>\n                        </div>\n                      {%- endif -%}\n\n                      {%- unless has_standard or has_custom -%}\n                        {%- comment %} Fallback to original rendering if no split detected {%- endcomment %}\n                        <div class=\"t4s-swatch__list pfd-fallback-list\">\n                          {%- if selector_mode != 'dropdown' -%}\n                            {%- for value in option.values -%}\n                              <div\n                                data-swatch-item\n                                class=\"t4s-swatch__item{% if selected_value == value %} is--selected{% endif %}\"\n                                data-value=\"{{ value | escape }}\"\n                              >\n                                {{ value | replace: '\"', '' }}\n                              </div>\n                            {%- endfor -%}\n                          {%- else -%}\n                            <button\n                              type=\"button\"\n                              data-pfd-dropdown-open\n                              data-position=\"bottom-end\"\n                              data-id=\"t4s_nt_{{ pr_sid }}{{ forloop.index }}\"\n                            >\n                              <span data-current-value>\n                                {{- selected_value | default: choose_an_option -}}\n                              </span>\n                              <svg\n                                class=\"t4s-icon-select-arrow\"\n                                role=\"presentation\"\n                                viewBox=\"0 0 19 12\"\n                              >\n                                <use xlink:href=\"#t4s-select-arrow\"></use>\n                              </svg>\n                            </button>\n                            <div\n                              data-dropdown-wrapper\n                              class=\"t4s-dropdown__wrapper t4s-current-scrollbar\"\n                              id=\"t4s_nt_{{ pr_sid }}{{ forloop.index }}\"\n                            >\n                              <div class=\"t4s-drop-arrow\"></div>\n                              <div class=\"t4s-dropdown__content\">\n                                {%- for value in option.values -%}\n                                  <div\n                                    data-swatch-item\n                                    data-dropdown-off\n                                    class=\"t4s-swatch__item t4s-truncate{% if selected_value == value %} is--selected{% endif %}\"\n                                    data-value=\"{{ value | escape }}\"\n                                  >\n                                    {{ value | replace: '\"', '' }}\n                                  </div>\n                                {%- endfor -%}\n                              </div>\n                            </div>\n                          {%- endif -%}\n                        </div>\n                      {%- endunless -%}\n                    </div>\n\n                    {%- comment %} Custom order notice - shown when custom option is selected {%- endcomment %}\n                    {%- assign show_custom_notice = false -%}\n                    {%- for custom_val in custom_values_array -%}\n                      {%- if selected_value == custom_val -%}\n                        {%- assign show_custom_notice = true -%}\n                        {%- break -%}\n                      {%- endif -%}\n                    {%- endfor -%}\n                    <div\n                      class=\"pfd-custom-notice\"\n                      style=\"display: {% if show_custom_notice %}block{% else %}none{% endif %};\"\n                    >\n                      <div class=\"pfd-custom-notice-content\">\n                        <svg\n                          class=\"pfd-custom-notice-icon\"\n                          xmlns=\"http://www.w3.org/2000/svg\"\n                          width=\"24\"\n                          height=\"24\"\n                          viewBox=\"0 0 24 24\"\n                          fill=\"none\"\n                          stroke=\"currentColor\"\n                          stroke-width=\"2\"\n                          stroke-linecap=\"round\"\n                          stroke-linejoin=\"round\"\n                        >\n                          <circle cx=\"12\" cy=\"12\" r=\"10\"></circle>\n                          <polyline points=\"12 6 12 12 16 14\"></polyline>\n                        </svg>\n                        <p class=\"pfd-custom-notice-text\">\n                          Custom {{ option_name | downcase }}s are <strong>made to order</strong>. Please allow\n                          <span class=\"pfd-custom-notice-highlight\">6-8 weeks</span> for delivery.\n                        </p>\n                      </div>\n                    </div>\n\n                    {%- comment %} Configuration-based custom content for options {%- endcomment %}\n                    {%- comment %} Renders ALL matching option content, shows only the selected one {%- endcomment %}\n                    {%- assign option_name_lower = option_name | downcase -%}\n                    {%- assign selected_value_lower = selected_value | downcase -%}\n\n                    {%- capture all_option_info -%}\n  {%- for pair in option_content_pairs -%}\n    {%- assign pair_cleaned = pair | strip -%}\n    {%- if pair_cleaned contains '|' -%}\n      {%- assign parts = pair_cleaned | split: '|' -%}\n      {%- assign option_key_full = parts[0] | strip -%}\n      {%- assign content_value = parts[1] | strip -%}\n\n      {%- if option_key_full contains ':' -%}\n        {%- assign key_parts = option_key_full | split: ':' -%}\n        {%- assign option_key = key_parts[0] | strip | downcase -%}\n        {%- assign value_key = key_parts[1] | strip -%}\n        {%- assign value_key_lower = value_key | downcase -%}\n\n        {%- if option_name_lower == option_key -%}\n          {%- assign is_selected = false -%}\n          {%- if selected_value_lower == value_key_lower -%}\n            {%- assign is_selected = true -%}\n          {%- endif -%}\n          <div class=\"pfd-option-info-item\"\n               data-option-name=\"{{ option_name_lower }}\"\n               data-option-value=\"{{ value_key | handle }}\"\n               style=\"{% unless is_selected %}display: none;{% endunless %}\">\n            {{ content_value }}\n          </div>\n        {%- endif -%}\n      {%- endif -%}\n    {%- endif -%}\n  {%- endfor -%}\n{%- endcapture -%}\n\n                    {%- assign all_option_info_stripped = all_option_info | strip -%}\n                    {%- if all_option_info_stripped != blank -%}\n                      <div class=\"pfd-custom-option-info\" data-option-info-container=\"{{ option_name_lower }}\">\n                        {{ all_option_info }}\n                      </div>\n                    {%- endif -%}\n                  </div>\n                {%- endif -%}\n              {%- endfor -%}\n            </div>\n          {%- endif -%}\n\n          {%- liquid\n            if arr_properties.size > 0 and isProductAvailable\n              render 'frm_properties', arr_properties: arr_properties, product: product\n            endif\n          -%}\n\n          {%- if use_incoming_mess\n            and current_variant_incoming\n            and pr_variants.size == 1\n            and current_variant.next_incoming_date != blank\n          -%}\n            {%- assign format_date = current_variant.next_incoming_date | date: date_in -%}\n            {% comment %}<div class=\"t4s-incoming__mess\">{% if current_variant_available %}{{ 'products.product_single.will_not_ship_until_html' | t: date: format_date }}{% else %}{{ 'products.product_single.will_be_in_stock_after_html' | t: date: format_date }}{% endif %}</div>{% endcomment %}\n          {%- elsif use_incoming_mess and pr_variants.size > 1 -%}\n            {%- liquid\n              assign format_date = current_variant.next_incoming_date | date: date_in\n              unless format_date\n                assign format_date = '19041994'\n              endunless\n            -%}\n            {% comment %}<div data-incoming__mess class=\"t4s-incoming__mess\"{% unless current_variant_incoming %} hidden{% endunless %}><span data-incoming-available{% if current_variant_available == false or current_variant == blank %} style=\"display: none\"{% endif %}>{{ 'products.product_single.will_not_ship_until_html' | t: date: format_date }}</span><span data-incoming-soldout{% if current_variant_available or current_variant == blank %} style=\"display: none\"{% endif %}>{{ 'products.product_single.will_be_in_stock_after_html' | t: date: format_date }}</span></div>{% endcomment %}\n          {%- endif -%}\n\n          {{ 'button-style.css' | asset_url | stylesheet_tag }}\n          <link\n            href=\"{{ 'custom-effect.css' | asset_url }}\"\n            rel=\"stylesheet\"\n            media=\"print\"\n            onload=\"this.media='all'\"\n          >\n\n          {{- html_price -}}\n\n          <div\n            class=\"t4s-product-form__buttons\"\n            style=\"--pr-btn-round: {{ bk_stts.pr_btn_round }}px;--wis-cp-btn-round: {{ bk_stts.wis_cp_btn_round }}px;\"\n          >\n            <div class=\"t4s-pr__qty_cart t4s-d-flex t4s-flex-wrap\">\n              {%- if isExternal -%}\n                <a\n                  href=\"{{ external_link }}\"\n                  rel=\"nofollow\"\n                  target=\"_blank\"\n                  class=\"t4s-product-form__submit t4s-btn t4s-btn-base t4s-btn-style-{{ bk_stts.button_style }} t4s-btn-color-{{ bk_stts.button_color }} t4s-w-100 t4s-justify-content-center {% if bk_stts.button_style == 'default' or bk_stts.button_style == 'outline' %} t4s-btn-effect-{{ bk_stts.button_effect }}{% endif %} t4s-truncate is--btn-external t4s-btn-loading__svg\"\n                >\n                  {%- if bk_stts.btn_icon -%}\n                    <svg class=\"t4s-btn-icon\" viewBox=\"0 0 24 24\">\n                      <use xlink:href=\"#t4s-icon-atc\"></use>\n                    </svg>\n                  {%- endif -%}\n                  <span class=\"t4s-btn-atc_text\">\n                    {{- external_title -}}\n                  </span>\n                  <span class=\"t4s-loading__spinner\" hidden>\n                    <svg\n                      width=\"16\"\n                      height=\"16\"\n                      hidden\n                      class=\"t4s-svg-spinner\"\n                      focusable=\"false\"\n                      role=\"presentation\"\n                      viewBox=\"0 0 66 66\"\n                      xmlns=\"http://www.w3.org/2000/svg\"\n                    >\n                      <circle class=\"t4s-path\" fill=\"none\" stroke-width=\"6\" cx=\"33\" cy=\"33\" r=\"30\"></circle>\n                    </svg>\n                  </span>\n                </a>\n              {%- else -%}\n                {%- if bk_stts.show_qty and isProductAvailable -%}\n                  <div\n                    data-quantity-wrapper\n                    class=\"t4s-quantity-wrapper t4s-product-form__qty\"\n                  >\n                    <button\n                      data-quantity-selector\n                      data-decrease-qty\n                      type=\"button\"\n                      class=\"t4s-quantity-selector is--minus\"\n                    ></button>\n                    <input\n                      data-quantity-value\n                      type=\"number\"\n                      class=\"t4s-quantity-input\"\n                      step=\"1\"\n                      min=\"{{cus_qty}}\"\n                      max=\"{{max_qty}}\"\n                      name=\"quantity\"\n                      value=\"{{cus_qty}}\"\n                      size=\"4\"\n                      pattern=\"[0-9]*\"\n                      inputmode=\"numeric\"\n                    >\n                    <button\n                      data-quantity-selector\n                      data-increase-qty\n                      type=\"button\"\n                      class=\"t4s-quantity-selector is--plus\"\n                    ></button>\n                  </div>\n                {%- else -%}\n                  <input type=\"hidden\" name=\"quantity\" value=\"1\">\n                {%- endif -%}\n                {% if customer %}\n                  <button\n                    data-animation-atc='{ \"ani\": \"{{ bk_stts.ani }}\",\"time\": {{ bk_stts.time }}000 }'\n                    type=\"submit\"\n                    name=\"add\"\n                    data-atc-form\n                    class=\"t4s-product-form__submit t4s-btn t4s-btn-base t4s-btn-style-{{ bk_stts.button_style }} t4s-btn-color-{{ bk_stts.button_color }} t4s-w-100 t4s-justify-content-center {% if bk_stts.button_style == 'default' or bk_stts.button_style == 'outline' %} t4s-btn-effect-{{ bk_stts.button_effect }}{% endif %} t4s-btn-loading__svg\"\n                    {% unless current_variant_available %}\n                      aria-disabled=\"true\"\n                    {% endunless -%}\n                    {% unless isProductAvailable %}\n                      disabled=\"disabled\"\n                    {% endunless %}\n                  >\n                    {%- if bk_stts.btn_icon -%}\n                      <svg\n                        class=\"t4s-btn-icon\"\n                        viewBox=\"0 0 24 24\"\n                      >\n                        <use xlink:href=\"#t4s-icon-atc\"></use>\n                      </svg>\n                    {%- endif -%}\n                    <span class=\"t4s-btn-atc_text\">\n                      {%- if current_variant_available == false or isProductAvailable == false -%}\n                        {{- 'products.product.sold_out' | t -}}\n                      {%- elsif isPreoder -%}\n                        {{- 'products.product.pre_order' | t }}\n                      {%- else -%}\n                        {{ 'products.product.add_to_cart' | t }}\n                      {%- endif -%}\n                    </span>\n                    <span class=\"t4s-loading__spinner\" hidden>\n                      <svg\n                        width=\"16\"\n                        height=\"16\"\n                        hidden\n                        class=\"t4s-svg-spinner\"\n                        focusable=\"false\"\n                        role=\"presentation\"\n                        viewBox=\"0 0 66 66\"\n                        xmlns=\"http://www.w3.org/2000/svg\"\n                      >\n                        <circle class=\"t4s-path\" fill=\"none\" stroke-width=\"6\" cx=\"33\" cy=\"33\" r=\"30\"></circle>\n                      </svg>\n                    </span>\n                  </button>\n                {% else %}\n                  <a\n                    href=\"/account/login\"\n                    onclick=\"rememberPage(event)\"\n                    data-drawer-delay-\n                    data-drawer-options='{ \"id\": \"#t4s-login-sidebar\" }'\n                    class=\"atc-btn t4s-btn t4s-btn-base t4s-btn-style-default t4s-btn-color-dark t4s-w-100 t4s-justify-content-center t4s-btn-effect-sweep-to-right t4s-btn-loading__svg\"\n                  >\n                    <svg\n                      class=\"t4s-btn-icon\"\n                      viewBox=\"0 0 24 24\"\n                      style=\"margin-right:4px\"\n                    >\n                      <use xlink:href=\"#t4s-icon-atc\"></use>\n                    </svg>\n                    <span class=\"t4s-btn-atc_text\">Login to Shop</span>\n                    <span class=\"t4s-loading__spinner\" hidden=\"\">\n                      <svg\n                        width=\"16\"\n                        height=\"16\"\n                        hidden=\"\"\n                        class=\"t4s-svg-spinner\"\n                        focusable=\"false\"\n                        role=\"presentation\"\n                        viewBox=\"0 0 66 66\"\n                        xmlns=\"http://www.w3.org/2000/svg\"\n                      >\n                        <circle class=\"t4s-path\" fill=\"none\" stroke-width=\"6\" cx=\"33\" cy=\"33\" r=\"30\"></circle>\n                      </svg>\n                    </span>\n                  </a>\n                {% endif %}\n              {%- endif -%}\n            </div>\n            {%- if PR_buy_pr and type != 'main_sticky' %}\n              {{- form | payment_button -}}\n            {% endif -%}\n            {%- if settings.use_notify_me -%}\n              {% if customer -%}\n                <button\n                  data-class=\"t4s-mfp-btn-close-inline\"\n                  data-id=\"t4s-pr-popup__notify-stock\"\n                  data-storageid=\"notify-stock{{ current_variant.id }}\"\n                  data-mfp-src\n                  data-open-mfp-ajax\n                  class=\"t4s-pr__notify-stock{% if current_variant_available or current_variant == blank %} t4s-d-none{% endif %}\"\n                  type=\"button\"\n                  data-notify-stock-btn\n                  data-variant-id=\"{{ current_variant.id }}\"\n                  data-root-url=\"{{ routes.root_url }}\"\n                >\n                  {{ 'products.notify_stock.trigger' | t }}\n                </button>\n              {%- endif %}\n            {%- endif -%}\n            {%- if bk_stts.enable_wishlist or bk_stts.enable_compare -%}\n              <div class=\"t4s-pr__wis_cp\">\n                {%- render 't4s_wis_cp', product: product, bk_stts: bk_stts, disableTooltip: true -%}\n              </div>\n            {%- endif -%}\n          </div>\n        {%- endform -%}\n        {%- unless isProductDefault or type == 'main_sticky' -%}\n          <script type=\"application/json\" class=\"pr_variants_json\">\n            {{ shsd_product_variants | json }}\n          </script>\n          <script type=\"application/json\" class=\"pr_options_json\">\n            {{ shsd_product_options_with_values | json }}\n          </script>\n        {%- endunless -%}\n        {%- if bk_stts.ani != 'none' -%}\n          <link\n            href=\"{{ 'ani-atc.min.css' | asset_url }}\"\n            rel=\"stylesheet\"\n            media=\"print\"\n            onload=\"this.media='all'\"\n          >\n        {%- endif -%}\n      </div>\n    </div>\n  </div>\n\n  <script>\n    (function () {\n      'use strict';\n\n      function updateOptionInfo(container, selectedValue) {\n        var optionName = container.getAttribute('data-option-name');\n        if (!optionName) return;\n        optionName = optionName.toLowerCase();\n\n        var infoContainer = container.querySelector('[data-option-info-container=\"' + optionName + '\"]');\n        if (!infoContainer) return;\n\n        var valueHandle = selectedValue\n          .toLowerCase()\n          .replace(/\\s+/g, '-')\n          .replace(/[^a-z0-9-]/g, '');\n        var infoItems = infoContainer.querySelectorAll('.pfd-option-info-item');\n\n        infoItems.forEach(function (item) {\n          var itemValue = item.getAttribute('data-option-value');\n          item.style.display = itemValue === valueHandle ? '' : 'none';\n        });\n      }\n\n      function initOptionInfoHandler() {\n        var swatchContainers = document.querySelectorAll('[data-swatch-option]');\n\n        swatchContainers.forEach(function (container) {\n          // Method 1: MutationObserver for instant updates\n          var observer = new MutationObserver(function (mutations) {\n            mutations.forEach(function (mutation) {\n              if (mutation.type === 'attributes' && mutation.attributeName === 'class') {\n                var target = mutation.target;\n                if (target.classList.contains('is--selected') && target.hasAttribute('data-value')) {\n                  var selectedValue = target.getAttribute('data-value');\n                  updateOptionInfo(container, selectedValue);\n                }\n              }\n            });\n          });\n\n          observer.observe(container, {\n            attributes: true,\n            subtree: true,\n            attributeFilter: ['class'],\n          });\n\n          // Method 2: Backup click handler with small delay\n          var swatchItems = container.querySelectorAll('[data-swatch-item]');\n          swatchItems.forEach(function (swatch) {\n            swatch.addEventListener('click', function () {\n              var selectedValue = this.getAttribute('data-value');\n              if (!selectedValue) return;\n              setTimeout(function () {\n                updateOptionInfo(container, selectedValue);\n              }, 10);\n            });\n          });\n        });\n      }\n\n      if (document.readyState === 'loading') {\n        document.addEventListener('DOMContentLoaded', initOptionInfoHandler);\n      } else {\n        initOptionInfoHandler();\n      }\n\n      document.addEventListener('shopify:section:load', initOptionInfoHandler);\n    })();\n  </script>\n</div>\n{%- if PR_buy_pr and current_variant_available != true and type != 'main_sticky' -%}\n  <style>\n    #t4s-callBackVariant{{ product_form_id }} .shopify-payment-button { display: none;}\n  </style>\n{% endif -%}\n",
              "reasoning": "Remove the stray extra endfor that was left over from the original loop closing — the for loop is already closed at line 476."
            },
            "result": "(no result received)",
            "isError": true,
            "elapsedMs": 0
          },
          {
            "name": "edit_lines",
            "id": "toolu_01WAfgbKtBYLaskgnzUDfZ7s",
            "input": {
              "filePath": "snippets/product-form-dynamic.liquid",
              "startLine": 478,
              "endLine": 479,
              "newContent": "\n",
              "reasoning": "Remove the stray extra endfor that was left over from the original loop closing — the for loop is already closed at line 476."
            },
            "result": "(no result received)",
            "isError": true,
            "elapsedMs": 0
          },
          {
            "name": "propose_code_edit",
            "id": "pm-change-1772176162420",
            "input": {
              "filePath": "product-form-dynamic.liquid",
              "newContent": "{% comment %} Custom options configuration - options listed here will render as dropdowns {% endcomment %}\n{% assign custom_option_names = product.metafields.custom.custom_values.value %}\n\n{% comment %} Custom content configuration for specific options {% endcomment %}\n{% comment %} Format: option_name:option_value|<html content> - separated by semicolons for multiple {% endcomment %}\n\n{% assign option_content_config = 'texture:Straight|<div class=\"pfd-info-content\"><span class=\"pfd-info-icon\">i</span><span class=\"pfd-info-text\">Our straight texture has slight natural wave texture to it when washed and dried. It is not pin straight hair, nor is that desirable among most clientele.</span></div>;texture:Natural Wave|<div class=\"pfd-info-content\"><span class=\"pfd-info-icon\">i</span><span class=\"pfd-info-text\">Our natural wave texture features soft, beachy waves that blend seamlessly with most natural hair textures. Low maintenance and versatile for everyday styling.</span></div>;texture:Loose Curl|<div class=\"pfd-info-content\"><span class=\"pfd-info-icon\">i</span><span class=\"pfd-info-text\">Our loose curl texture offers bouncy, defined curls that hold their shape beautifully. Perfect for adding volume and movement with minimal styling required.</span></div>;texture:Tight Curl|<div class=\"pfd-info-content\"><span class=\"pfd-info-icon\">i</span><span class=\"pfd-info-text\">Our tight curl texture provides well-defined, springy curls with maximum volume. Ideal for protective styles and blending with naturally curly hair.</span></div>' %}\n\n{% assign option_content_pairs = option_content_config | split: ';' %}\n\n{% comment %} SellersDash collect child product details {% endcomment %}\n{% assign shsd_product_details = product.metafields.sellersdash.shsdproducts %}\n{% if shsd_product_details.product_type == 'shsd_parent' %}\n  {% assign shsd_product_handles = product.handle %}\n  {% assign shsd_product_handles = shsd_product_handles | concat: shsd_product_details.handles %}\n  {% for shsd_handle in shsd_product_handles %}\n    {% assign shsd_single_product = all_products[shsd_handle] %}\n    {% assign shsd_product_variants = shsd_product_variants | concat: shsd_single_product.variants %}\n    {% assign shsd_product_media = shsd_product_media | concat: shsd_single_product.media %}\n    {% assign shsd_product_images = shsd_product_images | concat: shsd_single_product.images %}\n  {% endfor %}\n  {% assign shsd_product_options_with_values = shsd_product_details.options_with_values %}\n{% else %}\n  {% assign shsd_product_options_with_values = product.options_with_values %}\n  {% assign shsd_product_variants = product.variants %}\n  {% assign shsd_product_media = product.media %}\n  {% assign shsd_product_images = product.images %}\n{% endif %}\n\n{% comment %} Reorder options: Length, Texture, Color, then remaining {% endcomment %}\n{% assign reordered_options = '' | split: '' %}\n{% assign remaining_options = '' | split: '' %}\n\n{% for option in shsd_product_options_with_values %}\n  {% assign opt_name_lower = option.name | downcase | strip %}\n  {% if opt_name_lower == 'length' %}\n    {% assign length_slice = shsd_product_options_with_values | slice: forloop.index0, 1 %}\n  {% elsif opt_name_lower == 'texture' %}\n    {% assign texture_slice = shsd_product_options_with_values | slice: forloop.index0, 1 %}\n  {% elsif opt_name_lower == 'color' or opt_name_lower == 'colour' or opt_name_lower == 'colors' %}\n    {% assign color_slice = shsd_product_options_with_values | slice: forloop.index0, 1 %}\n  {% else %}\n    {% assign other_slice = shsd_product_options_with_values | slice: forloop.index0, 1 %}\n    {% assign remaining_options = remaining_options | concat: other_slice %}\n  {% endif %}\n{% endfor %}\n\n{% if length_slice %}\n  {% assign reordered_options = reordered_options | concat: length_slice %}\n{% endif %}\n{% if texture_slice %}\n  {% assign reordered_options = reordered_options | concat: texture_slice %}\n{% endif %}\n{% if color_slice %}\n  {% assign reordered_options = reordered_options | concat: color_slice %}\n{% endif %}\n{% assign shsd_product_options_with_values = reordered_options | concat: remaining_options %}\n\n{%- assign product_form_id = 'product-form-' | append: pr_sid -%}\n{%- liquid\n  assign pr_variants = shsd_product_variants\n  assign PR_buy_pr = false\n  if bk_stts.show_dynamic_checkout and isExternal == false and isProductAvailable\n    assign PR_buy_pr = true\n  endif\n  assign choose_an_option = 'products.product.choose_an_option' | t\n  assign date_in = settings.date_in\n  assign class_frm = 't4s-form__product has--form__swatch'\n  if isProductDefault\n    assign class_frm = 't4s-form__product'\n  endif\n  if arr_properties.size > 0 and isProductAvailable\n    assign class_frm = class_frm | append: ' has--properties'\n  endif\n  if settings.sticky_atc and type == 'main'\n    assign class_frm = class_frm | append: ' is--main-sticky'\n  else\n    assign class_frm = class_frm | append: ' is--atc-sticky'\n  endif\n\n  assign color_swatch = 'disabled-'\n  assign color_mode = bk_stts.color_mode\n  assign selector_mode = bk_stts.selector_mode\n  assign stt_color_ck = settings.color_ck | default: ';'\n  assign color_ck = stt_color_ck | append: ',color,colors,couleur,colour' | remove: ';,'\n  assign get_color = color_ck | downcase | replace: ' ,', ',' | replace: ', ', ',' | split: ',' | uniq\n  assign color_mode_list = 'color, color is-sw-cl__round, color is-sw-cl__round is-sw-cl__label, variant_image, variant_image is-sw-cl__round, variant_image is-sw-cl__round is-sw-cl__label' | split: ', '\n  if color_mode_list contains color_mode\n    assign color_swatch = 'is-sw__color '\n  endif\n  assign current_variant_available = current_variant.available\n  assign use_incoming_mess = settings.use_incoming_mess\n  assign current_variant_incoming = false\n  assign current_inventory_quantity = current_variant.inventory_quantity\n  if current_inventory_quantity <= 0 and current_variant.inventory_management == 'shopify' and current_variant.incoming\n    assign current_variant_incoming = true\n  endif\n  if pos_sizeg == '1'\n    assign html_sizeg = ''\n  endif\n  if current_variant.inventory_management != null and current_inventory_quantity > 0 and current_variant.inventory_policy != 'continue'\n    assign max_qty = current_inventory_quantity\n  else\n    assign max_qty = 9999\n  endif\n  if color_mode contains 'color' or color_mode contains 'variant'\n    assign show_tooltip = ''\n  else\n    assign show_tooltip = '-off'\n  endif\n-%}\n\n{%- if product.metafields.custom.default_variant.value -%}\n  <script>\n    window.__HAS_SELECTED__ = {{ product.selected_variant | json }};\n    window.__DEFAULT_VARIANT__ = {{ product.metafields.custom.default_variant.value | json }};\n  </script>\n{%- endif -%}\n\n{%- assign length_option_position = -1 -%}\n{%- assign color_option_position = -1 -%}\n{%- for opt_name in product.options -%}\n  {%- assign opt_name_down = opt_name | downcase -%}\n  {%- if opt_name_down == 'length' -%}\n    {%- assign length_option_position = forloop.index -%}\n  {%- endif -%}\n  {%- if get_color contains opt_name_down -%}\n    {%- assign color_option_position = forloop.index -%}\n  {%- endif -%}\n{%- endfor -%}\n\n<script>\n  window.__CUSTOM_OPTION_NAMES__ = {{ custom_option_names | json }};\n  window.__LENGTH_OPTION_INDEX__ = {{ length_option_position | minus: 1 }};\n</script>\n\n{%- comment -%} Load dropdown CSS if either color mode or selector mode is dropdown {%- endcomment -%}\n\n{%- if color_mode == 'dropdown' or selector_mode == 'dropdown' -%}\n  <link\n    rel=\"stylesheet\"\n    href=\"{{ 'base_drop.min.css' | asset_url }}\"\n    media=\"all\"\n  >\n{%- endif -%}\n\n{%- comment -%} Custom CSS for product form dynamic {%- endcomment -%}\n{{ 'product-form-dynamic.css' | asset_url | stylesheet_tag }}\n\n<div class=\"pfd-override-wrapper\">\n  <div class=\"pfd-custom-wrapper\">\n    <div\n      class=\"t4s-product-form__variants is-no-pick__{{ PR_no_pick }}{% if PR_buy_pr %} is-payment-btn-true t4s-payment-button t4s-btn-color-{{ bk_stts.button_color_payment }}{% endif %} is-remove-soldout-{{ remove_soldout }} is-btn-full-width__{{ bk_stts.btn_atc_full }} is-btn-atc-txt-{{ bk_stts.btn_txt }} is-btn-ck-txt-{{ bk_stts.btn_txt2 }} is--fist-ratio-{{ is_fit_ratio_img }}\"\n      style=\"{% if is_fit_ratio_img %} --fit-ratio-img: {{ first_ratio_img }}; {% endif %} --wishlist-color: {{bk_stts.wishlist_color}};--wishlist-hover-color: {{bk_stts.wishlist_color_hover}};--wishlist-active-color: {{bk_stts.wishlist_color_active}};--compare-color: {{bk_stts.compare_color}};--compare-hover-color: {{bk_stts.compare_color_hover}};--compare-active-color: {{bk_stts.compare_color_active}};\"\n      {{ shopify_attributes }}\n    >\n      <div data-callBackVariant id=\"t4s-callBackVariant{{ product_form_id }}\">\n        {%- form 'product',\n          product,\n          id: product_form_id,\n          data-productid: product.id,\n          class: class_frm,\n          novalidate: 'novalidate',\n          data-type: 'add-to-cart-form',\n          data-disable-swatch: isProductDefault\n        -%}\n          {% comment %}{{- form | payment_terms -}}{% endcomment %}\n          {%- if isProductDefault -%}\n            <input\n              name=\"id\"\n              value=\"{{ pr_variants.first.id }}\"\n              type=\"hidden\"\n            >\n            {%- if advance_pr_type != blank -%}\n              {%- render 'choose_style', advance_pr_type: advance_pr_type, title: advance_label, pid: product.id -%}\n            {%- endif -%}\n          {%- else -%}\n            {{ 'swatch.css' | asset_url | stylesheet_tag }}\n            <select\n              name=\"id\"\n              id=\"product-select-{{ pr_sid }}\"\n              class=\"t4s-product__select t4s-d-none\"\n            >\n              {%- for variant in pr_variants -%}\n                {%- if variant.available -%}\n                  <option\n                    data-option1=\"{{ variant.option1 }}\"\n                    data-option2=\"{{ variant.option2 }}\"\n                    value=\"{{ variant.id }}\"\n                    data-mdid=\"{{ variant.featured_media.id | json }}\"\n                    data-incoming=\"{{ variant.incoming }}\"\n                    data-inventoryQuantity=\"{{ variant.inventory_quantity | json }}\"\n                    data-inventoryPolicy=\"{{ variant.inventory_policy | json }}\"\n                    data-nextIncomingDate=\"{{ variant.next_incoming_date | date: date_in }}\"\n                    {% if variant.id == current_variant.id %}\n                      selected=\"selected\"\n                    {% endif %}\n                  >\n                    {{ variant.title | escape }}\n                  </option>\n                {%- else -%}\n                  <option\n                    data-option1=\"{{ variant.option1 }}\"\n                    data-option2=\"{{ variant.option2 }}\"\n                    value=\"{{ variant.id }}\"\n                    data-mdid=\"{{ variant.featured_media.id | json }}\"\n                    data-incoming=\"{{ variant.incoming }}\"\n                    data-inventoryQuantity=\"{{ variant.inventory_quantity | json }}\"\n                    data-inventoryPolicy=\"{{ variant.inventory_policy | json }}\"\n                    data-nextIncomingDate=\"{{ variant.next_incoming_date | date: date_in }}\"\n                  >\n                    {{ variant.title | escape }}\n                  </option>\n                {%- endif -%}\n              {%- endfor -%}\n            </select>\n\n            <div class=\"pfd-variant-images\" style=\"display:none !important;\">\n              <div class=\"pfd-main-imgs\">\n                {%- for variant in pr_variants -%}\n                  {% assign var_imgs = variant.metafields.custom.variant_image.value %}\n                  <div\n                    class=\"pfd-img-listing\"\n                    data-var-img=\"{{ variant.image.src | img_url: 'master' }}\"\n                    data-pfd-variant-id=\"{{ variant.id }}\"\n                  >\n                    {% for value in var_imgs %}\n                      <div class=\"pfd-media-item\">\n                        <img src=\"{{value | img_url: 'master'}}\">\n                      </div>\n                    {% endfor %}\n                  </div>\n                {%- endfor -%}\n              </div>\n              <div class=\"pfd-thumb-imgs\">\n                {%- for variant in pr_variants -%}\n                  {% assign var_imgs = variant.metafields.custom.variant_image.value %}\n                  <div class=\"pfd-img-listing\" data-pfd-variant-id=\"{{ variant.id }}\">\n                    {% for value in var_imgs %}\n                      <div class=\"pfd-media-thumb\">\n                        <div\n                          class=\"pfd-img\"\n                          style=\"background-image:url('{{value | img_url: \"master\"}}');\"\n                        ></div>\n                      </div>\n                    {% endfor %}\n                  </div>\n                {%- endfor -%}\n              </div>\n            </div>\n\n            <div class=\"t4s-swatch t4s-color-mode__{{ color_mode }} t4s-color-size__{{ bk_stts.color_size }} t4s-selector-mode__{{ selector_mode }}\">\n              {%- if advance_pr_type != blank -%}\n                {%- render 'choose_style', advance_pr_type: advance_pr_type, title: advance_label, pid: product.id -%}\n              {%- endif -%}\n\n              {%- for option in shsd_product_options_with_values -%}\n                {%- liquid\n                  assign option_index = 'option' | append: forloop.index\n                  assign selected_value = product.selected_or_first_available_variant[option_index]\n                  assign option_name = option.name\n                  assign name_downcase = option_name | downcase\n                -%}\n\n                {%- if get_color contains name_downcase -%}\n                  {% comment %}--MARK: Color Option{% endcomment %}\n\n                  {% comment %} Build color nickname map from variant metafields {% endcomment %}\n                  {%- capture color_nicknames_map -%}\n                    {%- for variant in shsd_product_variants -%}\n                      {%- if variant.metafields.custom.variant_color != blank -%}\n                        {%- for opt_index in (1..3) -%}\n                          {%- assign opt_key = 'option' | append: opt_index -%}\n                          {%- assign opt_val = variant[opt_key] -%}\n                          {%- if opt_val != blank -%}\n                            {%- assign opt_index_adjusted = opt_index | minus: 1 -%}\n                            {%- assign opt_name_check = product.options[opt_index_adjusted] | downcase -%}\n                            {%- if get_color contains opt_name_check -%}\n                              {{ opt_val | handle }}:{{ variant.metafields.custom.variant_color }};\n                            {%- endif -%}\n                          {%- endif -%}\n                        {%- endfor -%}\n                      {%- endif -%}\n                    {%- endfor -%}\n                  {%- endcapture -%}\n                  {%- assign color_nicknames_map = color_nicknames_map | strip -%}\n\n                  <div\n                    data-swatch-option\n                    data-option-name=\"{{ option_name | escape }}\"\n                    data-id=\"{{ forloop.index0 }}\"\n                    data-option-unit=\"\n                      {%- liquid\n                        assign option_unit = ''\n                        if se_stts and se_stts.option_units and se_stts.option_units != blank\n                          assign option_units_raw = se_stts.option_units | strip | newline_to_br | split: '<br />'\n                          for pair in option_units_raw\n                            assign pair_cleaned = pair | strip\n                            if pair_cleaned contains ':'\n                              assign key_value = pair_cleaned | split: ':'\n                              assign key = key_value[0] | strip\n                              assign value = key_value[1] | strip\n                              if key == option_name and value != blank\n                                assign option_unit = value\n                                break\n                              endif\n                            endif\n                          endfor\n                        endif\n                      -%}{{ option_unit | escape }}\n                    \"\n                    class=\"t4s-swatch__option is-t4s-style__color is-t4s-name__{{ option_name | handle }} {% cycle 'is--first-color', '', '' %}\"\n                  >\n                    <h4 class=\"t4s-swatch__title t4s-swatch__title--color\">\n                      <span class=\"t4s-swatch__title--left\">\n                        <span class=\"bold\">\n                          {{- option_name | upcase -}}\n                          {%- liquid\n                            assign option_unit = ''\n                            if se_stts and se_stts.option_units and se_stts.option_units != blank\n                              assign option_units_raw = se_stts.option_units | strip | newline_to_br | split: '<br />'\n                              for pair in option_units_raw\n                                assign pair_cleaned = pair | strip\n                                if pair_cleaned contains ':'\n                                  assign key_value = pair_cleaned | split: ':'\n                                  assign key = key_value[0] | strip\n                                  assign value = key_value[1] | strip\n                                  if key == option_name and value != blank\n                                    assign option_unit = value\n                                    break\n                                  endif\n                                endif\n                              endfor\n                            endif\n                          -%}\n                          {%- if option_unit != blank %} ({{ option_unit }}){%- endif -%}\n                          :\n                        </span>\n                        <span class=\"t4s-selected-value\">\n                          {%- assign display_value = selected_value | default: choose_an_option | replace: '\"', '' -%}\n                          {{- display_value -}}\n                          {%- if option_unit != blank %} {{ option_unit }}{%- endif -%}\n                        </span>\n                      </span>\n                      {%- if name_sizeg == name_downcase -%}\n                        {{- html_sizeg -}}\n                      {%- endif %}\n                    </h4>\n\n                    <div data-swatch-list class=\"t4s-swatch__list\">\n                      {%- if color_mode != 'dropdown' -%}\n                        {%- if color_mode contains 'is-sw-cl__label' -%}\n                          {%- for value in option.values -%}\n                            {%- assign color_handle = value | handle -%}\n\n                            {%- comment %} Look up color nickname from map {%- endcomment -%}\n                            {%- assign color_nickname = '' -%}\n                            {%- assign nickname_pairs = color_nicknames_map | split: ';' -%}\n                            {%- for pair in nickname_pairs -%}\n                              {%- assign pair_clean = pair | strip -%}\n                              {%- if pair_clean != blank -%}\n                                {%- assign pair_parts = pair_clean | split: ':' -%}\n                                {%- if pair_parts[0] == color_handle -%}\n                                  {%- assign color_nickname = pair_parts[1] -%}\n                                  {%- break -%}\n                                {%- endif -%}\n                              {%- endif -%}\n                            {%- endfor -%}\n\n                            {%- comment %} Context-aware availability check: color + current other selections {%- endcomment -%}\n                            {%- assign color_is_available = false -%}\n                            {%- for variant in shsd_product_variants -%}\n                              {%- assign matches_color = false -%}\n                              {%- assign matches_other_options = true -%}\n\n                              {%- for opt_idx in (1..3) -%}\n                                {%- assign opt_key = 'option' | append: opt_idx -%}\n                                {%- assign variant_opt_val = variant[opt_key] -%}\n                                {%- if variant_opt_val != blank -%}\n                                  {%- assign variant_opt_handle = variant_opt_val | handle -%}\n\n                                  {%- comment %} Determine if this option index is the color option {%- endcomment -%}\n                                  {%- assign opt_idx_adjusted = opt_idx | minus: 1 -%}\n                                  {%- assign this_opt_name = product.options[opt_idx_adjusted] | downcase -%}\n\n                                  {%- if get_color contains this_opt_name -%}\n                                    {%- comment %} This is the color option - check if it matches our target color {%- endcomment -%}\n                                    {%- if variant_opt_handle == color_handle -%}\n                                      {%- assign matches_color = true -%}\n                                    {%- endif -%}\n                                  {%- else -%}\n                                    {%- comment %} This is a non-color option - check if variant matches current selection {%- endcomment -%}\n                                    {%- assign current_selected_val = product.selected_or_first_available_variant[opt_key] -%}\n                                    {%- if current_selected_val != blank -%}\n                                      {%- assign current_selected_handle = current_selected_val | handle -%}\n                                      {%- unless variant_opt_handle == current_selected_handle -%}\n                                        {%- assign matches_other_options = false -%}\n                                      {%- endunless -%}\n                                    {%- endif -%}\n                                  {%- endif -%}\n                                {%- endif -%}\n                              {%- endfor -%}\n\n                              {%- if matches_color and matches_other_options and variant.available -%}\n                                {%- assign color_is_available = true -%}\n                                {%- break -%}\n                              {%- endif -%}\n                            {%- endfor -%}\n\n                            {%- comment %} Compute available standard lengths for this color (used for both classes and content) {%- endcomment -%}\n                            {%- assign avail_lengths = '' -%}\n                            {%- assign avail_lengths_seen = '' -%}\n                            {%- assign length_opt_key = 'option' | append: length_option_position -%}\n                            {%- if length_option_position > 0 and color_option_position > 0 -%}\n                              {%- for lv in shsd_product_variants -%}\n                                {%- assign v_color_key = 'option' | append: color_option_position -%}\n                                {%- assign v_color_val = lv[v_color_key] | handle -%}\n                                {%- if v_color_val == color_handle and lv.available -%}\n                                  {%- assign v_length_val = lv[length_opt_key] -%}\n                                  {%- if v_length_val != blank -%}\n                                    {%- assign is_custom_length = false -%}\n                                    {%- if custom_option_names -%}\n                                      {%- for custom_name in custom_option_names -%}\n                                        {%- assign custom_name_stripped = custom_name | strip -%}\n                                        {%- if v_length_val == custom_name_stripped -%}\n                                          {%- assign is_custom_length = true -%}\n                                          {%- break -%}\n                                        {%- endif -%}\n                                      {%- endfor -%}\n                                    {%- endif -%}\n                                    {%- unless is_custom_length -%}\n                                      {%- assign v_length_clean = v_length_val | replace: '\"', '' | strip -%}\n                                      {%- assign sentinel = '@@' | append: v_length_clean | append: '@@' -%}\n                                      {%- unless avail_lengths_seen contains sentinel -%}\n                                        {%- assign avail_lengths_seen = avail_lengths_seen | append: sentinel -%}\n                                        {%- if avail_lengths == '' -%}\n                                          {%- assign avail_lengths = v_length_clean -%}\n                                        {%- else -%}\n                                          {%- assign avail_lengths = avail_lengths | append: ', ' | append: v_length_clean -%}\n\n                                        {%- endif -%}\n                                      {%- endunless -%}\n                                    {%- endunless -%}\n                                  {%- endif -%}\n                                {%- endif -%}\n                              {%- endfor -%}\n                            {%- endif -%}\n\n                            <div\n                              data-swatch-item\n                              class=\"t4s-swatch__btn-wrap{% if selected_value == value %} is--selected{% endif %}{% unless color_is_available %} is--out-of-stock{% if avail_lengths != '' %} pfd-has-lengths{% endif %}{% endunless %}\"\n                              data-value=\"{{ value | escape }}\"\n                              data-available=\"{{ color_is_available }}\"\n                            >\n                              <!-- DEBUG: color={{ color_handle }} | available={{ color_is_available }} | selected_opt1={{ product.selected_or_first_available_variant.option1 | handle }} | selected_opt2={{ product.selected_or_first_available_variant.option2 | handle }} -->\n                              <div\n                                data-img-el\n                                class=\"t4s-swatch__item {{ color_swatch }}bg_color_{{ value | handle }} lazyloadt4s\"\n                              >\n                                <img crossorigin=\"anonymous\">\n                                {%- unless color_is_available -%}\n                                  <span class=\"t4s-swatch__re-visible\">Awaiting Restock</span>\n                                {%- endunless -%}\n                              </div>\n                              {%- unless color_is_available -%}\n                                {%- if avail_lengths != '' -%}\n                                  <span class=\"t4s-swatch__available-lengths is-visible\">Available in {{ avail_lengths }}</span>\n                                {%- endif -%}\n                              {%- endunless -%}\n                              <span class=\"t4s-swatch__label\">\n                                {{- value | replace: '\"', '' -}}\n                              </span>\n                              {%- if color_nickname != blank -%}\n                                <span class=\"t4s-swatch__nickname\">{{ color_nickname }}</span>\n                              {%- endif -%}\n                            </div>\n                          {%- endfor -%}\n\n                        {%- else -%}\n                          {%- for value in option.values -%}\n                            {%- assign color_handle = value | handle -%}\n\n                            {%- comment %} Look up color nickname {%- endcomment -%}\n                            {%- assign color_nickname = '' -%}\n                            {%- assign nickname_pairs = color_nicknames_map | split: ';' -%}\n                            {%- for pair in nickname_pairs -%}\n                              {%- assign pair_clean = pair | strip -%}\n                              {%- if pair_clean != blank -%}\n                                {%- assign pair_parts = pair_clean | split: ':' -%}\n                                {%- if pair_parts[0] == color_handle -%}\n                                  {%- assign color_nickname = pair_parts[1] -%}\n                                  {%- break -%}\n                                {%- endif -%}\n                              {%- endif -%}\n                            {%- endfor -%}\n\n                            {%- comment %} Context-aware availability check: color + current other selections {%- endcomment -%}\n                            {%- assign color_is_available = false -%}\n                            {%- for variant in shsd_product_variants -%}\n                              {%- assign matches_color = false -%}\n                              {%- assign matches_other_options = true -%}\n\n                              {%- for opt_idx in (1..3) -%}\n                                {%- assign opt_key = 'option' | append: opt_idx -%}\n                                {%- assign variant_opt_val = variant[opt_key] -%}\n                                {%- if variant_opt_val != blank -%}\n                                  {%- assign variant_opt_handle = variant_opt_val | handle -%}\n\n                                  {%- comment %} Determine if this option index is the color option {%- endcomment -%}\n                                  {%- assign opt_idx_adjusted = opt_idx | minus: 1 -%}\n                                  {%- assign this_opt_name = product.options[opt_idx_adjusted] | downcase -%}\n\n                                  {%- if get_color contains this_opt_name -%}\n                                    {%- comment %} This is the color option - check if it matches our target color {%- endcomment -%}\n                                    {%- if variant_opt_handle == color_handle -%}\n                                      {%- assign matches_color = true -%}\n                                    {%- endif -%}\n                                  {%- else -%}\n                                    {%- comment %} This is a non-color option - check if variant matches current selection {%- endcomment -%}\n                                    {%- assign current_selected_val = product.selected_or_first_available_variant[opt_key] -%}\n                                    {%- if current_selected_val != blank -%}\n                                      {%- assign current_selected_handle = current_selected_val | handle -%}\n                                      {%- unless variant_opt_handle == current_selected_handle -%}\n                                        {%- assign matches_other_options = false -%}\n                                      {%- endunless -%}\n                                    {%- endif -%}\n                                  {%- endif -%}\n                                {%- endif -%}\n                              {%- endfor -%}\n\n                              {%- if matches_color and matches_other_options and variant.available -%}\n                                {%- assign color_is_available = true -%}\n                                {%- break -%}\n                              {%- endif -%}\n                            {%- endfor -%}\n\n                            {%- comment %} Compute available standard lengths for this color {%- endcomment -%}\n                            {%- assign avail_lengths = '' -%}\n                            {%- assign avail_lengths_seen = '' -%}\n                            {%- assign length_opt_key = 'option' | append: length_option_position -%}\n                            {%- if length_option_position > 0 and color_option_position > 0 -%}\n                              {%- for lv in shsd_product_variants -%}\n                                {%- assign v_color_key = 'option' | append: color_option_position -%}\n                                {%- assign v_color_val = lv[v_color_key] | handle -%}\n                                {%- if v_color_val == color_handle and lv.available -%}\n                                  {%- assign v_length_val = lv[length_opt_key] -%}\n                                  {%- if v_length_val != blank -%}\n                                    {%- assign is_custom_length = false -%}\n                                    {%- if custom_option_names -%}\n                _name in custom_option_names -%}\n                                        {%- assign custom_name_stripped = custom_name | strip -%}\n                                        {%- if v_length_val == custom_name_stripped -%}\n                                          {%- assign is_custom_length = true -%}\n                                          {%- break -%}\n                                        {%- endif -%}\n                                      {%- endfor -%}\n                                    {%- endif -%}\n                                    {%- unless is_custom_length -%}\n                                      {%- assign v_length_clean = v_length_val | replace: '\"', '' | strip -%}\n                                      {%- assign sentinel = '@@' | append: v_length_clean | append: '@@' -%}\n                                      {%- unless avail_lengths_seen contains sentinel -%}\n                                        {%- assign avail_lengths_seen = avail_lengths_seen | append: sentinel -%}\n                                        {%- if avail_lengths == '' -%}\n                                          {%- assign avail_lengths = v_length_clean -%}\n                                        {%- else -%}\n                                          {%- assign avail_lengths = avail_lengths | append: ', ' | append: v_length_clean -%}\n                                        {%- endif -%}\n                                      {%- endunless -%}\n                                    {%- endunless -%}\n                                  {%- endif -%}\n                                {%- endif -%}\n                              {%- endfor -%}\n                            {%- endif -%}\n\n                            <div\n                              data-swatch-item\n                              class=\"t4s-swatch__btn-wrap{% if selected_value == value %} is--selected{% endif %}{% unless color_is_available %} is--out-of-stock{% if avail_lengths != '' %} pfd-has-lengths{% endif %}{% endunless %}\"\n                              data-value escape }}\"\n                              data-available=\"{{ color_is_available }}\"\n                            >\n                              <div\n                                data-img-el\n                                class=\"t4s-swatch__item {{ color_swatch }}bg_color_{{ value | handle }} lazyloadt4s\"\n                              >\n                                <img crossorigin=\"anonymous\">\n                                {%- unless color_is_available -%}\n                                  <span class=\"t4s-swatch__restock-badge\">Awaiting Restock</span>\n                                {%- endunless -%}\n                              </div>\n                              {%- unless color_is_available -%}\n                                {%- if avail_lengths != '' -%}\n                                  <span class=\"t4s-swatch__available-lengths is-visible\">Available in {{ avail_lengths }}</span>\n                                {%- endif -%}\n                              {%- endunless -%}\n                              {%- if color_nickname != blank -%}\n                                <span class=\"t4s-swatch__nickname\">{{ color_nickname }}</span>\n                              {%- endif -%}\n                            </div>\n\n                          {%- endfor -%}\n\n                        {%- endif -%}\n                      {%- else -%}\n                        <button\n                          type=\"button\"\n                          data-dropdown-open\n                          data-position=\"bottom-end\"\n                          data-id=\"t4s_nt_{{ pr_sid }}{{ forloop.index }}\"\n                        >\n                          <span data-current-value>\n                            {{- selected_value | default: choose_an_option -}}\n                          </span>\n                          <svg\n                            class=\"t4s-icon-select-arrow\"\n                            role=\"presentation\"\n                            viewBox=\"0 0 19 12\"\n                          >\n                            <use xlink:href=\"#t4s-select-arrow\"></use>\n                          </svg>\n                        </button>\n                        <div\n                          data-dropdown-wrapper\n                          class=\"t4s-dropdown__wrapper t4s-current-scrollbar\"\n                          id=\"t4s_nt_{{ pr_sid }}{{ forloop.index }}\"\n                        >\n                          <div class=\"t4s-drop-arrow\"></div>\n                          <div class=\"t4s-dropdown__header\">\n                            <span\n                              data-current-value\n                              class=\"t4s-dropdown__title\"\n                            >\n                              {{- selected_value | default: choose_an_option -}}\n                            </span>\n                            <button\n                              data-dropdown-close\n                              aria-label=\"{{ 'general.aria.close' | t }}\"\n                            >\n                              <svg\n                                role=\"presentation\"\n                                class=\"t4s-iconsvg-close\"\n                                viewBox=\"0 0 16 14\"\n                              >\n                                <path d=\"M15 0L1 14m14 0L1 0\" stroke=\"currentColor\" fill=\"none\" fill-rule=\"evenodd\"></path>\n                              </svg>\n                            </button>\n                          </div>\n                          <div class=\"t4s-dropdown__content\">\n                            {%- for value in option.values -%}\n                              <div\n                                data-swatch-item\n                                data-dropdown-off\n                                class=\"t4s-swatch__item t4s-truncate {{ color_swatch }}bg_color_{{ value | handle }} lazyloadt4s{% if selected_value == value %} is--selected{% endif %}\"\n                                data-value=\"{{ value | escape }}\"\n                              >\n                                {{ value | replace: '\"', '' }}\n                              </div>\n                            {%- endfor -%}\n                          </div>\n                        </div>\n                      {%- endif -%}\n                    </div>\n                    {%- render 'color-info-accordion' -%}\n                  </div>\n                {%- else -%}\n                  {% comment %}--MARK: Non-Color{% endcomment %}\n                  {%- liquid\n                    assign standard_values = ''\n                    assign custom_values = ''\n                    assign has_standard = false\n                    assign has_custom = false\n\n                    for value in option.values\n                      assign is_custom = false\n                      for custom_name in custom_option_names\n                        assign custom_name_clean = custom_name | strip\n                        if value contains custom_name_clean\n                          assign is_custom = true\n                          break\n                        endif\n                      endfor\n\n                      if is_custom\n                        if custom_values == ''\n                          assign custom_values = value\n                        else\n                          assign custom_values = custom_values | append: ',' | append: value\n                        endif\n                        assign has_custom = true\n                      else\n                        if standard_values == ''\n                          assign standard_values = value\n                        else\n                          assign standard_values = standard_values | append: ',' | append: value\n                        endif\n                        assign has_standard = true\n                      endif\n                    endfor\n\n                    assign standard_values_array = standard_values | split: ','\n                    assign custom_values_array = custom_values | split: ','\n                  -%}\n\n                  <div\n                    data-swatch-option\n                    data-option-name=\"{{ option_name | escape }}\"\n                    data-id=\"{{ forloop.index0 }}\"\n                    data-option-unit=\"\n                      {%- liquid\n                        assign option_unit = ''\n                        if se_stts and se_stts.option_units and se_stts.option_units != blank\n                          assign option_units_raw = se_stts.option_units | strip | newline_to_br | split: '<br />'\n                          for pair in option_units_raw\n                            assign pair_cleaned = pair | strip\n                            if pair_cleaned contains ':'\n                              assign key_value = pair_cleaned | split: ':'\n                              assign key = key_value[0] | strip\n                              assign value = key_value[1] | strip\n                              if key == option_name and value != blank\n                                assign option_unit = value\n                                break\n                              endif\n                            endif\n                          endfor\n                        endif\n                      -%}{{ option_unit | escape }}\n                    \"\n                    class=\"t4s-swatch__option is-t4s-name__{{ option_name | handle }} pfd-split-option\"\n                  >\n                    <h4 class=\"t4s-swatch__title\">\n                      <span class=\"t4s-swatch__title--left\"\n                        >Select a\n                        <span class=\"bold\">\n                          {{- option_name -}}\n                        </span>\n                        {%- liquid\n                          assign option_unit = ''\n                          if se_stts and se_stts.option_units and se_stts.option_units != blank\n                            assign option_units_raw = se_stts.option_units | strip | newline_to_br | split: '<br />'\n                            for pair in option_units_raw\n                              assign pair_cleaned = pair | strip\n                              if pair_cleaned contains ':'\n                                assign key_value = pair_cleaned | split: ':'\n                                assign key = key_value[0] | strip\n                                assign value = key_value[1] | strip\n                                if key == option_name and value != blank\n                                  assign option_unit = value\n                                  break\n                                endif\n                              endif\n                            endfor\n                          endif\n                        -%}\n                        {%- if option_unit != blank %} ({{ option_unit }}){%- endif -%}\n                      </span>\n                      <span class=\"t4s-swatch__title--right\"\n                        >Selected:\n                        <span class=\"bold\">\n                          {%- assign display_value = selected_value | default: choose_an_option | replace: '\"', '' -%}\n                          {{- display_value -}}\n                          {%- if option_unit != blank %} {{ option_unit }}{%- endif -%}\n                        </span></span\n                      >\n                      {%- if name_sizeg == name_downcase -%}\n                        {{- html_sizeg -}}\n                      {%- endif %}\n                    </h4>\n\n                    <div class=\"pfd-split-selection\">\n                      {%- if has_standard -%}\n                        <div class=\"pfd-standard-options\">\n                          {%- if selector_mode != 'dropdown' -%}\n                            {%- for value in standard_values_array -%}\n                              <div\n                                data-swatch-item\n                                class=\"t4s-swatch__item{% if selected_value == value %} is--selected{% endif %}\"\n                                data-value=\"{{ value | escape }}\"\n                              >\n                                {{ value | replace: '\"', '' }}\n                              </div>\n                            {%- endfor -%}\n                          {%- else -%}\n                            <button\n                              type=\"button\"\n                              data-pfd-dropdown-open\n                              data-position=\"bottom-end\"\n                              data-id=\"t4s_nt_{{ pr_sid }}{{ forloop.index }}_standard\"\n                            >\n                              <span data-current-value>\n                                {{- selected_value | default: choose_an_option -}}\n                              </span>\n                              <svg\n                                class=\"t4s-icon-select-arrow\"\n                                role=\"presentation\"\n                                viewBox=\"0 0 19 12\"\n                              >\n                                <use xlink:href=\"#t4s-select-arrow\"></use>\n                              </svg>\n                            </button>\n                            <div\n                              data-dropdown-wrapper\n                              class=\"t4s-dropdown__wrapper t4s-current-scrollbar\"\n                              id=\"t4s_nt_{{ pr_sid }}{{ forloop.index }}_standard\"\n                            >\n                              <div class=\"t4s-drop-arrow\"></div>\n                              <div class=\"t4s-dropdown__content\">\n                                {%- for value in standard_values_array -%}\n                                  <div\n                                    data-swatch-item\n                                    data-dropdown-off\n                                    class=\"t4s-swatch__item t4s-truncate{% if selected_value == value %} is--selected{% endif %}\"\n                                    data-value=\"{{ value | escape }}\"\n                                  >\n                                    {{ value | replace: '\"', '' }}\n                                  </div>\n                                {%- endfor -%}\n                              </div>\n                            </div>\n                          {%- endif -%}\n                        </div>\n                      {%- endif -%}\n\n                      {%- if has_custom -%}\n                        <div class=\"pfd-custom-options\">\n                          {%- if has_standard and has_custom -%}\n                            <span class=\"pfd-or-separator\">or</span>\n                          {%- endif -%}\n                          <button\n                            type=\"button\"\n                            data-pfd-dropdown-open\n                            data-position=\"bottom-end\"\n                            data-id=\"t4s_nt_{{ pr_sid }}{{ forloop.index }}_custom\"\n                            class=\"pfd-custom-dropdown\"\n                          >\n                            <span data-current-value>\n                              {%- assign is_custom_selected = false -%}\n                              {%- for custom_val in custom_values_array -%}\n                                {%- if selected_value == custom_val -%}\n                                  {%- assign display_custom_val = custom_val | replace: '\"', '' -%}\n                                  {%- if option_unit != blank -%}\n                                    {{ display_custom_val }}\n                                    {{ option_unit }}\n                                    <span class=\"pfd-custom-badge\">Custom</span>\n                                  {%- else -%}\n                                    {{ display_custom_val }}\n                                    <span class=\"pfd-custom-badge\">Custom</span>\n                                  {%- endif -%}\n                                  {%- assign is_custom_selected = true -%}\n                                  {%- break -%}\n                                {%- endif -%}\n                              {%- endfor -%}\n                              {%- unless is_custom_selected -%}\n                                Custom {{ option_name | downcase }}\n                              {%- endunless -%}\n                            </span>\n                            <svg\n                              class=\"t4s-icon-select-arrow\"\n                              role=\"presentation\"\n                              viewBox=\"0 0 19 12\"\n                            >\n                              <use xlink:href=\"#t4s-select-arrow\"></use>\n                            </svg>\n                          </button>\n                          <div\n                            data-dropdown-wrapper\n                            class=\"t4s-dropdown__wrapper t4s-current-scrollbar\"\n                            id=\"t4s_nt_{{ pr_sid }}{{ forloop.index }}_custom\"\n                          >\n                            <div class=\"t4s-drop-arrow\"></div>\n                            <div class=\"t4s-dropdown__content\">\n                              {%- for value in custom_values_array -%}\n                                <div\n                                  data-swatch-item\n                                  data-dropdown-off\n                                  class=\"t4s-swatch__item t4s-truncate{% if selected_value == value %} is--selected{% endif %}\"\n                                  data-value=\"{{ value | escape }}\"\n                                >\n                                  <span class=\"pfd-checkmark\">✓</span>\n                                  <span class=\"pfd-option-text\">\n                                    {%- assign display_value = value | replace: '\"', '' -%}\n                                    {%- if option_unit != blank -%}\n                                      {{ display_value }}\n                                      {{ option_unit }}\n                                    {%- else -%}\n                                      {{ display_value }}\n                                    {%- endif -%}\n                                  </span>\n                                  <span class=\"pfd-custom-badge\">Custom</span>\n                                </div>\n                              {%- endfor -%}\n                            </div>\n                          </div>\n                        </div>\n                      {%- endif -%}\n\n                      {%- unless has_standard or has_custom -%}\n                        {%- comment %} Fallback to original rendering if no split detected {%- endcomment %}\n                        <div class=\"t4s-swatch__list pfd-fallback-list\">\n                          {%- if selector_mode != 'dropdown' -%}\n                            {%- for value in option.values -%}\n                              <div\n                                data-swatch-item\n                                class=\"t4s-swatch__item{% if selected_value == value %} is--selected{% endif %}\"\n                                data-value=\"{{ value | escape }}\"\n                              >\n                                {{ value | replace: '\"', '' }}\n                              </div>\n                            {%- endfor -%}\n                          {%- else -%}\n                            <button\n                              type=\"button\"\n                              data-pfd-dropdown-open\n                              data-position=\"bottom-end\"\n                              data-id=\"t4s_nt_{{ pr_sid }}{{ forloop.index }}\"\n                            >\n                              <span data-current-value>\n                                {{- selected_value | default: choose_an_option -}}\n                              </span>\n                              <svg\n                                class=\"t4s-icon-select-arrow\"\n                                role=\"presentation\"\n                                viewBox=\"0 0 19 12\"\n                              >\n                                <use xlink:href=\"#t4s-select-arrow\"></use>\n                              </svg>\n                            </button>\n                            <div\n                              data-dropdown-wrapper\n                              class=\"t4s-dropdown__wrapper t4s-current-scrollbar\"\n                              id=\"t4s_nt_{{ pr_sid }}{{ forloop.index }}\"\n                            >\n                              <div class=\"t4s-drop-arrow\"></div>\n                              <div class=\"t4s-dropdown__content\">\n                                {%- for value in option.values -%}\n                                  <div\n                                    data-swatch-item\n                                    data-dropdown-off\n                                    class=\"t4s-swatch__item t4s-truncate{% if selected_value == value %} is--selected{% endif %}\"\n                                    data-value=\"{{ value | escape }}\"\n                                  >\n                                    {{ value | replace: '\"', '' }}\n                                  </div>\n                                {%- endfor -%}\n                              </div>\n                            </div>\n                          {%- endif -%}\n                        </div>\n                      {%- endunless -%}\n                    </div>\n\n                    {%- comment %} Custom order notice - shown when custom option is selected {%- endcomment %}\n                    {%- assign show_custom_notice = false -%}\n                    {%- for custom_val in custom_values_array -%}\n                      {%- if selected_value == custom_val -%}\n                        {%- assign show_custom_notice = true -%}\n                        {%- break -%}\n                      {%- endif -%}\n                    {%- endfor -%}\n                    <div\n                      class=\"pfd-custom-notice\"\n                      style=\"display: {% if show_custom_notice %}block{% else %}none{% endif %};\"\n                    >\n                      <div class=\"pfd-custom-notice-content\">\n                        <svg\n                          class=\"pfd-custom-notice-icon\"\n                          xmlns=\"http://www.w3.org/2000/svg\"\n                          width=\"24\"\n                          height=\"24\"\n                          viewBox=\"0 0 24 24\"\n                          fill=\"none\"\n                          stroke=\"currentColor\"\n                          stroke-width=\"2\"\n                          stroke-linecap=\"round\"\n                          stroke-linejoin=\"round\"\n                        >\n                          <circle cx=\"12\" cy=\"12\" r=\"10\"></circle>\n                          <polyline points=\"12 6 12 12 16 14\"></polyline>\n                        </svg>\n                        <p class=\"pfd-custom-notice-text\">\n                          Custom {{ option_name | downcase }}s are <strong>made to order</strong>. Please allow\n                          <span class=\"pfd-custom-notice-highlight\">6-8 weeks</span> for delivery.\n                        </p>\n                      </div>\n                    </div>\n\n                    {%- comment %} Configuration-based custom content for options {%- endcomment %}\n                    {%- comment %} Renders ALL matching option content, shows only the selected one {%- endcomment %}\n                    {%- assign option_name_lower = option_name | downcase -%}\n                    {%- assign selected_value_lower = selected_value | downcase -%}\n\n                    {%- capture all_option_info -%}\n  {%- for pair in option_content_pairs -%}\n    {%- assign pair_cleaned = pair | strip -%}\n    {%- if pair_cleaned contains '|' -%}\n      {%- assign parts = pair_cleaned | split: '|' -%}\n      {%- assign option_key_full = parts[0] | strip -%}\n      {%- assign content_value = parts[1] | strip -%}\n\n      {%- if option_key_full contains ':' -%}\n        {%- assign key_parts = option_key_full | split: ':' -%}\n        {%- assign option_key = key_parts[0] | strip | downcase -%}\n        {%- assign value_key = key_parts[1] | strip -%}\n        {%- assign value_key_lower = value_key | downcase -%}\n\n        {%- if option_name_lower == option_key -%}\n          {%- assign is_selected = false -%}\n          {%- if selected_value_lower == value_key_lower -%}\n            {%- assign is_selected = true -%}\n          {%- endif -%}\n          <div class=\"pfd-option-info-item\"\n               data-option-name=\"{{ option_name_lower }}\"\n               data-option-value=\"{{ value_key | handle }}\"\n               style=\"{% unless is_selected %}display: none;{% endunless %}\">\n            {{ content_value }}\n          </div>\n        {%- endif -%}\n      {%- endif -%}\n    {%- endif -%}\n  {%- endfor -%}\n{%- endcapture -%}\n\n                    {%- assign all_option_info_stripped = all_option_info | strip -%}\n                    {%- if all_option_info_stripped != blank -%}\n                      <div class=\"pfd-custom-option-info\" data-option-info-container=\"{{ option_name_lower }}\">\n                        {{ all_option_info }}\n                      </div>\n                    {%- endif -%}\n                  </div>\n                {%- endif -%}\n              {%- endfor -%}\n            </div>\n          {%- endif -%}\n\n          {%- liquid\n            if arr_properties.size > 0 and isProductAvailable\n              render 'frm_properties', arr_properties: arr_properties, product: product\n            endif\n          -%}\n\n          {%- if use_incoming_mess\n            and current_variant_incoming\n            and pr_variants.size == 1\n            and current_variant.next_incoming_date != blank\n          -%}\n            {%- assign format_date = current_variant.next_incoming_date | date: date_in -%}\n            {% comment %}<div class=\"t4s-incoming__mess\">{% if current_variant_available %}{{ 'products.product_single.will_not_ship_until_html' | t: date: format_date }}{% else %}{{ 'products.product_single.will_be_in_stock_after_html' | t: date: format_date }}{% endif %}</div>{% endcomment %}\n          {%- elsif use_incoming_mess and pr_variants.size > 1 -%}\n            {%- liquid\n              assign format_date = current_variant.next_incoming_date | date: date_in\n              unless format_date\n                assign format_date = '19041994'\n              endunless\n            -%}\n            {% comment %}<div data-incoming__mess class=\"t4s-incoming__mess\"{% unless current_variant_incoming %} hidden{% endunless %}><span data-incoming-available{% if current_variant_available == false or current_variant == blank %} style=\"display: none\"{% endif %}>{{ 'products.product_single.will_not_ship_until_html' | t: date: format_date }}</span><span data-incoming-soldout{% if current_variant_available or current_variant == blank %} style=\"display: none\"{% endif %}>{{ 'products.product_single.will_be_in_stock_after_html' | t: date: format_date }}</span></div>{% endcomment %}\n          {%- endif -%}\n\n          {{ 'button-style.css' | asset_url | stylesheet_tag }}\n          <link\n            href=\"{{ 'custom-effect.css' | asset_url }}\"\n            rel=\"stylesheet\"\n            media=\"print\"\n            onload=\"this.media='all'\"\n          >\n\n          {{- html_price -}}\n\n          <div\n            class=\"t4s-product-form__buttons\"\n            style=\"--pr-btn-round: {{ bk_stts.pr_btn_round }}px;--wis-cp-btn-round: {{ bk_stts.wis_cp_btn_round }}px;\"\n          >\n            <div class=\"t4s-pr__qty_cart t4s-d-flex t4s-flex-wrap\">\n              {%- if isExternal -%}\n                <a\n                  href=\"{{ external_link }}\"\n                  rel=\"nofollow\"\n                  target=\"_blank\"\n                  class=\"t4s-product-form__submit t4s-btn t4s-btn-base t4s-btn-style-{{ bk_stts.button_style }} t4s-btn-color-{{ bk_stts.button_color }} t4s-w-100 t4s-justify-content-center {% if bk_stts.button_style == 'default' or bk_stts.button_style == 'outline' %} t4s-btn-effect-{{ bk_stts.button_effect }}{% endif %} t4s-truncate is--btn-external t4s-btn-loading__svg\"\n                >\n                  {%- if bk_stts.btn_icon -%}\n                    <svg class=\"t4s-btn-icon\" viewBox=\"0 0 24 24\">\n                      <use xlink:href=\"#t4s-icon-atc\"></use>\n                    </svg>\n                  {%- endif -%}\n                  <span class=\"t4s-btn-atc_text\">\n                    {{- external_title -}}\n                  </span>\n                  <span class=\"t4s-loading__spinner\" hidden>\n                    <svg\n                      width=\"16\"\n                      height=\"16\"\n                      hidden\n                      class=\"t4s-svg-spinner\"\n                      focusable=\"false\"\n                      role=\"presentation\"\n                      viewBox=\"0 0 66 66\"\n                      xmlns=\"http://www.w3.org/2000/svg\"\n                    >\n                      <circle class=\"t4s-path\" fill=\"none\" stroke-width=\"6\" cx=\"33\" cy=\"33\" r=\"30\"></circle>\n                    </svg>\n                  </span>\n                </a>\n              {%- else -%}\n                {%- if bk_stts.show_qty and isProductAvailable -%}\n                  <div\n                    data-quantity-wrapper\n                    class=\"t4s-quantity-wrapper t4s-product-form__qty\"\n                  >\n                    <button\n                      data-quantity-selector\n                      data-decrease-qty\n                      type=\"button\"\n                      class=\"t4s-quantity-selector is--minus\"\n                    ></button>\n                    <input\n                      data-quantity-value\n                      type=\"number\"\n                      class=\"t4s-quantity-input\"\n                      step=\"1\"\n                      min=\"{{cus_qty}}\"\n                      max=\"{{max_qty}}\"\n                      name=\"quantity\"\n                      value=\"{{cus_qty}}\"\n                      size=\"4\"\n                      pattern=\"[0-9]*\"\n                      inputmode=\"numeric\"\n                    >\n                    <button\n                      data-quantity-selector\n                      data-increase-qty\n                      type=\"button\"\n                      class=\"t4s-quantity-selector is--plus\"\n                    ></button>\n                  </div>\n                {%- else -%}\n                  <input type=\"hidden\" name=\"quantity\" value=\"1\">\n                {%- endif -%}\n                {% if customer %}\n                  <button\n                    data-animation-atc='{ \"ani\": \"{{ bk_stts.ani }}\",\"time\": {{ bk_stts.time }}000 }'\n                    type=\"submit\"\n                    name=\"add\"\n                    data-atc-form\n                    class=\"t4s-product-form__submit t4s-btn t4s-btn-base t4s-btn-style-{{ bk_stts.button_style }} t4s-btn-color-{{ bk_stts.button_color }} t4s-w-100 t4s-justify-content-center {% if bk_stts.button_style == 'default' or bk_stts.button_style == 'outline' %} t4s-btn-effect-{{ bk_stts.button_effect }}{% endif %} t4s-btn-loading__svg\"\n                    {% unless current_variant_available %}\n                      aria-disabled=\"true\"\n                    {% endunless -%}\n                    {% unless isProductAvailable %}\n                      disabled=\"disabled\"\n                    {% endunless %}\n                  >\n                    {%- if bk_stts.btn_icon -%}\n                      <svg\n                        class=\"t4s-btn-icon\"\n                        viewBox=\"0 0 24 24\"\n                      >\n                        <use xlink:href=\"#t4s-icon-atc\"></use>\n                      </svg>\n                    {%- endif -%}\n                    <span class=\"t4s-btn-atc_text\">\n                      {%- if current_variant_available == false or isProductAvailable == false -%}\n                        {{- 'products.product.sold_out' | t -}}\n                      {%- elsif isPreoder -%}\n                        {{- 'products.product.pre_order' | t }}\n                      {%- else -%}\n                        {{ 'products.product.add_to_cart' | t }}\n                      {%- endif -%}\n                    </span>\n                    <span class=\"t4s-loading__spinner\" hidden>\n                      <svg\n                        width=\"16\"\n                        height=\"16\"\n                        hidden\n                        class=\"t4s-svg-spinner\"\n                        focusable=\"false\"\n                        role=\"presentation\"\n                        viewBox=\"0 0 66 66\"\n                        xmlns=\"http://www.w3.org/2000/svg\"\n                      >\n                        <circle class=\"t4s-path\" fill=\"none\" stroke-width=\"6\" cx=\"33\" cy=\"33\" r=\"30\"></circle>\n                      </svg>\n                    </span>\n                  </button>\n                {% else %}\n                  <a\n                    href=\"/account/login\"\n                    onclick=\"rememberPage(event)\"\n                    data-drawer-delay-\n                    data-drawer-options='{ \"id\": \"#t4s-login-sidebar\" }'\n                    class=\"atc-btn t4s-btn t4s-btn-base t4s-btn-style-default t4s-btn-color-dark t4s-w-100 t4s-justify-content-center t4s-btn-effect-sweep-to-right t4s-btn-loading__svg\"\n                  >\n                    <svg\n                      class=\"t4s-btn-icon\"\n                      viewBox=\"0 0 24 24\"\n                      style=\"margin-right:4px\"\n                    >\n                      <use xlink:href=\"#t4s-icon-atc\"></use>\n                    </svg>\n                    <span class=\"t4s-btn-atc_text\">Login to Shop</span>\n                    <span class=\"t4s-loading__spinner\" hidden=\"\">\n                      <svg\n                        width=\"16\"\n                        height=\"16\"\n                        hidden=\"\"\n                        class=\"t4s-svg-spinner\"\n                        focusable=\"false\"\n                        role=\"presentation\"\n                        viewBox=\"0 0 66 66\"\n                        xmlns=\"http://www.w3.org/2000/svg\"\n                      >\n                        <circle class=\"t4s-path\" fill=\"none\" stroke-width=\"6\" cx=\"33\" cy=\"33\" r=\"30\"></circle>\n                      </svg>\n                    </span>\n                  </a>\n                {% endif %}\n              {%- endif -%}\n            </div>\n            {%- if PR_buy_pr and type != 'main_sticky' %}\n              {{- form | payment_button -}}\n            {% endif -%}\n            {%- if settings.use_notify_me -%}\n              {% if customer -%}\n                <button\n                  data-class=\"t4s-mfp-btn-close-inline\"\n                  data-id=\"t4s-pr-popup__notify-stock\"\n                  data-storageid=\"notify-stock{{ current_variant.id }}\"\n                  data-mfp-src\n                  data-open-mfp-ajax\n                  class=\"t4s-pr__notify-stock{% if current_variant_available or current_variant == blank %} t4s-d-none{% endif %}\"\n                  type=\"button\"\n                  data-notify-stock-btn\n                  data-variant-id=\"{{ current_variant.id }}\"\n                  data-root-url=\"{{ routes.root_url }}\"\n                >\n                  {{ 'products.notify_stock.trigger' | t }}\n                </button>\n              {%- endif %}\n            {%- endif -%}\n            {%- if bk_stts.enable_wishlist or bk_stts.enable_compare -%}\n              <div class=\"t4s-pr__wis_cp\">\n                {%- render 't4s_wis_cp', product: product, bk_stts: bk_stts, disableTooltip: true -%}\n              </div>\n            {%- endif -%}\n          </div>\n        {%- endform -%}\n        {%- unless isProductDefault or type == 'main_sticky' -%}\n          <script type=\"application/json\" class=\"pr_variants_json\">\n            {{ shsd_product_variants | json }}\n          </script>\n          <script type=\"application/json\" class=\"pr_options_json\">\n            {{ shsd_product_options_with_values | json }}\n          </script>\n        {%- endunless -%}\n        {%- if bk_stts.ani != 'none' -%}\n          <link\n            href=\"{{ 'ani-atc.min.css' | asset_url }}\"\n            rel=\"stylesheet\"\n            media=\"print\"\n            onload=\"this.media='all'\"\n          >\n        {%- endif -%}\n      </div>\n    </div>\n  </div>\n\n  <script>\n    (function () {\n      'use strict';\n\n      function updateOptionInfo(container, selectedValue) {\n        var optionName = container.getAttribute('data-option-name');\n        if (!optionName) return;\n        optionName = optionName.toLowerCase();\n\n        var infoContainer = container.querySelector('[data-option-info-container=\"' + optionName + '\"]');\n        if (!infoContainer) return;\n\n        var valueHandle = selectedValue\n          .toLowerCase()\n          .replace(/\\s+/g, '-')\n          .replace(/[^a-z0-9-]/g, '');\n        var infoItems = infoContainer.querySelectorAll('.pfd-option-info-item');\n\n        infoItems.forEach(function (item) {\n          var itemValue = item.getAttribute('data-option-value');\n          item.style.display = itemValue === valueHandle ? '' : 'none';\n        });\n      }\n\n      function initOptionInfoHandler() {\n        var swatchContainers = document.querySelectorAll('[data-swatch-option]');\n\n        swatchContainers.forEach(function (container) {\n          // Method 1: MutationObserver for instant updates\n          var observer = new MutationObserver(function (mutations) {\n            mutations.forEach(function (mutation) {\n              if (mutation.type === 'attributes' && mutation.attributeName === 'class') {\n                var target = mutation.target;\n                if (target.classList.contains('is--selected') && target.hasAttribute('data-value')) {\n                  var selectedValue = target.getAttribute('data-value');\n                  updateOptionInfo(container, selectedValue);\n                }\n              }\n            });\n          });\n\n          observer.observe(container, {\n            attributes: true,\n            subtree: true,\n            attributeFilter: ['class'],\n          });\n\n          // Method 2: Backup click handler with small delay\n          var swatchItems = container.querySelectorAll('[data-swatch-item]');\n          swatchItems.forEach(function (swatch) {\n            swatch.addEventListener('click', function () {\n              var selectedValue = this.getAttribute('data-value');\n              if (!selectedValue) return;\n              setTimeout(function () {\n                updateOptionInfo(container, selectedValue);\n              }, 10);\n            });\n          });\n        });\n      }\n\n      if (document.readyState === 'loading') {\n        document.addEventListener('DOMContentLoaded', initOptionInfoHandler);\n      } else {\n        initOptionInfoHandler();\n      }\n\n      document.addEventListener('shopify:section:load', initOptionInfoHandler);\n    })();\n  </script>\n</div>\n{%- if PR_buy_pr and current_variant_available != true and type != 'main_sticky' -%}\n  <style>\n    #t4s-callBackVariant{{ product_form_id }} .shopify-payment-button { display: none;}\n  </style>\n{% endif -%}\n",
              "reasoning": "Replace the second color swatch branch with the same clean pattern: pre-compute lengths before the div using @@ sentinel dedup, move restock badge inside [data-img-el] so JS finds and reuses it, fix indentation, remove the inline one-liner class computation."
            },
            "result": "(no result received)",
            "isError": true,
            "elapsedMs": 0
          },
          {
            "name": "edit_lines",
            "id": "toolu_0125XfBkAH5CxtbBGeZezZTF",
            "input": {
              "filePath": "snippets/product-form-dynamic.liquid",
              "startLine": 537,
              "endLine": 596,
              "newContent": "                            {%- comment %} Compute available standard lengths for this color {%- endcomment -%}\n                            {%- assign avail_lengths = '' -%}\n                            {%- assign avail_lengths_seen = '' -%}\n                            {%- assign length_opt_key = 'option' | append: length_option_position -%}\n                            {%- if length_option_position > 0 and color_option_position > 0 -%}\n                              {%- for lv in shsd_product_variants -%}\n                                {%- assign v_color_key = 'option' | append: color_option_position -%}\n                                {%- assign v_color_val = lv[v_color_key] | handle -%}\n                                {%- if v_color_val == color_handle and lv.available -%}\n                                  {%- assign v_length_val = lv[length_opt_key] -%}\n                                  {%- if v_length_val != blank -%}\n                                    {%- assign is_custom_length = false -%}\n                                    {%- if custom_option_names -%}\n                _name in custom_option_names -%}\n                                        {%- assign custom_name_stripped = custom_name | strip -%}\n                                        {%- if v_length_val == custom_name_stripped -%}\n                                          {%- assign is_custom_length = true -%}\n                                          {%- break -%}\n                                        {%- endif -%}\n                                      {%- endfor -%}\n                                    {%- endif -%}\n                                    {%- unless is_custom_length -%}\n                                      {%- assign v_length_clean = v_length_val | replace: '\"', '' | strip -%}\n                                      {%- assign sentinel = '@@' | append: v_length_clean | append: '@@' -%}\n                                      {%- unless avail_lengths_seen contains sentinel -%}\n                                        {%- assign avail_lengths_seen = avail_lengths_seen | append: sentinel -%}\n                                        {%- if avail_lengths == '' -%}\n                                          {%- assign avail_lengths = v_length_clean -%}\n                                        {%- else -%}\n                                          {%- assign avail_lengths = avail_lengths | append: ', ' | append: v_length_clean -%}\n                                        {%- endif -%}\n                                      {%- endunless -%}\n                                    {%- endunless -%}\n                                  {%- endif -%}\n                                {%- endif -%}\n                              {%- endfor -%}\n                            {%- endif -%}\n\n                            <div\n                              data-swatch-item\n                              class=\"t4s-swatch__btn-wrap{% if selected_value == value %} is--selected{% endif %}{% unless color_is_available %} is--out-of-stock{% if avail_lengths != '' %} pfd-has-lengths{% endif %}{% endunless %}\"\n                              data-value escape }}\"\n                              data-available=\"{{ color_is_available }}\"\n                            >\n                              <div\n                                data-img-el\n                                class=\"t4s-swatch__item {{ color_swatch }}bg_color_{{ value | handle }} lazyloadt4s\"\n                              >\n                                <img crossorigin=\"anonymous\">\n                                {%- unless color_is_available -%}\n                                  <span class=\"t4s-swatch__restock-badge\">Awaiting Restock</span>\n                                {%- endunless -%}\n                              </div>\n                              {%- unless color_is_available -%}\n                                {%- if avail_lengths != '' -%}\n                                  <span class=\"t4s-swatch__available-lengths is-visible\">Available in {{ avail_lengths }}</span>\n                                {%- endif -%}\n                              {%- endunless -%}\n                              {%- if color_nickname != blank -%}\n                                <span class=\"t4s-swatch__nickname\">{{ color_nickname }}</span>\n                              {%- endif -%}\n                            </div>\n\n                          {%- endfor -%}\n",
              "reasoning": "Replace the second color swatch branch with the same clean pattern: pre-compute lengths before the div using @@ sentinel dedup, move restock badge inside [data-img-el] so JS finds and reuses it, fix indentation, remove the inline one-liner class computation."
            },
            "result": "(no result received)",
            "isError": true,
            "elapsedMs": 0
          }
        ],
        "reasoningBlocks": [],
        "responseText": "",
        "outcome": {
          "status": "no-change",
          "changedFiles": 0,
          "validationIssues": [
            {
              "gate": "syntax",
              "errors": [
                "product-form-dynamic.liquid:478 — Unexpected tag \"{% endfor %}\" without matching opening tag",
                "product-form-dynamic.liquid:479 — Unexpected tag \"{% endfor %}\" without matching opening tag",
                "product-form-dynamic.liquid:556 — Unexpected tag \"{% endfor %}\" without matching opening tag",
                "snippets/product-form-dynamic.liquid:1025 — Unexpected closing tag {% endfor %} with no matching opener",
                "templates/page.ecom-deadfest2025.json:0 — Invalid JSON in template file"
              ],
              "changesKept": true
            },
            {
              "gate": "cross_file",
              "errors": [
                "product-form-dynamic.liquid — Liquid introduces new class(es) without companion CSS change: \"avail_lengths\", \"!=\", \"t4s-swatch__re-visible\"."
              ],
              "changesKept": true
            },
            {
              "gate": "cross_file",
              "errors": [
                "product-form-dynamic.liquid — Liquid introduces new class(es) without companion CSS change: \"avail_lengths\", \"!=\", \"t4s-swatch__re-visible\"."
              ],
              "changesKept": false
            }
          ]
        },
        "metrics": {
          "totalToolCalls": 21,
          "editToolCalls": 8,
          "readToolCalls": 12,
          "searchToolCalls": 0,
          "elapsedMs": 249936,
          "costCents": 0,
          "inputTokens": 0,
          "outputTokens": 0
        }
      },
      "analysis": {
        "diagnosis": {
          "summary": "Agent executed 21 tool calls (12 reads, 8 edits, 0 searches) over 250s but produced zero file changes. The tool sequence shows repeated read_lines calls on the same three files (product-form-dynamic.liquid, .js, .css), followed by 8 consecutive edit/propose_code_edit failures (calls 14-21). All edit attempts returned ERROR with 'no result received', indicating the edit_lines and propose_code_edit tools failed silently or crashed without returning results. The agent never recovered from these failures and stalled without completing the three-layer implementation.",
          "rootCause": "The tool executor (lib/agents/tools/v2-tool-executor.ts) or the underlying edit_lines/propose_code_edit tool implementations are failing to return valid responses when invoked. The agent read files successfully (0ms latency indicates cached/mocked responses) but could not execute edits. This suggests either: (1) tool_executor.ts is not properly catching and returning error states, (2) the edit tools are crashing and not returning structured error objects, or (3) the coordinator is not validating tool responses before proceeding, allowing the agent to enter a retry loop with no recovery mechanism.",
          "agentBehavior": "The agent correctly classified the request as COMPLEX tier with GOD_MODE strategy and loaded context (606 files, style profile). It systematically read the three target files multiple times (possibly gathering context for edits). However, after call 13 (final read_lines), it attempted to call propose_code_edit and edit_lines 8 times in succession. Each call returned ERROR with no result. The agent did not: (1) emit diagnostic errors to the user, (2) fall back to a simpler strategy, (3) detect stagnation (repeated errors), or (4) exit gracefully. It appears the coordinator's iteration loop continued despite tool failures, exhausting attempts without progress."
        },
        "recommendations": [
          {
            "priority": "critical",
            "category": "tools",
            "title": "Fix edit_lines and propose_code_edit error handling and response validation",
            "description": "The edit_lines and propose_code_edit tools are returning ERROR with no result. The tool executor must: (1) catch all exceptions from underlying edit operations, (2) return structured error objects with clear reason and recovery suggestion, (3) validate that file paths are correct (snippets/product-form-dynamic.liquid vs product-form-dynamic.liquid mismatch in call 14-16), (4) ensure response always includes {success: boolean, error?: string, result?: object}. Add defensive checks for file existence, path normalization, and permission errors before attempting edits.",
            "targetFile": "lib/agents/tools/v2-tool-executor.ts",
            "targetArea": "edit_lines and propose_code_edit handler functions",
            "suggestedChange": "Wrap all edit operations in try-catch. Return {success: false, error: 'File not found: snippets/product-form-dynamic.liquid', recoveryHint: 'Verify file path'} on failure. Validate filePath matches actual file (remove leading 'snippets/' if not present). Add logging of all edit attempts and responses. Return early with error if path is malformed."
          },
          {
            "priority": "critical",
            "category": "coordinator",
            "title": "Implement stagnation detection and failure recovery in coordinator loop",
            "description": "The coordinator's main loop (think -> tool -> observe -> repeat) continued for 21 iterations despite 8 consecutive tool failures starting at call 14. There is no stagnation detection that would: (1) count consecutive errors, (2) detect when the same tool is called repeatedly with the same parameters, (3) trigger fallback strategy or exit, (4) emit user-facing error messages. Add a failure counter that breaks the loop after 3 consecutive tool errors, or switches to a read-only diagnostic mode.",
            "targetFile": "lib/agents/coordinator-v2.ts",
            "targetArea": "Main iteration loop (think -> tool -> observe cycle)",
            "suggestedChange": "Add consecutiveErrorCount variable. After each tool call, if result.error is set, increment counter. If consecutiveErrorCount >= 3, emit error message to user with details of failed tool and last 3 error messages, then exit loop. Reset counter on successful tool execution. Add logging: console.log(`[coordinator] Tool call ${callNum} failed: ${result.error}`) before attempting retry."
          },
          {
            "priority": "high",
            "category": "validation",
            "title": "Validate tool responses before proceeding in coordinator",
            "description": "The coordinator appears to accept tool responses without validation. Calls 14-21 all show [ERROR] but the agent continued. The orchestration_policy.ts must define response validation gates: (1) check that tool result is not null/undefined, (2) check that result.success is boolean, (3) for edit tools, verify result.linesModified > 0 or result.error is set, (4) halt iteration if response is malformed.",
            "targetFile": "lib/agents/orchestration-policy.ts",
            "targetArea": "Validation rules and context gates",
            "suggestedChange": "Add validateToolResponse(toolName, result) function. For edit_lines and propose_code_edit: require result.success === true OR result.error is a non-empty string. If validation fails, return {valid: false, reason: 'Tool returned no result', shouldRetry: false}. Call this after every tool execution in coordinator before updating context."
          },
          {
            "priority": "high",
            "category": "prompt",
            "title": "Clarify file path handling and multi-file edit sequencing in PM prompt",
            "description": "The tool sequence shows calls 14-16 using filePath='product-form-dynamic.liquid' (missing 'snippets/' prefix), while earlier calls used 'snippets/product-form-dynamic.liquid'. This path inconsistency likely caused edit failures. The PM prompt must emphasize: (1) always use full relative paths (snippets/, assets/), (2) when editing multiple files in one pass, use separate edit_lines calls per file with clear reasoning, (3) validate file paths before proposing edits.",
            "targetFile": "lib/agents/prompts/v2-pm-prompt.ts",
            "targetArea": "Tool usage instructions for edit_lines and propose_code_edit",
            "suggestedChange": "Add explicit instruction: 'Always use full relative file paths (e.g., snippets/product-form-dynamic.liquid, not product-form-dynamic.liquid). For multi-file edits, call edit_lines once per file. Before calling edit_lines, verify the file path matches the file you read earlier.' Add example: 'read_lines(snippets/product-form-dynamic.liquid) -> ... -> edit_lines(snippets/product-form-dynamic.liquid, newContent=...)'."
          },
          {
            "priority": "high",
            "category": "context",
            "title": "Provide pre-parsed file structure and line ranges in context to avoid repeated reads",
            "description": "The agent called read_lines on the same 3 files 12 times (calls 1-11, 13). This suggests the agent was uncertain about file structure or line numbers for edits. The theme-map cache should provide: (1) a structural summary of each file (sections, key line numbers), (2) pre-identified insertion points for the three-layer implementation, (3) line ranges for swatch rendering, color assignment, and CSS selectors. This reduces uncertainty and prevents redundant reads.",
            "targetFile": "lib/agents/theme-map/cache.ts",
            "targetArea": "Cache structure and line range tracking for target files",
            "suggestedChange": "Extend cache to include {filePath, sections: [{name, startLine, endLine}], keyPatterns: [{pattern, line}]}. For product-form-dynamic.liquid, pre-identify: swatch rendering loop (line ~X), variant option handling (line ~Y), out-of-stock condition. For .css, identify swatch styles section. For .js, identify color/length data handling. Return this in context so agent knows exact edit locations without repeated reads."
          },
          {
            "priority": "high",
            "category": "strategy",
            "title": "Implement fallback strategy when GOD_MODE encounters repeated edit failures",
            "description": "The agent selected GOD_MODE strategy (all three files in one pass) but failed on edits. There is no fallback to HYBRID (one file at a time with review gates) or SIMPLE (read-only + propose). When edit_lines fails 3+ times, the strategy should downgrade to HYBRID mode, which would: (1) edit only Liquid first, (2) review with get_second_opinion, (3) proceed to CSS if successful, (4) finally edit JS.",
            "targetFile": "lib/agents/strategy.ts",
            "targetArea": "Strategy selection and fallback logic",
            "suggestedChange": "Add dynamic strategy downgrade. If edit_lines fails consecutively, emit event to coordinator: {type: 'strategy_downgrade', from: 'GOD_MODE', to: 'HYBRID', reason: 'Edit failures detected'}. Coordinator updates strategy mid-loop. HYBRID strategy calls edit_lines(liquid), then run_review, then edit_lines(css), then edit_lines(js) sequentially with validation gates between each."
          },
          {
            "priority": "medium",
            "category": "prompt",
            "title": "Add explicit three-layer sequencing and metafield filtering logic to PM prompt",
            "description": "The prompt requires: (1) Liquid markup with length list from variant option1 excluding custom_values metafield, (2) CSS with background-aware text contrast, (3) JS data handling. The PM prompt should provide: (1) pseudocode for filtering logic (how to exclude metafield values), (2) CSS contrast formula (luminance-based), (3) example of how to pass data from Liquid to JS via data attributes. This reduces ambiguity and improves first-pass correctness.",
            "targetFile": "lib/agents/prompts/v2-pm-prompt.ts",
            "targetArea": "Shopify knowledge section and implementation guidance",
            "suggestedChange": "Add section: 'For Shopify product variants with metafield filtering: (1) In Liquid, use {%- assign custom_vals = product.metafields.custom_values | split: ',' -%} to parse exclusion list. (2) Loop variant.option1 and filter: {%- unless custom_vals contains item -%}. (3) In CSS, use filter: brightness() or mix-blend-mode: screen to ensure text contrast over images. (4) Pass filtered data to JS via data-available-lengths=\\\"{{avail_lengths}}\\\".'"
          },
          {
            "priority": "medium",
            "category": "context",
            "title": "Scout should identify and pre-brief on metafield schema and variant structure",
            "description": "The agent did not query the product metafield schema or variant structure before attempting edits. The scout (structural-scout.ts) should identify: (1) where product.metafields.custom_values is defined or populated, (2) variant option1 field name and data type, (3) swatch rendering loop in Liquid, (4) existing color-to-length mappings in JS. This would have provided the agent with critical context to construct correct filters.",
            "targetFile": "lib/agents/scout/structural-scout.ts",
            "targetArea": "LLM brief generation for Shopify-specific patterns",
            "suggestedChange": "When scanning product-form-dynamic.liquid, add brief: 'Variant structure: option1 contains [length values]. Metafield custom_values is a comma-separated list of lengths to exclude. Swatch loop at line ~X renders color options. Need to add second line showing available lengths for out-of-stock colors.' Provide line references and data structure summary."
          },
          {
            "priority": "medium",
            "category": "tools",
            "title": "Add propose_code_edit validation to check Liquid syntax before committing",
            "description": "Calls 14-21 show multiple propose_code_edit attempts with syntax errors (missing 'assign' keyword, stray 'endfor'). The propose_code_edit tool should: (1) parse proposed Liquid/JS/CSS before returning, (2) run check_lint to validate syntax, (3) return {success: false, error: 'Syntax error: missing assign keyword', suggestion: 'Use {%- assign var = value -%}'} if invalid.",
            "targetFile": "lib/agents/tools/v2-tool-executor.ts",
            "targetArea": "propose_code_edit and edit_lines handlers",
            "suggestedChange": "Before executing edit_lines with newContent, call check_lint(filePath, newContent). If lint returns errors, return {success: false, error: 'Syntax validation failed', details: lintErrors}. In propose_code_edit, include syntax validation in reasoning output so agent can self-correct before calling edit_lines."
          },
          {
            "priority": "low",
            "category": "context",
            "title": "Cache and pre-load CSS contrast utility functions in style profile",
            "description": "The prompt requires 'text contrast is background-aware over swatch images'. The style profile (loaded at start) should include cached CSS patterns for: (1) text-shadow for contrast over images, (2) filter: brightness() or backdrop-filter, (3) mix-blend-mode options. This reduces guesswork and speeds up CSS generation.",
            "targetFile": "lib/agents/theme-map/lookup.ts",
            "targetArea": "Style profile and CSS pattern caching",
            "suggestedChange": "Add cssPatterns: {contrastOverImage: 'text-shadow: 0 0 2px rgba(0,0,0,0.8), 0 0 4px rgba(255,255,255,0.8)', filterBrightness: 'filter: brightness(1.1)', mixBlendMode: 'mix-blend-mode: screen'}. Return in context so PM prompt can reference these patterns when generating CSS."
          }
        ]
      }
    }
  ],
  "summary": {
    "passRate": "1/1 (100%)",
    "avgToolCalls": 21,
    "avgTimeSeconds": 250,
    "totalCostCents": 0,
    "failureReasons": []
  },
  "aggregateAnalysis": {
    "diagnosis": {
      "summary": "Agent performed extensive reconnaissance (11 read_lines calls) but failed to execute any edits. 8 propose_code_edit → edit_lines pairs all returned no results, causing complete task failure with 0 files modified.",
      "rootCause": "Tool executor failure in edit pipeline: propose_code_edit and edit_lines tools are returning null/undefined results instead of success/failure responses, breaking the feedback loop and preventing the agent from detecting edit failures or retrying.",
      "agentBehavior": "Agent correctly identified files to modify (product-form-dynamic.liquid, .css, .js) and attempted edits 4 times across 3 files, but received no feedback from tool executor. Without error signals, agent continued iterating through remaining edits but ultimately made no changes. No stagnation detection or edit validation gate caught the silent failures."
    },
    "recommendations": [
      {
        "priority": "critical",
        "category": "tools",
        "title": "Fix tool executor result handling for propose_code_edit and edit_lines",
        "description": "The v2-tool-executor.ts is not returning proper result objects for propose_code_edit and edit_lines operations. These tools are executing but returning undefined/null instead of {success: boolean, result: string, error?: string} structures. This breaks the coordinator's ability to validate edits and detect failures.",
        "targetFile": "lib/agents/tools/v2-tool-executor.ts",
        "targetArea": "propose_code_edit and edit_lines execution handlers",
        "suggestedChange": "Ensure all tool execution paths return structured results: (1) Wrap propose_code_edit response in {success: true, result: proposedCode} or {success: false, error: message}. (2) Wrap edit_lines response in {success: true, result: editSummary} with file/line counts. (3) Add try-catch around all edit operations with error propagation. (4) Log all tool results before returning to coordinator for observability."
      },
      {
        "priority": "critical",
        "category": "coordinator",
        "title": "Add edit validation gate and failure detection",
        "description": "Coordinator must detect when propose_code_edit or edit_lines return no result and either retry, escalate, or fail explicitly. Currently the agent silently continues despite edit failures, wasting iterations and guaranteeing task failure.",
        "targetFile": "lib/agents/coordinator-v2.ts",
        "targetArea": "observe() function and tool result validation",
        "suggestedChange": "After each tool execution: (1) Check if result is null/undefined and mark as validation failure. (2) For edit tools specifically, require {success: boolean} in response. (3) If edit fails 2+ times on same file, trigger escalation or switch to review strategy. (4) Add explicit logging: 'Tool [name] returned no result on iteration [N]' to catch silent failures."
      },
      {
        "priority": "high",
        "category": "validation",
        "title": "Implement edit operation pre-flight validation",
        "description": "Before executing edit_lines, validate that the target file exists, line ranges are valid, and content matches expected state. This prevents malformed edits from silently failing.",
        "targetFile": "lib/agents/orchestration-policy.ts",
        "targetArea": "validation gates for edit operations",
        "suggestedChange": "Add pre-edit validation: (1) Check file exists via theme map. (2) Verify line range [start, end] is within file bounds. (3) Read current content at target lines and compare against expected pattern. (4) If mismatch, return validation error with actual content to coordinator. (5) Block edit_lines if validation fails, force re-read of file first."
      },
      {
        "priority": "high",
        "category": "prompt",
        "title": "Add explicit edit confirmation and error recovery instructions",
        "description": "PM prompt should instruct the agent to explicitly verify each edit succeeded before proceeding, and to re-read files after edits to confirm changes. Currently agent has no recovery strategy when edits fail silently.",
        "targetFile": "lib/agents/prompts/v2-pm-prompt.ts",
        "targetArea": "Tool usage section, edit_lines instructions",
        "suggestedChange": "Add to edit_lines instructions: (1) 'After each edit_lines call, you MUST read the file again to verify the edit succeeded.' (2) 'If re-read shows the content was not changed, this is a critical error—immediately report it and stop.' (3) 'Do not proceed to next file until current file edits are confirmed via re-read.' (4) Add example: 'edit_lines → observe no result → read_lines to verify → if unchanged, escalate to review'."
      },
      {
        "priority": "high",
        "category": "context",
        "title": "Ensure scout/theme-map provides complete file structure upfront",
        "description": "Agent read 11 files but may not have had accurate line range metadata from theme map, causing edit_lines to target invalid ranges. Scout should provide exact line counts and key section markers for all 3 target files.",
        "targetFile": "lib/agents/scout/structural-scout.ts",
        "targetArea": "Brief generation for multi-file edits",
        "suggestedChange": "For multi-file scenarios, scout brief must include: (1) Exact line count for each target file. (2) Line numbers of key sections (e.g., 'product form starts at line 45, swatch section at line 120'). (3) Variant data structure location and metafield access pattern. (4) CSS class names used in markup for styling correlation. (5) JavaScript event hooks for behavior integration."
      },
      {
        "priority": "high",
        "category": "strategy",
        "title": "Upgrade to HYBRID or GOD_MODE for multi-file, multi-layer edits",
        "description": "This scenario requires coordinated edits across 3 files (Liquid, CSS, JS) with data dependencies. SIMPLE strategy with single PM may not have sufficient context switching. Current run used SIMPLE strategy which failed.",
        "targetFile": "lib/agents/strategy.ts",
        "targetArea": "Strategy selection logic for complexity detection",
        "suggestedChange": "Detect multi-layer scenarios: If task requires edits to 3+ files OR mentions 'all three layers' OR requires cross-file data flow, automatically select HYBRID or GOD_MODE. For this task: (1) Trigger HYBRID with specialist for each layer (liquid, css, js). (2) Require PM to validate specialist outputs before edit_lines. (3) Add orchestration check: no edit_lines until all specialists complete review."
      },
      {
        "priority": "medium",
        "category": "tools",
        "title": "Add propose_code_edit → edit_lines atomic transaction pattern",
        "description": "Current pattern is propose_code_edit followed by edit_lines, but they are separate tool calls. If edit_lines fails, proposed code is lost. Implement atomic pattern or explicit linking.",
        "targetFile": "lib/agents/tools/v2-tool-definitions.ts",
        "targetArea": "propose_code_edit and edit_lines tool definitions",
        "suggestedChange": "Add optional 'apply_immediately' flag to propose_code_edit: if true, returns both proposed code AND edit result in one call. For now, add to edit_lines definition: 'reference_proposal_id' field to link back to specific proposal. Coordinator must log proposal_id → edit_id mapping to trace failures."
      },
      {
        "priority": "medium",
        "category": "coordinator",
        "title": "Add iteration-level stagnation detection for edit failures",
        "description": "Agent made 4 edit attempts (8 tool calls) with 0 successes. Stagnation detector should catch 'repeating same action with no success' pattern and escalate after 2 consecutive failures on same file.",
        "targetFile": "lib/agents/coordinator-v2.ts",
        "targetArea": "Stagnation detection logic",
        "suggestedChange": "Track per-file edit attempts: (1) If edit_lines fails on file X, increment failure counter. (2) If 2+ consecutive failures on same file, mark file as 'edit_blocked'. (3) Trigger escalation: switch to review strategy or request human intervention. (4) Log: 'File [X] edit failed 2x, escalating to review specialist' to surface issue to user."
      },
      {
        "priority": "medium",
        "category": "context",
        "title": "Add variant/metafield data structure to context before edits",
        "description": "Agent needs to understand product variant structure and custom_values metafield format before implementing JS data handling. Current context may lack this domain knowledge.",
        "targetFile": "lib/agents/prompts/v2-pm-prompt.ts",
        "targetArea": "Shopify domain knowledge section",
        "suggestedChange": "Add section: 'Variant and Metafield Structures': (1) Example variant JSON with option1 (length) values. (2) Example custom_values metafield format and access pattern (e.g., product.metafields.custom.custom_values). (3) How to filter lengths: 'available_lengths = variant.option1 values where variant.available == true, minus lengths in custom_values list'. (4) JavaScript pattern for accessing this data from Liquid-passed JSON."
      },
      {
        "priority": "low",
        "category": "tools",
        "title": "Add post-edit verification tool",
        "description": "Create explicit verify_edit tool that reads file and compares against expected state, providing clear pass/fail signal.",
        "targetFile": "lib/agents/tools/v2-tool-definitions.ts",
        "targetArea": "New tool definition section",
        "suggestedChange": "Define verify_edit tool: (1) Input: file path, expected_content (string or regex). (2) Output: {verified: boolean, actual_content: string, matches: boolean, diff: string}. (3) Coordinator calls verify_edit after each edit_lines to confirm success. (4) If verification fails, agent immediately re-reads file and decides to retry or escalate."
      }
    ],
    "patterns": {
      "consistentFailureMode": "propose_code_edit and edit_lines tools return no results (null/undefined), blocking all edit operations. Agent detects no error and continues iterating, resulting in 0 file modifications despite 4 edit attempts across 3 files.",
      "intermittentIssues": [],
      "toolUsageAntiPatterns": [
        "propose_code_edit → edit_lines pairs (8 calls) all fail silently with no result; agent does not retry or escalate",
        "11 read_lines calls before any edit attempt; no reads after edits to verify success",
        "check_lint called once but not used to validate edit results",
        "No alternation between read and edit; all reads clustered at start, then all edits clustered mid-run"
      ],
      "contextGaps": [
        "Variant option1 structure and how to query available lengths not documented in context",
        "custom_values metafield format and access pattern not provided to agent",
        "Exact line numbers for product form, swatch section, and event hooks not in scout brief",
        "CSS class names used in Liquid markup not cross-referenced in CSS file context",
        "JavaScript event binding pattern for dynamic swatch behavior not explained"
      ]
    }
  }
}