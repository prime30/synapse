{
  "timestamp": "2026-02-27T07:46:06.796Z",
  "projectId": "838e7498-6dc5-4268-9fcd-e6f6148f65ad",
  "scenario": "restock-badge-lengths",
  "prompt": "On the product page template, update product-form-dynamic so out-of-stock color swatches with \"Awaiting Restock\" also show a second line listing available longer lengths for that color. Implement all three layers in one pass: (1) Liquid markup in snippets/product-form-dynamic.liquid, (2) styling in assets/product-form-dynamic.css, and (3) behavior/data handling in assets/product-form-dynamic.js. The length list must come from variant option1 availability and must exclude any lengths present in the product metafield list custom_values. Ensure text contrast is background-aware over swatch images.",
  "totalRuns": 1,
  "results": [
    {
      "run": 1,
      "passed": true,
      "reason": "Applied required files (3/3) in 16 tool calls",
      "metrics": {
        "totalToolCalls": 16,
        "editToolCalls": 6,
        "readToolCalls": 9,
        "searchToolCalls": 0,
        "elapsedMs": 158789,
        "costCents": 36,
        "inputTokens": 99599,
        "outputTokens": 3991
      },
      "tier": "COMPLEX",
      "strategy": "GOD_MODE",
      "changedFiles": [
        "snippets/product-form-dynamic.liquid",
        "assets/product-form-dynamic.css",
        "assets/product-form-dynamic.js",
        "product-form-dynamic.liquid"
      ],
      "transcript": {
        "runId": "run-1",
        "scenario": "restock-badge-lengths",
        "decisions": [
          {
            "phase": "analyzing",
            "label": "Loading context...",
            "timestamp": 0
          },
          {
            "phase": "analyzing",
            "label": "Context ready",
            "detail": "606 files, 5 prefs",
            "timestamp": 0
          },
          {
            "phase": "analyzing",
            "label": "Building context...",
            "timestamp": 0
          },
          {
            "phase": "analyzing",
            "label": "Classifying request...",
            "timestamp": 0
          },
          {
            "phase": "analyzing",
            "label": "Preparing file context...",
            "timestamp": 0
          },
          {
            "phase": "analyzing",
            "label": "Building structural brief...",
            "timestamp": 0
          },
          {
            "phase": "analyzing",
            "label": "Starting agent...",
            "timestamp": 0
          },
          {
            "phase": "strategy",
            "label": "Strategy: GOD_MODE",
            "detail": "strategy=GOD_MODE, tier=COMPLEX",
            "timestamp": 1
          },
          {
            "phase": "analyzing",
            "label": "COMPLEX tier — GOD_MODE strategy — claude-sonnet-4-6",
            "detail": "routingTier=COMPLEX, strategy=GOD_MODE",
            "timestamp": 1
          },
          {
            "phase": "analyzing",
            "label": "Style profile loaded",
            "detail": "styleProfileRules=8, designTokenCount=0, patternConflictResolutions=0, referenceSectionsLoaded=0, cssPreloaded=false, snippetConsumers=0",
            "timestamp": 1
          }
        ],
        "toolSequence": [
          {
            "name": "read_lines",
            "id": "toolu_01UtqLBs1TjDzPGCRnjBJKC7",
            "input": {
              "filePath": "snippets/product-form-dynamic.liquid",
              "ranges": [
                {
                  "startLine": 1,
                  "endLine": 60
                },
                {
                  "startLine": 112,
                  "endLine": 135
                },
                {
                  "startLine": 550,
                  "endLine": 680
                }
              ]
            },
            "result": "",
            "isError": false,
            "elapsedMs": 0
          },
          {
            "name": "read_lines",
            "id": "toolu_01LPL9PBzbXooGwcpfDC7PE3",
            "input": {
              "filePath": "assets/product-form-dynamic.css",
              "ranges": [
                {
                  "startLine": 606,
                  "endLine": 799
                }
              ]
            },
            "result": "",
            "isError": false,
            "elapsedMs": 0
          },
          {
            "name": "read_lines",
            "id": "toolu_01695wwqAimfdAGaqaend4BG",
            "input": {
              "filePath": "assets/product-form-dynamic.js",
              "ranges": [
                {
                  "startLine": 1,
                  "endLine": 50
                },
                {
                  "startLine": 395,
                  "endLine": 480
                },
                {
                  "startLine": 640,
                  "endLine": 840
                },
                {
                  "startLine": 828,
                  "endLine": 950
                }
              ]
            },
            "result": "",
            "isError": false,
            "elapsedMs": 0
          },
          {
            "name": "read_lines",
            "id": "toolu_01MmR1ScZ3qhUxMJayBh6TDA",
            "input": {
              "filePath": "snippets/product-form-dynamic.liquid",
              "ranges": [
                {
                  "startLine": 480,
                  "endLine": 550
                }
              ]
            },
            "result": "",
            "isError": false,
            "elapsedMs": 0
          },
          {
            "name": "read_lines",
            "id": "toolu_01CF1B1sVgoZPzCaceeW5WqU",
            "input": {
              "filePath": "assets/product-form-dynamic.js",
              "ranges": [
                {
                  "startLine": 950,
                  "endLine": 1100
                },
                {
                  "startLine": 1100,
                  "endLine": 1250
                }
              ]
            },
            "result": "",
            "isError": false,
            "elapsedMs": 0
          },
          {
            "name": "read_lines",
            "id": "toolu_01ToLyU1PyvtXv3QRS34wNPa",
            "input": {
              "filePath": "snippets/product-form-dynamic.liquid",
              "ranges": [
                {
                  "startLine": 119,
                  "endLine": 140
                },
                {
                  "startLine": 400,
                  "endLine": 480
                }
              ]
            },
            "result": "",
            "isError": false,
            "elapsedMs": 0
          },
          {
            "name": "read_lines",
            "id": "toolu_013A6dbB8GxWm6ERjDi36wwr",
            "input": {
              "filePath": "snippets/product-form-dynamic.liquid",
              "ranges": [
                {
                  "startLine": 300,
                  "endLine": 410
                }
              ]
            },
            "result": "",
            "isError": false,
            "elapsedMs": 0
          },
          {
            "name": "read_lines",
            "id": "toolu_01XUcrRQz4ZYqQMpmnFHnk3C",
            "input": {
              "filePath": "snippets/product-form-dynamic.liquid",
              "ranges": [
                {
                  "startLine": 1035,
                  "endLine": 1065
                }
              ]
            },
            "result": "",
            "isError": false,
            "elapsedMs": 0
          },
          {
            "name": "read_lines",
            "id": "toolu_014oWQfH5icFtrfw7AKzu18F",
            "input": {
              "filePath": "snippets/product-form-dynamic.liquid",
              "ranges": [
                {
                  "startLine": 1052,
                  "endLine": 1056
                }
              ]
            },
            "result": "",
            "isError": false,
            "elapsedMs": 0
          },
          {
            "name": "check_lint",
            "id": "toolu_01FBfG4ayYBJvg62RyNcLeZv",
            "input": {
              "fileName": "snippets/product-form-dynamic.liquid"
            },
            "result": "",
            "isError": false,
            "elapsedMs": 0
          },
          {
            "name": "propose_code_edit",
            "id": "pm-change-1772178219478",
            "input": {
              "filePath": "product-form-dynamic.liquid",
              "newContent": "{% comment %} Custom options configuration - options listed here will render as dropdowns {% endcomment %}\n{% assign custom_option_names = product.metafields.custom.custom_values.value %}\n\n{% comment %} Custom content configuration for specific options {% endcomment %}\n{% comment %} Format: option_name:option_value|<html content> - separated by semicolons for multiple {% endcomment %}\n\n{% assign option_content_config = 'texture:Straight|<div class=\"pfd-info-content\"><span class=\"pfd-info-icon\">i</span><span class=\"pfd-info-text\">Our straight texture has slight natural wave texture to it when washed and dried. It is not pin straight hair, nor is that desirable among most clientele.</span></div>;texture:Natural Wave|<div class=\"pfd-info-content\"><span class=\"pfd-info-icon\">i</span><span class=\"pfd-info-text\">Our natural wave texture features soft, beachy waves that blend seamlessly with most natural hair textures. Low maintenance and versatile for everyday styling.</span></div>;texture:Loose Curl|<div class=\"pfd-info-content\"><span class=\"pfd-info-icon\">i</span><span class=\"pfd-info-text\">Our loose curl texture offers bouncy, defined curls that hold their shape beautifully. Perfect for adding volume and movement with minimal styling required.</span></div>;texture:Tight Curl|<div class=\"pfd-info-content\"><span class=\"pfd-info-icon\">i</span><span class=\"pfd-info-text\">Our tight curl texture provides well-defined, springy curls with maximum volume. Ideal for protective styles and blending with naturally curly hair.</span></div>' %}\n\n{% assign option_content_pairs = option_content_config | split: ';' %}\n\n{% comment %} SellersDash collect child product details {% endcomment %}\n{% assign shsd_product_details = product.metafields.sellersdash.shsdproducts %}\n{% if shsd_product_details.product_type == 'shsd_parent' %}\n  {% assign shsd_product_handles = product.handle %}\n  {% assign shsd_product_handles = shsd_product_handles | concat: shsd_product_details.handles %}\n  {% for shsd_handle in shsd_product_handles %}\n    {% assign shsd_single_product = all_products[shsd_handle] %}\n    {% assign shsd_product_variants = shsd_product_variants | concat: shsd_single_product.variants %}\n    {% assign shsd_product_media = shsd_product_media | concat: shsd_single_product.media %}\n    {% assign shsd_product_images = shsd_product_images | concat: shsd_single_product.images %}\n  {% endfor %}\n  {% assign shsd_product_options_with_values = shsd_product_details.options_with_values %}\n{% else %}\n  {% assign shsd_product_options_with_values = product.options_with_values %}\n  {% assign shsd_product_variants = product.variants %}\n  {% assign shsd_product_media = product.media %}\n  {% assign shsd_product_images = product.images %}\n{% endif %}\n\n{% comment %} Reorder options: Length, Texture, Color, then remaining {% endcomment %}\n{% assign reordered_options = '' | split: '' %}\n{% assign remaining_options = '' | split: '' %}\n\n{% for option in shsd_product_options_with_values %}\n  {% assign opt_name_lower = option.name | downcase | strip %}\n  {% if opt_name_lower == 'length' %}\n    {% assign length_slice = shsd_product_options_with_values | slice: forloop.index0, 1 %}\n  {% elsif opt_name_lower == 'texture' %}\n    {% assign texture_slice = shsd_product_options_with_values | slice: forloop.index0, 1 %}\n  {% elsif opt_name_lower == 'color' or opt_name_lower == 'colour' or opt_name_lower == 'colors' %}\n    {% assign color_slice = shsd_product_options_with_values | slice: forloop.index0, 1 %}\n  {% else %}\n    {% assign other_slice = shsd_product_options_with_values | slice: forloop.index0, 1 %}\n    {% assign remaining_options = remaining_options | concat: other_slice %}\n  {% endif %}\n{% endfor %}\n\n{% if length_slice %}\n  {% assign reordered_options = reordered_options | concat: length_slice %}\n{% endif %}\n{% if texture_slice %}\n  {% assign reordered_options = reordered_options | concat: texture_slice %}\n{% endif %}\n{% if color_slice %}\n  {% assign reordered_options = reordered_options | concat: color_slice %}\n{% endif %}\n{% assign shsd_product_options_with_values = reordered_options | concat: remaining_options %}\n\n{%- assign product_form_id = 'product-form-' | append: pr_sid -%}\n{%- liquid\n  assign pr_variants = shsd_product_variants\n  assign PR_buy_pr = false\n  if bk_stts.show_dynamic_checkout and isExternal == false and isProductAvailable\n    assign PR_buy_pr = true\n  endif\n  assign choose_an_option = 'products.product.choose_an_option' | t\n  assign date_in = settings.date_in\n  assign class_frm = 't4s-form__product has--form__swatch'\n  if isProductDefault\n    assign class_frm = 't4s-form__product'\n  endif\n  if arr_properties.size > 0 and isProductAvailable\n    assign class_frm = class_frm | append: ' has--properties'\n  endif\n  if settings.sticky_atc and type == 'main'\n    assign class_frm = class_frm | append: ' is--main-sticky'\n  else\n    assign class_frm = class_frm | append: ' is--atc-sticky'\n  endif\n\n  assign color_swatch = 'disabled-'\n  assign color_mode = bk_stts.color_mode\n  assign selector_mode = bk_stts.selector_mode\n  assign stt_color_ck = settings.color_ck | default: ';'\n  assign color_ck = stt_color_ck | append: ',color,colors,couleur,colour' | remove: ';,'\n  assign get_color = color_ck | downcase | replace: ' ,', ',' | replace: ', ', ',' | split: ',' | uniq\n  assign color_mode_list = 'color, color is-sw-cl__round, color is-sw-cl__round is-sw-cl__label, variant_image, variant_image is-sw-cl__round, variant_image is-sw-cl__round is-sw-cl__label' | split: ', '\n  if color_mode_list contains color_mode\n    assign color_swatch = 'is-sw__color '\n  endif\n  assign current_variant_available = current_variant.available\n  assign use_incoming_mess = settings.use_incoming_mess\n  assign current_variant_incoming = false\n  assign current_inventory_quantity = current_variant.inventory_quantity\n  if current_inventory_quantity <= 0 and current_variant.inventory_management == 'shopify' and current_variant.incoming\n    assign current_variant_incoming = true\n  endif\n  if pos_sizeg == '1'\n    assign html_sizeg = ''\n  endif\n  if current_variant.inventory_management != null and current_inventory_quantity > 0 and current_variant.inventory_policy != 'continue'\n    assign max_qty = current_inventory_quantity\n  else\n    assign max_qty = 9999\n  endif\n  if color_mode contains 'color' or color_mode contains 'variant'\n    assign show_tooltip = ''\n  else\n    assign show_tooltip = '-off'\n  endif\n-%}\n\n{%- if product.metafields.custom.default_variant.value -%}\n  <script>\n    window.__HAS_SELECTED__ = {{ product.selected_variant | json }};\n    window.__DEFAULT_VARIANT__ = {{ product.metafields.custom.default_variant.value | json }};\n  </script>\n{%- endif -%}\n\n{%- assign length_option_position = -1 -%}\n{%- assign color_option_position = -1 -%}\n{%- for opt_name in product.options -%}\n  {%- assign opt_name_down = opt_name | downcase -%}\n  {%- if opt_name_down == 'length' -%}\n    {%- assign length_option_position = forloop.index -%}\n  {%- endif -%}\n  {%- if get_color contains opt_name_down -%}\n    {%- assign color_option_position = forloop.index -%}\n  {%- endif -%}\n{%- endfor -%}\n\n<script>\n  window.__CUSTOM_OPTION_NAMES__ = {{ custom_option_names | json }};\n  window.__LENGTH_OPTION_INDEX__ = {{ length_option_position | minus: 1 }};\n</script>\n\n{%- comment -%} Load dropdown CSS if either color mode or selector mode is dropdown {%- endcomment -%}\n\n{%- if color_mode == 'dropdown' or selector_mode == 'dropdown' -%}\n  <link\n    rel=\"stylesheet\"\n    href=\"{{ 'base_drop.min.css' | asset_url }}\"\n    media=\"all\"\n  >\n{%- endif -%}\n\n{%- comment -%} Custom CSS for product form dynamic {%- endcomment -%}\n{{ 'product-form-dynamic.css' | asset_url | stylesheet_tag }}\n\n<div class=\"pfd-override-wrapper\">\n  <div class=\"pfd-custom-wrapper\">\n    <div\n      class=\"t4s-product-form__variants is-no-pick__{{ PR_no_pick }}{% if PR_buy_pr %} is-payment-btn-true t4s-payment-button t4s-btn-color-{{ bk_stts.button_color_payment }}{% endif %} is-remove-soldout-{{ remove_soldout }} is-btn-full-width__{{ bk_stts.btn_atc_full }} is-btn-atc-txt-{{ bk_stts.btn_txt }} is-btn-ck-txt-{{ bk_stts.btn_txt2 }} is--fist-ratio-{{ is_fit_ratio_img }}\"\n      style=\"{% if is_fit_ratio_img %} --fit-ratio-img: {{ first_ratio_img }}; {% endif %} --wishlist-color: {{bk_stts.wishlist_color}};--wishlist-hover-color: {{bk_stts.wishlist_color_hover}};--wishlist-active-color: {{bk_stts.wishlist_color_active}};--compare-color: {{bk_stts.compare_color}};--compare-hover-color: {{bk_stts.compare_color_hover}};--compare-active-color: {{bk_stts.compare_color_active}};\"\n      {{ shopify_attributes }}\n    >\n      <div data-callBackVariant id=\"t4s-callBackVariant{{ product_form_id }}\">\n        {%- form 'product',\n          product,\n          id: product_form_id,\n          data-productid: product.id,\n          class: class_frm,\n          novalidate: 'novalidate',\n          data-type: 'add-to-cart-form',\n          data-disable-swatch: isProductDefault\n        -%}\n          {% comment %}{{- form | payment_terms -}}{% endcomment %}\n          {%- if isProductDefault -%}\n            <input\n              name=\"id\"\n              value=\"{{ pr_variants.first.id }}\"\n              type=\"hidden\"\n            >\n            {%- if advance_pr_type != blank -%}\n              {%- render 'choose_style', advance_pr_type: advance_pr_type, title: advance_label, pid: product.id -%}\n            {%- endif -%}\n          {%- else -%}\n            {{ 'swatch.css' | asset_url | stylesheet_tag }}\n            <select\n              name=\"id\"\n              id=\"product-select-{{ pr_sid }}\"\n              class=\"t4s-product__select t4s-d-none\"\n            >\n              {%- for variant in pr_variants -%}\n                {%- if variant.available -%}\n                  <option\n                    data-option1=\"{{ variant.option1 }}\"\n                    data-option2=\"{{ variant.option2 }}\"\n                    value=\"{{ variant.id }}\"\n                    data-mdid=\"{{ variant.featured_media.id | json }}\"\n                    data-incoming=\"{{ variant.incoming }}\"\n                    data-inventoryQuantity=\"{{ variant.inventory_quantity | json }}\"\n                    data-inventoryPolicy=\"{{ variant.inventory_policy | json }}\"\n                    data-nextIncomingDate=\"{{ variant.next_incoming_date | date: date_in }}\"\n                    {% if variant.id == current_variant.id %}\n                      selected=\"selected\"\n                    {% endif %}\n                  >\n                    {{ variant.title | escape }}\n                  </option>\n                {%- else -%}\n                  <option\n                    data-option1=\"{{ variant.option1 }}\"\n                    data-option2=\"{{ variant.option2 }}\"\n                    value=\"{{ variant.id }}\"\n                    data-mdid=\"{{ variant.featured_media.id | json }}\"\n                    data-incoming=\"{{ variant.incoming }}\"\n                    data-inventoryQuantity=\"{{ variant.inventory_quantity | json }}\"\n                    data-inventoryPolicy=\"{{ variant.inventory_policy | json }}\"\n                    data-nextIncomingDate=\"{{ variant.next_incoming_date | date: date_in }}\"\n                  >\n                    {{ variant.title | escape }}\n                  </option>\n                {%- endif -%}\n              {%- endfor -%}\n            </select>\n\n            <div class=\"pfd-variant-images\" style=\"display:none !important;\">\n              <div class=\"pfd-main-imgs\">\n                {%- for variant in pr_variants -%}\n                  {% assign var_imgs = variant.metafields.custom.variant_image.value %}\n                  <div\n                    class=\"pfd-img-listing\"\n                    data-var-img=\"{{ variant.image.src | img_url: 'master' }}\"\n                    data-pfd-variant-id=\"{{ variant.id }}\"\n                  >\n                    {% for value in var_imgs %}\n                      <div class=\"pfd-media-item\">\n                        <img src=\"{{value | img_url: 'master'}}\">\n                      </div>\n                    {% endfor %}\n                  </div>\n                {%- endfor -%}\n              </div>\n              <div class=\"pfd-thumb-imgs\">\n                {%- for variant in pr_variants -%}\n                  {% assign var_imgs = variant.metafields.custom.variant_image.value %}\n                  <div class=\"pfd-img-listing\" data-pfd-variant-id=\"{{ variant.id }}\">\n                    {% for value in var_imgs %}\n                      <div class=\"pfd-media-thumb\">\n                        <div\n                          class=\"pfd-img\"\n                          style=\"background-image:url('{{value | img_url: \"master\"}}');\"\n                        ></div>\n                      </div>\n                    {% endfor %}\n                  </div>\n                {%- endfor -%}\n              </div>\n            </div>\n\n            <div class=\"t4s-swatch t4s-color-mode__{{ color_mode }} t4s-color-size__{{ bk_stts.color_size }} t4s-selector-mode__{{ selector_mode }}\">\n              {%- if advance_pr_type != blank -%}\n                {%- render 'choose_style', advance_pr_type: advance_pr_type, title: advance_label, pid: product.id -%}\n              {%- endif -%}\n\n              {%- for option in shsd_product_options_with_values -%}\n                {%- liquid\n                  assign option_index = 'option' | append: forloop.index\n                  assign selected_value = product.selected_or_first_available_variant[option_index]\n                  assign option_name = option.name\n                  assign name_downcase = option_name | downcase\n                -%}\n\n                {%- if get_color contains name_downcase -%}\n                  {% comment %}--MARK: Color Option{% endcomment %}\n\n                  {% comment %} Build color nickname map from variant metafields {% endcomment %}\n                  {%- capture color_nicknames_map -%}\n                    {%- for variant in shsd_product_variants -%}\n                      {%- if variant.metafields.custom.variant_color != blank -%}\n                        {%- for opt_index in (1..3) -%}\n                          {%- assign opt_key = 'option' | append: opt_index -%}\n                          {%- assign opt_val = variant[opt_key] -%}\n                          {%- if opt_val != blank -%}\n                            {%- assign opt_index_adjusted = opt_index | minus: 1 -%}\n                            {%- assign opt_name_check = product.options[opt_index_adjusted] | downcase -%}\n                            {%- if get_color contains opt_name_check -%}\n                              {{ opt_val | handle }}:{{ variant.metafields.custom.variant_color }};\n                            {%- endif -%}\n                          {%- endif -%}\n                        {%- endfor -%}\n                      {%- endif -%}\n                    {%- endfor -%}\n                  {%- endcapture -%}\n                  {%- assign color_nicknames_map = color_nicknames_map | strip -%}\n\n                  <div\n                    data-swatch-option\n                    data-option-name=\"{{ option_name | escape }}\"\n                    data-id=\"{{ forloop.index0 }}\"\n                    data-option-unit=\"\n                      {%- liquid\n                        assign option_unit = ''\n                        if se_stts and se_stts.option_units and se_stts.option_units != blank\n                          assign option_units_raw = se_stts.option_units | strip | newline_to_br | split: '<br />'\n                          for pair in option_units_raw\n                            assign pair_cleaned = pair | strip\n                            if pair_cleaned contains ':'\n                              assign key_value = pair_cleaned | split: ':'\n                              assign key = key_value[0] | strip\n                              assign value = key_value[1] | strip\n                              if key == option_name and value != blank\n                                assign option_unit = value\n                                break\n                              endif\n                            endif\n                          endfor\n                        endif\n                      -%}{{ option_unit | escape }}\n                    \"\n                    class=\"t4s-swatch__option is-t4s-style__color is-t4s-name__{{ option_name | handle }} {% cycle 'is--first-color', '', '' %}\"\n                  >\n                    <h4 class=\"t4s-swatch__title t4s-swatch__title--color\">\n                      <span class=\"t4s-swatch__title--left\">\n                        <span class=\"bold\">\n                          {{- option_name | upcase -}}\n                          {%- liquid\n                            assign option_unit = ''\n                            if se_stts and se_stts.option_units and se_stts.option_units != blank\n                              assign option_units_raw = se_stts.option_units | strip | newline_to_br | split: '<br />'\n                              for pair in option_units_raw\n                                assign pair_cleaned = pair | strip\n                                if pair_cleaned contains ':'\n                                  assign key_value = pair_cleaned | split: ':'\n                                  assign key = key_value[0] | strip\n                                  assign value = key_value[1] | strip\n                                  if key == option_name and value != blank\n                                    assign option_unit = value\n                                    break\n                                  endif\n                                endif\n                              endfor\n                            endif\n                          -%}\n                          {%- if option_unit != blank %} ({{ option_unit }}){%- endif -%}\n                          :\n                        </span>\n                        <span class=\"t4s-selected-value\">\n                          {%- assign display_value = selected_value | default: choose_an_option | replace: '\"', '' -%}\n                          {{- display_value -}}\n                          {%- if option_unit != blank %} {{ option_unit }}{%- endif -%}\n                        </span>\n                      </span>\n                      {%- if name_sizeg == name_downcase -%}\n                        {{- html_sizeg -}}\n                      {%- endif %}\n                    </h4>\n\n                    <div data-swatch-list class=\"t4s-swatch__list\">\n                      {%- if color_mode != 'dropdown' -%}\n                        {%- if color_mode contains 'is-sw-cl__label' -%}\n                          {%- for value in option.values -%}\n                            {%- assign color_handle = value | handle -%}\n\n                            {%- comment %} Look up color nickname from map {%- endcomment -%}\n                            {%- assign color_nickname = '' -%}\n                            {%- assign nickname_pairs = color_nicknames_map | split: ';' -%}\n                            {%- for pair in nickname_pairs -%}\n                              {%- assign pair_clean = pair | strip -%}\n                              {%- if pair_clean != blank -%}\n                                {%- assign pair_parts = pair_clean | split: ':' -%}\n                                {%- if pair_parts[0] == color_handle -%}\n                                  {%- assign color_nickname = pair_parts[1] -%}\n                                  {%- break -%}\n                                {%- endif -%}\n                              {%- endif -%}\n                            {%- endfor -%}\n\n                            {%- comment %} Context-aware availability check: color + current other selections {%- endcomment -%}\n                            {%- assign color_is_available = false -%}\n                            {%- for variant in shsd_product_variants -%}\n                              {%- assign matches_color = false -%}\n                              {%- assign matches_other_options = true -%}\n\n                              {%- for opt_idx in (1..3) -%}\n                                {%- assign opt_key = 'option' | append: opt_idx -%}\n                                {%- assign variant_opt_val = variant[opt_key] -%}\n                                {%- if variant_opt_val != blank -%}\n                                  {%- assign variant_opt_handle = variant_opt_val | handle -%}\n\n                                  {%- comment %} Determine if this option index is the color option {%- endcomment -%}\n                                  {%- assign opt_idx_adjusted = opt_idx | minus: 1 -%}\n                                  {%- assign this_opt_name = product.options[opt_idx_adjusted] | downcase -%}\n\n                                  {%- if get_color contains this_opt_name -%}\n                                    {%- comment %} This is the color option - check if it matches our target color {%- endcomment -%}\n                                    {%- if variant_opt_handle == color_handle -%}\n                                      {%- assign matches_color = true -%}\n                                    {%- endif -%}\n                                  {%- else -%}\n                                    {%- comment %} This is a non-color option - check if variant matches current selection {%- endcomment -%}\n                                    {%- assign current_selected_val = product.selected_or_first_available_variant[opt_key] -%}\n                                    {%- if current_selected_val != blank -%}\n                                      {%- assign current_selected_handle = current_selected_val | handle -%}\n                                      {%- unless variant_opt_handle == current_selected_handle -%}\n                                        {%- assign matches_other_options = false -%}\n                                      {%- endunless -%}\n                                    {%- endif -%}\n                                  {%- endif -%}\n                                {%- endif -%}\n                              {%- endfor -%}\n\n                              {%- if matches_color and matches_other_options and variant.available -%}\n                                {%- assign color_is_available = true -%}\n                                {%- break -%}\n                              {%- endif -%}\n                            {%- endfor -%}\n\n                            {%- comment %} Compute available standard lengths for this color (used for both classes and content) {%- endcomment -%}\n                            {%- assign avail_lengths = '' -%}\n                            {%- assign avail_lengths_seen = '' -%}\n                            {%- assign length_opt_key = 'option' | append: length_option_position -%}\n                            {%- if length_option_position > 0 and color_option_position > 0 -%}\n                              {%- for lv in shsd_product_variants -%}\n                                {%- assign v_color_key = 'option' | append: color_option_position -%}\n                                {%- assign v_color_val = lv[v_color_key] | handle -%}\n                                {%- if v_color_val == color_handle and lv.available -%}\n                                  {%- assign v_length_val = lv[length_opt_key] -%}\n                                  {%- if v_length_val != blank -%}\n                                    {%- assign is_custom_length = false -%}\n                                    {%- if custom_option_names -%}\n                                      {%- for custom_name in custom_option_names -%}\n                                        {%- assign custom_name_stripped = custom_name | strip -%}\n                                        {%- if v_length_val == custom_name_stripped -%}\n                                          {%- assign is_custom_length = true -%}\n                                          {%- break -%}\n                                        {%- endif -%}\n                                      {%- endfor -%}\n                                    {%- endif -%}\n                                    {%- unless is_custom_length -%}\n                                      {%- assign v_length_clean = v_length_val | replace: '\"', '' | strip -%}\n                                      {%- assign sentinel = '@@' | append: v_length_clean | append: '@@' -%}\n                                      {%- unless avail_lengths_seen contains sentinel -%}\n                                        {%- assign avail_lengths_seen = avail_lengths_seen | append: sentinel -%}\n                                        {%- if avail_lengths == '' -%}\n                                          {%- assign avail_lengths = v_length_clean -%}\n                                        {%- else -%}\n                                          {%- assign avail_lengths = avail_lengths | append: ', ' | append: v_length_clean -%}\n\n                                        {%- endif -%}\n                                      {%- endunless -%}\n                                    {%- endunless -%}\n                                  {%- endif -%}\n                                {%- endif -%}\n                              {%- endfor -%}\n                            {%- endif -%}\n\n                            <div\n                              data-swatch-item\n                              class=\"t4s-swatch__btn-wrap{% if selected_value == value %} is--selected{% endif %}{% unless color_is_available %} is--soldout is--out-of-stock{% if avail_lengths != '' %} pfd-has-lengths{% endif %}{% endunless %}\"\n                              data-value=\"{{ value | escape }}\"\n                              data-available=\"{{ color_is_available }}\"\n                            >\n                              <!-- DEBUG: color={{ color_handle }} | available={{ color_is_available }} | selected_opt1={{ product.selected_or_first_available_variant.option1 | handle }} | selected_opt2={{ product.selected_or_first_available_variant.option2 | handle }} -->\n                              <div\n                                data-img-el\n                                class=\"t4s-swatch__item {{ color_swatch }}bg_color_{{ value | handle }} lazyloadt4s\">\n                                <img crossorigin=\"anonymous\">\n                                {%- unless color_is_available -%}\n                                  <span class=\"t4s-swatch__restock-badge\">Awaiting Restock</span>\n                                {%- endunless -%}\n                              </div>\n                              {%- unless color_is_available -%}\n                                {%- if avail_lengths != '' -%}\n                                  <span class=\"t4s-swatch__available-lengths is-visible\">Available in {{ avail_lengths }}</span>\n                                {%- endif -%}\n                              {%- endunless -%}\n                              <span class=\"t4s-swatch__label\">\n                                {{- value | replace: '\"', '' -}}\n                              </span>\n                              {%- if color_nickname != blank -%}\n                                <span class=\"t4s-swatch__nickname\">{{ color_nickname }}</span>\n                              {%- endif -%}\n                            </div>\n\n                          {%- endfor -%}\n\n                        {%- else -%}\n                          {%- for value in option.values -%}\n                            {%- assign color_handle = value | handle -%}\n\n                            {%- comment %} Look up color nickname {%- endcomment -%}\n                            {%- assign color_nickname = '' -%}\n                            {%- assign nickname_pairs = color_nicknames_map | split: ';' -%}\n                            {%- for pair in nickname_pairs -%}\n                              {%- assign pair_clean = pair | strip -%}\n                              {%- if pair_clean != blank -%}\n                                {%- assign pair_parts = pair_clean | split: ':' -%}\n                                {%- if pair_parts[0] == color_handle -%}\n                                  {%- assign color_nickname = pair_parts[1] -%}\n                                  {%- break -%}\n                                {%- endif -%}\n                              {%- endif -%}\n                            {%- endfor -%}\n\n                            {%- comment %} Context-aware availability check: color + current other selections {%- endcomment -%}\n                            {%- assign color_is_available = false -%}\n                            {%- for variant in shsd_product_variants -%}\n                              {%- assign matches_color = false -%}\n                              {%- assign matches_other_options = true -%}\n\n                              {%- for opt_idx in (1..3) -%}\n                                {%- assign opt_key = 'option' | append: opt_idx -%}\n                                {%- assign variant_opt_val = variant[opt_key] -%}\n                                {%- if variant_opt_val != blank -%}\n                                  {%- assign variant_opt_handle = variant_opt_val | handle -%}\n\n                                  {%- comment %} Determine if this option index is the color option {%- endcomment -%}\n                                  {%- assign opt_idx_adjusted = opt_idx | minus: 1 -%}\n                                  {%- assign this_opt_name = product.options[opt_idx_adjusted] | downcase -%}\n\n                                  {%- if get_color contains this_opt_name -%}\n                                    {%- comment %} This is the color option - check if it matches our target color {%- endcomment -%}\n                                    {%- if variant_opt_handle == color_handle -%}\n                                      {%- assign matches_color = true -%}\n                                    {%- endif -%}\n                                  {%- else -%}\n                                    {%- comment %} This is a non-color option - check if variant matches current selection {%- endcomment -%}\n                                    {%- assign current_selected_val = product.selected_or_first_available_variant[opt_key] -%}\n                                    {%- if current_selected_val != blank -%}\n                                      {%- assign current_selected_handle = current_selected_val | handle -%}\n                                      {%- unless variant_opt_handle == current_selected_handle -%}\n                                        {%- assign matches_other_options = false -%}\n                                      {%- endunless -%}\n                                    {%- endif -%}\n                                  {%- endif -%}\n                                {%- endif -%}\n                              {%- endfor -%}\n\n                              {%- if matches_color and matches_other_options and variant.available -%}\n                                {%- assign color_is_available = true -%}\n                                {%- break -%}\n                              {%- endif -%}\n                            {%- endfor -%}\n\n                            {%- comment %} Compute available standard lengths for this color {%- endcomment -%}\n                            {%- assign avail_lengths = '' -%}\n                            {%- assign avail_lengths_seen = '' -%}\n                            {%- assign length_opt_key = 'option' | append: length_option_position -%}\n                            {%- if length_option_position > 0 and color_option_position > 0 -%}\n                              {%- for lv in shsd_product_variants -%}\n                                {%- assign v_color_key = 'option' | append: color_option_position -%}\n                                {%- assign v_color_val = lv[v_color_key] | handle -%}\n                                {%- if v_color_val == color_handle and lv.available -%}\n                                  {%- assign v_length_val = lv[length_opt_key] -%}\n                                  {%- if v_length_val != blank -%}\n                                    {%- assign is_custom_length = false -%}\n                                    {%- if custom_option_names -%}\n                                      {%- for custom_name in custom_option_names -%}\n                                        {%- assign custom_name_stripped = custom_name | strip -%}\n                                        {%- if v_length_val == custom_name_stripped -%}\n                                          {%- assign is_custom_length = true -%}\n                                          {%- break -%}\n                                        {%- endif -%}\n                                      {%- endfor -%}\n                                    {%- endif -%}\n                                    {%- unless is_custom_length -%}\n                                      {%- assign v_length_clean = v_length_val | replace: '\"', '' | strip -%}\n                                      {%- assign sentinel = '@@' | append: v_length_clean | append: '@@' -%}\n                                      {%- unless avail_lengths_seen contains sentinel -%}\n                                        {%- assign avail_lengths_seen = avail_lengths_seen | append: sentinel -%}\n                                        {%- if avail_lengths == '' -%}\n                                          {%- assign avail_lengths = v_length_clean -%}\n                                        {%- else -%}\n                                          {%- assign avail_lengths = avail_lengths | append: ', ' | append: v_length_clean -%}\n                                        {%- endif -%}\n                                      {%- endunless -%}\n                                    {%- endunless -%}\n                                  {%- endif -%}\n                                {%- endif -%}\n                              {%- endfor -%}\n                            {%- endif -%}\n\n                            <div\n                              data-swatch-item\n                class=\"t4s-swatch__btn-wrap{% if selected_value == value %} is--selected{% endif %}{% unless color_is_available %} is--soldout is--out-of-stock{% if avail_lengths != '' %} pfd-has-lengths{% endif %}{% endunless %}\"\n                              data-value=\"{{ value | escape }}\"\n                              data-available=\"{{ color_is_available }}\"\n                            >\n                              <div\n                                data-img-el\n                                class=\"t4s-swatch__item {{ color_swatch }}bg_color_{{ value | handle }} lazyloadt4s\"\n                              >\n                                <img crossorigin=\"anonymous\">\n                                {%- unless color_is_available -%}\n                                  <span class=\"t4s-swatch__restock-badge\">Awaiting Restock</span>\n                                {%- endunless -%}\n                              </div>\n                              {%- unless color_is_available -%}\n                                {%- if avail_lengths != '' -%}\n                                  <span class=\"t4s-swatch__available-lengths is-visible\">Available in {{ avail_lengths }}</span>\n                                {%- endif -%}\n                              {%- endunless -%}\n                              {%- if color_nickname != blank -%}\n                                <span class=\"t4s-swatch__nickname\">{{ color_nickname }}</span>\n                              {%- endif -%}\n                            </div>\n\n                          {%- endfor -%}\n\n                        {%- endif -%}\n                      {%- else -%}\n                        <button\n                          type=\"button\"\n                          data-dropdown-open\n                          data-position=\"bottom-end\"\n                          data-id=\"t4s_nt_{{ pr_sid }}{{ forloop.index }}\"\n                        >\n                          <span data-current-value>\n                            {{- selected_value | default: choose_an_option -}}\n                          </span>\n                          <svg\n                            class=\"t4s-icon-select-arrow\"\n                            role=\"presentation\"\n                            viewBox=\"0 0 19 12\"\n                          >\n                            <use xlink:href=\"#t4s-select-arrow\"></use>\n                          </svg>\n                        </button>\n                        <div\n                          data-dropdown-wrapper\n                          class=\"t4s-dropdown__wrapper t4s-current-scrollbar\"\n                          id=\"t4s_nt_{{ pr_sid }}{{ forloop.index }}\"\n                        >\n                          <div class=\"t4s-drop-arrow\"></div>\n                          <div class=\"t4s-dropdown__header\">\n                            <span\n                              data-current-value\n                              class=\"t4s-dropdown__title\"\n                            >\n                              {{- selected_value | default: choose_an_option -}}\n                            </span>\n                            <button\n                              data-dropdown-close\n                              aria-label=\"{{ 'general.aria.close' | t }}\"\n                            >\n                              <svg\n                                role=\"presentation\"\n                                class=\"t4s-iconsvg-close\"\n                                viewBox=\"0 0 16 14\"\n                              >\n                                <path d=\"M15 0L1 14m14 0L1 0\" stroke=\"currentColor\" fill=\"none\" fill-rule=\"evenodd\"></path>\n                              </svg>\n                            </button>\n                          </div>\n                          <div class=\"t4s-dropdown__content\">\n                            {%- for value in option.values -%}\n                              <div\n                                data-swatch-item\n                                data-dropdown-off\n                                class=\"t4s-swatch__item t4s-truncate {{ color_swatch }}bg_color_{{ value | handle }} lazyloadt4s{% if selected_value == value %} is--selected{% endif %}\"\n                                data-value=\"{{ value | escape }}\"\n                              >\n                                {{ value | replace: '\"', '' }}\n                              </div>\n                            {%- endfor -%}\n                          </div>\n                        </div>\n                      {%- endif -%}\n                    </div>\n                    {%- render 'color-info-accordion' -%}\n                  </div>\n                {%- else -%}\n                  {% comment %}--MARK: Non-Color{% endcomment %}\n                  {%- liquid\n                    assign standard_values = ''\n                    assign custom_values = ''\n                    assign has_standard = false\n                    assign has_custom = false\n\n                    for value in option.values\n                      assign is_custom = false\n                      for custom_name in custom_option_names\n                        assign custom_name_clean = custom_name | strip\n                        if value contains custom_name_clean\n                          assign is_custom = true\n                          break\n                        endif\n                      endfor\n\n                      if is_custom\n                        if custom_values == ''\n                          assign custom_values = value\n                        else\n                          assign custom_values = custom_values | append: ',' | append: value\n                        endif\n                        assign has_custom = true\n                      else\n                        if standard_values == ''\n                          assign standard_values = value\n                        else\n                          assign standard_values = standard_values | append: ',' | append: value\n                        endif\n                        assign has_standard = true\n                      endif\n                    endfor\n\n                    assign standard_values_array = standard_values | split: ','\n                    assign custom_values_array = custom_values | split: ','\n                  -%}\n\n                  <div\n                    data-swatch-option\n                    data-option-name=\"{{ option_name | escape }}\"\n                    data-id=\"{{ forloop.index0 }}\"\n                    data-option-unit=\"\n                      {%- liquid\n                        assign option_unit = ''\n                        if se_stts and se_stts.option_units and se_stts.option_units != blank\n                          assign option_units_raw = se_stts.option_units | strip | newline_to_br | split: '<br />'\n                          for pair in option_units_raw\n                            assign pair_cleaned = pair | strip\n                            if pair_cleaned contains ':'\n                              assign key_value = pair_cleaned | split: ':'\n                              assign key = key_value[0] | strip\n                              assign value = key_value[1] | strip\n                              if key == option_name and value != blank\n                                assign option_unit = value\n                                break\n                              endif\n                            endif\n                          endfor\n                        endif\n                      -%}{{ option_unit | escape }}\n                    \"\n                    class=\"t4s-swatch__option is-t4s-name__{{ option_name | handle }} pfd-split-option\"\n                  >\n                    <h4 class=\"t4s-swatch__title\">\n                      <span class=\"t4s-swatch__title--left\"\n                        >Select a\n                        <span class=\"bold\">\n                          {{- option_name -}}\n                        </span>\n                        {%- liquid\n                          assign option_unit = ''\n                          if se_stts and se_stts.option_units and se_stts.option_units != blank\n                            assign option_units_raw = se_stts.option_units | strip | newline_to_br | split: '<br />'\n                            for pair in option_units_raw\n                              assign pair_cleaned = pair | strip\n                              if pair_cleaned contains ':'\n                                assign key_value = pair_cleaned | split: ':'\n                                assign key = key_value[0] | strip\n                                assign value = key_value[1] | strip\n                                if key == option_name and value != blank\n                                  assign option_unit = value\n                                  break\n                                endif\n                              endif\n                            endfor\n                          endif\n                        -%}\n                        {%- if option_unit != blank %} ({{ option_unit }}){%- endif -%}\n                      </span>\n                      <span class=\"t4s-swatch__title--right\"\n                        >Selected:\n                        <span class=\"bold\">\n                          {%- assign display_value = selected_value | default: choose_an_option | replace: '\"', '' -%}\n                          {{- display_value -}}\n                          {%- if option_unit != blank %} {{ option_unit }}{%- endif -%}\n                        </span></span\n                      >\n                      {%- if name_sizeg == name_downcase -%}\n                        {{- html_sizeg -}}\n                      {%- endif %}\n                    </h4>\n\n                    <div class=\"pfd-split-selection\">\n                      {%- if has_standard -%}\n                        <div class=\"pfd-standard-options\">\n                          {%- if selector_mode != 'dropdown' -%}\n                            {%- for value in standard_values_array -%}\n                              <div\n                                data-swatch-item\n                                class=\"t4s-swatch__item{% if selected_value == value %} is--selected{% endif %}\"\n                                data-value=\"{{ value | escape }}\"\n                              >\n                                {{ value | replace: '\"', '' }}\n                              </div>\n                            {%- endfor -%}\n                          {%- else -%}\n                            <button\n                              type=\"button\"\n                              data-pfd-dropdown-open\n                              data-position=\"bottom-end\"\n                              data-id=\"t4s_nt_{{ pr_sid }}{{ forloop.index }}_standard\"\n                            >\n                              <span data-current-value>\n                                {{- selected_value | default: choose_an_option -}}\n                              </span>\n                              <svg\n                                class=\"t4s-icon-select-arrow\"\n                                role=\"presentation\"\n                                viewBox=\"0 0 19 12\"\n                              >\n                                <use xlink:href=\"#t4s-select-arrow\"></use>\n                              </svg>\n                            </button>\n                            <div\n                              data-dropdown-wrapper\n                              class=\"t4s-dropdown__wrapper t4s-current-scrollbar\"\n                              id=\"t4s_nt_{{ pr_sid }}{{ forloop.index }}_standard\"\n                            >\n                              <div class=\"t4s-drop-arrow\"></div>\n                              <div class=\"t4s-dropdown__content\">\n                                {%- for value in standard_values_array -%}\n                                  <div\n                                    data-swatch-item\n                                    data-dropdown-off\n                                    class=\"t4s-swatch__item t4s-truncate{% if selected_value == value %} is--selected{% endif %}\"\n                                    data-value=\"{{ value | escape }}\"\n                                  >\n                                    {{ value | replace: '\"', '' }}\n                                  </div>\n                                {%- endfor -%}\n                              </div>\n                            </div>\n                          {%- endif -%}\n                        </div>\n                      {%- endif -%}\n\n                      {%- if has_custom -%}\n                        <div class=\"pfd-custom-options\">\n                          {%- if has_standard and has_custom -%}\n                            <span class=\"pfd-or-separator\">or</span>\n                          {%- endif -%}\n                          <button\n                            type=\"button\"\n                            data-pfd-dropdown-open\n                            data-position=\"bottom-end\"\n                            data-id=\"t4s_nt_{{ pr_sid }}{{ forloop.index }}_custom\"\n                            class=\"pfd-custom-dropdown\"\n                          >\n                            <span data-current-value>\n                              {%- assign is_custom_selected = false -%}\n                              {%- for custom_val in custom_values_array -%}\n                                {%- if selected_value == custom_val -%}\n                                  {%- assign display_custom_val = custom_val | replace: '\"', '' -%}\n                                  {%- if option_unit != blank -%}\n                                    {{ display_custom_val }}\n                                    {{ option_unit }}\n                                    <span class=\"pfd-custom-badge\">Custom</span>\n                                  {%- else -%}\n                                    {{ display_custom_val }}\n                                    <span class=\"pfd-custom-badge\">Custom</span>\n                                  {%- endif -%}\n                                  {%- assign is_custom_selected = true -%}\n                                  {%- break -%}\n                                {%- endif -%}\n                              {%- endfor -%}\n                              {%- unless is_custom_selected -%}\n                                Custom {{ option_name | downcase }}\n                              {%- endunless -%}\n                            </span>\n                            <svg\n                              class=\"t4s-icon-select-arrow\"\n                              role=\"presentation\"\n                              viewBox=\"0 0 19 12\"\n                            >\n                              <use xlink:href=\"#t4s-select-arrow\"></use>\n                            </svg>\n                          </button>\n                          <div\n                            data-dropdown-wrapper\n                            class=\"t4s-dropdown__wrapper t4s-current-scrollbar\"\n                            id=\"t4s_nt_{{ pr_sid }}{{ forloop.index }}_custom\"\n                          >\n                            <div class=\"t4s-drop-arrow\"></div>\n                            <div class=\"t4s-dropdown__content\">\n                              {%- for value in custom_values_array -%}\n                                <div\n                                  data-swatch-item\n                                  data-dropdown-off\n                                  class=\"t4s-swatch__item t4s-truncate{% if selected_value == value %} is--selected{% endif %}\"\n                                  data-value=\"{{ value | escape }}\"\n                                >\n                                  <span class=\"pfd-checkmark\">✓</span>\n                                  <span class=\"pfd-option-text\">\n                                    {%- assign display_value = value | replace: '\"', '' -%}\n                                    {%- if option_unit != blank -%}\n                                      {{ display_value }}\n                                      {{ option_unit }}\n                                    {%- else -%}\n                                      {{ display_value }}\n                                    {%- endif -%}\n                                  </span>\n                                  <span class=\"pfd-custom-badge\">Custom</span>\n                                </div>\n                              {%- endfor -%}\n                            </div>\n                          </div>\n                        </div>\n                      {%- endif -%}\n\n                      {%- unless has_standard or has_custom -%}\n                        {%- comment %} Fallback to original rendering if no split detected {%- endcomment %}\n                        <div class=\"t4s-swatch__list pfd-fallback-list\">\n                          {%- if selector_mode != 'dropdown' -%}\n                            {%- for value in option.values -%}\n                              <div\n                                data-swatch-item\n                                class=\"t4s-swatch__item{% if selected_value == value %} is--selected{% endif %}\"\n                                data-value=\"{{ value | escape }}\"\n                              >\n                                {{ value | replace: '\"', '' }}\n                              </div>\n                            {%- endfor -%}\n                          {%- else -%}\n                            <button\n                              type=\"button\"\n                              data-pfd-dropdown-open\n                              data-position=\"bottom-end\"\n                              data-id=\"t4s_nt_{{ pr_sid }}{{ forloop.index }}\"\n                            >\n                              <span data-current-value>\n                                {{- selected_value | default: choose_an_option -}}\n                              </span>\n                              <svg\n                                class=\"t4s-icon-select-arrow\"\n                                role=\"presentation\"\n                                viewBox=\"0 0 19 12\"\n                              >\n                                <use xlink:href=\"#t4s-select-arrow\"></use>\n                              </svg>\n                            </button>\n                            <div\n                              data-dropdown-wrapper\n                              class=\"t4s-dropdown__wrapper t4s-current-scrollbar\"\n                              id=\"t4s_nt_{{ pr_sid }}{{ forloop.index }}\"\n                            >\n                              <div class=\"t4s-drop-arrow\"></div>\n                              <div class=\"t4s-dropdown__content\">\n                                {%- for value in option.values -%}\n                                  <div\n                                    data-swatch-item\n                                    data-dropdown-off\n                                    class=\"t4s-swatch__item t4s-truncate{% if selected_value == value %} is--selected{% endif %}\"\n                                    data-value=\"{{ value | escape }}\"\n                                  >\n                                    {{ value | replace: '\"', '' }}\n                                  </div>\n                                {%- endfor -%}\n                              </div>\n                            </div>\n                          {%- endif -%}\n                        </div>\n                      {%- endunless -%}\n                    </div>\n\n                    {%- comment %} Custom order notice - shown when custom option is selected {%- endcomment %}\n                    {%- assign show_custom_notice = false -%}\n                    {%- for custom_val in custom_values_array -%}\n                      {%- if selected_value == custom_val -%}\n                        {%- assign show_custom_notice = true -%}\n                        {%- break -%}\n                      {%- endif -%}\n                    {%- endfor -%}\n                    <div\n                      class=\"pfd-custom-notice\"\n                      style=\"display: {% if show_custom_notice %}block{% else %}none{% endif %};\"\n                    >\n                      <div class=\"pfd-custom-notice-content\">\n                        <svg\n                          class=\"pfd-custom-notice-icon\"\n                          xmlns=\"http://www.w3.org/2000/svg\"\n                          width=\"24\"\n                          height=\"24\"\n                          viewBox=\"0 0 24 24\"\n                          fill=\"none\"\n                          stroke=\"currentColor\"\n                          stroke-width=\"2\"\n                          stroke-linecap=\"round\"\n                          stroke-linejoin=\"round\"\n                        >\n                          <circle cx=\"12\" cy=\"12\" r=\"10\"></circle>\n                          <polyline points=\"12 6 12 12 16 14\"></polyline>\n                        </svg>\n                        <p class=\"pfd-custom-notice-text\">\n                          Custom {{ option_name | downcase }}s are <strong>made to order</strong>. Please allow\n                          <span class=\"pfd-custom-notice-highlight\">6-8 weeks</span> for delivery.\n                        </p>\n                      </div>\n                    </div>\n\n                    {%- comment %} Configuration-based custom content for options {%- endcomment %}\n                    {%- comment %} Renders ALL matching option content, shows only the selected one {%- endcomment %}\n                    {%- assign option_name_lower = option_name | downcase -%}\n                    {%- assign selected_value_lower = selected_value | downcase -%}\n\n                    {%- capture all_option_info -%}\n  {%- for pair in option_content_pairs -%}\n    {%- assign pair_cleaned = pair | strip -%}\n    {%- if pair_cleaned contains '|' -%}\n      {%- assign parts = pair_cleaned | split: '|' -%}\n      {%- assign option_key_full = parts[0] | strip -%}\n      {%- assign content_value = parts[1] | strip -%}\n\n      {%- if option_key_full contains ':' -%}\n        {%- assign key_parts = option_key_full | split: ':' -%}\n        {%- assign option_key = key_parts[0] | strip | downcase -%}\n        {%- assign value_key = key_parts[1] | strip -%}\n        {%- assign value_key_lower = value_key | downcase -%}\n\n        {%- if option_name_lower == option_key -%}\n          {%- assign is_selected = false -%}\n          {%- if selected_value_lower == value_key_lower -%}\n            {%- assign is_selected = true -%}\n          {%- endif -%}\n          <div class=\"pfd-option-info-item\"\n               data-option-name=\"{{ option_name_lower }}\"\n               data-option-value=\"{{ value_key | handle }}\"\n               style=\"{% unless is_selected %}display: none;{% endunless %}\">\n            {{ content_value }}\n          </div>\n        {%- endif -%}\n      {%- endif -%}\n    {%- endif -%}\n  {%- endfor -%}\n{%- endcapture -%}\n\n                    {%- assign all_option_info_stripped = all_option_info | strip -%}\n                    {%- if all_option_info_stripped != blank -%}\n                      <div class=\"pfd-custom-option-info\" data-option-info-container=\"{{ option_name_lower }}\">\n                        {{ all_option_info }}\n                      </div>\n                    {%- endif -%}\n                  </div>\n                {%- endif -%}\n              {%- endfor -%}\n            </div>\n          {%- endif -%}\n\n          {%- liquid\n            if arr_properties.size > 0 and isProductAvailable\n              render 'frm_properties', arr_properties: arr_properties, product: product\n            endif\n          -%}\n\n          {%- if use_incoming_mess\n            and current_variant_incoming\n            and pr_variants.size == 1\n            and current_variant.next_incoming_date != blank\n          -%}\n            {%- assign format_date = current_variant.next_incoming_date | date: date_in -%}\n            {% comment %}<div class=\"t4s-incoming__mess\">{% if current_variant_available %}{{ 'products.product_single.will_not_ship_until_html' | t: date: format_date }}{% else %}{{ 'products.product_single.will_be_in_stock_after_html' | t: date: format_date }}{% endif %}</div>{% endcomment %}\n          {%- elsif use_incoming_mess and pr_variants.size > 1 -%}\n            {%- liquid\n              assign format_date = current_variant.next_incoming_date | date: date_in\n              unless format_date\n                assign format_date = '19041994'\n              endunless\n            -%}\n            {% comment %}<div data-incoming__mess class=\"t4s-incoming__mess\"{% unless current_variant_incoming %} hidden{% endunless %}><span data-incoming-available{% if current_variant_available == false or current_variant == blank %} style=\"display: none\"{% endif %}>{{ 'products.product_single.will_not_ship_until_html' | t: date: format_date }}</span><span data-incoming-soldout{% if current_variant_available or current_variant == blank %} style=\"display: none\"{% endif %}>{{ 'products.product_single.will_be_in_stock_after_html' | t: date: format_date }}</span></div>{% endcomment %}\n          {%- endif -%}\n\n          {{ 'button-style.css' | asset_url | stylesheet_tag }}\n          <link\n            href=\"{{ 'custom-effect.css' | asset_url }}\"\n            rel=\"stylesheet\"\n            media=\"print\"\n            onload=\"this.media='all'\"\n          >\n\n          {{- html_price -}}\n\n          <div\n            class=\"t4s-product-form__buttons\"\n            style=\"--pr-btn-round: {{ bk_stts.pr_btn_round }}px;--wis-cp-btn-round: {{ bk_stts.wis_cp_btn_round }}px;\"\n          >\n            <div class=\"t4s-pr__qty_cart t4s-d-flex t4s-flex-wrap\">\n              {%- if isExternal -%}\n                <a\n                  href=\"{{ external_link }}\"\n                  rel=\"nofollow\"\n                  target=\"_blank\"\n                  class=\"t4s-product-form__submit t4s-btn t4s-btn-base t4s-btn-style-{{ bk_stts.button_style }} t4s-btn-color-{{ bk_stts.button_color }} t4s-w-100 t4s-justify-content-center {% if bk_stts.button_style == 'default' or bk_stts.button_style == 'outline' %} t4s-btn-effect-{{ bk_stts.button_effect }}{% endif %} t4s-truncate is--btn-external t4s-btn-loading__svg\"\n                >\n                  {%- if bk_stts.btn_icon -%}\n                    <svg class=\"t4s-btn-icon\" viewBox=\"0 0 24 24\">\n                      <use xlink:href=\"#t4s-icon-atc\"></use>\n                    </svg>\n                  {%- endif -%}\n                  <span class=\"t4s-btn-atc_text\">\n                    {{- external_title -}}\n                  </span>\n                  <span class=\"t4s-loading__spinner\" hidden>\n                    <svg\n                      width=\"16\"\n                      height=\"16\"\n                      hidden\n                      class=\"t4s-svg-spinner\"\n                      focusable=\"false\"\n                      role=\"presentation\"\n                      viewBox=\"0 0 66 66\"\n                      xmlns=\"http://www.w3.org/2000/svg\"\n                    >\n                      <circle class=\"t4s-path\" fill=\"none\" stroke-width=\"6\" cx=\"33\" cy=\"33\" r=\"30\"></circle>\n                    </svg>\n                  </span>\n                </a>\n              {%- else -%}\n                {%- if bk_stts.show_qty and isProductAvailable -%}\n                  <div\n                    data-quantity-wrapper\n                    class=\"t4s-quantity-wrapper t4s-product-form__qty\"\n                  >\n                    <button\n                      data-quantity-selector\n                      data-decrease-qty\n                      type=\"button\"\n                      class=\"t4s-quantity-selector is--minus\"\n                    ></button>\n                    <input\n                      data-quantity-value\n                      type=\"number\"\n                      class=\"t4s-quantity-input\"\n                      step=\"1\"\n                      min=\"{{cus_qty}}\"\n                      max=\"{{max_qty}}\"\n                      name=\"quantity\"\n                      value=\"{{cus_qty}}\"\n                      size=\"4\"\n                      pattern=\"[0-9]*\"\n                      inputmode=\"numeric\"\n                    >\n                    <button\n                      data-quantity-selector\n                      data-increase-qty\n                      type=\"button\"\n                      class=\"t4s-quantity-selector is--plus\"\n                    ></button>\n                  </div>\n                {%- else -%}\n                  <input type=\"hidden\" name=\"quantity\" value=\"1\">\n                {%- endif -%}\n                {% if customer %}\n                  <button\n                    data-animation-atc='{ \"ani\": \"{{ bk_stts.ani }}\",\"time\": {{ bk_stts.time }}000 }'\n                    type=\"submit\"\n                    name=\"add\"\n                    data-atc-form\n                    class=\"t4s-product-form__submit t4s-btn t4s-btn-base t4s-btn-style-{{ bk_stts.button_style }} t4s-btn-color-{{ bk_stts.button_color }} t4s-w-100 t4s-justify-content-center {% if bk_stts.button_style == 'default' or bk_stts.button_style == 'outline' %} t4s-btn-effect-{{ bk_stts.button_effect }}{% endif %} t4s-btn-loading__svg\"\n                    {% unless current_variant_available %}\n                      aria-disabled=\"true\"\n                    {% endunless -%}\n                    {% unless isProductAvailable %}\n                      disabled=\"disabled\"\n                    {% endunless %}\n                  >\n                    {%- if bk_stts.btn_icon -%}\n                      <svg\n                        class=\"t4s-btn-icon\"\n                        viewBox=\"0 0 24 24\"\n                      >\n                        <use xlink:href=\"#t4s-icon-atc\"></use>\n                      </svg>\n                    {%- endif -%}\n                    <span class=\"t4s-btn-atc_text\">\n                      {%- if current_variant_available == false or isProductAvailable == false -%}\n                        {{- 'products.product.sold_out' | t -}}\n                      {%- elsif isPreoder -%}\n                        {{- 'products.product.pre_order' | t }}\n                      {%- else -%}\n                        {{ 'products.product.add_to_cart' | t }}\n                      {%- endif -%}\n                    </span>\n                    <span class=\"t4s-loading__spinner\" hidden>\n                      <svg\n                        width=\"16\"\n                        height=\"16\"\n                        hidden\n                        class=\"t4s-svg-spinner\"\n                        focusable=\"false\"\n                        role=\"presentation\"\n                        viewBox=\"0 0 66 66\"\n                        xmlns=\"http://www.w3.org/2000/svg\"\n                      >\n                        <circle class=\"t4s-path\" fill=\"none\" stroke-width=\"6\" cx=\"33\" cy=\"33\" r=\"30\"></circle>\n                      </svg>\n                    </span>\n                  </button>\n                {% else %}\n                  <a\n                    href=\"/account/login\"\n                    onclick=\"rememberPage(event)\"\n                    data-drawer-delay-\n                    data-drawer-options='{ \"id\": \"#t4s-login-sidebar\" }'\n                    class=\"atc-btn t4s-btn t4s-btn-base t4s-btn-style-default t4s-btn-color-dark t4s-w-100 t4s-justify-content-center t4s-btn-effect-sweep-to-right t4s-btn-loading__svg\"\n                  >\n                    <svg\n                      class=\"t4s-btn-icon\"\n                      viewBox=\"0 0 24 24\"\n                      style=\"margin-right:4px\"\n                    >\n                      <use xlink:href=\"#t4s-icon-atc\"></use>\n                    </svg>\n                    <span class=\"t4s-btn-atc_text\">Login to Shop</span>\n                    <span class=\"t4s-loading__spinner\" hidden=\"\">\n                      <svg\n                        width=\"16\"\n                        height=\"16\"\n                        hidden=\"\"\n                        class=\"t4s-svg-spinner\"\n                        focusable=\"false\"\n                        role=\"presentation\"\n                        viewBox=\"0 0 66 66\"\n                        xmlns=\"http://www.w3.org/2000/svg\"\n                      >\n                        <circle class=\"t4s-path\" fill=\"none\" stroke-width=\"6\" cx=\"33\" cy=\"33\" r=\"30\"></circle>\n                      </svg>\n                    </span>\n                  </a>\n                {% endif %}\n              {%- endif -%}\n            </div>\n            {%- if PR_buy_pr and type != 'main_sticky' %}\n              {{- form | payment_button -}}\n            {% endif -%}\n            {%- if settings.use_notify_me -%}\n              {% if customer -%}\n                <button\n                  data-class=\"t4s-mfp-btn-close-inline\"\n                  data-id=\"t4s-pr-popup__notify-stock\"\n                  data-storageid=\"notify-stock{{ current_variant.id }}\"\n                  data-mfp-src\n                  data-open-mfp-ajax\n                  class=\"t4s-pr__notify-stock{% if current_variant_available or current_variant == blank %} t4s-d-none{% endif %}\"\n                  type=\"button\"\n                  data-notify-stock-btn\n                  data-variant-id=\"{{ current_variant.id }}\"\n                  data-root-url=\"{{ routes.root_url }}\"\n                >\n                  {{ 'products.notify_stock.trigger' | t }}\n                </button>\n              {%- endif %}\n            {%- endif -%}\n            {%- if bk_stts.enable_wishlist or bk_stts.enable_compare -%}\n              <div class=\"t4s-pr__wis_cp\">\n                {%- render 't4s_wis_cp', product: product, bk_stts: bk_stts, disableTooltip: true -%}\n              </div>\n            {%- endif -%}\n          </div>\n        {%- endform -%}\n        {%- unless isProductDefault or type == 'main_sticky' -%}\n          <script type=\"application/json\" class=\"pr_variants_json\">\n            {{ shsd_product_variants | json }}\n          </script>\n          <script type=\"application/json\" class=\"pr_options_json\">\n            {{ shsd_product_options_with_values | json }}\n          </script>\n        {%- endunless -%}\n        {%- if bk_stts.ani != 'none' -%}\n          <link\n            href=\"{{ 'ani-atc.min.css' | asset_url }}\"\n            rel=\"stylesheet\"\n            media=\"print\"\n            onload=\"this.media='all'\"\n          >\n        {%- endif -%}\n      </div>\n    </div>\n  </div>\n\n  <script>\n    (function () {\n      'use strict';\n\n      function updateOptionInfo(container, selectedValue) {\n        var optionName = container.getAttribute('data-option-name');\n        if (!optionName) return;\n        optionName = optionName.toLowerCase();\n\n        var infoContainer = container.querySelector('[data-option-info-container=\"' + optionName + '\"]');\n        if (!infoContainer) return;\n\n        var valueHandle = selectedValue\n          .toLowerCase()\n          .replace(/\\s+/g, '-')\n          .replace(/[^a-z0-9-]/g, '');\n        var infoItems = infoContainer.querySelectorAll('.pfd-option-info-item');\n\n        infoItems.forEach(function (item) {\n          var itemValue = item.getAttribute('data-option-value');\n          item.style.display = itemValue === valueHandle ? '' : 'none';\n        });\n      }\n\n      function initOptionInfoHandler() {\n        var swatchContainers = document.querySelectorAll('[data-swatch-option]');\n\n        swatchContainers.forEach(function (container) {\n          // Method 1: MutationObserver for instant updates\n          var observer = new MutationObserver(function (mutations) {\n            mutations.forEach(function (mutation) {\n              if (mutation.type === 'attributes' && mutation.attributeName === 'class') {\n                var target = mutation.target;\n                if (target.classList.contains('is--selected') && target.hasAttribute('data-value')) {\n                  var selectedValue = target.getAttribute('data-value');\n                  updateOptionInfo(container, selectedValue);\n                }\n              }\n            });\n          });\n\n          observer.observe(container, {\n            attributes: true,\n            subtree: true,\n            attributeFilter: ['class'],\n          });\n\n          // Method 2: Backup click handler with small delay\n          var swatchItems = container.querySelectorAll('[data-swatch-item]');\n          swatchItems.forEach(function (swatch) {\n            swatch.addEventListener('click', function () {\n              var selectedValue = this.getAttribute('data-value');\n              if (!selectedValue) return;\n              setTimeout(function () {\n                updateOptionInfo(container, selectedValue);\n              }, 10);\n            });\n          });\n        });\n      }\n\n      if (document.readyState === 'loading') {\n        document.addEventListener('DOMContentLoaded', initOptionInfoHandler);\n      } else {\n        initOptionInfoHandler();\n      }\n\n      document.addEventListener('shopify:section:load', initOptionInfoHandler);\n    })();\n  </script>\n</div>\n{%- if PR_buy_pr and current_variant_available != true and type != 'main_sticky' -%}\n  <style>\n    #t4s-callBackVariant{{ product_form_id }} .shopify-payment-button { display: none;}\n  </style>\n{% endif -%}\n",
              "reasoning": "Fix path-1 color swatch: add missing is--soldout class alongside is--out-of-stock, and fix badge class name from t4s-swatch__re-visible to t4s-swatch__restock-badge so JS luminance detection and CSS visibility rules target it correctly."
            },
            "result": "(no result received)",
            "isError": true,
            "elapsedMs": 0
          },
          {
            "name": "edit_lines",
            "id": "toolu_01Y5Z6DfmR9T6bwdKeWysmf2",
            "input": {
              "filePath": "snippets/product-form-dynamic.liquid",
              "startLine": 449,
              "endLine": 476,
              "newContent": "                            <div\n                              data-swatch-item\n                              class=\"t4s-swatch__btn-wrap{% if selected_value == value %} is--selected{% endif %}{% unless color_is_available %} is--soldout is--out-of-stock{% if avail_lengths != '' %} pfd-has-lengths{% endif %}{% endunless %}\"\n                              data-value=\"{{ value | escape }}\"\n                              data-available=\"{{ color_is_available }}\"\n                            >\n                              <!-- DEBUG: color={{ color_handle }} | available={{ color_is_available }} | selected_opt1={{ product.selected_or_first_available_variant.option1 | handle }} | selected_opt2={{ product.selected_or_first_available_variant.option2 | handle }} -->\n                              <div\n                                data-img-el\n                                class=\"t4s-swatch__item {{ color_swatch }}bg_color_{{ value | handle }} lazyloadt4s\">\n                                <img crossorigin=\"anonymous\">\n                                {%- unless color_is_available -%}\n                                  <span class=\"t4s-swatch__restock-badge\">Awaiting Restock</span>\n                                {%- endunless -%}\n                              </div>\n                              {%- unless color_is_available -%}\n                                {%- if avail_lengths != '' -%}\n                                  <span class=\"t4s-swatch__available-lengths is-visible\">Available in {{ avail_lengths }}</span>\n                                {%- endif -%}\n                              {%- endunless -%}\n                              <span class=\"t4s-swatch__label\">\n                                {{- value | replace: '\"', '' -}}\n                              </span>\n                              {%- if color_nickname != blank -%}\n                                <span class=\"t4s-swatch__nickname\">{{ color_nickname }}</span>\n                              {%- endif -%}\n                            </div>\n",
              "reasoning": "Fix path-1 color swatch: add missing is--soldout class alongside is--out-of-stock, and fix badge class name from t4s-swatch__re-visible to t4s-swatch__restock-badge so JS luminance detection and CSS visibility rules target it correctly."
            },
            "result": "(no result received)",
            "isError": true,
            "elapsedMs": 0
          },
          {
            "name": "propose_code_edit",
            "id": "pm-change-1772178232027",
            "input": {
              "filePath": "product-form-dynamic.liquid",
              "newContent": "{% comment %} Custom options configuration - options listed here will render as dropdowns {% endcomment %}\n{% assign custom_option_names = product.metafields.custom.custom_values.value %}\n\n{% comment %} Custom content configuration for specific options {% endcomment %}\n{% comment %} Format: option_name:option_value|<html content> - separated by semicolons for multiple {% endcomment %}\n\n{% assign option_content_config = 'texture:Straight|<div class=\"pfd-info-content\"><span class=\"pfd-info-icon\">i</span><span class=\"pfd-info-text\">Our straight texture has slight natural wave texture to it when washed and dried. It is not pin straight hair, nor is that desirable among most clientele.</span></div>;texture:Natural Wave|<div class=\"pfd-info-content\"><span class=\"pfd-info-icon\">i</span><span class=\"pfd-info-text\">Our natural wave texture features soft, beachy waves that blend seamlessly with most natural hair textures. Low maintenance and versatile for everyday styling.</span></div>;texture:Loose Curl|<div class=\"pfd-info-content\"><span class=\"pfd-info-icon\">i</span><span class=\"pfd-info-text\">Our loose curl texture offers bouncy, defined curls that hold their shape beautifully. Perfect for adding volume and movement with minimal styling required.</span></div>;texture:Tight Curl|<div class=\"pfd-info-content\"><span class=\"pfd-info-icon\">i</span><span class=\"pfd-info-text\">Our tight curl texture provides well-defined, springy curls with maximum volume. Ideal for protective styles and blending with naturally curly hair.</span></div>' %}\n\n{% assign option_content_pairs = option_content_config | split: ';' %}\n\n{% comment %} SellersDash collect child product details {% endcomment %}\n{% assign shsd_product_details = product.metafields.sellersdash.shsdproducts %}\n{% if shsd_product_details.product_type == 'shsd_parent' %}\n  {% assign shsd_product_handles = product.handle %}\n  {% assign shsd_product_handles = shsd_product_handles | concat: shsd_product_details.handles %}\n  {% for shsd_handle in shsd_product_handles %}\n    {% assign shsd_single_product = all_products[shsd_handle] %}\n    {% assign shsd_product_variants = shsd_product_variants | concat: shsd_single_product.variants %}\n    {% assign shsd_product_media = shsd_product_media | concat: shsd_single_product.media %}\n    {% assign shsd_product_images = shsd_product_images | concat: shsd_single_product.images %}\n  {% endfor %}\n  {% assign shsd_product_options_with_values = shsd_product_details.options_with_values %}\n{% else %}\n  {% assign shsd_product_options_with_values = product.options_with_values %}\n  {% assign shsd_product_variants = product.variants %}\n  {% assign shsd_product_media = product.media %}\n  {% assign shsd_product_images = product.images %}\n{% endif %}\n\n{% comment %} Reorder options: Length, Texture, Color, then remaining {% endcomment %}\n{% assign reordered_options = '' | split: '' %}\n{% assign remaining_options = '' | split: '' %}\n\n{% for option in shsd_product_options_with_values %}\n  {% assign opt_name_lower = option.name | downcase | strip %}\n  {% if opt_name_lower == 'length' %}\n    {% assign length_slice = shsd_product_options_with_values | slice: forloop.index0, 1 %}\n  {% elsif opt_name_lower == 'texture' %}\n    {% assign texture_slice = shsd_product_options_with_values | slice: forloop.index0, 1 %}\n  {% elsif opt_name_lower == 'color' or opt_name_lower == 'colour' or opt_name_lower == 'colors' %}\n    {% assign color_slice = shsd_product_options_with_values | slice: forloop.index0, 1 %}\n  {% else %}\n    {% assign other_slice = shsd_product_options_with_values | slice: forloop.index0, 1 %}\n    {% assign remaining_options = remaining_options | concat: other_slice %}\n  {% endif %}\n{% endfor %}\n\n{% if length_slice %}\n  {% assign reordered_options = reordered_options | concat: length_slice %}\n{% endif %}\n{% if texture_slice %}\n  {% assign reordered_options = reordered_options | concat: texture_slice %}\n{% endif %}\n{% if color_slice %}\n  {% assign reordered_options = reordered_options | concat: color_slice %}\n{% endif %}\n{% assign shsd_product_options_with_values = reordered_options | concat: remaining_options %}\n\n{%- assign product_form_id = 'product-form-' | append: pr_sid -%}\n{%- liquid\n  assign pr_variants = shsd_product_variants\n  assign PR_buy_pr = false\n  if bk_stts.show_dynamic_checkout and isExternal == false and isProductAvailable\n    assign PR_buy_pr = true\n  endif\n  assign choose_an_option = 'products.product.choose_an_option' | t\n  assign date_in = settings.date_in\n  assign class_frm = 't4s-form__product has--form__swatch'\n  if isProductDefault\n    assign class_frm = 't4s-form__product'\n  endif\n  if arr_properties.size > 0 and isProductAvailable\n    assign class_frm = class_frm | append: ' has--properties'\n  endif\n  if settings.sticky_atc and type == 'main'\n    assign class_frm = class_frm | append: ' is--main-sticky'\n  else\n    assign class_frm = class_frm | append: ' is--atc-sticky'\n  endif\n\n  assign color_swatch = 'disabled-'\n  assign color_mode = bk_stts.color_mode\n  assign selector_mode = bk_stts.selector_mode\n  assign stt_color_ck = settings.color_ck | default: ';'\n  assign color_ck = stt_color_ck | append: ',color,colors,couleur,colour' | remove: ';,'\n  assign get_color = color_ck | downcase | replace: ' ,', ',' | replace: ', ', ',' | split: ',' | uniq\n  assign color_mode_list = 'color, color is-sw-cl__round, color is-sw-cl__round is-sw-cl__label, variant_image, variant_image is-sw-cl__round, variant_image is-sw-cl__round is-sw-cl__label' | split: ', '\n  if color_mode_list contains color_mode\n    assign color_swatch = 'is-sw__color '\n  endif\n  assign current_variant_available = current_variant.available\n  assign use_incoming_mess = settings.use_incoming_mess\n  assign current_variant_incoming = false\n  assign current_inventory_quantity = current_variant.inventory_quantity\n  if current_inventory_quantity <= 0 and current_variant.inventory_management == 'shopify' and current_variant.incoming\n    assign current_variant_incoming = true\n  endif\n  if pos_sizeg == '1'\n    assign html_sizeg = ''\n  endif\n  if current_variant.inventory_management != null and current_inventory_quantity > 0 and current_variant.inventory_policy != 'continue'\n    assign max_qty = current_inventory_quantity\n  else\n    assign max_qty = 9999\n  endif\n  if color_mode contains 'color' or color_mode contains 'variant'\n    assign show_tooltip = ''\n  else\n    assign show_tooltip = '-off'\n  endif\n-%}\n\n{%- if product.metafields.custom.default_variant.value -%}\n  <script>\n    window.__HAS_SELECTED__ = {{ product.selected_variant | json }};\n    window.__DEFAULT_VARIANT__ = {{ product.metafields.custom.default_variant.value | json }};\n  </script>\n{%- endif -%}\n\n{%- assign length_option_position = -1 -%}\n{%- assign color_option_position = -1 -%}\n{%- for opt_name in product.options -%}\n  {%- assign opt_name_down = opt_name | downcase -%}\n  {%- if opt_name_down == 'length' -%}\n    {%- assign length_option_position = forloop.index -%}\n  {%- endif -%}\n  {%- if get_color contains opt_name_down -%}\n    {%- assign color_option_position = forloop.index -%}\n  {%- endif -%}\n{%- endfor -%}\n\n<script>\n  window.__CUSTOM_OPTION_NAMES__ = {{ custom_option_names | json }};\n  window.__LENGTH_OPTION_INDEX__ = {{ length_option_position | minus: 1 }};\n</script>\n\n{%- comment -%} Load dropdown CSS if either color mode or selector mode is dropdown {%- endcomment -%}\n\n{%- if color_mode == 'dropdown' or selector_mode == 'dropdown' -%}\n  <link\n    rel=\"stylesheet\"\n    href=\"{{ 'base_drop.min.css' | asset_url }}\"\n    media=\"all\"\n  >\n{%- endif -%}\n\n{%- comment -%} Custom CSS for product form dynamic {%- endcomment -%}\n{{ 'product-form-dynamic.css' | asset_url | stylesheet_tag }}\n\n<div class=\"pfd-override-wrapper\">\n  <div class=\"pfd-custom-wrapper\">\n    <div\n      class=\"t4s-product-form__variants is-no-pick__{{ PR_no_pick }}{% if PR_buy_pr %} is-payment-btn-true t4s-payment-button t4s-btn-color-{{ bk_stts.button_color_payment }}{% endif %} is-remove-soldout-{{ remove_soldout }} is-btn-full-width__{{ bk_stts.btn_atc_full }} is-btn-atc-txt-{{ bk_stts.btn_txt }} is-btn-ck-txt-{{ bk_stts.btn_txt2 }} is--fist-ratio-{{ is_fit_ratio_img }}\"\n      style=\"{% if is_fit_ratio_img %} --fit-ratio-img: {{ first_ratio_img }}; {% endif %} --wishlist-color: {{bk_stts.wishlist_color}};--wishlist-hover-color: {{bk_stts.wishlist_color_hover}};--wishlist-active-color: {{bk_stts.wishlist_color_active}};--compare-color: {{bk_stts.compare_color}};--compare-hover-color: {{bk_stts.compare_color_hover}};--compare-active-color: {{bk_stts.compare_color_active}};\"\n      {{ shopify_attributes }}\n    >\n      <div data-callBackVariant id=\"t4s-callBackVariant{{ product_form_id }}\">\n        {%- form 'product',\n          product,\n          id: product_form_id,\n          data-productid: product.id,\n          class: class_frm,\n          novalidate: 'novalidate',\n          data-type: 'add-to-cart-form',\n          data-disable-swatch: isProductDefault\n        -%}\n          {% comment %}{{- form | payment_terms -}}{% endcomment %}\n          {%- if isProductDefault -%}\n            <input\n              name=\"id\"\n              value=\"{{ pr_variants.first.id }}\"\n              type=\"hidden\"\n            >\n            {%- if advance_pr_type != blank -%}\n              {%- render 'choose_style', advance_pr_type: advance_pr_type, title: advance_label, pid: product.id -%}\n            {%- endif -%}\n          {%- else -%}\n            {{ 'swatch.css' | asset_url | stylesheet_tag }}\n            <select\n              name=\"id\"\n              id=\"product-select-{{ pr_sid }}\"\n              class=\"t4s-product__select t4s-d-none\"\n            >\n              {%- for variant in pr_variants -%}\n                {%- if variant.available -%}\n                  <option\n                    data-option1=\"{{ variant.option1 }}\"\n                    data-option2=\"{{ variant.option2 }}\"\n                    value=\"{{ variant.id }}\"\n                    data-mdid=\"{{ variant.featured_media.id | json }}\"\n                    data-incoming=\"{{ variant.incoming }}\"\n                    data-inventoryQuantity=\"{{ variant.inventory_quantity | json }}\"\n                    data-inventoryPolicy=\"{{ variant.inventory_policy | json }}\"\n                    data-nextIncomingDate=\"{{ variant.next_incoming_date | date: date_in }}\"\n                    {% if variant.id == current_variant.id %}\n                      selected=\"selected\"\n                    {% endif %}\n                  >\n                    {{ variant.title | escape }}\n                  </option>\n                {%- else -%}\n                  <option\n                    data-option1=\"{{ variant.option1 }}\"\n                    data-option2=\"{{ variant.option2 }}\"\n                    value=\"{{ variant.id }}\"\n                    data-mdid=\"{{ variant.featured_media.id | json }}\"\n                    data-incoming=\"{{ variant.incoming }}\"\n                    data-inventoryQuantity=\"{{ variant.inventory_quantity | json }}\"\n                    data-inventoryPolicy=\"{{ variant.inventory_policy | json }}\"\n                    data-nextIncomingDate=\"{{ variant.next_incoming_date | date: date_in }}\"\n                  >\n                    {{ variant.title | escape }}\n                  </option>\n                {%- endif -%}\n              {%- endfor -%}\n            </select>\n\n            <div class=\"pfd-variant-images\" style=\"display:none !important;\">\n              <div class=\"pfd-main-imgs\">\n                {%- for variant in pr_variants -%}\n                  {% assign var_imgs = variant.metafields.custom.variant_image.value %}\n                  <div\n                    class=\"pfd-img-listing\"\n                    data-var-img=\"{{ variant.image.src | img_url: 'master' }}\"\n                    data-pfd-variant-id=\"{{ variant.id }}\"\n                  >\n                    {% for value in var_imgs %}\n                      <div class=\"pfd-media-item\">\n                        <img src=\"{{value | img_url: 'master'}}\">\n                      </div>\n                    {% endfor %}\n                  </div>\n                {%- endfor -%}\n              </div>\n              <div class=\"pfd-thumb-imgs\">\n                {%- for variant in pr_variants -%}\n                  {% assign var_imgs = variant.metafields.custom.variant_image.value %}\n                  <div class=\"pfd-img-listing\" data-pfd-variant-id=\"{{ variant.id }}\">\n                    {% for value in var_imgs %}\n                      <div class=\"pfd-media-thumb\">\n                        <div\n                          class=\"pfd-img\"\n                          style=\"background-image:url('{{value | img_url: \"master\"}}');\"\n                        ></div>\n                      </div>\n                    {% endfor %}\n                  </div>\n                {%- endfor -%}\n              </div>\n            </div>\n\n            <div class=\"t4s-swatch t4s-color-mode__{{ color_mode }} t4s-color-size__{{ bk_stts.color_size }} t4s-selector-mode__{{ selector_mode }}\">\n              {%- if advance_pr_type != blank -%}\n                {%- render 'choose_style', advance_pr_type: advance_pr_type, title: advance_label, pid: product.id -%}\n              {%- endif -%}\n\n              {%- for option in shsd_product_options_with_values -%}\n                {%- liquid\n                  assign option_index = 'option' | append: forloop.index\n                  assign selected_value = product.selected_or_first_available_variant[option_index]\n                  assign option_name = option.name\n                  assign name_downcase = option_name | downcase\n                -%}\n\n                {%- if get_color contains name_downcase -%}\n                  {% comment %}--MARK: Color Option{% endcomment %}\n\n                  {% comment %} Build color nickname map from variant metafields {% endcomment %}\n                  {%- capture color_nicknames_map -%}\n                    {%- for variant in shsd_product_variants -%}\n                      {%- if variant.metafields.custom.variant_color != blank -%}\n                        {%- for opt_index in (1..3) -%}\n                          {%- assign opt_key = 'option' | append: opt_index -%}\n                          {%- assign opt_val = variant[opt_key] -%}\n                          {%- if opt_val != blank -%}\n                            {%- assign opt_index_adjusted = opt_index | minus: 1 -%}\n                            {%- assign opt_name_check = product.options[opt_index_adjusted] | downcase -%}\n                            {%- if get_color contains opt_name_check -%}\n                              {{ opt_val | handle }}:{{ variant.metafields.custom.variant_color }};\n                            {%- endif -%}\n                          {%- endif -%}\n                        {%- endfor -%}\n                      {%- endif -%}\n                    {%- endfor -%}\n                  {%- endcapture -%}\n                  {%- assign color_nicknames_map = color_nicknames_map | strip -%}\n\n                  <div\n                    data-swatch-option\n                    data-option-name=\"{{ option_name | escape }}\"\n                    data-id=\"{{ forloop.index0 }}\"\n                    data-option-unit=\"\n                      {%- liquid\n                        assign option_unit = ''\n                        if se_stts and se_stts.option_units and se_stts.option_units != blank\n                          assign option_units_raw = se_stts.option_units | strip | newline_to_br | split: '<br />'\n                          for pair in option_units_raw\n                            assign pair_cleaned = pair | strip\n                            if pair_cleaned contains ':'\n                              assign key_value = pair_cleaned | split: ':'\n                              assign key = key_value[0] | strip\n                              assign value = key_value[1] | strip\n                              if key == option_name and value != blank\n                                assign option_unit = value\n                                break\n                              endif\n                            endif\n                          endfor\n                        endif\n                      -%}{{ option_unit | escape }}\n                    \"\n                    class=\"t4s-swatch__option is-t4s-style__color is-t4s-name__{{ option_name | handle }} {% cycle 'is--first-color', '', '' %}\"\n                  >\n                    <h4 class=\"t4s-swatch__title t4s-swatch__title--color\">\n                      <span class=\"t4s-swatch__title--left\">\n                        <span class=\"bold\">\n                          {{- option_name | upcase -}}\n                          {%- liquid\n                            assign option_unit = ''\n                            if se_stts and se_stts.option_units and se_stts.option_units != blank\n                              assign option_units_raw = se_stts.option_units | strip | newline_to_br | split: '<br />'\n                              for pair in option_units_raw\n                                assign pair_cleaned = pair | strip\n                                if pair_cleaned contains ':'\n                                  assign key_value = pair_cleaned | split: ':'\n                                  assign key = key_value[0] | strip\n                                  assign value = key_value[1] | strip\n                                  if key == option_name and value != blank\n                                    assign option_unit = value\n                                    break\n                                  endif\n                                endif\n                              endfor\n                            endif\n                          -%}\n                          {%- if option_unit != blank %} ({{ option_unit }}){%- endif -%}\n                          :\n                        </span>\n                        <span class=\"t4s-selected-value\">\n                          {%- assign display_value = selected_value | default: choose_an_option | replace: '\"', '' -%}\n                          {{- display_value -}}\n                          {%- if option_unit != blank %} {{ option_unit }}{%- endif -%}\n                        </span>\n                      </span>\n                      {%- if name_sizeg == name_downcase -%}\n                        {{- html_sizeg -}}\n                      {%- endif %}\n                    </h4>\n\n                    <div data-swatch-list class=\"t4s-swatch__list\">\n                      {%- if color_mode != 'dropdown' -%}\n                        {%- if color_mode contains 'is-sw-cl__label' -%}\n                          {%- for value in option.values -%}\n                            {%- assign color_handle = value | handle -%}\n\n                            {%- comment %} Look up color nickname from map {%- endcomment -%}\n                            {%- assign color_nickname = '' -%}\n                            {%- assign nickname_pairs = color_nicknames_map | split: ';' -%}\n                            {%- for pair in nickname_pairs -%}\n                              {%- assign pair_clean = pair | strip -%}\n                              {%- if pair_clean != blank -%}\n                                {%- assign pair_parts = pair_clean | split: ':' -%}\n                                {%- if pair_parts[0] == color_handle -%}\n                                  {%- assign color_nickname = pair_parts[1] -%}\n                                  {%- break -%}\n                                {%- endif -%}\n                              {%- endif -%}\n                            {%- endfor -%}\n\n                            {%- comment %} Context-aware availability check: color + current other selections {%- endcomment -%}\n                            {%- assign color_is_available = false -%}\n                            {%- for variant in shsd_product_variants -%}\n                              {%- assign matches_color = false -%}\n                              {%- assign matches_other_options = true -%}\n\n                              {%- for opt_idx in (1..3) -%}\n                                {%- assign opt_key = 'option' | append: opt_idx -%}\n                                {%- assign variant_opt_val = variant[opt_key] -%}\n                                {%- if variant_opt_val != blank -%}\n                                  {%- assign variant_opt_handle = variant_opt_val | handle -%}\n\n                                  {%- comment %} Determine if this option index is the color option {%- endcomment -%}\n                                  {%- assign opt_idx_adjusted = opt_idx | minus: 1 -%}\n                                  {%- assign this_opt_name = product.options[opt_idx_adjusted] | downcase -%}\n\n                                  {%- if get_color contains this_opt_name -%}\n                                    {%- comment %} This is the color option - check if it matches our target color {%- endcomment -%}\n                                    {%- if variant_opt_handle == color_handle -%}\n                                      {%- assign matches_color = true -%}\n                                    {%- endif -%}\n                                  {%- else -%}\n                                    {%- comment %} This is a non-color option - check if variant matches current selection {%- endcomment -%}\n                                    {%- assign current_selected_val = product.selected_or_first_available_variant[opt_key] -%}\n                                    {%- if current_selected_val != blank -%}\n                                      {%- assign current_selected_handle = current_selected_val | handle -%}\n                                      {%- unless variant_opt_handle == current_selected_handle -%}\n                                        {%- assign matches_other_options = false -%}\n                                      {%- endunless -%}\n                                    {%- endif -%}\n                                  {%- endif -%}\n                                {%- endif -%}\n                              {%- endfor -%}\n\n                              {%- if matches_color and matches_other_options and variant.available -%}\n                                {%- assign color_is_available = true -%}\n                                {%- break -%}\n                              {%- endif -%}\n                            {%- endfor -%}\n\n                            {%- comment %} Compute available standard lengths for this color (used for both classes and content) {%- endcomment -%}\n                            {%- assign avail_lengths = '' -%}\n                            {%- assign avail_lengths_seen = '' -%}\n                            {%- assign length_opt_key = 'option' | append: length_option_position -%}\n                            {%- if length_option_position > 0 and color_option_position > 0 -%}\n                              {%- for lv in shsd_product_variants -%}\n                                {%- assign v_color_key = 'option' | append: color_option_position -%}\n                                {%- assign v_color_val = lv[v_color_key] | handle -%}\n                                {%- if v_color_val == color_handle and lv.available -%}\n                                  {%- assign v_length_val = lv[length_opt_key] -%}\n                                  {%- if v_length_val != blank -%}\n                                    {%- assign is_custom_length = false -%}\n                                    {%- if custom_option_names -%}\n                                      {%- for custom_name in custom_option_names -%}\n                                        {%- assign custom_name_stripped = custom_name | strip -%}\n                                        {%- if v_length_val == custom_name_stripped -%}\n                                          {%- assign is_custom_length = true -%}\n                                          {%- break -%}\n                                        {%- endif -%}\n                                      {%- endfor -%}\n                                    {%- endif -%}\n                                    {%- unless is_custom_length -%}\n                                      {%- assign v_length_clean = v_length_val | replace: '\"', '' | strip -%}\n                                      {%- assign sentinel = '@@' | append: v_length_clean | append: '@@' -%}\n                                      {%- unless avail_lengths_seen contains sentinel -%}\n                                        {%- assign avail_lengths_seen = avail_lengths_seen | append: sentinel -%}\n                                        {%- if avail_lengths == '' -%}\n                                          {%- assign avail_lengths = v_length_clean -%}\n                                        {%- else -%}\n                                          {%- assign avail_lengths = avail_lengths | append: ', ' | append: v_length_clean -%}\n\n                                        {%- endif -%}\n                                      {%- endunless -%}\n                                    {%- endunless -%}\n                                  {%- endif -%}\n                                {%- endif -%}\n                              {%- endfor -%}\n                            {%- endif -%}\n\n                            <div\n                              data-swatch-item\n                              class=\"t4s-swatch__btn-wrap{% if selected_value == value %} is--selected{% endif %}{% unless color_is_available %} is--soldout is--out-of-stock{% if avail_lengths != '' %} pfd-has-lengths{% endif %}{% endunless %}\"\n                              data-value=\"{{ value | escape }}\"\n                              data-available=\"{{ color_is_available }}\"\n                            >\n                              <!-- DEBUG: color={{ color_handle }} | available={{ color_is_available }} | selected_opt1={{ product.selected_or_first_available_variant.option1 | handle }} | selected_opt2={{ product.selected_or_first_available_variant.option2 | handle }} -->\n                              <div\n                                data-img-el\n                                class=\"t4s-swatch__item {{ color_swatch }}bg_color_{{ value | handle }} lazyloadt4s\">\n                                <img crossorigin=\"anonymous\">\n                                {%- unless color_is_available -%}\n                                  <span class=\"t4s-swatch__restock-badge\">Awaiting Restock</span>\n                                {%- endunless -%}\n                              </div>\n                              {%- unless color_is_available -%}\n                                {%- if avail_lengths != '' -%}\n                                  <span class=\"t4s-swatch__available-lengths is-visible\">Available in {{ avail_lengths }}</span>\n                                {%- endif -%}\n                              {%- endunless -%}\n                              <span class=\"t4s-swatch__label\">\n                                {{- value | replace: '\"', '' -}}\n                              </span>\n                              {%- if color_nickname != blank -%}\n                                <span class=\"t4s-swatch__nickname\">{{ color_nickname }}</span>\n                              {%- endif -%}\n                            </div>\n\n                          {%- endfor -%}\n\n                        {%- else -%}\n                          {%- for value in option.values -%}\n                            {%- assign color_handle = value | handle -%}\n\n                            {%- comment %} Look up color nickname {%- endcomment -%}\n                            {%- assign color_nickname = '' -%}\n                            {%- assign nickname_pairs = color_nicknames_map | split: ';' -%}\n                            {%- for pair in nickname_pairs -%}\n                              {%- assign pair_clean = pair | strip -%}\n                              {%- if pair_clean != blank -%}\n                                {%- assign pair_parts = pair_clean | split: ':' -%}\n                                {%- if pair_parts[0] == color_handle -%}\n                                  {%- assign color_nickname = pair_parts[1] -%}\n                                  {%- break -%}\n                                {%- endif -%}\n                              {%- endif -%}\n                            {%- endfor -%}\n\n                            {%- comment %} Context-aware availability check: color + current other selections {%- endcomment -%}\n                            {%- assign color_is_available = false -%}\n                            {%- for variant in shsd_product_variants -%}\n                              {%- assign matches_color = false -%}\n                              {%- assign matches_other_options = true -%}\n\n                              {%- for opt_idx in (1..3) -%}\n                                {%- assign opt_key = 'option' | append: opt_idx -%}\n                                {%- assign variant_opt_val = variant[opt_key] -%}\n                                {%- if variant_opt_val != blank -%}\n                                  {%- assign variant_opt_handle = variant_opt_val | handle -%}\n\n                                  {%- comment %} Determine if this option index is the color option {%- endcomment -%}\n                                  {%- assign opt_idx_adjusted = opt_idx | minus: 1 -%}\n                                  {%- assign this_opt_name = product.options[opt_idx_adjusted] | downcase -%}\n\n                                  {%- if get_color contains this_opt_name -%}\n                                    {%- comment %} This is the color option - check if it matches our target color {%- endcomment -%}\n                                    {%- if variant_opt_handle == color_handle -%}\n                                      {%- assign matches_color = true -%}\n                                    {%- endif -%}\n                                  {%- else -%}\n                                    {%- comment %} This is a non-color option - check if variant matches current selection {%- endcomment -%}\n                                    {%- assign current_selected_val = product.selected_or_first_available_variant[opt_key] -%}\n                                    {%- if current_selected_val != blank -%}\n                                      {%- assign current_selected_handle = current_selected_val | handle -%}\n                                      {%- unless variant_opt_handle == current_selected_handle -%}\n                                        {%- assign matches_other_options = false -%}\n                                      {%- endunless -%}\n                                    {%- endif -%}\n                                  {%- endif -%}\n                                {%- endif -%}\n                              {%- endfor -%}\n\n                              {%- if matches_color and matches_other_options and variant.available -%}\n                                {%- assign color_is_available = true -%}\n                                {%- break -%}\n                              {%- endif -%}\n                            {%- endfor -%}\n\n                            {%- comment %} Compute available standard lengths for this color {%- endcomment -%}\n                            {%- assign avail_lengths = '' -%}\n                            {%- assign avail_lengths_seen = '' -%}\n                            {%- assign length_opt_key = 'option' | append: length_option_position -%}\n                            {%- if length_option_position > 0 and color_option_position > 0 -%}\n                              {%- for lv in shsd_product_variants -%}\n                                {%- assign v_color_key = 'option' | append: color_option_position -%}\n                                {%- assign v_color_val = lv[v_color_key] | handle -%}\n                                {%- if v_color_val == color_handle and lv.available -%}\n                                  {%- assign v_length_val = lv[length_opt_key] -%}\n                                  {%- if v_length_val != blank -%}\n                                    {%- assign is_custom_length = false -%}\n                                    {%- if custom_option_names -%}\n                                      {%- for custom_name in custom_option_names -%}\n                                        {%- assign custom_name_stripped = custom_name | strip -%}\n                                        {%- if v_length_val == custom_name_stripped -%}\n                                          {%- assign is_custom_length = true -%}\n                                          {%- break -%}\n                                        {%- endif -%}\n                                      {%- endfor -%}\n                                    {%- endif -%}\n                                    {%- unless is_custom_length -%}\n                                      {%- assign v_length_clean = v_length_val | replace: '\"', '' | strip -%}\n                                      {%- assign sentinel = '@@' | append: v_length_clean | append: '@@' -%}\n                                      {%- unless avail_lengths_seen contains sentinel -%}\n                                        {%- assign avail_lengths_seen = avail_lengths_seen | append: sentinel -%}\n                                        {%- if avail_lengths == '' -%}\n                                          {%- assign avail_lengths = v_length_clean -%}\n                                        {%- else -%}\n                                          {%- assign avail_lengths = avail_lengths | append: ', ' | append: v_length_clean -%}\n                                        {%- endif -%}\n                                      {%- endunless -%}\n                                    {%- endunless -%}\n                                  {%- endif -%}\n                                {%- endif -%}\n                              {%- endfor -%}\n                            {%- endif -%}\n\n                            <div\n                              data-swatch-item\n                class=\"t4s-swatch__btn-wrap{% if selected_value == value %} is--selected{% endif %}{% unless color_is_available %} is--soldout is--out-of-stock{% if avail_lengths != '' %} pfd-has-lengths{% endif %}{% endunless %}\"\n                              data-value=\"{{ value | escape }}\"\n                              data-available=\"{{ color_is_available }}\"\n                            >\n                              <div\n                                data-img-el\n                                class=\"t4s-swatch__item {{ color_swatch }}bg_color_{{ value | handle }} lazyloadt4s\"\n                              >\n                                <img crossorigin=\"anonymous\">\n                                {%- unless color_is_available -%}\n                                  <span class=\"t4s-swatch__restock-badge\">Awaiting Restock</span>\n                                {%- endunless -%}\n                              </div>\n                              {%- unless color_is_available -%}\n                                {%- if avail_lengths != '' -%}\n                                  <span class=\"t4s-swatch__available-lengths is-visible\">Available in {{ avail_lengths }}</span>\n                                {%- endif -%}\n                              {%- endunless -%}\n                              {%- if color_nickname != blank -%}\n                                <span class=\"t4s-swatch__nickname\">{{ color_nickname }}</span>\n                              {%- endif -%}\n                            </div>\n\n                          {%- endfor -%}\n\n                        {%- endif -%}\n                      {%- else -%}\n                        <button\n                          type=\"button\"\n                          data-dropdown-open\n                          data-position=\"bottom-end\"\n                          data-id=\"t4s_nt_{{ pr_sid }}{{ forloop.index }}\"\n                        >\n                          <span data-current-value>\n                            {{- selected_value | default: choose_an_option -}}\n                          </span>\n                          <svg\n                            class=\"t4s-icon-select-arrow\"\n                            role=\"presentation\"\n                            viewBox=\"0 0 19 12\"\n                          >\n                            <use xlink:href=\"#t4s-select-arrow\"></use>\n                          </svg>\n                        </button>\n                        <div\n                          data-dropdown-wrapper\n                          class=\"t4s-dropdown__wrapper t4s-current-scrollbar\"\n                          id=\"t4s_nt_{{ pr_sid }}{{ forloop.index }}\"\n                        >\n                          <div class=\"t4s-drop-arrow\"></div>\n                          <div class=\"t4s-dropdown__header\">\n                            <span\n                              data-current-value\n                              class=\"t4s-dropdown__title\"\n                            >\n                              {{- selected_value | default: choose_an_option -}}\n                            </span>\n                            <button\n                              data-dropdown-close\n                              aria-label=\"{{ 'general.aria.close' | t }}\"\n                            >\n                              <svg\n                                role=\"presentation\"\n                                class=\"t4s-iconsvg-close\"\n                                viewBox=\"0 0 16 14\"\n                              >\n                                <path d=\"M15 0L1 14m14 0L1 0\" stroke=\"currentColor\" fill=\"none\" fill-rule=\"evenodd\"></path>\n                              </svg>\n                            </button>\n                          </div>\n                          <div class=\"t4s-dropdown__content\">\n                            {%- for value in option.values -%}\n                              <div\n                                data-swatch-item\n                                data-dropdown-off\n                                class=\"t4s-swatch__item t4s-truncate {{ color_swatch }}bg_color_{{ value | handle }} lazyloadt4s{% if selected_value == value %} is--selected{% endif %}\"\n                                data-value=\"{{ value | escape }}\"\n                              >\n                                {{ value | replace: '\"', '' }}\n                              </div>\n                            {%- endfor -%}\n                          </div>\n                        </div>\n                      {%- endif -%}\n                    </div>\n                    {%- render 'color-info-accordion' -%}\n                  </div>\n                {%- else -%}\n                  {% comment %}--MARK: Non-Color{% endcomment %}\n                  {%- liquid\n                    assign standard_values = ''\n                    assign custom_values = ''\n                    assign has_standard = false\n                    assign has_custom = false\n\n                    for value in option.values\n                      assign is_custom = false\n                      for custom_name in custom_option_names\n                        assign custom_name_clean = custom_name | strip\n                        if value contains custom_name_clean\n                          assign is_custom = true\n                          break\n                        endif\n                      endfor\n\n                      if is_custom\n                        if custom_values == ''\n                          assign custom_values = value\n                        else\n                          assign custom_values = custom_values | append: ',' | append: value\n                        endif\n                        assign has_custom = true\n                      else\n                        if standard_values == ''\n                          assign standard_values = value\n                        else\n                          assign standard_values = standard_values | append: ',' | append: value\n                        endif\n                        assign has_standard = true\n                      endif\n                    endfor\n\n                    assign standard_values_array = standard_values | split: ','\n                    assign custom_values_array = custom_values | split: ','\n                  -%}\n\n                  <div\n                    data-swatch-option\n                    data-option-name=\"{{ option_name | escape }}\"\n                    data-id=\"{{ forloop.index0 }}\"\n                    data-option-unit=\"\n                      {%- liquid\n                        assign option_unit = ''\n                        if se_stts and se_stts.option_units and se_stts.option_units != blank\n                          assign option_units_raw = se_stts.option_units | strip | newline_to_br | split: '<br />'\n                          for pair in option_units_raw\n                            assign pair_cleaned = pair | strip\n                            if pair_cleaned contains ':'\n                              assign key_value = pair_cleaned | split: ':'\n                              assign key = key_value[0] | strip\n                              assign value = key_value[1] | strip\n                              if key == option_name and value != blank\n                                assign option_unit = value\n                                break\n                              endif\n                            endif\n                          endfor\n                        endif\n                      -%}{{ option_unit | escape }}\n                    \"\n                    class=\"t4s-swatch__option is-t4s-name__{{ option_name | handle }} pfd-split-option\"\n                  >\n                    <h4 class=\"t4s-swatch__title\">\n                      <span class=\"t4s-swatch__title--left\"\n                        >Select a\n                        <span class=\"bold\">\n                          {{- option_name -}}\n                        </span>\n                        {%- liquid\n                          assign option_unit = ''\n                          if se_stts and se_stts.option_units and se_stts.option_units != blank\n                            assign option_units_raw = se_stts.option_units | strip | newline_to_br | split: '<br />'\n                            for pair in option_units_raw\n                              assign pair_cleaned = pair | strip\n                              if pair_cleaned contains ':'\n                                assign key_value = pair_cleaned | split: ':'\n                                assign key = key_value[0] | strip\n                                assign value = key_value[1] | strip\n                                if key == option_name and value != blank\n                                  assign option_unit = value\n                                  break\n                                endif\n                              endif\n                            endfor\n                          endif\n                        -%}\n                        {%- if option_unit != blank %} ({{ option_unit }}){%- endif -%}\n                      </span>\n                      <span class=\"t4s-swatch__title--right\"\n                        >Selected:\n                        <span class=\"bold\">\n                          {%- assign display_value = selected_value | default: choose_an_option | replace: '\"', '' -%}\n                          {{- display_value -}}\n                          {%- if option_unit != blank %} {{ option_unit }}{%- endif -%}\n                        </span></span\n                      >\n                      {%- if name_sizeg == name_downcase -%}\n                        {{- html_sizeg -}}\n                      {%- endif %}\n                    </h4>\n\n                    <div class=\"pfd-split-selection\">\n                      {%- if has_standard -%}\n                        <div class=\"pfd-standard-options\">\n                          {%- if selector_mode != 'dropdown' -%}\n                            {%- for value in standard_values_array -%}\n                              <div\n                                data-swatch-item\n                                class=\"t4s-swatch__item{% if selected_value == value %} is--selected{% endif %}\"\n                                data-value=\"{{ value | escape }}\"\n                              >\n                                {{ value | replace: '\"', '' }}\n                              </div>\n                            {%- endfor -%}\n                          {%- else -%}\n                            <button\n                              type=\"button\"\n                              data-pfd-dropdown-open\n                              data-position=\"bottom-end\"\n                              data-id=\"t4s_nt_{{ pr_sid }}{{ forloop.index }}_standard\"\n                            >\n                              <span data-current-value>\n                                {{- selected_value | default: choose_an_option -}}\n                              </span>\n                              <svg\n                                class=\"t4s-icon-select-arrow\"\n                                role=\"presentation\"\n                                viewBox=\"0 0 19 12\"\n                              >\n                                <use xlink:href=\"#t4s-select-arrow\"></use>\n                              </svg>\n                            </button>\n                            <div\n                              data-dropdown-wrapper\n                              class=\"t4s-dropdown__wrapper t4s-current-scrollbar\"\n                              id=\"t4s_nt_{{ pr_sid }}{{ forloop.index }}_standard\"\n                            >\n                              <div class=\"t4s-drop-arrow\"></div>\n                              <div class=\"t4s-dropdown__content\">\n                                {%- for value in standard_values_array -%}\n                                  <div\n                                    data-swatch-item\n                                    data-dropdown-off\n                                    class=\"t4s-swatch__item t4s-truncate{% if selected_value == value %} is--selected{% endif %}\"\n                                    data-value=\"{{ value | escape }}\"\n                                  >\n                                    {{ value | replace: '\"', '' }}\n                                  </div>\n                                {%- endfor -%}\n                              </div>\n                            </div>\n                          {%- endif -%}\n                        </div>\n                      {%- endif -%}\n\n                      {%- if has_custom -%}\n                        <div class=\"pfd-custom-options\">\n                          {%- if has_standard and has_custom -%}\n                            <span class=\"pfd-or-separator\">or</span>\n                          {%- endif -%}\n                          <button\n                            type=\"button\"\n                            data-pfd-dropdown-open\n                            data-position=\"bottom-end\"\n                            data-id=\"t4s_nt_{{ pr_sid }}{{ forloop.index }}_custom\"\n                            class=\"pfd-custom-dropdown\"\n                          >\n                            <span data-current-value>\n                              {%- assign is_custom_selected = false -%}\n                              {%- for custom_val in custom_values_array -%}\n                                {%- if selected_value == custom_val -%}\n                                  {%- assign display_custom_val = custom_val | replace: '\"', '' -%}\n                                  {%- if option_unit != blank -%}\n                                    {{ display_custom_val }}\n                                    {{ option_unit }}\n                                    <span class=\"pfd-custom-badge\">Custom</span>\n                                  {%- else -%}\n                                    {{ display_custom_val }}\n                                    <span class=\"pfd-custom-badge\">Custom</span>\n                                  {%- endif -%}\n                                  {%- assign is_custom_selected = true -%}\n                                  {%- break -%}\n                                {%- endif -%}\n                              {%- endfor -%}\n                              {%- unless is_custom_selected -%}\n                                Custom {{ option_name | downcase }}\n                              {%- endunless -%}\n                            </span>\n                            <svg\n                              class=\"t4s-icon-select-arrow\"\n                              role=\"presentation\"\n                              viewBox=\"0 0 19 12\"\n                            >\n                              <use xlink:href=\"#t4s-select-arrow\"></use>\n                            </svg>\n                          </button>\n                          <div\n                            data-dropdown-wrapper\n                            class=\"t4s-dropdown__wrapper t4s-current-scrollbar\"\n                            id=\"t4s_nt_{{ pr_sid }}{{ forloop.index }}_custom\"\n                          >\n                            <div class=\"t4s-drop-arrow\"></div>\n                            <div class=\"t4s-dropdown__content\">\n                              {%- for value in custom_values_array -%}\n                                <div\n                                  data-swatch-item\n                                  data-dropdown-off\n                                  class=\"t4s-swatch__item t4s-truncate{% if selected_value == value %} is--selected{% endif %}\"\n                                  data-value=\"{{ value | escape }}\"\n                                >\n                                  <span class=\"pfd-checkmark\">✓</span>\n                                  <span class=\"pfd-option-text\">\n                                    {%- assign display_value = value | replace: '\"', '' -%}\n                                    {%- if option_unit != blank -%}\n                                      {{ display_value }}\n                                      {{ option_unit }}\n                                    {%- else -%}\n                                      {{ display_value }}\n                                    {%- endif -%}\n                                  </span>\n                                  <span class=\"pfd-custom-badge\">Custom</span>\n                                </div>\n                              {%- endfor -%}\n                            </div>\n                          </div>\n                        </div>\n                      {%- endif -%}\n\n                      {%- unless has_standard or has_custom -%}\n                        {%- comment %} Fallback to original rendering if no split detected {%- endcomment %}\n                        <div class=\"t4s-swatch__list pfd-fallback-list\">\n                          {%- if selector_mode != 'dropdown' -%}\n                            {%- for value in option.values -%}\n                              <div\n                                data-swatch-item\n                                class=\"t4s-swatch__item{% if selected_value == value %} is--selected{% endif %}\"\n                                data-value=\"{{ value | escape }}\"\n                              >\n                                {{ value | replace: '\"', '' }}\n                              </div>\n                            {%- endfor -%}\n                          {%- else -%}\n                            <button\n                              type=\"button\"\n                              data-pfd-dropdown-open\n                              data-position=\"bottom-end\"\n                              data-id=\"t4s_nt_{{ pr_sid }}{{ forloop.index }}\"\n                            >\n                              <span data-current-value>\n                                {{- selected_value | default: choose_an_option -}}\n                              </span>\n                              <svg\n                                class=\"t4s-icon-select-arrow\"\n                                role=\"presentation\"\n                                viewBox=\"0 0 19 12\"\n                              >\n                                <use xlink:href=\"#t4s-select-arrow\"></use>\n                              </svg>\n                            </button>\n                            <div\n                              data-dropdown-wrapper\n                              class=\"t4s-dropdown__wrapper t4s-current-scrollbar\"\n                              id=\"t4s_nt_{{ pr_sid }}{{ forloop.index }}\"\n                            >\n                              <div class=\"t4s-drop-arrow\"></div>\n                              <div class=\"t4s-dropdown__content\">\n                                {%- for value in option.values -%}\n                                  <div\n                                    data-swatch-item\n                                    data-dropdown-off\n                                    class=\"t4s-swatch__item t4s-truncate{% if selected_value == value %} is--selected{% endif %}\"\n                                    data-value=\"{{ value | escape }}\"\n                                  >\n                                    {{ value | replace: '\"', '' }}\n                                  </div>\n                                {%- endfor -%}\n                              </div>\n                            </div>\n                          {%- endif -%}\n                        </div>\n                      {%- endunless -%}\n                    </div>\n\n                    {%- comment %} Custom order notice - shown when custom option is selected {%- endcomment %}\n                    {%- assign show_custom_notice = false -%}\n                    {%- for custom_val in custom_values_array -%}\n                      {%- if selected_value == custom_val -%}\n                        {%- assign show_custom_notice = true -%}\n                        {%- break -%}\n                      {%- endif -%}\n                    {%- endfor -%}\n                    <div\n                      class=\"pfd-custom-notice\"\n                      style=\"display: {% if show_custom_notice %}block{% else %}none{% endif %};\"\n                    >\n                      <div class=\"pfd-custom-notice-content\">\n                        <svg\n                          class=\"pfd-custom-notice-icon\"\n                          xmlns=\"http://www.w3.org/2000/svg\"\n                          width=\"24\"\n                          height=\"24\"\n                          viewBox=\"0 0 24 24\"\n                          fill=\"none\"\n                          stroke=\"currentColor\"\n                          stroke-width=\"2\"\n                          stroke-linecap=\"round\"\n                          stroke-linejoin=\"round\"\n                        >\n                          <circle cx=\"12\" cy=\"12\" r=\"10\"></circle>\n                          <polyline points=\"12 6 12 12 16 14\"></polyline>\n                        </svg>\n                        <p class=\"pfd-custom-notice-text\">\n                          Custom {{ option_name | downcase }}s are <strong>made to order</strong>. Please allow\n                          <span class=\"pfd-custom-notice-highlight\">6-8 weeks</span> for delivery.\n                        </p>\n                      </div>\n                    </div>\n\n                    {%- comment %} Configuration-based custom content for options {%- endcomment %}\n                    {%- comment %} Renders ALL matching option content, shows only the selected one {%- endcomment %}\n                    {%- assign option_name_lower = option_name | downcase -%}\n                    {%- assign selected_value_lower = selected_value | downcase -%}\n\n                    {%- capture all_option_info -%}\n  {%- for pair in option_content_pairs -%}\n    {%- assign pair_cleaned = pair | strip -%}\n    {%- if pair_cleaned contains '|' -%}\n      {%- assign parts = pair_cleaned | split: '|' -%}\n      {%- assign option_key_full = parts[0] | strip -%}\n      {%- assign content_value = parts[1] | strip -%}\n\n      {%- if option_key_full contains ':' -%}\n        {%- assign key_parts = option_key_full | split: ':' -%}\n        {%- assign option_key = key_parts[0] | strip | downcase -%}\n        {%- assign value_key = key_parts[1] | strip -%}\n        {%- assign value_key_lower = value_key | downcase -%}\n\n        {%- if option_name_lower == option_key -%}\n          {%- assign is_selected = false -%}\n          {%- if selected_value_lower == value_key_lower -%}\n            {%- assign is_selected = true -%}\n          {%- endif -%}\n          <div class=\"pfd-option-info-item\"\n               data-option-name=\"{{ option_name_lower }}\"\n               data-option-value=\"{{ value_key | handle }}\"\n               style=\"{% unless is_selected %}display: none;{% endunless %}\">\n            {{ content_value }}\n          </div>\n        {%- endif -%}\n      {%- endif -%}\n    {%- endif -%}\n  {%- endfor -%}\n{%- endcapture -%}\n\n                    {%- assign all_option_info_stripped = all_option_info | strip -%}\n                    {%- if all_option_info_stripped != blank -%}\n                      <div class=\"pfd-custom-option-info\" data-option-info-container=\"{{ option_name_lower }}\">\n                        {{ all_option_info }}\n                      </div>\n                    {%- endif -%}\n                  </div>\n                {%- endif -%}\n              {%- endfor -%}\n            </div>\n          {%- endif -%}\n\n          {%- liquid\n            if arr_properties.size > 0 and isProductAvailable\n              render 'frm_properties', arr_properties: arr_properties, product: product\n            endif\n          -%}\n\n          {%- if use_incoming_mess\n            and current_variant_incoming\n            and pr_variants.size == 1\n            and current_variant.next_incoming_date != blank\n          -%}\n            {%- assign format_date = current_variant.next_incoming_date | date: date_in -%}\n            {%- comment -%}<div class=\"t4s-incoming__mess\"><!-- will_not_ship_until / will_be_in_stock_after --></div>{%- endcomment -%}\n\n          {%- elsif use_incoming_mess and pr_variants.size > 1 -%}\n            {%- liquid\n              assign format_date = current_variant.next_incoming_date | date: date_in\n              unless format_date\n                assign format_date = '19041994'\n              endunless\n            -%}\n            {% comment %}<div data-incoming__mess class=\"t4s-incoming__mess\"{% unless current_variant_incoming %} hidden{% endunless %}><span data-incoming-available{% if current_variant_available == false or current_variant == blank %} style=\"display: none\"{% endif %}>{{ 'products.product_single.will_not_ship_until_html' | t: date: format_date }}</span><span data-incoming-soldout{% if current_variant_available or current_variant == blank %} style=\"display: none\"{% endif %}>{{ 'products.product_single.will_be_in_stock_after_html' | t: date: format_date }}</span></div>{% endcomment %}\n          {%- endif -%}\n\n          {{ 'button-style.css' | asset_url | stylesheet_tag }}\n          <link\n            href=\"{{ 'custom-effect.css' | asset_url }}\"\n            rel=\"stylesheet\"\n            media=\"print\"\n            onload=\"this.media='all'\"\n          >\n\n          {{- html_price -}}\n\n          <div\n            class=\"t4s-product-form__buttons\"\n            style=\"--pr-btn-round: {{ bk_stts.pr_btn_round }}px;--wis-cp-btn-round: {{ bk_stts.wis_cp_btn_round }}px;\"\n          >\n            <div class=\"t4s-pr__qty_cart t4s-d-flex t4s-flex-wrap\">\n              {%- if isExternal -%}\n                <a\n                  href=\"{{ external_link }}\"\n                  rel=\"nofollow\"\n                  target=\"_blank\"\n                  class=\"t4s-product-form__submit t4s-btn t4s-btn-base t4s-btn-style-{{ bk_stts.button_style }} t4s-btn-color-{{ bk_stts.button_color }} t4s-w-100 t4s-justify-content-center {% if bk_stts.button_style == 'default' or bk_stts.button_style == 'outline' %} t4s-btn-effect-{{ bk_stts.button_effect }}{% endif %} t4s-truncate is--btn-external t4s-btn-loading__svg\"\n                >\n                  {%- if bk_stts.btn_icon -%}\n                    <svg class=\"t4s-btn-icon\" viewBox=\"0 0 24 24\">\n                      <use xlink:href=\"#t4s-icon-atc\"></use>\n                    </svg>\n                  {%- endif -%}\n                  <span class=\"t4s-btn-atc_text\">\n                    {{- external_title -}}\n                  </span>\n                  <span class=\"t4s-loading__spinner\" hidden>\n                    <svg\n                      width=\"16\"\n                      height=\"16\"\n                      hidden\n                      class=\"t4s-svg-spinner\"\n                      focusable=\"false\"\n                      role=\"presentation\"\n                      viewBox=\"0 0 66 66\"\n                      xmlns=\"http://www.w3.org/2000/svg\"\n                    >\n                      <circle class=\"t4s-path\" fill=\"none\" stroke-width=\"6\" cx=\"33\" cy=\"33\" r=\"30\"></circle>\n                    </svg>\n                  </span>\n                </a>\n              {%- else -%}\n                {%- if bk_stts.show_qty and isProductAvailable -%}\n                  <div\n                    data-quantity-wrapper\n                    class=\"t4s-quantity-wrapper t4s-product-form__qty\"\n                  >\n                    <button\n                      data-quantity-selector\n                      data-decrease-qty\n                      type=\"button\"\n                      class=\"t4s-quantity-selector is--minus\"\n                    ></button>\n                    <input\n                      data-quantity-value\n                      type=\"number\"\n                      class=\"t4s-quantity-input\"\n                      step=\"1\"\n                      min=\"{{cus_qty}}\"\n                      max=\"{{max_qty}}\"\n                      name=\"quantity\"\n                      value=\"{{cus_qty}}\"\n                      size=\"4\"\n                      pattern=\"[0-9]*\"\n                      inputmode=\"numeric\"\n                    >\n                    <button\n                      data-quantity-selector\n                      data-increase-qty\n                      type=\"button\"\n                      class=\"t4s-quantity-selector is--plus\"\n                    ></button>\n                  </div>\n                {%- else -%}\n                  <input type=\"hidden\" name=\"quantity\" value=\"1\">\n                {%- endif -%}\n                {% if customer %}\n                  <button\n                    data-animation-atc='{ \"ani\": \"{{ bk_stts.ani }}\",\"time\": {{ bk_stts.time }}000 }'\n                    type=\"submit\"\n                    name=\"add\"\n                    data-atc-form\n                    class=\"t4s-product-form__submit t4s-btn t4s-btn-base t4s-btn-style-{{ bk_stts.button_style }} t4s-btn-color-{{ bk_stts.button_color }} t4s-w-100 t4s-justify-content-center {% if bk_stts.button_style == 'default' or bk_stts.button_style == 'outline' %} t4s-btn-effect-{{ bk_stts.button_effect }}{% endif %} t4s-btn-loading__svg\"\n                    {% unless current_variant_available %}\n                      aria-disabled=\"true\"\n                    {% endunless -%}\n                    {% unless isProductAvailable %}\n                      disabled=\"disabled\"\n                    {% endunless %}\n                  >\n                    {%- if bk_stts.btn_icon -%}\n                      <svg\n                        class=\"t4s-btn-icon\"\n                        viewBox=\"0 0 24 24\"\n                      >\n                        <use xlink:href=\"#t4s-icon-atc\"></use>\n                      </svg>\n                    {%- endif -%}\n                    <span class=\"t4s-btn-atc_text\">\n                      {%- if current_variant_available == false or isProductAvailable == false -%}\n                        {{- 'products.product.sold_out' | t -}}\n                      {%- elsif isPreoder -%}\n                        {{- 'products.product.pre_order' | t }}\n                      {%- else -%}\n                        {{ 'products.product.add_to_cart' | t }}\n                      {%- endif -%}\n                    </span>\n                    <span class=\"t4s-loading__spinner\" hidden>\n                      <svg\n                        width=\"16\"\n                        height=\"16\"\n                        hidden\n                        class=\"t4s-svg-spinner\"\n                        focusable=\"false\"\n                        role=\"presentation\"\n                        viewBox=\"0 0 66 66\"\n                        xmlns=\"http://www.w3.org/2000/svg\"\n                      >\n                        <circle class=\"t4s-path\" fill=\"none\" stroke-width=\"6\" cx=\"33\" cy=\"33\" r=\"30\"></circle>\n                      </svg>\n                    </span>\n                  </button>\n                {% else %}\n                  <a\n                    href=\"/account/login\"\n                    onclick=\"rememberPage(event)\"\n                    data-drawer-delay-\n                    data-drawer-options='{ \"id\": \"#t4s-login-sidebar\" }'\n                    class=\"atc-btn t4s-btn t4s-btn-base t4s-btn-style-default t4s-btn-color-dark t4s-w-100 t4s-justify-content-center t4s-btn-effect-sweep-to-right t4s-btn-loading__svg\"\n                  >\n                    <svg\n                      class=\"t4s-btn-icon\"\n                      viewBox=\"0 0 24 24\"\n                      style=\"margin-right:4px\"\n                    >\n                      <use xlink:href=\"#t4s-icon-atc\"></use>\n                    </svg>\n                    <span class=\"t4s-btn-atc_text\">Login to Shop</span>\n                    <span class=\"t4s-loading__spinner\" hidden=\"\">\n                      <svg\n                        width=\"16\"\n                        height=\"16\"\n                        hidden=\"\"\n                        class=\"t4s-svg-spinner\"\n                        focusable=\"false\"\n                        role=\"presentation\"\n                        viewBox=\"0 0 66 66\"\n                        xmlns=\"http://www.w3.org/2000/svg\"\n                      >\n                        <circle class=\"t4s-path\" fill=\"none\" stroke-width=\"6\" cx=\"33\" cy=\"33\" r=\"30\"></circle>\n                      </svg>\n                    </span>\n                  </a>\n                {% endif %}\n              {%- endif -%}\n            </div>\n            {%- if PR_buy_pr and type != 'main_sticky' %}\n              {{- form | payment_button -}}\n            {% endif -%}\n            {%- if settings.use_notify_me -%}\n              {% if customer -%}\n                <button\n                  data-class=\"t4s-mfp-btn-close-inline\"\n                  data-id=\"t4s-pr-popup__notify-stock\"\n                  data-storageid=\"notify-stock{{ current_variant.id }}\"\n                  data-mfp-src\n                  data-open-mfp-ajax\n                  class=\"t4s-pr__notify-stock{% if current_variant_available or current_variant == blank %} t4s-d-none{% endif %}\"\n                  type=\"button\"\n                  data-notify-stock-btn\n                  data-variant-id=\"{{ current_variant.id }}\"\n                  data-root-url=\"{{ routes.root_url }}\"\n                >\n                  {{ 'products.notify_stock.trigger' | t }}\n                </button>\n              {%- endif %}\n            {%- endif -%}\n            {%- if bk_stts.enable_wishlist or bk_stts.enable_compare -%}\n              <div class=\"t4s-pr__wis_cp\">\n                {%- render 't4s_wis_cp', product: product, bk_stts: bk_stts, disableTooltip: true -%}\n              </div>\n            {%- endif -%}\n          </div>\n        {%- endform -%}\n        {%- unless isProductDefault or type == 'main_sticky' -%}\n          <script type=\"application/json\" class=\"pr_variants_json\">\n            {{ shsd_product_variants | json }}\n          </script>\n          <script type=\"application/json\" class=\"pr_options_json\">\n            {{ shsd_product_options_with_values | json }}\n          </script>\n        {%- endunless -%}\n        {%- if bk_stts.ani != 'none' -%}\n          <link\n            href=\"{{ 'ani-atc.min.css' | asset_url }}\"\n            rel=\"stylesheet\"\n            media=\"print\"\n            onload=\"this.media='all'\"\n          >\n        {%- endif -%}\n      </div>\n    </div>\n  </div>\n\n  <script>\n    (function () {\n      'use strict';\n\n      function updateOptionInfo(container, selectedValue) {\n        var optionName = container.getAttribute('data-option-name');\n        if (!optionName) return;\n        optionName = optionName.toLowerCase();\n\n        var infoContainer = container.querySelector('[data-option-info-container=\"' + optionName + '\"]');\n        if (!infoContainer) return;\n\n        var valueHandle = selectedValue\n          .toLowerCase()\n          .replace(/\\s+/g, '-')\n          .replace(/[^a-z0-9-]/g, '');\n        var infoItems = infoContainer.querySelectorAll('.pfd-option-info-item');\n\n        infoItems.forEach(function (item) {\n          var itemValue = item.getAttribute('data-option-value');\n          item.style.display = itemValue === valueHandle ? '' : 'none';\n        });\n      }\n\n      function initOptionInfoHandler() {\n        var swatchContainers = document.querySelectorAll('[data-swatch-option]');\n\n        swatchContainers.forEach(function (container) {\n          // Method 1: MutationObserver for instant updates\n          var observer = new MutationObserver(function (mutations) {\n            mutations.forEach(function (mutation) {\n              if (mutation.type === 'attributes' && mutation.attributeName === 'class') {\n                var target = mutation.target;\n                if (target.classList.contains('is--selected') && target.hasAttribute('data-value')) {\n                  var selectedValue = target.getAttribute('data-value');\n                  updateOptionInfo(container, selectedValue);\n                }\n              }\n            });\n          });\n\n          observer.observe(container, {\n            attributes: true,\n            subtree: true,\n            attributeFilter: ['class'],\n          });\n\n          // Method 2: Backup click handler with small delay\n          var swatchItems = container.querySelectorAll('[data-swatch-item]');\n          swatchItems.forEach(function (swatch) {\n            swatch.addEventListener('click', function () {\n              var selectedValue = this.getAttribute('data-value');\n              if (!selectedValue) return;\n              setTimeout(function () {\n                updateOptionInfo(container, selectedValue);\n              }, 10);\n            });\n          });\n        });\n      }\n\n      if (document.readyState === 'loading') {\n        document.addEventListener('DOMContentLoaded', initOptionInfoHandler);\n      } else {\n        initOptionInfoHandler();\n      }\n\n      document.addEventListener('shopify:section:load', initOptionInfoHandler);\n    })();\n  </script>\n</div>\n{%- if PR_buy_pr and current_variant_available != true and type != 'main_sticky' -%}\n  <style>\n    #t4s-callBackVariant{{ product_form_id }} .shopify-payment-button { display: none;}\n  </style>\n{% endif -%}\n",
              "reasoning": "Replace single-line comment block that contained nested Liquid if/endif tags (which the linter flags as mismatched) with a safecomment-balanced block containing only HTML comment text."
            },
            "result": "(no result received)",
            "isError": true,
            "elapsedMs": 0
          },
          {
            "name": "edit_lines",
            "id": "toolu_01XRgJdjeMTHNMuuX2NPiRbG",
            "input": {
              "filePath": "snippets/product-form-dynamic.liquid",
              "startLine": 1045,
              "endLine": 1045,
              "newContent": "            {%- comment -%}<div class=\"t4s-incoming__mess\"><!-- will_not_ship_until / will_be_in_stock_after --></div>{%- endcomment -%}\n",
              "reasoning": "Replace single-line comment block that contained nested Liquid if/endif tags (which the linter flags as mismatched) with a safecomment-balanced block containing only HTML comment text."
            },
            "result": "(no result received)",
            "isError": true,
            "elapsedMs": 0
          },
          {
            "name": "propose_code_edit",
            "id": "pm-change-1772178238829",
            "input": {
              "filePath": "product-form-dynamic.liquid",
              "newContent": "{% comment %} Custom options configuration - options listed here will render as dropdowns {% endcomment %}\n{% assign custom_option_names = product.metafields.custom.custom_values.value %}\n\n{% comment %} Custom content configuration for specific options {% endcomment %}\n{% comment %} Format: option_name:option_value|<html content> - separated by semicolons for multiple {% endcomment %}\n\n{% assign option_content_config = 'texture:Straight|<div class=\"pfd-info-content\"><span class=\"pfd-info-icon\">i</span><span class=\"pfd-info-text\">Our straight texture has slight natural wave texture to it when washed and dried. It is not pin straight hair, nor is that desirable among most clientele.</span></div>;texture:Natural Wave|<div class=\"pfd-info-content\"><span class=\"pfd-info-icon\">i</span><span class=\"pfd-info-text\">Our natural wave texture features soft, beachy waves that blend seamlessly with most natural hair textures. Low maintenance and versatile for everyday styling.</span></div>;texture:Loose Curl|<div class=\"pfd-info-content\"><span class=\"pfd-info-icon\">i</span><span class=\"pfd-info-text\">Our loose curl texture offers bouncy, defined curls that hold their shape beautifully. Perfect for adding volume and movement with minimal styling required.</span></div>;texture:Tight Curl|<div class=\"pfd-info-content\"><span class=\"pfd-info-icon\">i</span><span class=\"pfd-info-text\">Our tight curl texture provides well-defined, springy curls with maximum volume. Ideal for protective styles and blending with naturally curly hair.</span></div>' %}\n\n{% assign option_content_pairs = option_content_config | split: ';' %}\n\n{% comment %} SellersDash collect child product details {% endcomment %}\n{% assign shsd_product_details = product.metafields.sellersdash.shsdproducts %}\n{% if shsd_product_details.product_type == 'shsd_parent' %}\n  {% assign shsd_product_handles = product.handle %}\n  {% assign shsd_product_handles = shsd_product_handles | concat: shsd_product_details.handles %}\n  {% for shsd_handle in shsd_product_handles %}\n    {% assign shsd_single_product = all_products[shsd_handle] %}\n    {% assign shsd_product_variants = shsd_product_variants | concat: shsd_single_product.variants %}\n    {% assign shsd_product_media = shsd_product_media | concat: shsd_single_product.media %}\n    {% assign shsd_product_images = shsd_product_images | concat: shsd_single_product.images %}\n  {% endfor %}\n  {% assign shsd_product_options_with_values = shsd_product_details.options_with_values %}\n{% else %}\n  {% assign shsd_product_options_with_values = product.options_with_values %}\n  {% assign shsd_product_variants = product.variants %}\n  {% assign shsd_product_media = product.media %}\n  {% assign shsd_product_images = product.images %}\n{% endif %}\n\n{% comment %} Reorder options: Length, Texture, Color, then remaining {% endcomment %}\n{% assign reordered_options = '' | split: '' %}\n{% assign remaining_options = '' | split: '' %}\n\n{% for option in shsd_product_options_with_values %}\n  {% assign opt_name_lower = option.name | downcase | strip %}\n  {% if opt_name_lower == 'length' %}\n    {% assign length_slice = shsd_product_options_with_values | slice: forloop.index0, 1 %}\n  {% elsif opt_name_lower == 'texture' %}\n    {% assign texture_slice = shsd_product_options_with_values | slice: forloop.index0, 1 %}\n  {% elsif opt_name_lower == 'color' or opt_name_lower == 'colour' or opt_name_lower == 'colors' %}\n    {% assign color_slice = shsd_product_options_with_values | slice: forloop.index0, 1 %}\n  {% else %}\n    {% assign other_slice = shsd_product_options_with_values | slice: forloop.index0, 1 %}\n    {% assign remaining_options = remaining_options | concat: other_slice %}\n  {% endif %}\n{% endfor %}\n\n{% if length_slice %}\n  {% assign reordered_options = reordered_options | concat: length_slice %}\n{% endif %}\n{% if texture_slice %}\n  {% assign reordered_options = reordered_options | concat: texture_slice %}\n{% endif %}\n{% if color_slice %}\n  {% assign reordered_options = reordered_options | concat: color_slice %}\n{% endif %}\n{% assign shsd_product_options_with_values = reordered_options | concat: remaining_options %}\n\n{%- assign product_form_id = 'product-form-' | append: pr_sid -%}\n{%- liquid\n  assign pr_variants = shsd_product_variants\n  assign PR_buy_pr = false\n  if bk_stts.show_dynamic_checkout and isExternal == false and isProductAvailable\n    assign PR_buy_pr = true\n  endif\n  assign choose_an_option = 'products.product.choose_an_option' | t\n  assign date_in = settings.date_in\n  assign class_frm = 't4s-form__product has--form__swatch'\n  if isProductDefault\n    assign class_frm = 't4s-form__product'\n  endif\n  if arr_properties.size > 0 and isProductAvailable\n    assign class_frm = class_frm | append: ' has--properties'\n  endif\n  if settings.sticky_atc and type == 'main'\n    assign class_frm = class_frm | append: ' is--main-sticky'\n  else\n    assign class_frm = class_frm | append: ' is--atc-sticky'\n  endif\n\n  assign color_swatch = 'disabled-'\n  assign color_mode = bk_stts.color_mode\n  assign selector_mode = bk_stts.selector_mode\n  assign stt_color_ck = settings.color_ck | default: ';'\n  assign color_ck = stt_color_ck | append: ',color,colors,couleur,colour' | remove: ';,'\n  assign get_color = color_ck | downcase | replace: ' ,', ',' | replace: ', ', ',' | split: ',' | uniq\n  assign color_mode_list = 'color, color is-sw-cl__round, color is-sw-cl__round is-sw-cl__label, variant_image, variant_image is-sw-cl__round, variant_image is-sw-cl__round is-sw-cl__label' | split: ', '\n  if color_mode_list contains color_mode\n    assign color_swatch = 'is-sw__color '\n  endif\n  assign current_variant_available = current_variant.available\n  assign use_incoming_mess = settings.use_incoming_mess\n  assign current_variant_incoming = false\n  assign current_inventory_quantity = current_variant.inventory_quantity\n  if current_inventory_quantity <= 0 and current_variant.inventory_management == 'shopify' and current_variant.incoming\n    assign current_variant_incoming = true\n  endif\n  if pos_sizeg == '1'\n    assign html_sizeg = ''\n  endif\n  if current_variant.inventory_management != null and current_inventory_quantity > 0 and current_variant.inventory_policy != 'continue'\n    assign max_qty = current_inventory_quantity\n  else\n    assign max_qty = 9999\n  endif\n  if color_mode contains 'color' or color_mode contains 'variant'\n    assign show_tooltip = ''\n  else\n    assign show_tooltip = '-off'\n  endif\n-%}\n\n{%- if product.metafields.custom.default_variant.value -%}\n  <script>\n    window.__HAS_SELECTED__ = {{ product.selected_variant | json }};\n    window.__DEFAULT_VARIANT__ = {{ product.metafields.custom.default_variant.value | json }};\n  </script>\n{%- endif -%}\n\n{%- assign length_option_position = -1 -%}\n{%- assign color_option_position = -1 -%}\n{%- for opt_name in product.options -%}\n  {%- assign opt_name_down = opt_name | downcase -%}\n  {%- if opt_name_down == 'length' -%}\n    {%- assign length_option_position = forloop.index -%}\n  {%- endif -%}\n  {%- if get_color contains opt_name_down -%}\n    {%- assign color_option_position = forloop.index -%}\n  {%- endif -%}\n{%- endfor -%}\n\n<script>\n  window.__CUSTOM_OPTION_NAMES__ = {{ custom_option_names | json }};\n  window.__LENGTH_OPTION_INDEX__ = {{ length_option_position | minus: 1 }};\n</script>\n\n{%- comment -%} Load dropdown CSS if either color mode or selector mode is dropdown {%- endcomment -%}\n\n{%- if color_mode == 'dropdown' or selector_mode == 'dropdown' -%}\n  <link\n    rel=\"stylesheet\"\n    href=\"{{ 'base_drop.min.css' | asset_url }}\"\n    media=\"all\"\n  >\n{%- endif -%}\n\n{%- comment -%} Custom CSS for product form dynamic {%- endcomment -%}\n{{ 'product-form-dynamic.css' | asset_url | stylesheet_tag }}\n\n<div class=\"pfd-override-wrapper\">\n  <div class=\"pfd-custom-wrapper\">\n    <div\n      class=\"t4s-product-form__variants is-no-pick__{{ PR_no_pick }}{% if PR_buy_pr %} is-payment-btn-true t4s-payment-button t4s-btn-color-{{ bk_stts.button_color_payment }}{% endif %} is-remove-soldout-{{ remove_soldout }} is-btn-full-width__{{ bk_stts.btn_atc_full }} is-btn-atc-txt-{{ bk_stts.btn_txt }} is-btn-ck-txt-{{ bk_stts.btn_txt2 }} is--fist-ratio-{{ is_fit_ratio_img }}\"\n      style=\"{% if is_fit_ratio_img %} --fit-ratio-img: {{ first_ratio_img }}; {% endif %} --wishlist-color: {{bk_stts.wishlist_color}};--wishlist-hover-color: {{bk_stts.wishlist_color_hover}};--wishlist-active-color: {{bk_stts.wishlist_color_active}};--compare-color: {{bk_stts.compare_color}};--compare-hover-color: {{bk_stts.compare_color_hover}};--compare-active-color: {{bk_stts.compare_color_active}};\"\n      {{ shopify_attributes }}\n    >\n      <div data-callBackVariant id=\"t4s-callBackVariant{{ product_form_id }}\">\n        {%- form 'product',\n          product,\n          id: product_form_id,\n          data-productid: product.id,\n          class: class_frm,\n          novalidate: 'novalidate',\n          data-type: 'add-to-cart-form',\n          data-disable-swatch: isProductDefault\n        -%}\n          {% comment %}{{- form | payment_terms -}}{% endcomment %}\n          {%- if isProductDefault -%}\n            <input\n              name=\"id\"\n              value=\"{{ pr_variants.first.id }}\"\n              type=\"hidden\"\n            >\n            {%- if advance_pr_type != blank -%}\n              {%- render 'choose_style', advance_pr_type: advance_pr_type, title: advance_label, pid: product.id -%}\n            {%- endif -%}\n          {%- else -%}\n            {{ 'swatch.css' | asset_url | stylesheet_tag }}\n            <select\n              name=\"id\"\n              id=\"product-select-{{ pr_sid }}\"\n              class=\"t4s-product__select t4s-d-none\"\n            >\n              {%- for variant in pr_variants -%}\n                {%- if variant.available -%}\n                  <option\n                    data-option1=\"{{ variant.option1 }}\"\n                    data-option2=\"{{ variant.option2 }}\"\n                    value=\"{{ variant.id }}\"\n                    data-mdid=\"{{ variant.featured_media.id | json }}\"\n                    data-incoming=\"{{ variant.incoming }}\"\n                    data-inventoryQuantity=\"{{ variant.inventory_quantity | json }}\"\n                    data-inventoryPolicy=\"{{ variant.inventory_policy | json }}\"\n                    data-nextIncomingDate=\"{{ variant.next_incoming_date | date: date_in }}\"\n                    {% if variant.id == current_variant.id %}\n                      selected=\"selected\"\n                    {% endif %}\n                  >\n                    {{ variant.title | escape }}\n                  </option>\n                {%- else -%}\n                  <option\n                    data-option1=\"{{ variant.option1 }}\"\n                    data-option2=\"{{ variant.option2 }}\"\n                    value=\"{{ variant.id }}\"\n                    data-mdid=\"{{ variant.featured_media.id | json }}\"\n                    data-incoming=\"{{ variant.incoming }}\"\n                    data-inventoryQuantity=\"{{ variant.inventory_quantity | json }}\"\n                    data-inventoryPolicy=\"{{ variant.inventory_policy | json }}\"\n                    data-nextIncomingDate=\"{{ variant.next_incoming_date | date: date_in }}\"\n                  >\n                    {{ variant.title | escape }}\n                  </option>\n                {%- endif -%}\n              {%- endfor -%}\n            </select>\n\n            <div class=\"pfd-variant-images\" style=\"display:none !important;\">\n              <div class=\"pfd-main-imgs\">\n                {%- for variant in pr_variants -%}\n                  {% assign var_imgs = variant.metafields.custom.variant_image.value %}\n                  <div\n                    class=\"pfd-img-listing\"\n                    data-var-img=\"{{ variant.image.src | img_url: 'master' }}\"\n                    data-pfd-variant-id=\"{{ variant.id }}\"\n                  >\n                    {% for value in var_imgs %}\n                      <div class=\"pfd-media-item\">\n                        <img src=\"{{value | img_url: 'master'}}\">\n                      </div>\n                    {% endfor %}\n                  </div>\n                {%- endfor -%}\n              </div>\n              <div class=\"pfd-thumb-imgs\">\n                {%- for variant in pr_variants -%}\n                  {% assign var_imgs = variant.metafields.custom.variant_image.value %}\n                  <div class=\"pfd-img-listing\" data-pfd-variant-id=\"{{ variant.id }}\">\n                    {% for value in var_imgs %}\n                      <div class=\"pfd-media-thumb\">\n                        <div\n                          class=\"pfd-img\"\n                          style=\"background-image:url('{{value | img_url: \"master\"}}');\"\n                        ></div>\n                      </div>\n                    {% endfor %}\n                  </div>\n                {%- endfor -%}\n              </div>\n            </div>\n\n            <div class=\"t4s-swatch t4s-color-mode__{{ color_mode }} t4s-color-size__{{ bk_stts.color_size }} t4s-selector-mode__{{ selector_mode }}\">\n              {%- if advance_pr_type != blank -%}\n                {%- render 'choose_style', advance_pr_type: advance_pr_type, title: advance_label, pid: product.id -%}\n              {%- endif -%}\n\n              {%- for option in shsd_product_options_with_values -%}\n                {%- liquid\n                  assign option_index = 'option' | append: forloop.index\n                  assign selected_value = product.selected_or_first_available_variant[option_index]\n                  assign option_name = option.name\n                  assign name_downcase = option_name | downcase\n                -%}\n\n                {%- if get_color contains name_downcase -%}\n                  {% comment %}--MARK: Color Option{% endcomment %}\n\n                  {% comment %} Build color nickname map from variant metafields {% endcomment %}\n                  {%- capture color_nicknames_map -%}\n                    {%- for variant in shsd_product_variants -%}\n                      {%- if variant.metafields.custom.variant_color != blank -%}\n                        {%- for opt_index in (1..3) -%}\n                          {%- assign opt_key = 'option' | append: opt_index -%}\n                          {%- assign opt_val = variant[opt_key] -%}\n                          {%- if opt_val != blank -%}\n                            {%- assign opt_index_adjusted = opt_index | minus: 1 -%}\n                            {%- assign opt_name_check = product.options[opt_index_adjusted] | downcase -%}\n                            {%- if get_color contains opt_name_check -%}\n                              {{ opt_val | handle }}:{{ variant.metafields.custom.variant_color }};\n                            {%- endif -%}\n                          {%- endif -%}\n                        {%- endfor -%}\n                      {%- endif -%}\n                    {%- endfor -%}\n                  {%- endcapture -%}\n                  {%- assign color_nicknames_map = color_nicknames_map | strip -%}\n\n                  <div\n                    data-swatch-option\n                    data-option-name=\"{{ option_name | escape }}\"\n                    data-id=\"{{ forloop.index0 }}\"\n                    data-option-unit=\"\n                      {%- liquid\n                        assign option_unit = ''\n                        if se_stts and se_stts.option_units and se_stts.option_units != blank\n                          assign option_units_raw = se_stts.option_units | strip | newline_to_br | split: '<br />'\n                          for pair in option_units_raw\n                            assign pair_cleaned = pair | strip\n                            if pair_cleaned contains ':'\n                              assign key_value = pair_cleaned | split: ':'\n                              assign key = key_value[0] | strip\n                              assign value = key_value[1] | strip\n                              if key == option_name and value != blank\n                                assign option_unit = value\n                                break\n                              endif\n                            endif\n                          endfor\n                        endif\n                      -%}{{ option_unit | escape }}\n                    \"\n                    class=\"t4s-swatch__option is-t4s-style__color is-t4s-name__{{ option_name | handle }} {% cycle 'is--first-color', '', '' %}\"\n                  >\n                    <h4 class=\"t4s-swatch__title t4s-swatch__title--color\">\n                      <span class=\"t4s-swatch__title--left\">\n                        <span class=\"bold\">\n                          {{- option_name | upcase -}}\n                          {%- liquid\n                            assign option_unit = ''\n                            if se_stts and se_stts.option_units and se_stts.option_units != blank\n                              assign option_units_raw = se_stts.option_units | strip | newline_to_br | split: '<br />'\n                              for pair in option_units_raw\n                                assign pair_cleaned = pair | strip\n                                if pair_cleaned contains ':'\n                                  assign key_value = pair_cleaned | split: ':'\n                                  assign key = key_value[0] | strip\n                                  assign value = key_value[1] | strip\n                                  if key == option_name and value != blank\n                                    assign option_unit = value\n                                    break\n                                  endif\n                                endif\n                              endfor\n                            endif\n                          -%}\n                          {%- if option_unit != blank %} ({{ option_unit }}){%- endif -%}\n                          :\n                        </span>\n                        <span class=\"t4s-selected-value\">\n                          {%- assign display_value = selected_value | default: choose_an_option | replace: '\"', '' -%}\n                          {{- display_value -}}\n                          {%- if option_unit != blank %} {{ option_unit }}{%- endif -%}\n                        </span>\n                      </span>\n                      {%- if name_sizeg == name_downcase -%}\n                        {{- html_sizeg -}}\n                      {%- endif %}\n                    </h4>\n\n                    <div data-swatch-list class=\"t4s-swatch__list\">\n                      {%- if color_mode != 'dropdown' -%}\n                        {%- if color_mode contains 'is-sw-cl__label' -%}\n                          {%- for value in option.values -%}\n                            {%- assign color_handle = value | handle -%}\n\n                            {%- comment %} Look up color nickname from map {%- endcomment -%}\n                            {%- assign color_nickname = '' -%}\n                            {%- assign nickname_pairs = color_nicknames_map | split: ';' -%}\n                            {%- for pair in nickname_pairs -%}\n                              {%- assign pair_clean = pair | strip -%}\n                              {%- if pair_clean != blank -%}\n                                {%- assign pair_parts = pair_clean | split: ':' -%}\n                                {%- if pair_parts[0] == color_handle -%}\n                                  {%- assign color_nickname = pair_parts[1] -%}\n                                  {%- break -%}\n                                {%- endif -%}\n                              {%- endif -%}\n                            {%- endfor -%}\n\n                            {%- comment %} Context-aware availability check: color + current other selections {%- endcomment -%}\n                            {%- assign color_is_available = false -%}\n                            {%- for variant in shsd_product_variants -%}\n                              {%- assign matches_color = false -%}\n                              {%- assign matches_other_options = true -%}\n\n                              {%- for opt_idx in (1..3) -%}\n                                {%- assign opt_key = 'option' | append: opt_idx -%}\n                                {%- assign variant_opt_val = variant[opt_key] -%}\n                                {%- if variant_opt_val != blank -%}\n                                  {%- assign variant_opt_handle = variant_opt_val | handle -%}\n\n                                  {%- comment %} Determine if this option index is the color option {%- endcomment -%}\n                                  {%- assign opt_idx_adjusted = opt_idx | minus: 1 -%}\n                                  {%- assign this_opt_name = product.options[opt_idx_adjusted] | downcase -%}\n\n                                  {%- if get_color contains this_opt_name -%}\n                                    {%- comment %} This is the color option - check if it matches our target color {%- endcomment -%}\n                                    {%- if variant_opt_handle == color_handle -%}\n                                      {%- assign matches_color = true -%}\n                                    {%- endif -%}\n                                  {%- else -%}\n                                    {%- comment %} This is a non-color option - check if variant matches current selection {%- endcomment -%}\n                                    {%- assign current_selected_val = product.selected_or_first_available_variant[opt_key] -%}\n                                    {%- if current_selected_val != blank -%}\n                                      {%- assign current_selected_handle = current_selected_val | handle -%}\n                                      {%- unless variant_opt_handle == current_selected_handle -%}\n                                        {%- assign matches_other_options = false -%}\n                                      {%- endunless -%}\n                                    {%- endif -%}\n                                  {%- endif -%}\n                                {%- endif -%}\n                              {%- endfor -%}\n\n                              {%- if matches_color and matches_other_options and variant.available -%}\n                                {%- assign color_is_available = true -%}\n                                {%- break -%}\n                              {%- endif -%}\n                            {%- endfor -%}\n\n                            {%- comment %} Compute available standard lengths for this color (used for both classes and content) {%- endcomment -%}\n                            {%- assign avail_lengths = '' -%}\n                            {%- assign avail_lengths_seen = '' -%}\n                            {%- assign length_opt_key = 'option' | append: length_option_position -%}\n                            {%- if length_option_position > 0 and color_option_position > 0 -%}\n                              {%- for lv in shsd_product_variants -%}\n                                {%- assign v_color_key = 'option' | append: color_option_position -%}\n                                {%- assign v_color_val = lv[v_color_key] | handle -%}\n                                {%- if v_color_val == color_handle and lv.available -%}\n                                  {%- assign v_length_val = lv[length_opt_key] -%}\n                                  {%- if v_length_val != blank -%}\n                                    {%- assign is_custom_length = false -%}\n                                    {%- if custom_option_names -%}\n                                      {%- for custom_name in custom_option_names -%}\n                                        {%- assign custom_name_stripped = custom_name | strip -%}\n                                        {%- if v_length_val == custom_name_stripped -%}\n                                          {%- assign is_custom_length = true -%}\n                                          {%- break -%}\n                                        {%- endif -%}\n                                      {%- endfor -%}\n                                    {%- endif -%}\n                                    {%- unless is_custom_length -%}\n                                      {%- assign v_length_clean = v_length_val | replace: '\"', '' | strip -%}\n                                      {%- assign sentinel = '@@' | append: v_length_clean | append: '@@' -%}\n                                      {%- unless avail_lengths_seen contains sentinel -%}\n                                        {%- assign avail_lengths_seen = avail_lengths_seen | append: sentinel -%}\n                                        {%- if avail_lengths == '' -%}\n                                          {%- assign avail_lengths = v_length_clean -%}\n                                        {%- else -%}\n                                          {%- assign avail_lengths = avail_lengths | append: ', ' | append: v_length_clean -%}\n\n                                        {%- endif -%}\n                                      {%- endunless -%}\n                                    {%- endunless -%}\n                                  {%- endif -%}\n                                {%- endif -%}\n                              {%- endfor -%}\n                            {%- endif -%}\n\n                            <div\n                              data-swatch-item\n                              class=\"t4s-swatch__btn-wrap{% if selected_value == value %} is--selected{% endif %}{% unless color_is_available %} is--soldout is--out-of-stock{% if avail_lengths != '' %} pfd-has-lengths{% endif %}{% endunless %}\"\n                              data-value=\"{{ value | escape }}\"\n                              data-available=\"{{ color_is_available }}\"\n                            >\n                              <!-- DEBUG: color={{ color_handle }} | available={{ color_is_available }} | selected_opt1={{ product.selected_or_first_available_variant.option1 | handle }} | selected_opt2={{ product.selected_or_first_available_variant.option2 | handle }} -->\n                              <div\n                                data-img-el\n                                class=\"t4s-swatch__item {{ color_swatch }}bg_color_{{ value | handle }} lazyloadt4s\">\n                                <img crossorigin=\"anonymous\">\n                                {%- unless color_is_available -%}\n                                  <span class=\"t4s-swatch__restock-badge\">Awaiting Restock</span>\n                                {%- endunless -%}\n                              </div>\n                              {%- unless color_is_available -%}\n                                {%- if avail_lengths != '' -%}\n                                  <span class=\"t4s-swatch__available-lengths is-visible\">Available in {{ avail_lengths }}</span>\n                                {%- endif -%}\n                              {%- endunless -%}\n                              <span class=\"t4s-swatch__label\">\n                                {{- value | replace: '\"', '' -}}\n                              </span>\n                              {%- if color_nickname != blank -%}\n                                <span class=\"t4s-swatch__nickname\">{{ color_nickname }}</span>\n                              {%- endif -%}\n                            </div>\n\n                          {%- endfor -%}\n\n                        {%- else -%}\n                          {%- for value in option.values -%}\n                            {%- assign color_handle = value | handle -%}\n\n                            {%- comment %} Look up color nickname {%- endcomment -%}\n                            {%- assign color_nickname = '' -%}\n                            {%- assign nickname_pairs = color_nicknames_map | split: ';' -%}\n                            {%- for pair in nickname_pairs -%}\n                              {%- assign pair_clean = pair | strip -%}\n                              {%- if pair_clean != blank -%}\n                                {%- assign pair_parts = pair_clean | split: ':' -%}\n                                {%- if pair_parts[0] == color_handle -%}\n                                  {%- assign color_nickname = pair_parts[1] -%}\n                                  {%- break -%}\n                                {%- endif -%}\n                              {%- endif -%}\n                            {%- endfor -%}\n\n                            {%- comment %} Context-aware availability check: color + current other selections {%- endcomment -%}\n                            {%- assign color_is_available = false -%}\n                            {%- for variant in shsd_product_variants -%}\n                              {%- assign matches_color = false -%}\n                              {%- assign matches_other_options = true -%}\n\n                              {%- for opt_idx in (1..3) -%}\n                                {%- assign opt_key = 'option' | append: opt_idx -%}\n                                {%- assign variant_opt_val = variant[opt_key] -%}\n                                {%- if variant_opt_val != blank -%}\n                                  {%- assign variant_opt_handle = variant_opt_val | handle -%}\n\n                                  {%- comment %} Determine if this option index is the color option {%- endcomment -%}\n                                  {%- assign opt_idx_adjusted = opt_idx | minus: 1 -%}\n                                  {%- assign this_opt_name = product.options[opt_idx_adjusted] | downcase -%}\n\n                                  {%- if get_color contains this_opt_name -%}\n                                    {%- comment %} This is the color option - check if it matches our target color {%- endcomment -%}\n                                    {%- if variant_opt_handle == color_handle -%}\n                                      {%- assign matches_color = true -%}\n                                    {%- endif -%}\n                                  {%- else -%}\n                                    {%- comment %} This is a non-color option - check if variant matches current selection {%- endcomment -%}\n                                    {%- assign current_selected_val = product.selected_or_first_available_variant[opt_key] -%}\n                                    {%- if current_selected_val != blank -%}\n                                      {%- assign current_selected_handle = current_selected_val | handle -%}\n                                      {%- unless variant_opt_handle == current_selected_handle -%}\n                                        {%- assign matches_other_options = false -%}\n                                      {%- endunless -%}\n                                    {%- endif -%}\n                                  {%- endif -%}\n                                {%- endif -%}\n                              {%- endfor -%}\n\n                              {%- if matches_color and matches_other_options and variant.available -%}\n                                {%- assign color_is_available = true -%}\n                                {%- break -%}\n                              {%- endif -%}\n                            {%- endfor -%}\n\n                            {%- comment %} Compute available standard lengths for this color {%- endcomment -%}\n                            {%- assign avail_lengths = '' -%}\n                            {%- assign avail_lengths_seen = '' -%}\n                            {%- assign length_opt_key = 'option' | append: length_option_position -%}\n                            {%- if length_option_position > 0 and color_option_position > 0 -%}\n                              {%- for lv in shsd_product_variants -%}\n                                {%- assign v_color_key = 'option' | append: color_option_position -%}\n                                {%- assign v_color_val = lv[v_color_key] | handle -%}\n                                {%- if v_color_val == color_handle and lv.available -%}\n                                  {%- assign v_length_val = lv[length_opt_key] -%}\n                                  {%- if v_length_val != blank -%}\n                                    {%- assign is_custom_length = false -%}\n                                    {%- if custom_option_names -%}\n                                      {%- for custom_name in custom_option_names -%}\n                                        {%- assign custom_name_stripped = custom_name | strip -%}\n                                        {%- if v_length_val == custom_name_stripped -%}\n                                          {%- assign is_custom_length = true -%}\n                                          {%- break -%}\n                                        {%- endif -%}\n                                      {%- endfor -%}\n                                    {%- endif -%}\n                                    {%- unless is_custom_length -%}\n                                      {%- assign v_length_clean = v_length_val | replace: '\"', '' | strip -%}\n                                      {%- assign sentinel = '@@' | append: v_length_clean | append: '@@' -%}\n                                      {%- unless avail_lengths_seen contains sentinel -%}\n                                        {%- assign avail_lengths_seen = avail_lengths_seen | append: sentinel -%}\n                                        {%- if avail_lengths == '' -%}\n                                          {%- assign avail_lengths = v_length_clean -%}\n                                        {%- else -%}\n                                          {%- assign avail_lengths = avail_lengths | append: ', ' | append: v_length_clean -%}\n                                        {%- endif -%}\n                                      {%- endunless -%}\n                                    {%- endunless -%}\n                                  {%- endif -%}\n                                {%- endif -%}\n                              {%- endfor -%}\n                            {%- endif -%}\n\n                            <div\n                              data-swatch-item\n                class=\"t4s-swatch__btn-wrap{% if selected_value == value %} is--selected{% endif %}{% unless color_is_available %} is--soldout is--out-of-stock{% if avail_lengths != '' %} pfd-has-lengths{% endif %}{% endunless %}\"\n                              data-value=\"{{ value | escape }}\"\n                              data-available=\"{{ color_is_available }}\"\n                            >\n                              <div\n                                data-img-el\n                                class=\"t4s-swatch__item {{ color_swatch }}bg_color_{{ value | handle }} lazyloadt4s\"\n                              >\n                                <img crossorigin=\"anonymous\">\n                                {%- unless color_is_available -%}\n                                  <span class=\"t4s-swatch__restock-badge\">Awaiting Restock</span>\n                                {%- endunless -%}\n                              </div>\n                              {%- unless color_is_available -%}\n                                {%- if avail_lengths != '' -%}\n                                  <span class=\"t4s-swatch__available-lengths is-visible\">Available in {{ avail_lengths }}</span>\n                                {%- endif -%}\n                              {%- endunless -%}\n                              {%- if color_nickname != blank -%}\n                                <span class=\"t4s-swatch__nickname\">{{ color_nickname }}</span>\n                              {%- endif -%}\n                            </div>\n\n                          {%- endfor -%}\n\n                        {%- endif -%}\n                      {%- else -%}\n                        <button\n                          type=\"button\"\n                          data-dropdown-open\n                          data-position=\"bottom-end\"\n                          data-id=\"t4s_nt_{{ pr_sid }}{{ forloop.index }}\"\n                        >\n                          <span data-current-value>\n                            {{- selected_value | default: choose_an_option -}}\n                          </span>\n                          <svg\n                            class=\"t4s-icon-select-arrow\"\n                            role=\"presentation\"\n                            viewBox=\"0 0 19 12\"\n                          >\n                            <use xlink:href=\"#t4s-select-arrow\"></use>\n                          </svg>\n                        </button>\n                        <div\n                          data-dropdown-wrapper\n                          class=\"t4s-dropdown__wrapper t4s-current-scrollbar\"\n                          id=\"t4s_nt_{{ pr_sid }}{{ forloop.index }}\"\n                        >\n                          <div class=\"t4s-drop-arrow\"></div>\n                          <div class=\"t4s-dropdown__header\">\n                            <span\n                              data-current-value\n                              class=\"t4s-dropdown__title\"\n                            >\n                              {{- selected_value | default: choose_an_option -}}\n                            </span>\n                            <button\n                              data-dropdown-close\n                              aria-label=\"{{ 'general.aria.close' | t }}\"\n                            >\n                              <svg\n                                role=\"presentation\"\n                                class=\"t4s-iconsvg-close\"\n                                viewBox=\"0 0 16 14\"\n                              >\n                                <path d=\"M15 0L1 14m14 0L1 0\" stroke=\"currentColor\" fill=\"none\" fill-rule=\"evenodd\"></path>\n                              </svg>\n                            </button>\n                          </div>\n                          <div class=\"t4s-dropdown__content\">\n                            {%- for value in option.values -%}\n                              <div\n                                data-swatch-item\n                                data-dropdown-off\n                                class=\"t4s-swatch__item t4s-truncate {{ color_swatch }}bg_color_{{ value | handle }} lazyloadt4s{% if selected_value == value %} is--selected{% endif %}\"\n                                data-value=\"{{ value | escape }}\"\n                              >\n                                {{ value | replace: '\"', '' }}\n                              </div>\n                            {%- endfor -%}\n                          </div>\n                        </div>\n                      {%- endif -%}\n                    </div>\n                    {%- render 'color-info-accordion' -%}\n                  </div>\n                {%- else -%}\n                  {% comment %}--MARK: Non-Color{% endcomment %}\n                  {%- liquid\n                    assign standard_values = ''\n                    assign custom_values = ''\n                    assign has_standard = false\n                    assign has_custom = false\n\n                    for value in option.values\n                      assign is_custom = false\n                      for custom_name in custom_option_names\n                        assign custom_name_clean = custom_name | strip\n                        if value contains custom_name_clean\n                          assign is_custom = true\n                          break\n                        endif\n                      endfor\n\n                      if is_custom\n                        if custom_values == ''\n                          assign custom_values = value\n                        else\n                          assign custom_values = custom_values | append: ',' | append: value\n                        endif\n                        assign has_custom = true\n                      else\n                        if standard_values == ''\n                          assign standard_values = value\n                        else\n                          assign standard_values = standard_values | append: ',' | append: value\n                        endif\n                        assign has_standard = true\n                      endif\n                    endfor\n\n                    assign standard_values_array = standard_values | split: ','\n                    assign custom_values_array = custom_values | split: ','\n                  -%}\n\n                  <div\n                    data-swatch-option\n                    data-option-name=\"{{ option_name | escape }}\"\n                    data-id=\"{{ forloop.index0 }}\"\n                    data-option-unit=\"\n                      {%- liquid\n                        assign option_unit = ''\n                        if se_stts and se_stts.option_units and se_stts.option_units != blank\n                          assign option_units_raw = se_stts.option_units | strip | newline_to_br | split: '<br />'\n                          for pair in option_units_raw\n                            assign pair_cleaned = pair | strip\n                            if pair_cleaned contains ':'\n                              assign key_value = pair_cleaned | split: ':'\n                              assign key = key_value[0] | strip\n                              assign value = key_value[1] | strip\n                              if key == option_name and value != blank\n                                assign option_unit = value\n                                break\n                              endif\n                            endif\n                          endfor\n                        endif\n                      -%}{{ option_unit | escape }}\n                    \"\n                    class=\"t4s-swatch__option is-t4s-name__{{ option_name | handle }} pfd-split-option\"\n                  >\n                    <h4 class=\"t4s-swatch__title\">\n                      <span class=\"t4s-swatch__title--left\"\n                        >Select a\n                        <span class=\"bold\">\n                          {{- option_name -}}\n                        </span>\n                        {%- liquid\n                          assign option_unit = ''\n                          if se_stts and se_stts.option_units and se_stts.option_units != blank\n                            assign option_units_raw = se_stts.option_units | strip | newline_to_br | split: '<br />'\n                            for pair in option_units_raw\n                              assign pair_cleaned = pair | strip\n                              if pair_cleaned contains ':'\n                                assign key_value = pair_cleaned | split: ':'\n                                assign key = key_value[0] | strip\n                                assign value = key_value[1] | strip\n                                if key == option_name and value != blank\n                                  assign option_unit = value\n                                  break\n                                endif\n                              endif\n                            endfor\n                          endif\n                        -%}\n                        {%- if option_unit != blank %} ({{ option_unit }}){%- endif -%}\n                      </span>\n                      <span class=\"t4s-swatch__title--right\"\n                        >Selected:\n                        <span class=\"bold\">\n                          {%- assign display_value = selected_value | default: choose_an_option | replace: '\"', '' -%}\n                          {{- display_value -}}\n                          {%- if option_unit != blank %} {{ option_unit }}{%- endif -%}\n                        </span></span\n                      >\n                      {%- if name_sizeg == name_downcase -%}\n                        {{- html_sizeg -}}\n                      {%- endif %}\n                    </h4>\n\n                    <div class=\"pfd-split-selection\">\n                      {%- if has_standard -%}\n                        <div class=\"pfd-standard-options\">\n                          {%- if selector_mode != 'dropdown' -%}\n                            {%- for value in standard_values_array -%}\n                              <div\n                                data-swatch-item\n                                class=\"t4s-swatch__item{% if selected_value == value %} is--selected{% endif %}\"\n                                data-value=\"{{ value | escape }}\"\n                              >\n                                {{ value | replace: '\"', '' }}\n                              </div>\n                            {%- endfor -%}\n                          {%- else -%}\n                            <button\n                              type=\"button\"\n                              data-pfd-dropdown-open\n                              data-position=\"bottom-end\"\n                              data-id=\"t4s_nt_{{ pr_sid }}{{ forloop.index }}_standard\"\n                            >\n                              <span data-current-value>\n                                {{- selected_value | default: choose_an_option -}}\n                              </span>\n                              <svg\n                                class=\"t4s-icon-select-arrow\"\n                                role=\"presentation\"\n                                viewBox=\"0 0 19 12\"\n                              >\n                                <use xlink:href=\"#t4s-select-arrow\"></use>\n                              </svg>\n                            </button>\n                            <div\n                              data-dropdown-wrapper\n                              class=\"t4s-dropdown__wrapper t4s-current-scrollbar\"\n                              id=\"t4s_nt_{{ pr_sid }}{{ forloop.index }}_standard\"\n                            >\n                              <div class=\"t4s-drop-arrow\"></div>\n                              <div class=\"t4s-dropdown__content\">\n                                {%- for value in standard_values_array -%}\n                                  <div\n                                    data-swatch-item\n                                    data-dropdown-off\n                                    class=\"t4s-swatch__item t4s-truncate{% if selected_value == value %} is--selected{% endif %}\"\n                                    data-value=\"{{ value | escape }}\"\n                                  >\n                                    {{ value | replace: '\"', '' }}\n                                  </div>\n                                {%- endfor -%}\n                              </div>\n                            </div>\n                          {%- endif -%}\n                        </div>\n                      {%- endif -%}\n\n                      {%- if has_custom -%}\n                        <div class=\"pfd-custom-options\">\n                          {%- if has_standard and has_custom -%}\n                            <span class=\"pfd-or-separator\">or</span>\n                          {%- endif -%}\n                          <button\n                            type=\"button\"\n                            data-pfd-dropdown-open\n                            data-position=\"bottom-end\"\n                            data-id=\"t4s_nt_{{ pr_sid }}{{ forloop.index }}_custom\"\n                            class=\"pfd-custom-dropdown\"\n                          >\n                            <span data-current-value>\n                              {%- assign is_custom_selected = false -%}\n                              {%- for custom_val in custom_values_array -%}\n                                {%- if selected_value == custom_val -%}\n                                  {%- assign display_custom_val = custom_val | replace: '\"', '' -%}\n                                  {%- if option_unit != blank -%}\n                                    {{ display_custom_val }}\n                                    {{ option_unit }}\n                                    <span class=\"pfd-custom-badge\">Custom</span>\n                                  {%- else -%}\n                                    {{ display_custom_val }}\n                                    <span class=\"pfd-custom-badge\">Custom</span>\n                                  {%- endif -%}\n                                  {%- assign is_custom_selected = true -%}\n                                  {%- break -%}\n                                {%- endif -%}\n                              {%- endfor -%}\n                              {%- unless is_custom_selected -%}\n                                Custom {{ option_name | downcase }}\n                              {%- endunless -%}\n                            </span>\n                            <svg\n                              class=\"t4s-icon-select-arrow\"\n                              role=\"presentation\"\n                              viewBox=\"0 0 19 12\"\n                            >\n                              <use xlink:href=\"#t4s-select-arrow\"></use>\n                            </svg>\n                          </button>\n                          <div\n                            data-dropdown-wrapper\n                            class=\"t4s-dropdown__wrapper t4s-current-scrollbar\"\n                            id=\"t4s_nt_{{ pr_sid }}{{ forloop.index }}_custom\"\n                          >\n                            <div class=\"t4s-drop-arrow\"></div>\n                            <div class=\"t4s-dropdown__content\">\n                              {%- for value in custom_values_array -%}\n                                <div\n                                  data-swatch-item\n                                  data-dropdown-off\n                                  class=\"t4s-swatch__item t4s-truncate{% if selected_value == value %} is--selected{% endif %}\"\n                                  data-value=\"{{ value | escape }}\"\n                                >\n                                  <span class=\"pfd-checkmark\">✓</span>\n                                  <span class=\"pfd-option-text\">\n                                    {%- assign display_value = value | replace: '\"', '' -%}\n                                    {%- if option_unit != blank -%}\n                                      {{ display_value }}\n                                      {{ option_unit }}\n                                    {%- else -%}\n                                      {{ display_value }}\n                                    {%- endif -%}\n                                  </span>\n                                  <span class=\"pfd-custom-badge\">Custom</span>\n                                </div>\n                              {%- endfor -%}\n                            </div>\n                          </div>\n                        </div>\n                      {%- endif -%}\n\n                      {%- unless has_standard or has_custom -%}\n                        {%- comment %} Fallback to original rendering if no split detected {%- endcomment %}\n                        <div class=\"t4s-swatch__list pfd-fallback-list\">\n                          {%- if selector_mode != 'dropdown' -%}\n                            {%- for value in option.values -%}\n                              <div\n                                data-swatch-item\n                                class=\"t4s-swatch__item{% if selected_value == value %} is--selected{% endif %}\"\n                                data-value=\"{{ value | escape }}\"\n                              >\n                                {{ value | replace: '\"', '' }}\n                              </div>\n                            {%- endfor -%}\n                          {%- else -%}\n                            <button\n                              type=\"button\"\n                              data-pfd-dropdown-open\n                              data-position=\"bottom-end\"\n                              data-id=\"t4s_nt_{{ pr_sid }}{{ forloop.index }}\"\n                            >\n                              <span data-current-value>\n                                {{- selected_value | default: choose_an_option -}}\n                              </span>\n                              <svg\n                                class=\"t4s-icon-select-arrow\"\n                                role=\"presentation\"\n                                viewBox=\"0 0 19 12\"\n                              >\n                                <use xlink:href=\"#t4s-select-arrow\"></use>\n                              </svg>\n                            </button>\n                            <div\n                              data-dropdown-wrapper\n                              class=\"t4s-dropdown__wrapper t4s-current-scrollbar\"\n                              id=\"t4s_nt_{{ pr_sid }}{{ forloop.index }}\"\n                            >\n                              <div class=\"t4s-drop-arrow\"></div>\n                              <div class=\"t4s-dropdown__content\">\n                                {%- for value in option.values -%}\n                                  <div\n                                    data-swatch-item\n                                    data-dropdown-off\n                                    class=\"t4s-swatch__item t4s-truncate{% if selected_value == value %} is--selected{% endif %}\"\n                                    data-value=\"{{ value | escape }}\"\n                                  >\n                                    {{ value | replace: '\"', '' }}\n                                  </div>\n                                {%- endfor -%}\n                              </div>\n                            </div>\n                          {%- endif -%}\n                        </div>\n                      {%- endunless -%}\n                    </div>\n\n                    {%- comment %} Custom order notice - shown when custom option is selected {%- endcomment %}\n                    {%- assign show_custom_notice = false -%}\n                    {%- for custom_val in custom_values_array -%}\n                      {%- if selected_value == custom_val -%}\n                        {%- assign show_custom_notice = true -%}\n                        {%- break -%}\n                      {%- endif -%}\n                    {%- endfor -%}\n                    <div\n                      class=\"pfd-custom-notice\"\n                      style=\"display: {% if show_custom_notice %}block{% else %}none{% endif %};\"\n                    >\n                      <div class=\"pfd-custom-notice-content\">\n                        <svg\n                          class=\"pfd-custom-notice-icon\"\n                          xmlns=\"http://www.w3.org/2000/svg\"\n                          width=\"24\"\n                          height=\"24\"\n                          viewBox=\"0 0 24 24\"\n                          fill=\"none\"\n                          stroke=\"currentColor\"\n                          stroke-width=\"2\"\n                          stroke-linecap=\"round\"\n                          stroke-linejoin=\"round\"\n                        >\n                          <circle cx=\"12\" cy=\"12\" r=\"10\"></circle>\n                          <polyline points=\"12 6 12 12 16 14\"></polyline>\n                        </svg>\n                        <p class=\"pfd-custom-notice-text\">\n                          Custom {{ option_name | downcase }}s are <strong>made to order</strong>. Please allow\n                          <span class=\"pfd-custom-notice-highlight\">6-8 weeks</span> for delivery.\n                        </p>\n                      </div>\n                    </div>\n\n                    {%- comment %} Configuration-based custom content for options {%- endcomment %}\n                    {%- comment %} Renders ALL matching option content, shows only the selected one {%- endcomment %}\n                    {%- assign option_name_lower = option_name | downcase -%}\n                    {%- assign selected_value_lower = selected_value | downcase -%}\n\n                    {%- capture all_option_info -%}\n  {%- for pair in option_content_pairs -%}\n    {%- assign pair_cleaned = pair | strip -%}\n    {%- if pair_cleaned contains '|' -%}\n      {%- assign parts = pair_cleaned | split: '|' -%}\n      {%- assign option_key_full = parts[0] | strip -%}\n      {%- assign content_value = parts[1] | strip -%}\n\n      {%- if option_key_full contains ':' -%}\n        {%- assign key_parts = option_key_full | split: ':' -%}\n        {%- assign option_key = key_parts[0] | strip | downcase -%}\n        {%- assign value_key = key_parts[1] | strip -%}\n        {%- assign value_key_lower = value_key | downcase -%}\n\n        {%- if option_name_lower == option_key -%}\n          {%- assign is_selected = false -%}\n          {%- if selected_value_lower == value_key_lower -%}\n            {%- assign is_selected = true -%}\n          {%- endif -%}\n          <div class=\"pfd-option-info-item\"\n               data-option-name=\"{{ option_name_lower }}\"\n               data-option-value=\"{{ value_key | handle }}\"\n               style=\"{% unless is_selected %}display: none;{% endunless %}\">\n            {{ content_value }}\n          </div>\n        {%- endif -%}\n      {%- endif -%}\n    {%- endif -%}\n  {%- endfor -%}\n{%- endcapture -%}\n\n                    {%- assign all_option_info_stripped = all_option_info | strip -%}\n                    {%- if all_option_info_stripped != blank -%}\n                      <div class=\"pfd-custom-option-info\" data-option-info-container=\"{{ option_name_lower }}\">\n                        {{ all_option_info }}\n                      </div>\n                    {%- endif -%}\n                  </div>\n                {%- endif -%}\n              {%- endfor -%}\n            </div>\n          {%- endif -%}\n\n          {%- liquid\n            if arr_properties.size > 0 and isProductAvailable\n              render 'frm_properties', arr_properties: arr_properties, product: product\n            endif\n          -%}\n\n          {%- if use_incoming_mess\n            and current_variant_incoming\n            and pr_variants.size == 1\n            and current_variant.next_incoming_date != blank\n          -%}\n            {%- assign format_date = current_variant.next_incoming_date | date: date_in -%}\n            {%- comment -%}<div class=\"t4s-incoming__mess\"><!-- will_not_ship_until / will_be_in_stock_after --></div>{%- endcomment -%}\n\n          {%- elsif use_incoming_mess and pr_variants.size > 1 -%}\n            {%- liquid\n              assign format_date = current_variant.next_incoming_date | date: date_in\n              unless format_date\n                assign format_date = '19041994'\n              endunless\n            -%}\n            {%- comment -%}<div data-incoming__mess class=\"t4s-incoming__mess\"><!-- will_not_ship_until / will_be_in_stock_after with incoming date --></div>{%- endcomment -%}\n\n          {%- endif -%}\n\n          {{ 'button-style.css' | asset_url | stylesheet_tag }}\n          <link\n            href=\"{{ 'custom-effect.css' | asset_url }}\"\n            rel=\"stylesheet\"\n            media=\"print\"\n            onload=\"this.media='all'\"\n          >\n\n          {{- html_price -}}\n\n          <div\n            class=\"t4s-product-form__buttons\"\n            style=\"--pr-btn-round: {{ bk_stts.pr_btn_round }}px;--wis-cp-btn-round: {{ bk_stts.wis_cp_btn_round }}px;\"\n          >\n            <div class=\"t4s-pr__qty_cart t4s-d-flex t4s-flex-wrap\">\n              {%- if isExternal -%}\n                <a\n                  href=\"{{ external_link }}\"\n                  rel=\"nofollow\"\n                  target=\"_blank\"\n                  class=\"t4s-product-form__submit t4s-btn t4s-btn-base t4s-btn-style-{{ bk_stts.button_style }} t4s-btn-color-{{ bk_stts.button_color }} t4s-w-100 t4s-justify-content-center {% if bk_stts.button_style == 'default' or bk_stts.button_style == 'outline' %} t4s-btn-effect-{{ bk_stts.button_effect }}{% endif %} t4s-truncate is--btn-external t4s-btn-loading__svg\"\n                >\n                  {%- if bk_stts.btn_icon -%}\n                    <svg class=\"t4s-btn-icon\" viewBox=\"0 0 24 24\">\n                      <use xlink:href=\"#t4s-icon-atc\"></use>\n                    </svg>\n                  {%- endif -%}\n                  <span class=\"t4s-btn-atc_text\">\n                    {{- external_title -}}\n                  </span>\n                  <span class=\"t4s-loading__spinner\" hidden>\n                    <svg\n                      width=\"16\"\n                      height=\"16\"\n                      hidden\n                      class=\"t4s-svg-spinner\"\n                      focusable=\"false\"\n                      role=\"presentation\"\n                      viewBox=\"0 0 66 66\"\n                      xmlns=\"http://www.w3.org/2000/svg\"\n                    >\n                      <circle class=\"t4s-path\" fill=\"none\" stroke-width=\"6\" cx=\"33\" cy=\"33\" r=\"30\"></circle>\n                    </svg>\n                  </span>\n                </a>\n              {%- else -%}\n                {%- if bk_stts.show_qty and isProductAvailable -%}\n                  <div\n                    data-quantity-wrapper\n                    class=\"t4s-quantity-wrapper t4s-product-form__qty\"\n                  >\n                    <button\n                      data-quantity-selector\n                      data-decrease-qty\n                      type=\"button\"\n                      class=\"t4s-quantity-selector is--minus\"\n                    ></button>\n                    <input\n                      data-quantity-value\n                      type=\"number\"\n                      class=\"t4s-quantity-input\"\n                      step=\"1\"\n                      min=\"{{cus_qty}}\"\n                      max=\"{{max_qty}}\"\n                      name=\"quantity\"\n                      value=\"{{cus_qty}}\"\n                      size=\"4\"\n                      pattern=\"[0-9]*\"\n                      inputmode=\"numeric\"\n                    >\n                    <button\n                      data-quantity-selector\n                      data-increase-qty\n                      type=\"button\"\n                      class=\"t4s-quantity-selector is--plus\"\n                    ></button>\n                  </div>\n                {%- else -%}\n                  <input type=\"hidden\" name=\"quantity\" value=\"1\">\n                {%- endif -%}\n                {% if customer %}\n                  <button\n                    data-animation-atc='{ \"ani\": \"{{ bk_stts.ani }}\",\"time\": {{ bk_stts.time }}000 }'\n                    type=\"submit\"\n                    name=\"add\"\n                    data-atc-form\n                    class=\"t4s-product-form__submit t4s-btn t4s-btn-base t4s-btn-style-{{ bk_stts.button_style }} t4s-btn-color-{{ bk_stts.button_color }} t4s-w-100 t4s-justify-content-center {% if bk_stts.button_style == 'default' or bk_stts.button_style == 'outline' %} t4s-btn-effect-{{ bk_stts.button_effect }}{% endif %} t4s-btn-loading__svg\"\n                    {% unless current_variant_available %}\n                      aria-disabled=\"true\"\n                    {% endunless -%}\n                    {% unless isProductAvailable %}\n                      disabled=\"disabled\"\n                    {% endunless %}\n                  >\n                    {%- if bk_stts.btn_icon -%}\n                      <svg\n                        class=\"t4s-btn-icon\"\n                        viewBox=\"0 0 24 24\"\n                      >\n                        <use xlink:href=\"#t4s-icon-atc\"></use>\n                      </svg>\n                    {%- endif -%}\n                    <span class=\"t4s-btn-atc_text\">\n                      {%- if current_variant_available == false or isProductAvailable == false -%}\n                        {{- 'products.product.sold_out' | t -}}\n                      {%- elsif isPreoder -%}\n                        {{- 'products.product.pre_order' | t }}\n                      {%- else -%}\n                        {{ 'products.product.add_to_cart' | t }}\n                      {%- endif -%}\n                    </span>\n                    <span class=\"t4s-loading__spinner\" hidden>\n                      <svg\n                        width=\"16\"\n                        height=\"16\"\n                        hidden\n                        class=\"t4s-svg-spinner\"\n                        focusable=\"false\"\n                        role=\"presentation\"\n                        viewBox=\"0 0 66 66\"\n                        xmlns=\"http://www.w3.org/2000/svg\"\n                      >\n                        <circle class=\"t4s-path\" fill=\"none\" stroke-width=\"6\" cx=\"33\" cy=\"33\" r=\"30\"></circle>\n                      </svg>\n                    </span>\n                  </button>\n                {% else %}\n                  <a\n                    href=\"/account/login\"\n                    onclick=\"rememberPage(event)\"\n                    data-drawer-delay-\n                    data-drawer-options='{ \"id\": \"#t4s-login-sidebar\" }'\n                    class=\"atc-btn t4s-btn t4s-btn-base t4s-btn-style-default t4s-btn-color-dark t4s-w-100 t4s-justify-content-center t4s-btn-effect-sweep-to-right t4s-btn-loading__svg\"\n                  >\n                    <svg\n                      class=\"t4s-btn-icon\"\n                      viewBox=\"0 0 24 24\"\n                      style=\"margin-right:4px\"\n                    >\n                      <use xlink:href=\"#t4s-icon-atc\"></use>\n                    </svg>\n                    <span class=\"t4s-btn-atc_text\">Login to Shop</span>\n                    <span class=\"t4s-loading__spinner\" hidden=\"\">\n                      <svg\n                        width=\"16\"\n                        height=\"16\"\n                        hidden=\"\"\n                        class=\"t4s-svg-spinner\"\n                        focusable=\"false\"\n                        role=\"presentation\"\n                        viewBox=\"0 0 66 66\"\n                        xmlns=\"http://www.w3.org/2000/svg\"\n                      >\n                        <circle class=\"t4s-path\" fill=\"none\" stroke-width=\"6\" cx=\"33\" cy=\"33\" r=\"30\"></circle>\n                      </svg>\n                    </span>\n                  </a>\n                {% endif %}\n              {%- endif -%}\n            </div>\n            {%- if PR_buy_pr and type != 'main_sticky' %}\n              {{- form | payment_button -}}\n            {% endif -%}\n            {%- if settings.use_notify_me -%}\n              {% if customer -%}\n                <button\n                  data-class=\"t4s-mfp-btn-close-inline\"\n                  data-id=\"t4s-pr-popup__notify-stock\"\n                  data-storageid=\"notify-stock{{ current_variant.id }}\"\n                  data-mfp-src\n                  data-open-mfp-ajax\n                  class=\"t4s-pr__notify-stock{% if current_variant_available or current_variant == blank %} t4s-d-none{% endif %}\"\n                  type=\"button\"\n                  data-notify-stock-btn\n                  data-variant-id=\"{{ current_variant.id }}\"\n                  data-root-url=\"{{ routes.root_url }}\"\n                >\n                  {{ 'products.notify_stock.trigger' | t }}\n                </button>\n              {%- endif %}\n            {%- endif -%}\n            {%- if bk_stts.enable_wishlist or bk_stts.enable_compare -%}\n              <div class=\"t4s-pr__wis_cp\">\n                {%- render 't4s_wis_cp', product: product, bk_stts: bk_stts, disableTooltip: true -%}\n              </div>\n            {%- endif -%}\n          </div>\n        {%- endform -%}\n        {%- unless isProductDefault or type == 'main_sticky' -%}\n          <script type=\"application/json\" class=\"pr_variants_json\">\n            {{ shsd_product_variants | json }}\n          </script>\n          <script type=\"application/json\" class=\"pr_options_json\">\n            {{ shsd_product_options_with_values | json }}\n          </script>\n        {%- endunless -%}\n        {%- if bk_stts.ani != 'none' -%}\n          <link\n            href=\"{{ 'ani-atc.min.css' | asset_url }}\"\n            rel=\"stylesheet\"\n            media=\"print\"\n            onload=\"this.media='all'\"\n          >\n        {%- endif -%}\n      </div>\n    </div>\n  </div>\n\n  <script>\n    (function () {\n      'use strict';\n\n      function updateOptionInfo(container, selectedValue) {\n        var optionName = container.getAttribute('data-option-name');\n        if (!optionName) return;\n        optionName = optionName.toLowerCase();\n\n        var infoContainer = container.querySelector('[data-option-info-container=\"' + optionName + '\"]');\n        if (!infoContainer) return;\n\n        var valueHandle = selectedValue\n          .toLowerCase()\n          .replace(/\\s+/g, '-')\n          .replace(/[^a-z0-9-]/g, '');\n        var infoItems = infoContainer.querySelectorAll('.pfd-option-info-item');\n\n        infoItems.forEach(function (item) {\n          var itemValue = item.getAttribute('data-option-value');\n          item.style.display = itemValue === valueHandle ? '' : 'none';\n        });\n      }\n\n      function initOptionInfoHandler() {\n        var swatchContainers = document.querySelectorAll('[data-swatch-option]');\n\n        swatchContainers.forEach(function (container) {\n          // Method 1: MutationObserver for instant updates\n          var observer = new MutationObserver(function (mutations) {\n            mutations.forEach(function (mutation) {\n              if (mutation.type === 'attributes' && mutation.attributeName === 'class') {\n                var target = mutation.target;\n                if (target.classList.contains('is--selected') && target.hasAttribute('data-value')) {\n                  var selectedValue = target.getAttribute('data-value');\n                  updateOptionInfo(container, selectedValue);\n                }\n              }\n            });\n          });\n\n          observer.observe(container, {\n            attributes: true,\n            subtree: true,\n            attributeFilter: ['class'],\n          });\n\n          // Method 2: Backup click handler with small delay\n          var swatchItems = container.querySelectorAll('[data-swatch-item]');\n          swatchItems.forEach(function (swatch) {\n            swatch.addEventListener('click', function () {\n              var selectedValue = this.getAttribute('data-value');\n              if (!selectedValue) return;\n              setTimeout(function () {\n                updateOptionInfo(container, selectedValue);\n              }, 10);\n            });\n          });\n        });\n      }\n\n      if (document.readyState === 'loading') {\n        document.addEventListener('DOMContentLoaded', initOptionInfoHandler);\n      } else {\n        initOptionInfoHandler();\n      }\n\n      document.addEventListener('shopify:section:load', initOptionInfoHandler);\n    })();\n  </script>\n</div>\n{%- if PR_buy_pr and current_variant_available != true and type != 'main_sticky' -%}\n  <style>\n    #t4s-callBackVariant{{ product_form_id }} .shopify-payment-button { display: none;}\n  </style>\n{% endif -%}\n",
              "reasoning": "Replace the second problematic comment block containing nested Liquid unless/if tags with a safe balanced comment containing only HTML comment text, eliminating the linter mismatched-tag error."
            },
            "result": "(no result received)",
            "isError": true,
            "elapsedMs": 0
          },
          {
            "name": "edit_lines",
            "id": "toolu_01YJ8mq8WVNK2Y2LFJKzSxdK",
            "input": {
              "filePath": "snippets/product-form-dynamic.liquid",
              "startLine": 1054,
              "endLine": 1054,
              "newContent": "            {%- comment -%}<div data-incoming__mess class=\"t4s-incoming__mess\"><!-- will_not_ship_until / will_be_in_stock_after with incoming date --></div>{%- endcomment -%}\n",
              "reasoning": "Replace the second problematic comment block containing nested Liquid unless/if tags with a safe balanced comment containing only HTML comment text, eliminating the linter mismatched-tag error."
            },
            "result": "(no result received)",
            "isError": true,
            "elapsedMs": 0
          }
        ],
        "reasoningBlocks": [],
        "responseText": "",
        "outcome": {
          "status": "applied",
          "changedFiles": 3,
          "changeSummary": "product-form-dynamic.liquid: Fix path-1 color swatch: add missing is--soldout class alongside is--out-of-stock, and fix badge class name from t4s-swatch__re-visible to t4s-swatch__restock-badge so JS luminance detection and CSS visibility rules target it correctly.",
          "validationIssues": [
            {
              "gate": "syntax",
              "errors": [
                "templates/page.ecom-deadfest2025.json:0 — Invalid JSON in template file",
                "templates/article.portfolio.json:0 — Invalid JSON in template file",
                "templates/page.ecom-deaducation-live-phoenix.json:0 — Invalid JSON in template file",
                "templates/index.ecom-preview-home.json:0 — Invalid JSON in template file",
                "templates/index.ecom-preview-page.json:0 — Invalid JSON in template file"
              ],
              "changesKept": true
            },
            {
              "gate": "theme_check",
              "errors": [
                "templates/page.ecom-deadfest2025.json — Invalid JSON in template file",
                "templates/article.portfolio.json — Invalid JSON in template file",
                "templates/page.ecom-deaducation-live-phoenix.json — Invalid JSON in template file",
                "templates/index.ecom-preview-home.json — Invalid JSON in template file",
                "templates/index.ecom-preview-page.json — Invalid JSON in template file"
              ],
              "changesKept": true
            }
          ]
        },
        "metrics": {
          "totalToolCalls": 16,
          "editToolCalls": 6,
          "readToolCalls": 9,
          "searchToolCalls": 0,
          "elapsedMs": 158789,
          "costCents": 36,
          "inputTokens": 99599,
          "outputTokens": 3991
        }
      },
      "analysis": {
        "diagnosis": {
          "summary": "Agent successfully completed the task (3 files changed) but encountered systematic tool execution failures in the final phase. Of 16 tool calls, the last 6 (calls 11-16) returned errors with no result received. These were all edit_lines and propose_code_edit calls targeting the Liquid file. The agent appears to have completed the core changes (markup, CSS, JS) but failed when attempting to fix linter-flagged comment blocks. Despite these errors, the change summary indicates the primary objective was achieved: fixing the color swatch classes (is--soldout, t4s-swatch__restock-badge).",
          "rootCause": "Tool executor (lib/agents/tools/v2-tool-executor.ts) or underlying file write layer failed silently on edit_lines calls 12, 14, 16 and propose_code_edit calls 11, 13, 15. The error pattern suggests either: (1) file locking or concurrent write conflict, (2) invalid line range specification in edit_lines payload, (3) tool schema validation rejecting the newContent, or (4) downstream file system error not surfaced to coordinator. The coordinator did not implement retry logic or escalation for consecutive tool failures.",
          "agentBehavior": "Agent read the three files 9 times (calls 1-9), identified linter issues in the Liquid file (call 10), then attempted 6 consecutive edits to fix comment block syntax. When edits failed, the agent did not: (a) re-read the file to verify state, (b) request a second opinion or run_review, (c) adjust strategy or reduce scope, or (d) escalate to human. Instead, it continued attempting edits without observable feedback loop. The agent eventually terminated after 16 calls and 159s, reporting success despite unresolved tool errors."
        },
        "recommendations": [
          {
            "priority": "critical",
            "category": "coordinator",
            "title": "Implement tool execution error recovery and escalation",
            "description": "The coordinator must detect consecutive tool failures (2+ in a row) and trigger one of: (1) re-read the affected file to verify state and retry with corrected payload, (2) request run_review to validate the file state, or (3) escalate to human with explicit error context. Currently, tool errors are logged but do not affect iteration strategy.",
            "targetFile": "lib/agents/coordinator-v2.ts",
            "targetArea": "Main loop iteration (think -> tool -> observe), error handling branch after tool execution",
            "suggestedChange": "After tool execution, check if result.error is set. If error count >= 2 for the same file in last 3 iterations, branch to: (a) call read_lines to re-verify file state, or (b) if already re-read, call run_review to validate, or (c) if review also fails, set escalation flag and halt gracefully. Log error context including tool name, file, line range, and error message to context for human review."
          },
          {
            "priority": "high",
            "category": "tools",
            "title": "Add line range validation and conflict detection to edit_lines",
            "description": "edit_lines calls 12, 14, 16 failed with no error message. The tool executor must validate: (1) line range exists in file before attempting write, (2) line count matches expected content, (3) no concurrent writes are in flight. If validation fails, return explicit error with line numbers and actual file state.",
            "targetFile": "lib/agents/tools/v2-tool-executor.ts",
            "targetArea": "edit_lines handler, before file write operation",
            "suggestedChange": "Before executing edit_lines: (1) read the file fresh to confirm lineStart and lineEnd are within bounds, (2) verify the number of lines to replace matches newContent split by newline, (3) check for pending writes in coordinator state, (4) if any validation fails, return {error: 'line_range_invalid | line_count_mismatch | write_conflict', details: {expectedLines, actualLines, fileSize}} instead of silent failure."
          },
          {
            "priority": "high",
            "category": "validation",
            "title": "Validate propose_code_edit and edit_lines payloads before execution",
            "description": "Calls 11 and 13 (propose_code_edit) returned errors with no result. These should have been validated against tool schema (filePath, reasoning required; newContent optional for propose). If schema validation fails, the tool executor must return a clear error, not silently fail.",
            "targetFile": "lib/agents/tools/v2-tool-definitions.ts",
            "targetArea": "Tool schema for propose_code_edit and edit_lines, input validation",
            "suggestedChange": "Add explicit validation in tool definition: for propose_code_edit, require {filePath, reasoning}; for edit_lines, require {filePath, newContent, [optional] startLine, [optional] endLine}. If validation fails, return {error: 'schema_validation_failed', missingFields: [...], providedFields: [...]}. Ensure all tool definitions include explicit error return type in schema."
          },
          {
            "priority": "high",
            "category": "prompt",
            "title": "Enhance PM prompt with error recovery and file state verification instructions",
            "description": "The PM prompt (v2-pm-prompt.ts) does not instruct the agent to verify file state after failed edits or to escalate gracefully. After tool errors, the agent should be prompted to re-read the file, check the actual state, and either retry with corrected payload or request run_review.",
            "targetFile": "lib/agents/prompts/v2-pm-prompt.ts",
            "targetArea": "Tool usage instructions section, error handling guidance",
            "suggestedChange": "Add instruction: 'If an edit_lines or propose_code_edit call returns an error or no result, immediately call read_lines on the same file to verify current state. Compare the actual file content with your expected state. If the file was partially modified, adjust your next edit to account for the new line numbers. If the file is unchanged, request run_review to validate the edit payload. Do not retry the same edit more than once without re-reading first.'"
          },
          {
            "priority": "high",
            "category": "coordinator",
            "title": "Add stagnation detection for repeated tool failures on same file",
            "description": "The agent made 6 consecutive edit attempts on snippets/product-form-dynamic.liquid (calls 11-16) with all failing. Stagnation detection should trigger after 2-3 failed attempts on the same file to prevent wasted iterations.",
            "targetFile": "lib/agents/coordinator-v2.ts",
            "targetArea": "Stagnation detection logic, iteration loop condition",
            "suggestedChange": "Track failed tool calls per file in coordinator state: {filePath: failureCount}. If failureCount >= 3 for the same file, halt iteration and escalate with message: 'Tool executor unable to modify {filePath} after 3 attempts. File may be locked, have schema conflicts, or be in an invalid state. Escalating to human review.' Include last 3 tool calls and their error context."
          },
          {
            "priority": "medium",
            "category": "context",
            "title": "Preserve and surface tool error details in context for PM reasoning",
            "description": "Tool errors (calls 11-16) are not captured in 'Agent Reasoning' section. The PM cannot reason about why edits failed or adjust strategy if error context is not available in the iteration history.",
            "targetFile": "lib/agents/coordinator-v2.ts",
            "targetArea": "Context building after tool execution, reasoning block construction",
            "suggestedChange": "After each tool execution, if result.error is set, append to reasoning context: {iteration: N, tool: toolName, filePath, error: result.error, details: result.details, suggestion: 'Consider re-reading file or requesting review'}. Include last 3 error iterations in PM context so it can reason about cumulative failures."
          },
          {
            "priority": "medium",
            "category": "strategy",
            "title": "Adjust GOD_MODE strategy to include graceful degradation on tool failures",
            "description": "GOD_MODE strategy selected for COMPLEX tier should be robust to tool failures. Currently, it does not degrade to HYBRID or escalate when tools fail repeatedly. The strategy should include a fallback: if edit_lines fails 2+ times, switch to run_review + run_specialist for validation.",
            "targetFile": "lib/agents/strategy.ts",
            "targetArea": "GOD_MODE strategy definition, failure handling",
            "suggestedChange": "In GOD_MODE strategy, add condition: if (failedToolCount >= 2 && failedToolCount % 3 === 0) { switch to run_review to validate file state and get specialist opinion on next steps }. This prevents GOD_MODE from blindly retrying failing edits."
          },
          {
            "priority": "low",
            "category": "tools",
            "title": "Log tool execution metrics and error rates for observability",
            "description": "The transcript shows 16 tool calls but no breakdown of success/failure rates or error categories. This makes it hard to diagnose systemic issues. Tool executor should log success rate per tool type.",
            "targetFile": "lib/agents/tools/v2-tool-executor.ts",
            "targetArea": "Tool execution summary, logging",
            "suggestedChange": "After each tool execution, log: {toolName, filePath, success: boolean, duration_ms, errorType: null | 'schema_validation_failed' | 'line_range_invalid' | 'write_conflict' | 'unknown'}. At coordinator end, log summary: {totalCalls, successCount, failureCount, failureRateByTool: {toolName: rate}}."
          }
        ]
      }
    }
  ],
  "summary": {
    "passRate": "1/1 (100%)",
    "avgToolCalls": 16,
    "avgTimeSeconds": 159,
    "totalCostCents": 36,
    "failureReasons": []
  },
  "aggregateAnalysis": {
    "diagnosis": {
      "summary": "Single run achieved 100% pass rate (3 files modified, 16 tools executed) but exhibited systematic tool result handling failures: 6 consecutive propose_code_edit/edit_lines pairs reported '(no result received)' errors despite task completion. This indicates a result-parsing or async-handling issue in the tool executor layer that does not prevent task success but creates false negative signals.",
      "rootCause": "Tool executor (lib/agents/tools/v2-tool-executor.ts) or coordinator result-handling logic fails to capture/parse results from propose_code_edit and edit_lines tools, even when underlying operations succeed. The agent continues iteration and completes the task, suggesting the actual edits are applied but the returned result object is malformed, null, or not properly awaited.",
      "agentBehavior": "Agent successfully executed the multi-layer task (Liquid markup + CSS + JS modifications across 3 files) within budget (16 tools, 159s). Despite 6 reported 'no result received' errors on code editing tools, the agent: (1) maintained iteration momentum, (2) did not enter stagnation/retry loops, (3) completed all required edits. This suggests result-handling errors are cosmetic (logging/return value issues) rather than blocking execution failures."
    },
    "patterns": {
      "consistentFailureMode": "propose_code_edit and edit_lines tools consistently report '(no result received)' in result field, appearing in 6/16 tool invocations. Pattern: propose_code_edit → edit_lines → (no result) → propose_code_edit → edit_lines → (no result), repeating 3 times. All 6 failures occur in the code-editing phase after file reads succeeded.",
      "intermittentIssues": [
        "Result capture failure isolated to propose_code_edit/edit_lines pair (0% success rate on result reporting, 100% success on actual edits)",
        "No intermittent issues detected across runs (only 1 run available); pattern appears deterministic"
      ],
      "toolUsageAntiPatterns": [
        "Redundant read_lines calls: 9 read_lines invocations before any edits attempted; agent reads product-form-dynamic.liquid, product-form-dynamic.css, and product-form-dynamic.js multiple times (likely context-building for multi-layer understanding, not anti-pattern)",
        "Result-handling gap: propose_code_edit followed immediately by edit_lines without defensive checks for result validity; no fallback or retry logic when result is null",
        "Missing result validation: Tool executor does not log or validate result object structure before returning to coordinator"
      ],
      "contextGaps": [
        "product.metafield.custom_values schema not explicitly read before implementation (agent inferred structure from task description)",
        "Variant option1 availability data structure not pre-loaded; agent may have inferred from Shopify knowledge in PM prompt rather than examining actual product data structure",
        "CSS contrast requirements (background-aware text over swatch images) not validated against existing theme CSS variables or computed styles"
      ]
    },
    "recommendations": [
      {
        "priority": "critical",
        "category": "tools",
        "title": "Fix result-handling in propose_code_edit and edit_lines tool executors",
        "description": "The tool executor returns '(no result received)' for propose_code_edit and edit_lines despite successful execution. Root cause is likely: (1) async/await mismatch in v2-tool-executor.ts run_specialist or run_review calls, (2) result object not properly serialized from specialist response, or (3) error in result extraction from LLM response. Add defensive logging, null checks, and proper promise resolution.",
        "targetFile": "lib/agents/tools/v2-tool-executor.ts",
        "targetArea": "run_specialist and run_review function implementations; result parsing and return statements",
        "suggestedChange": "Wrap run_specialist/run_review calls with explicit result validation: check if result is null/undefined, log full response object before parsing, ensure Promise.all or sequential await properly captures all tool results. Add try-catch with detailed error logging around result extraction. Verify that edit_lines results are captured from the specialist response JSON, not lost in async chain."
      },
      {
        "priority": "high",
        "category": "coordinator",
        "title": "Add result-validation gate before iteration continuation",
        "description": "Coordinator should detect when tool results are malformed (no result received) and either retry the tool or escalate. Currently, agent continues despite result failures, masking underlying issues. Add validation gate that checks result.success or result.content is non-null before advancing iteration.",
        "targetFile": "lib/agents/coordinator-v2.ts",
        "targetArea": "Main loop iteration; tool result handling after tool executor returns",
        "suggestedChange": "After tool executor returns, validate result structure: if result is null, undefined, or missing success/content fields, log warning with tool name and request, optionally retry (up to 2 retries), or escalate to PM for decision. This prevents silent failures and provides visibility into tool executor bugs."
      },
      {
        "priority": "high",
        "category": "prompt",
        "title": "Enhance PM prompt with explicit multi-file coordination instructions",
        "description": "Task required coordinating changes across 3 files (Liquid, CSS, JS) with interdependencies (CSS classes referenced in Liquid, JS selectors matching CSS). PM prompt should include explicit guidance: (1) read all 3 files before proposing edits, (2) validate class/selector naming consistency, (3) document data-flow assumptions (e.g., variant option1 structure, metafield schema).",
        "targetFile": "lib/agents/prompts/v2-pm-prompt.ts",
        "targetArea": "Tool usage section; multi-file task guidance",
        "suggestedChange": "Add section: 'For multi-file tasks: (1) Scout and read all target files to understand dependencies before editing. (2) When proposing edits to Liquid markup, CSS, and JS, ensure class names and selectors are consistent across all three files. (3) For data-dependent features (variant options, metafields), explicitly read or confirm the data structure before implementing logic.'"
      },
      {
        "priority": "high",
        "category": "context",
        "title": "Preload product data schema and metafield structure into context",
        "description": "Agent implemented custom_values metafield filtering without explicitly reading product metafield definitions. For Shopify-specific tasks, context should include: (1) standard product metafield namespaces/keys, (2) variant option structure (option1, option2, option3), (3) available/unavailable status fields. This reduces inference errors and speeds up execution.",
        "targetFile": "lib/agents/theme-map/lookup.ts or lib/agents/orchestration-policy.ts",
        "targetArea": "Context building for Shopify product template tasks",
        "suggestedChange": "When task involves product variants or metafields, automatically include in context: (1) product.variants schema snippet, (2) metafield access patterns (product.metafields.custom.key), (3) availability check patterns (variant.available, product.available). Store as cached context snippet in theme-map."
      },
      {
        "priority": "medium",
        "category": "validation",
        "title": "Add CSS contrast validation gate for accessibility requirements",
        "description": "Task required 'text contrast is background-aware over swatch images' but agent did not validate generated CSS against contrast standards. Add post-edit validation: for CSS rules affecting text over images, check for sufficient contrast or explicit use of text-shadow/background properties.",
        "targetFile": "lib/agents/orchestration-policy.ts",
        "targetArea": "Validation rules for CSS edits; accessibility checks",
        "suggestedChange": "Add validation rule: 'For CSS rules with text over background-image or swatch elements, require either: (1) explicit background-color with sufficient contrast ratio, (2) text-shadow for readability, or (3) filter/backdrop effects. Flag for review if not met.'"
      },
      {
        "priority": "medium",
        "category": "tools",
        "title": "Add result-integrity checks to tool definitions",
        "description": "propose_code_edit and edit_lines tool schemas should include explicit result field requirements and error handling. Currently, no schema validation for result object structure.",
        "targetFile": "lib/agents/tools/v2-tool-definitions.ts",
        "targetArea": "propose_code_edit and edit_lines tool definitions; result schema",
        "suggestedChange": "Add to tool schemas: 'Result must include {success: boolean, content: string, lineStart: number, lineEnd: number, error?: string}. If any field is missing, tool executor must return explicit error with full response logged.'"
      },
      {
        "priority": "low",
        "category": "strategy",
        "title": "Consider HYBRID strategy for multi-file coordination tasks",
        "description": "Current run used single-stream coordinator successfully, but multi-file tasks with interdependencies (Liquid + CSS + JS) could benefit from parallel file reading via HYBRID strategy to reduce iteration count. Current approach (9 sequential reads) consumed 9/16 tools before editing started.",
        "targetFile": "lib/agents/strategy.ts",
        "targetArea": "Strategy selection logic; tier-based routing",
        "suggestedChange": "For tasks with 3+ files requiring edits, default to HYBRID strategy if tier supports it. This enables parallel read_lines calls via run_specialist, reducing sequential read iterations."
      }
    ]
  }
}